(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}})();const Pf=()=>{};var wc={};const _u=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},kf=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const o=n[t++];e[r++]=String.fromCharCode((s&31)<<6|o&63)}else if(s>239&&s<365){const o=n[t++],a=n[t++],l=n[t++],h=((s&7)<<18|(o&63)<<12|(a&63)<<6|l&63)-65536;e[r++]=String.fromCharCode(55296+(h>>10)),e[r++]=String.fromCharCode(56320+(h&1023))}else{const o=n[t++],a=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(o&63)<<6|a&63)}}return e.join("")},yu={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const o=n[s],a=s+1<n.length,l=a?n[s+1]:0,h=s+2<n.length,d=h?n[s+2]:0,p=o>>2,_=(o&3)<<4|l>>4;let E=(l&15)<<2|d>>6,C=d&63;h||(C=64,a||(E=64)),r.push(t[p],t[_],t[E],t[C])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(_u(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):kf(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const o=t[n.charAt(s++)],l=s<n.length?t[n.charAt(s)]:0;++s;const d=s<n.length?t[n.charAt(s)]:64;++s;const _=s<n.length?t[n.charAt(s)]:64;if(++s,o==null||l==null||d==null||_==null)throw new Nf;const E=o<<2|l>>4;if(r.push(E),d!==64){const C=l<<4&240|d>>2;if(r.push(C),_!==64){const k=d<<6&192|_;r.push(k)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class Nf extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Df=function(n){const e=_u(n);return yu.encodeByteArray(e,!0)},Rs=function(n){return Df(n).replace(/\./g,"")},Eu=function(n){try{return yu.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function Vf(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const Of=()=>Vf().__FIREBASE_DEFAULTS__,Mf=()=>{if(typeof process>"u"||typeof wc>"u")return;const n=wc.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},Lf=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&Eu(n[1]);return e&&JSON.parse(e)},Hs=()=>{try{return Pf()||Of()||Mf()||Lf()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Iu=n=>Hs()?.emulatorHosts?.[n],xf=n=>{const e=Iu(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},vu=()=>Hs()?.config,Tu=n=>Hs()?.[`_${n}`];class Ff{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}function Fn(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function wu(n){return(await fetch(n,{credentials:"include"})).ok}function Uf(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,o=n.sub||n.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a={iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}},...n};return[Rs(JSON.stringify(t)),Rs(JSON.stringify(a)),""].join(".")}const mr={};function Bf(){const n={prod:[],emulator:[]};for(const e of Object.keys(mr))mr[e]?n.emulator.push(e):n.prod.push(e);return n}function jf(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let Ac=!1;function Au(n,e){if(typeof window>"u"||typeof document>"u"||!Fn(window.location.host)||mr[n]===e||mr[n]||Ac)return;mr[n]=e;function t(E){return`__firebase__banner__${E}`}const r="__firebase__banner",o=Bf().prod.length>0;function a(){const E=document.getElementById(r);E&&E.remove()}function l(E){E.style.display="flex",E.style.background="#7faaf0",E.style.position="fixed",E.style.bottom="5px",E.style.left="5px",E.style.padding=".5em",E.style.borderRadius="5px",E.style.alignItems="center"}function h(E,C){E.setAttribute("width","24"),E.setAttribute("id",C),E.setAttribute("height","24"),E.setAttribute("viewBox","0 0 24 24"),E.setAttribute("fill","none"),E.style.marginLeft="-6px"}function d(){const E=document.createElement("span");return E.style.cursor="pointer",E.style.marginLeft="16px",E.style.fontSize="24px",E.innerHTML=" &times;",E.onclick=()=>{Ac=!0,a()},E}function p(E,C){E.setAttribute("id",C),E.innerText="Learn more",E.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",E.setAttribute("target","__blank"),E.style.paddingLeft="5px",E.style.textDecoration="underline"}function _(){const E=jf(r),C=t("text"),k=document.getElementById(C)||document.createElement("span"),O=t("learnmore"),M=document.getElementById(O)||document.createElement("a"),G=t("preprendIcon"),z=document.getElementById(G)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(E.created){const J=E.element;l(J),p(M,O);const Oe=d();h(z,G),J.append(z,k,M,Oe),document.body.appendChild(J)}o?(k.innerText="Preview backend disconnected.",z.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(z.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,k.innerText="Preview backend running in this workspace."),k.setAttribute("id",C)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",_):_()}function Se(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function $f(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Se())}function qf(){const n=Hs()?.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function Hf(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function Gf(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function Wf(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function zf(){const n=Se();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function Kf(){return!qf()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Qf(){try{return typeof indexedDB=="object"}catch{return!1}}function Yf(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{e(s.error?.message||"")}}catch(t){e(t)}})}const Jf="FirebaseError";class dt extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=Jf,Object.setPrototypeOf(this,dt.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Or.prototype.create)}}class Or{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,o=this.errors[e],a=o?Xf(o,r):"Error",l=`${this.serviceName}: ${a} (${s}).`;return new dt(s,l,r)}}function Xf(n,e){return n.replace(Zf,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const Zf=/\{\$([^}]+)}/g;function ep(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function tn(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const o=n[s],a=e[s];if(Rc(o)&&Rc(a)){if(!tn(o,a))return!1}else if(o!==a)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function Rc(n){return n!==null&&typeof n=="object"}function Mr(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function tp(n,e){const t=new np(n,e);return t.subscribe.bind(t)}class np{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");rp(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=xi),s.error===void 0&&(s.error=xi),s.complete===void 0&&(s.complete=xi);const o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),o}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function rp(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function xi(){}function Ee(n){return n&&n._delegate?n._delegate:n}class nn{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const Yt="[DEFAULT]";class sp{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new Ff;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e?.identifier),r=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(op(e))try{this.getOrInitializeService({instanceIdentifier:Yt})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const o=this.getOrInitializeService({instanceIdentifier:s});r.resolve(o)}catch{}}}}clearInstance(e=Yt){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Yt){return this.instances.has(e)}getOptions(e=Yt){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[o,a]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(o);r===l&&a.resolve(s)}return s}onInit(e,t){const r=this.normalizeInstanceIdentifier(t),s=this.onInitCallbacks.get(r)??new Set;s.add(e),this.onInitCallbacks.set(r,s);const o=this.instances.get(r);return o&&e(o,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:ip(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Yt){return this.component?this.component.multipleInstances?e:Yt:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function ip(n){return n===Yt?void 0:n}function op(n){return n.instantiationMode==="EAGER"}class ap{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new sp(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}var $;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})($||($={}));const cp={debug:$.DEBUG,verbose:$.VERBOSE,info:$.INFO,warn:$.WARN,error:$.ERROR,silent:$.SILENT},lp=$.INFO,up={[$.DEBUG]:"log",[$.VERBOSE]:"log",[$.INFO]:"info",[$.WARN]:"warn",[$.ERROR]:"error"},hp=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=up[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Co{constructor(e){this.name=e,this._logLevel=lp,this._logHandler=hp,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in $))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?cp[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,$.DEBUG,...e),this._logHandler(this,$.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,$.VERBOSE,...e),this._logHandler(this,$.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,$.INFO,...e),this._logHandler(this,$.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,$.WARN,...e),this._logHandler(this,$.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,$.ERROR,...e),this._logHandler(this,$.ERROR,...e)}}const dp=(n,e)=>e.some(t=>n instanceof t);let Sc,Cc;function fp(){return Sc||(Sc=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function pp(){return Cc||(Cc=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Ru=new WeakMap,Xi=new WeakMap,Su=new WeakMap,Fi=new WeakMap,bo=new WeakMap;function gp(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",o),n.removeEventListener("error",a)},o=()=>{t(kt(n.result)),s()},a=()=>{r(n.error),s()};n.addEventListener("success",o),n.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&Ru.set(t,n)}).catch(()=>{}),bo.set(e,n),e}function mp(n){if(Xi.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",o),n.removeEventListener("error",a),n.removeEventListener("abort",a)},o=()=>{t(),s()},a=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",o),n.addEventListener("error",a),n.addEventListener("abort",a)});Xi.set(n,e)}let Zi={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return Xi.get(n);if(e==="objectStoreNames")return n.objectStoreNames||Su.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return kt(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function _p(n){Zi=n(Zi)}function yp(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(Ui(this),e,...t);return Su.set(r,e.sort?e.sort():[e]),kt(r)}:pp().includes(n)?function(...e){return n.apply(Ui(this),e),kt(Ru.get(this))}:function(...e){return kt(n.apply(Ui(this),e))}}function Ep(n){return typeof n=="function"?yp(n):(n instanceof IDBTransaction&&mp(n),dp(n,fp())?new Proxy(n,Zi):n)}function kt(n){if(n instanceof IDBRequest)return gp(n);if(Fi.has(n))return Fi.get(n);const e=Ep(n);return e!==n&&(Fi.set(n,e),bo.set(e,n)),e}const Ui=n=>bo.get(n);function Ip(n,e,{blocked:t,upgrade:r,blocking:s,terminated:o}={}){const a=indexedDB.open(n,e),l=kt(a);return r&&a.addEventListener("upgradeneeded",h=>{r(kt(a.result),h.oldVersion,h.newVersion,kt(a.transaction),h)}),t&&a.addEventListener("blocked",h=>t(h.oldVersion,h.newVersion,h)),l.then(h=>{o&&h.addEventListener("close",()=>o()),s&&h.addEventListener("versionchange",d=>s(d.oldVersion,d.newVersion,d))}).catch(()=>{}),l}const vp=["get","getKey","getAll","getAllKeys","count"],Tp=["put","add","delete","clear"],Bi=new Map;function bc(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Bi.get(e))return Bi.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=Tp.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||vp.includes(t)))return;const o=async function(a,...l){const h=this.transaction(a,s?"readwrite":"readonly");let d=h.store;return r&&(d=d.index(l.shift())),(await Promise.all([d[t](...l),s&&h.done]))[0]};return Bi.set(e,o),o}_p(n=>({...n,get:(e,t,r)=>bc(e,t)||n.get(e,t,r),has:(e,t)=>!!bc(e,t)||n.has(e,t)}));class wp{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(Ap(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function Ap(n){return n.getComponent()?.type==="VERSION"}const eo="@firebase/app",Pc="0.14.7";const at=new Co("@firebase/app"),Rp="@firebase/app-compat",Sp="@firebase/analytics-compat",Cp="@firebase/analytics",bp="@firebase/app-check-compat",Pp="@firebase/app-check",kp="@firebase/auth",Np="@firebase/auth-compat",Dp="@firebase/database",Vp="@firebase/data-connect",Op="@firebase/database-compat",Mp="@firebase/functions",Lp="@firebase/functions-compat",xp="@firebase/installations",Fp="@firebase/installations-compat",Up="@firebase/messaging",Bp="@firebase/messaging-compat",jp="@firebase/performance",$p="@firebase/performance-compat",qp="@firebase/remote-config",Hp="@firebase/remote-config-compat",Gp="@firebase/storage",Wp="@firebase/storage-compat",zp="@firebase/firestore",Kp="@firebase/ai",Qp="@firebase/firestore-compat",Yp="firebase",Jp="12.8.0";const to="[DEFAULT]",Xp={[eo]:"fire-core",[Rp]:"fire-core-compat",[Cp]:"fire-analytics",[Sp]:"fire-analytics-compat",[Pp]:"fire-app-check",[bp]:"fire-app-check-compat",[kp]:"fire-auth",[Np]:"fire-auth-compat",[Dp]:"fire-rtdb",[Vp]:"fire-data-connect",[Op]:"fire-rtdb-compat",[Mp]:"fire-fn",[Lp]:"fire-fn-compat",[xp]:"fire-iid",[Fp]:"fire-iid-compat",[Up]:"fire-fcm",[Bp]:"fire-fcm-compat",[jp]:"fire-perf",[$p]:"fire-perf-compat",[qp]:"fire-rc",[Hp]:"fire-rc-compat",[Gp]:"fire-gcs",[Wp]:"fire-gcs-compat",[zp]:"fire-fst",[Qp]:"fire-fst-compat",[Kp]:"fire-vertex","fire-js":"fire-js",[Yp]:"fire-js-all"};const Ss=new Map,Zp=new Map,no=new Map;function kc(n,e){try{n.container.addComponent(e)}catch(t){at.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function Pn(n){const e=n.name;if(no.has(e))return at.debug(`There were multiple attempts to register component ${e}.`),!1;no.set(e,n);for(const t of Ss.values())kc(t,n);for(const t of Zp.values())kc(t,n);return!0}function Po(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function Be(n){return n==null?!1:n.settings!==void 0}const eg={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Nt=new Or("app","Firebase",eg);class tg{constructor(e,t,r){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new nn("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Nt.create("app-deleted",{appName:this._name})}}const Un=Jp;function Cu(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r={name:to,automaticDataCollectionEnabled:!0,...e},s=r.name;if(typeof s!="string"||!s)throw Nt.create("bad-app-name",{appName:String(s)});if(t||(t=vu()),!t)throw Nt.create("no-options");const o=Ss.get(s);if(o){if(tn(t,o.options)&&tn(r,o.config))return o;throw Nt.create("duplicate-app",{appName:s})}const a=new ap(s);for(const h of no.values())a.addComponent(h);const l=new tg(t,r,a);return Ss.set(s,l),l}function bu(n=to){const e=Ss.get(n);if(!e&&n===to&&vu())return Cu();if(!e)throw Nt.create("no-app",{appName:n});return e}function Dt(n,e,t){let r=Xp[n]??n;t&&(r+=`-${t}`);const s=r.match(/\s|\//),o=e.match(/\s|\//);if(s||o){const a=[`Unable to register library "${r}" with version "${e}":`];s&&a.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),at.warn(a.join(" "));return}Pn(new nn(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}const ng="firebase-heartbeat-database",rg=1,wr="firebase-heartbeat-store";let ji=null;function Pu(){return ji||(ji=Ip(ng,rg,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(wr)}catch(t){console.warn(t)}}}}).catch(n=>{throw Nt.create("idb-open",{originalErrorMessage:n.message})})),ji}async function sg(n){try{const t=(await Pu()).transaction(wr),r=await t.objectStore(wr).get(ku(n));return await t.done,r}catch(e){if(e instanceof dt)at.warn(e.message);else{const t=Nt.create("idb-get",{originalErrorMessage:e?.message});at.warn(t.message)}}}async function Nc(n,e){try{const r=(await Pu()).transaction(wr,"readwrite");await r.objectStore(wr).put(e,ku(n)),await r.done}catch(t){if(t instanceof dt)at.warn(t.message);else{const r=Nt.create("idb-set",{originalErrorMessage:t?.message});at.warn(r.message)}}}function ku(n){return`${n.name}!${n.options.appId}`}const ig=1024,og=30;class ag{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new lg(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){try{const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=Dc();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(s=>s.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:t}),this._heartbeatsCache.heartbeats.length>og){const s=ug(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(s,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){at.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=Dc(),{heartbeatsToSend:t,unsentEntries:r}=cg(this._heartbeatsCache.heartbeats),s=Rs(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(e){return at.warn(e),""}}}function Dc(){return new Date().toISOString().substring(0,10)}function cg(n,e=ig){const t=[];let r=n.slice();for(const s of n){const o=t.find(a=>a.agent===s.agent);if(o){if(o.dates.push(s.date),Vc(t)>e){o.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),Vc(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class lg{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Qf()?Yf().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await sg(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return Nc(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return Nc(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function Vc(n){return Rs(JSON.stringify({version:2,heartbeats:n})).length}function ug(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}function hg(n){Pn(new nn("platform-logger",e=>new wp(e),"PRIVATE")),Pn(new nn("heartbeat",e=>new ag(e),"PRIVATE")),Dt(eo,Pc,n),Dt(eo,Pc,"esm2020"),Dt("fire-js","")}hg("");var dg="firebase",fg="12.8.0";Dt(dg,fg,"app");var Oc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var Vt,Nu;(function(){var n;function e(v,g){function y(){}y.prototype=g.prototype,v.F=g.prototype,v.prototype=new y,v.prototype.constructor=v,v.D=function(T,I,A){for(var m=Array(arguments.length-2),Ne=2;Ne<arguments.length;Ne++)m[Ne-2]=arguments[Ne];return g.prototype[I].apply(T,m)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,t),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(v,g,y){y||(y=0);const T=Array(16);if(typeof g=="string")for(var I=0;I<16;++I)T[I]=g.charCodeAt(y++)|g.charCodeAt(y++)<<8|g.charCodeAt(y++)<<16|g.charCodeAt(y++)<<24;else for(I=0;I<16;++I)T[I]=g[y++]|g[y++]<<8|g[y++]<<16|g[y++]<<24;g=v.g[0],y=v.g[1],I=v.g[2];let A=v.g[3],m;m=g+(A^y&(I^A))+T[0]+3614090360&4294967295,g=y+(m<<7&4294967295|m>>>25),m=A+(I^g&(y^I))+T[1]+3905402710&4294967295,A=g+(m<<12&4294967295|m>>>20),m=I+(y^A&(g^y))+T[2]+606105819&4294967295,I=A+(m<<17&4294967295|m>>>15),m=y+(g^I&(A^g))+T[3]+3250441966&4294967295,y=I+(m<<22&4294967295|m>>>10),m=g+(A^y&(I^A))+T[4]+4118548399&4294967295,g=y+(m<<7&4294967295|m>>>25),m=A+(I^g&(y^I))+T[5]+1200080426&4294967295,A=g+(m<<12&4294967295|m>>>20),m=I+(y^A&(g^y))+T[6]+2821735955&4294967295,I=A+(m<<17&4294967295|m>>>15),m=y+(g^I&(A^g))+T[7]+4249261313&4294967295,y=I+(m<<22&4294967295|m>>>10),m=g+(A^y&(I^A))+T[8]+1770035416&4294967295,g=y+(m<<7&4294967295|m>>>25),m=A+(I^g&(y^I))+T[9]+2336552879&4294967295,A=g+(m<<12&4294967295|m>>>20),m=I+(y^A&(g^y))+T[10]+4294925233&4294967295,I=A+(m<<17&4294967295|m>>>15),m=y+(g^I&(A^g))+T[11]+2304563134&4294967295,y=I+(m<<22&4294967295|m>>>10),m=g+(A^y&(I^A))+T[12]+1804603682&4294967295,g=y+(m<<7&4294967295|m>>>25),m=A+(I^g&(y^I))+T[13]+4254626195&4294967295,A=g+(m<<12&4294967295|m>>>20),m=I+(y^A&(g^y))+T[14]+2792965006&4294967295,I=A+(m<<17&4294967295|m>>>15),m=y+(g^I&(A^g))+T[15]+1236535329&4294967295,y=I+(m<<22&4294967295|m>>>10),m=g+(I^A&(y^I))+T[1]+4129170786&4294967295,g=y+(m<<5&4294967295|m>>>27),m=A+(y^I&(g^y))+T[6]+3225465664&4294967295,A=g+(m<<9&4294967295|m>>>23),m=I+(g^y&(A^g))+T[11]+643717713&4294967295,I=A+(m<<14&4294967295|m>>>18),m=y+(A^g&(I^A))+T[0]+3921069994&4294967295,y=I+(m<<20&4294967295|m>>>12),m=g+(I^A&(y^I))+T[5]+3593408605&4294967295,g=y+(m<<5&4294967295|m>>>27),m=A+(y^I&(g^y))+T[10]+38016083&4294967295,A=g+(m<<9&4294967295|m>>>23),m=I+(g^y&(A^g))+T[15]+3634488961&4294967295,I=A+(m<<14&4294967295|m>>>18),m=y+(A^g&(I^A))+T[4]+3889429448&4294967295,y=I+(m<<20&4294967295|m>>>12),m=g+(I^A&(y^I))+T[9]+568446438&4294967295,g=y+(m<<5&4294967295|m>>>27),m=A+(y^I&(g^y))+T[14]+3275163606&4294967295,A=g+(m<<9&4294967295|m>>>23),m=I+(g^y&(A^g))+T[3]+4107603335&4294967295,I=A+(m<<14&4294967295|m>>>18),m=y+(A^g&(I^A))+T[8]+1163531501&4294967295,y=I+(m<<20&4294967295|m>>>12),m=g+(I^A&(y^I))+T[13]+2850285829&4294967295,g=y+(m<<5&4294967295|m>>>27),m=A+(y^I&(g^y))+T[2]+4243563512&4294967295,A=g+(m<<9&4294967295|m>>>23),m=I+(g^y&(A^g))+T[7]+1735328473&4294967295,I=A+(m<<14&4294967295|m>>>18),m=y+(A^g&(I^A))+T[12]+2368359562&4294967295,y=I+(m<<20&4294967295|m>>>12),m=g+(y^I^A)+T[5]+4294588738&4294967295,g=y+(m<<4&4294967295|m>>>28),m=A+(g^y^I)+T[8]+2272392833&4294967295,A=g+(m<<11&4294967295|m>>>21),m=I+(A^g^y)+T[11]+1839030562&4294967295,I=A+(m<<16&4294967295|m>>>16),m=y+(I^A^g)+T[14]+4259657740&4294967295,y=I+(m<<23&4294967295|m>>>9),m=g+(y^I^A)+T[1]+2763975236&4294967295,g=y+(m<<4&4294967295|m>>>28),m=A+(g^y^I)+T[4]+1272893353&4294967295,A=g+(m<<11&4294967295|m>>>21),m=I+(A^g^y)+T[7]+4139469664&4294967295,I=A+(m<<16&4294967295|m>>>16),m=y+(I^A^g)+T[10]+3200236656&4294967295,y=I+(m<<23&4294967295|m>>>9),m=g+(y^I^A)+T[13]+681279174&4294967295,g=y+(m<<4&4294967295|m>>>28),m=A+(g^y^I)+T[0]+3936430074&4294967295,A=g+(m<<11&4294967295|m>>>21),m=I+(A^g^y)+T[3]+3572445317&4294967295,I=A+(m<<16&4294967295|m>>>16),m=y+(I^A^g)+T[6]+76029189&4294967295,y=I+(m<<23&4294967295|m>>>9),m=g+(y^I^A)+T[9]+3654602809&4294967295,g=y+(m<<4&4294967295|m>>>28),m=A+(g^y^I)+T[12]+3873151461&4294967295,A=g+(m<<11&4294967295|m>>>21),m=I+(A^g^y)+T[15]+530742520&4294967295,I=A+(m<<16&4294967295|m>>>16),m=y+(I^A^g)+T[2]+3299628645&4294967295,y=I+(m<<23&4294967295|m>>>9),m=g+(I^(y|~A))+T[0]+4096336452&4294967295,g=y+(m<<6&4294967295|m>>>26),m=A+(y^(g|~I))+T[7]+1126891415&4294967295,A=g+(m<<10&4294967295|m>>>22),m=I+(g^(A|~y))+T[14]+2878612391&4294967295,I=A+(m<<15&4294967295|m>>>17),m=y+(A^(I|~g))+T[5]+4237533241&4294967295,y=I+(m<<21&4294967295|m>>>11),m=g+(I^(y|~A))+T[12]+1700485571&4294967295,g=y+(m<<6&4294967295|m>>>26),m=A+(y^(g|~I))+T[3]+2399980690&4294967295,A=g+(m<<10&4294967295|m>>>22),m=I+(g^(A|~y))+T[10]+4293915773&4294967295,I=A+(m<<15&4294967295|m>>>17),m=y+(A^(I|~g))+T[1]+2240044497&4294967295,y=I+(m<<21&4294967295|m>>>11),m=g+(I^(y|~A))+T[8]+1873313359&4294967295,g=y+(m<<6&4294967295|m>>>26),m=A+(y^(g|~I))+T[15]+4264355552&4294967295,A=g+(m<<10&4294967295|m>>>22),m=I+(g^(A|~y))+T[6]+2734768916&4294967295,I=A+(m<<15&4294967295|m>>>17),m=y+(A^(I|~g))+T[13]+1309151649&4294967295,y=I+(m<<21&4294967295|m>>>11),m=g+(I^(y|~A))+T[4]+4149444226&4294967295,g=y+(m<<6&4294967295|m>>>26),m=A+(y^(g|~I))+T[11]+3174756917&4294967295,A=g+(m<<10&4294967295|m>>>22),m=I+(g^(A|~y))+T[2]+718787259&4294967295,I=A+(m<<15&4294967295|m>>>17),m=y+(A^(I|~g))+T[9]+3951481745&4294967295,v.g[0]=v.g[0]+g&4294967295,v.g[1]=v.g[1]+(I+(m<<21&4294967295|m>>>11))&4294967295,v.g[2]=v.g[2]+I&4294967295,v.g[3]=v.g[3]+A&4294967295}r.prototype.v=function(v,g){g===void 0&&(g=v.length);const y=g-this.blockSize,T=this.C;let I=this.h,A=0;for(;A<g;){if(I==0)for(;A<=y;)s(this,v,A),A+=this.blockSize;if(typeof v=="string"){for(;A<g;)if(T[I++]=v.charCodeAt(A++),I==this.blockSize){s(this,T),I=0;break}}else for(;A<g;)if(T[I++]=v[A++],I==this.blockSize){s(this,T),I=0;break}}this.h=I,this.o+=g},r.prototype.A=function(){var v=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);v[0]=128;for(var g=1;g<v.length-8;++g)v[g]=0;g=this.o*8;for(var y=v.length-8;y<v.length;++y)v[y]=g&255,g/=256;for(this.v(v),v=Array(16),g=0,y=0;y<4;++y)for(let T=0;T<32;T+=8)v[g++]=this.g[y]>>>T&255;return v};function o(v,g){var y=l;return Object.prototype.hasOwnProperty.call(y,v)?y[v]:y[v]=g(v)}function a(v,g){this.h=g;const y=[];let T=!0;for(let I=v.length-1;I>=0;I--){const A=v[I]|0;T&&A==g||(y[I]=A,T=!1)}this.g=y}var l={};function h(v){return-128<=v&&v<128?o(v,function(g){return new a([g|0],g<0?-1:0)}):new a([v|0],v<0?-1:0)}function d(v){if(isNaN(v)||!isFinite(v))return _;if(v<0)return M(d(-v));const g=[];let y=1;for(let T=0;v>=y;T++)g[T]=v/y|0,y*=4294967296;return new a(g,0)}function p(v,g){if(v.length==0)throw Error("number format error: empty string");if(g=g||10,g<2||36<g)throw Error("radix out of range: "+g);if(v.charAt(0)=="-")return M(p(v.substring(1),g));if(v.indexOf("-")>=0)throw Error('number format error: interior "-" character');const y=d(Math.pow(g,8));let T=_;for(let A=0;A<v.length;A+=8){var I=Math.min(8,v.length-A);const m=parseInt(v.substring(A,A+I),g);I<8?(I=d(Math.pow(g,I)),T=T.j(I).add(d(m))):(T=T.j(y),T=T.add(d(m)))}return T}var _=h(0),E=h(1),C=h(16777216);n=a.prototype,n.m=function(){if(O(this))return-M(this).m();let v=0,g=1;for(let y=0;y<this.g.length;y++){const T=this.i(y);v+=(T>=0?T:4294967296+T)*g,g*=4294967296}return v},n.toString=function(v){if(v=v||10,v<2||36<v)throw Error("radix out of range: "+v);if(k(this))return"0";if(O(this))return"-"+M(this).toString(v);const g=d(Math.pow(v,6));var y=this;let T="";for(;;){const I=Oe(y,g).g;y=G(y,I.j(g));let A=((y.g.length>0?y.g[0]:y.h)>>>0).toString(v);if(y=I,k(y))return A+T;for(;A.length<6;)A="0"+A;T=A+T}},n.i=function(v){return v<0?0:v<this.g.length?this.g[v]:this.h};function k(v){if(v.h!=0)return!1;for(let g=0;g<v.g.length;g++)if(v.g[g]!=0)return!1;return!0}function O(v){return v.h==-1}n.l=function(v){return v=G(this,v),O(v)?-1:k(v)?0:1};function M(v){const g=v.g.length,y=[];for(let T=0;T<g;T++)y[T]=~v.g[T];return new a(y,~v.h).add(E)}n.abs=function(){return O(this)?M(this):this},n.add=function(v){const g=Math.max(this.g.length,v.g.length),y=[];let T=0;for(let I=0;I<=g;I++){let A=T+(this.i(I)&65535)+(v.i(I)&65535),m=(A>>>16)+(this.i(I)>>>16)+(v.i(I)>>>16);T=m>>>16,A&=65535,m&=65535,y[I]=m<<16|A}return new a(y,y[y.length-1]&-2147483648?-1:0)};function G(v,g){return v.add(M(g))}n.j=function(v){if(k(this)||k(v))return _;if(O(this))return O(v)?M(this).j(M(v)):M(M(this).j(v));if(O(v))return M(this.j(M(v)));if(this.l(C)<0&&v.l(C)<0)return d(this.m()*v.m());const g=this.g.length+v.g.length,y=[];for(var T=0;T<2*g;T++)y[T]=0;for(T=0;T<this.g.length;T++)for(let I=0;I<v.g.length;I++){const A=this.i(T)>>>16,m=this.i(T)&65535,Ne=v.i(I)>>>16,Ht=v.i(I)&65535;y[2*T+2*I]+=m*Ht,z(y,2*T+2*I),y[2*T+2*I+1]+=A*Ht,z(y,2*T+2*I+1),y[2*T+2*I+1]+=m*Ne,z(y,2*T+2*I+1),y[2*T+2*I+2]+=A*Ne,z(y,2*T+2*I+2)}for(v=0;v<g;v++)y[v]=y[2*v+1]<<16|y[2*v];for(v=g;v<2*g;v++)y[v]=0;return new a(y,0)};function z(v,g){for(;(v[g]&65535)!=v[g];)v[g+1]+=v[g]>>>16,v[g]&=65535,g++}function J(v,g){this.g=v,this.h=g}function Oe(v,g){if(k(g))throw Error("division by zero");if(k(v))return new J(_,_);if(O(v))return g=Oe(M(v),g),new J(M(g.g),M(g.h));if(O(g))return g=Oe(v,M(g)),new J(M(g.g),g.h);if(v.g.length>30){if(O(v)||O(g))throw Error("slowDivide_ only works with positive integers.");for(var y=E,T=g;T.l(v)<=0;)y=Ue(y),T=Ue(T);var I=ge(y,1),A=ge(T,1);for(T=ge(T,2),y=ge(y,2);!k(T);){var m=A.add(T);m.l(v)<=0&&(I=I.add(y),A=m),T=ge(T,1),y=ge(y,1)}return g=G(v,I.j(g)),new J(I,g)}for(I=_;v.l(g)>=0;){for(y=Math.max(1,Math.floor(v.m()/g.m())),T=Math.ceil(Math.log(y)/Math.LN2),T=T<=48?1:Math.pow(2,T-48),A=d(y),m=A.j(g);O(m)||m.l(v)>0;)y-=T,A=d(y),m=A.j(g);k(A)&&(A=E),I=I.add(A),v=G(v,m)}return new J(I,v)}n.B=function(v){return Oe(this,v).h},n.and=function(v){const g=Math.max(this.g.length,v.g.length),y=[];for(let T=0;T<g;T++)y[T]=this.i(T)&v.i(T);return new a(y,this.h&v.h)},n.or=function(v){const g=Math.max(this.g.length,v.g.length),y=[];for(let T=0;T<g;T++)y[T]=this.i(T)|v.i(T);return new a(y,this.h|v.h)},n.xor=function(v){const g=Math.max(this.g.length,v.g.length),y=[];for(let T=0;T<g;T++)y[T]=this.i(T)^v.i(T);return new a(y,this.h^v.h)};function Ue(v){const g=v.g.length+1,y=[];for(let T=0;T<g;T++)y[T]=v.i(T)<<1|v.i(T-1)>>>31;return new a(y,v.h)}function ge(v,g){const y=g>>5;g%=32;const T=v.g.length-y,I=[];for(let A=0;A<T;A++)I[A]=g>0?v.i(A+y)>>>g|v.i(A+y+1)<<32-g:v.i(A+y);return new a(I,v.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,Nu=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.B,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=p,Vt=a}).apply(typeof Oc<"u"?Oc:typeof self<"u"?self:typeof window<"u"?window:{});var as=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var Du,dr,Vu,ps,ro,Ou,Mu,Lu;(function(){var n,e=Object.defineProperty;function t(i){i=[typeof globalThis=="object"&&globalThis,i,typeof window=="object"&&window,typeof self=="object"&&self,typeof as=="object"&&as];for(var c=0;c<i.length;++c){var u=i[c];if(u&&u.Math==Math)return u}throw Error("Cannot find global object")}var r=t(this);function s(i,c){if(c)e:{var u=r;i=i.split(".");for(var f=0;f<i.length-1;f++){var w=i[f];if(!(w in u))break e;u=u[w]}i=i[i.length-1],f=u[i],c=c(f),c!=f&&c!=null&&e(u,i,{configurable:!0,writable:!0,value:c})}}s("Symbol.dispose",function(i){return i||Symbol("Symbol.dispose")}),s("Array.prototype.values",function(i){return i||function(){return this[Symbol.iterator]()}}),s("Object.entries",function(i){return i||function(c){var u=[],f;for(f in c)Object.prototype.hasOwnProperty.call(c,f)&&u.push([f,c[f]]);return u}});var o=o||{},a=this||self;function l(i){var c=typeof i;return c=="object"&&i!=null||c=="function"}function h(i,c,u){return i.call.apply(i.bind,arguments)}function d(i,c,u){return d=h,d.apply(null,arguments)}function p(i,c){var u=Array.prototype.slice.call(arguments,1);return function(){var f=u.slice();return f.push.apply(f,arguments),i.apply(this,f)}}function _(i,c){function u(){}u.prototype=c.prototype,i.Z=c.prototype,i.prototype=new u,i.prototype.constructor=i,i.Ob=function(f,w,S){for(var N=Array(arguments.length-2),j=2;j<arguments.length;j++)N[j-2]=arguments[j];return c.prototype[w].apply(f,N)}}var E=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?i=>i&&AsyncContext.Snapshot.wrap(i):i=>i;function C(i){const c=i.length;if(c>0){const u=Array(c);for(let f=0;f<c;f++)u[f]=i[f];return u}return[]}function k(i,c){for(let f=1;f<arguments.length;f++){const w=arguments[f];var u=typeof w;if(u=u!="object"?u:w?Array.isArray(w)?"array":u:"null",u=="array"||u=="object"&&typeof w.length=="number"){u=i.length||0;const S=w.length||0;i.length=u+S;for(let N=0;N<S;N++)i[u+N]=w[N]}else i.push(w)}}class O{constructor(c,u){this.i=c,this.j=u,this.h=0,this.g=null}get(){let c;return this.h>0?(this.h--,c=this.g,this.g=c.next,c.next=null):c=this.i(),c}}function M(i){a.setTimeout(()=>{throw i},0)}function G(){var i=v;let c=null;return i.g&&(c=i.g,i.g=i.g.next,i.g||(i.h=null),c.next=null),c}class z{constructor(){this.h=this.g=null}add(c,u){const f=J.get();f.set(c,u),this.h?this.h.next=f:this.g=f,this.h=f}}var J=new O(()=>new Oe,i=>i.reset());class Oe{constructor(){this.next=this.g=this.h=null}set(c,u){this.h=c,this.g=u,this.next=null}reset(){this.next=this.g=this.h=null}}let Ue,ge=!1,v=new z,g=()=>{const i=Promise.resolve(void 0);Ue=()=>{i.then(y)}};function y(){for(var i;i=G();){try{i.h.call(i.g)}catch(u){M(u)}var c=J;c.j(i),c.h<100&&(c.h++,i.next=c.g,c.g=i)}ge=!1}function T(){this.u=this.u,this.C=this.C}T.prototype.u=!1,T.prototype.dispose=function(){this.u||(this.u=!0,this.N())},T.prototype[Symbol.dispose]=function(){this.dispose()},T.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function I(i,c){this.type=i,this.g=this.target=c,this.defaultPrevented=!1}I.prototype.h=function(){this.defaultPrevented=!0};var A=(function(){if(!a.addEventListener||!Object.defineProperty)return!1;var i=!1,c=Object.defineProperty({},"passive",{get:function(){i=!0}});try{const u=()=>{};a.addEventListener("test",u,c),a.removeEventListener("test",u,c)}catch{}return i})();function m(i){return/^[\s\xa0]*$/.test(i)}function Ne(i,c){I.call(this,i?i.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,i&&this.init(i,c)}_(Ne,I),Ne.prototype.init=function(i,c){const u=this.type=i.type,f=i.changedTouches&&i.changedTouches.length?i.changedTouches[0]:null;this.target=i.target||i.srcElement,this.g=c,c=i.relatedTarget,c||(u=="mouseover"?c=i.fromElement:u=="mouseout"&&(c=i.toElement)),this.relatedTarget=c,f?(this.clientX=f.clientX!==void 0?f.clientX:f.pageX,this.clientY=f.clientY!==void 0?f.clientY:f.pageY,this.screenX=f.screenX||0,this.screenY=f.screenY||0):(this.clientX=i.clientX!==void 0?i.clientX:i.pageX,this.clientY=i.clientY!==void 0?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0),this.button=i.button,this.key=i.key||"",this.ctrlKey=i.ctrlKey,this.altKey=i.altKey,this.shiftKey=i.shiftKey,this.metaKey=i.metaKey,this.pointerId=i.pointerId||0,this.pointerType=i.pointerType,this.state=i.state,this.i=i,i.defaultPrevented&&Ne.Z.h.call(this)},Ne.prototype.h=function(){Ne.Z.h.call(this);const i=this.i;i.preventDefault?i.preventDefault():i.returnValue=!1};var Ht="closure_listenable_"+(Math.random()*1e6|0),Yd=0;function Jd(i,c,u,f,w){this.listener=i,this.proxy=null,this.src=c,this.type=u,this.capture=!!f,this.ha=w,this.key=++Yd,this.da=this.fa=!1}function Wr(i){i.da=!0,i.listener=null,i.proxy=null,i.src=null,i.ha=null}function zr(i,c,u){for(const f in i)c.call(u,i[f],f,i)}function Xd(i,c){for(const u in i)c.call(void 0,i[u],u,i)}function Ta(i){const c={};for(const u in i)c[u]=i[u];return c}const wa="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Aa(i,c){let u,f;for(let w=1;w<arguments.length;w++){f=arguments[w];for(u in f)i[u]=f[u];for(let S=0;S<wa.length;S++)u=wa[S],Object.prototype.hasOwnProperty.call(f,u)&&(i[u]=f[u])}}function Kr(i){this.src=i,this.g={},this.h=0}Kr.prototype.add=function(i,c,u,f,w){const S=i.toString();i=this.g[S],i||(i=this.g[S]=[],this.h++);const N=pi(i,c,f,w);return N>-1?(c=i[N],u||(c.fa=!1)):(c=new Jd(c,this.src,S,!!f,w),c.fa=u,i.push(c)),c};function fi(i,c){const u=c.type;if(u in i.g){var f=i.g[u],w=Array.prototype.indexOf.call(f,c,void 0),S;(S=w>=0)&&Array.prototype.splice.call(f,w,1),S&&(Wr(c),i.g[u].length==0&&(delete i.g[u],i.h--))}}function pi(i,c,u,f){for(let w=0;w<i.length;++w){const S=i[w];if(!S.da&&S.listener==c&&S.capture==!!u&&S.ha==f)return w}return-1}var gi="closure_lm_"+(Math.random()*1e6|0),mi={};function Ra(i,c,u,f,w){if(Array.isArray(c)){for(let S=0;S<c.length;S++)Ra(i,c[S],u,f,w);return null}return u=ba(u),i&&i[Ht]?i.J(c,u,l(f)?!!f.capture:!1,w):Zd(i,c,u,!1,f,w)}function Zd(i,c,u,f,w,S){if(!c)throw Error("Invalid event type");const N=l(w)?!!w.capture:!!w;let j=yi(i);if(j||(i[gi]=j=new Kr(i)),u=j.add(c,u,f,N,S),u.proxy)return u;if(f=ef(),u.proxy=f,f.src=i,f.listener=u,i.addEventListener)A||(w=N),w===void 0&&(w=!1),i.addEventListener(c.toString(),f,w);else if(i.attachEvent)i.attachEvent(Ca(c.toString()),f);else if(i.addListener&&i.removeListener)i.addListener(f);else throw Error("addEventListener and attachEvent are unavailable.");return u}function ef(){function i(u){return c.call(i.src,i.listener,u)}const c=tf;return i}function Sa(i,c,u,f,w){if(Array.isArray(c))for(var S=0;S<c.length;S++)Sa(i,c[S],u,f,w);else f=l(f)?!!f.capture:!!f,u=ba(u),i&&i[Ht]?(i=i.i,S=String(c).toString(),S in i.g&&(c=i.g[S],u=pi(c,u,f,w),u>-1&&(Wr(c[u]),Array.prototype.splice.call(c,u,1),c.length==0&&(delete i.g[S],i.h--)))):i&&(i=yi(i))&&(c=i.g[c.toString()],i=-1,c&&(i=pi(c,u,f,w)),(u=i>-1?c[i]:null)&&_i(u))}function _i(i){if(typeof i!="number"&&i&&!i.da){var c=i.src;if(c&&c[Ht])fi(c.i,i);else{var u=i.type,f=i.proxy;c.removeEventListener?c.removeEventListener(u,f,i.capture):c.detachEvent?c.detachEvent(Ca(u),f):c.addListener&&c.removeListener&&c.removeListener(f),(u=yi(c))?(fi(u,i),u.h==0&&(u.src=null,c[gi]=null)):Wr(i)}}}function Ca(i){return i in mi?mi[i]:mi[i]="on"+i}function tf(i,c){if(i.da)i=!0;else{c=new Ne(c,this);const u=i.listener,f=i.ha||i.src;i.fa&&_i(i),i=u.call(f,c)}return i}function yi(i){return i=i[gi],i instanceof Kr?i:null}var Ei="__closure_events_fn_"+(Math.random()*1e9>>>0);function ba(i){return typeof i=="function"?i:(i[Ei]||(i[Ei]=function(c){return i.handleEvent(c)}),i[Ei])}function ve(){T.call(this),this.i=new Kr(this),this.M=this,this.G=null}_(ve,T),ve.prototype[Ht]=!0,ve.prototype.removeEventListener=function(i,c,u,f){Sa(this,i,c,u,f)};function Ce(i,c){var u,f=i.G;if(f)for(u=[];f;f=f.G)u.push(f);if(i=i.M,f=c.type||c,typeof c=="string")c=new I(c,i);else if(c instanceof I)c.target=c.target||i;else{var w=c;c=new I(f,i),Aa(c,w)}w=!0;let S,N;if(u)for(N=u.length-1;N>=0;N--)S=c.g=u[N],w=Qr(S,f,!0,c)&&w;if(S=c.g=i,w=Qr(S,f,!0,c)&&w,w=Qr(S,f,!1,c)&&w,u)for(N=0;N<u.length;N++)S=c.g=u[N],w=Qr(S,f,!1,c)&&w}ve.prototype.N=function(){if(ve.Z.N.call(this),this.i){var i=this.i;for(const c in i.g){const u=i.g[c];for(let f=0;f<u.length;f++)Wr(u[f]);delete i.g[c],i.h--}}this.G=null},ve.prototype.J=function(i,c,u,f){return this.i.add(String(i),c,!1,u,f)},ve.prototype.K=function(i,c,u,f){return this.i.add(String(i),c,!0,u,f)};function Qr(i,c,u,f){if(c=i.i.g[String(c)],!c)return!0;c=c.concat();let w=!0;for(let S=0;S<c.length;++S){const N=c[S];if(N&&!N.da&&N.capture==u){const j=N.listener,le=N.ha||N.src;N.fa&&fi(i.i,N),w=j.call(le,f)!==!1&&w}}return w&&!f.defaultPrevented}function nf(i,c){if(typeof i!="function")if(i&&typeof i.handleEvent=="function")i=d(i.handleEvent,i);else throw Error("Invalid listener argument");return Number(c)>2147483647?-1:a.setTimeout(i,c||0)}function Pa(i){i.g=nf(()=>{i.g=null,i.i&&(i.i=!1,Pa(i))},i.l);const c=i.h;i.h=null,i.m.apply(null,c)}class rf extends T{constructor(c,u){super(),this.m=c,this.l=u,this.h=null,this.i=!1,this.g=null}j(c){this.h=arguments,this.g?this.i=!0:Pa(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Wn(i){T.call(this),this.h=i,this.g={}}_(Wn,T);var ka=[];function Na(i){zr(i.g,function(c,u){this.g.hasOwnProperty(u)&&_i(c)},i),i.g={}}Wn.prototype.N=function(){Wn.Z.N.call(this),Na(this)},Wn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Ii=a.JSON.stringify,sf=a.JSON.parse,of=class{stringify(i){return a.JSON.stringify(i,void 0)}parse(i){return a.JSON.parse(i,void 0)}};function Da(){}function Va(){}var zn={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function vi(){I.call(this,"d")}_(vi,I);function Ti(){I.call(this,"c")}_(Ti,I);var Gt={},Oa=null;function Yr(){return Oa=Oa||new ve}Gt.Ia="serverreachability";function Ma(i){I.call(this,Gt.Ia,i)}_(Ma,I);function Kn(i){const c=Yr();Ce(c,new Ma(c))}Gt.STAT_EVENT="statevent";function La(i,c){I.call(this,Gt.STAT_EVENT,i),this.stat=c}_(La,I);function be(i){const c=Yr();Ce(c,new La(c,i))}Gt.Ja="timingevent";function xa(i,c){I.call(this,Gt.Ja,i),this.size=c}_(xa,I);function Qn(i,c){if(typeof i!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){i()},c)}function Yn(){this.g=!0}Yn.prototype.ua=function(){this.g=!1};function af(i,c,u,f,w,S){i.info(function(){if(i.g)if(S){var N="",j=S.split("&");for(let Y=0;Y<j.length;Y++){var le=j[Y].split("=");if(le.length>1){const de=le[0];le=le[1];const ze=de.split("_");N=ze.length>=2&&ze[1]=="type"?N+(de+"="+le+"&"):N+(de+"=redacted&")}}}else N=null;else N=S;return"XMLHTTP REQ ("+f+") [attempt "+w+"]: "+c+`
`+u+`
`+N})}function cf(i,c,u,f,w,S,N){i.info(function(){return"XMLHTTP RESP ("+f+") [ attempt "+w+"]: "+c+`
`+u+`
`+S+" "+N})}function fn(i,c,u,f){i.info(function(){return"XMLHTTP TEXT ("+c+"): "+uf(i,u)+(f?" "+f:"")})}function lf(i,c){i.info(function(){return"TIMEOUT: "+c})}Yn.prototype.info=function(){};function uf(i,c){if(!i.g)return c;if(!c)return null;try{const S=JSON.parse(c);if(S){for(i=0;i<S.length;i++)if(Array.isArray(S[i])){var u=S[i];if(!(u.length<2)){var f=u[1];if(Array.isArray(f)&&!(f.length<1)){var w=f[0];if(w!="noop"&&w!="stop"&&w!="close")for(let N=1;N<f.length;N++)f[N]=""}}}}return Ii(S)}catch{return c}}var Jr={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Fa={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},Ua;function wi(){}_(wi,Da),wi.prototype.g=function(){return new XMLHttpRequest},Ua=new wi;function Jn(i){return encodeURIComponent(String(i))}function hf(i){var c=1;i=i.split(":");const u=[];for(;c>0&&i.length;)u.push(i.shift()),c--;return i.length&&u.push(i.join(":")),u}function ft(i,c,u,f){this.j=i,this.i=c,this.l=u,this.S=f||1,this.V=new Wn(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Ba}function Ba(){this.i=null,this.g="",this.h=!1}var ja={},Ai={};function Ri(i,c,u){i.M=1,i.A=Zr(We(c)),i.u=u,i.R=!0,$a(i,null)}function $a(i,c){i.F=Date.now(),Xr(i),i.B=We(i.A);var u=i.B,f=i.S;Array.isArray(f)||(f=[String(f)]),tc(u.i,"t",f),i.C=0,u=i.j.L,i.h=new Ba,i.g=Ec(i.j,u?c:null,!i.u),i.P>0&&(i.O=new rf(d(i.Y,i,i.g),i.P)),c=i.V,u=i.g,f=i.ba;var w="readystatechange";Array.isArray(w)||(w&&(ka[0]=w.toString()),w=ka);for(let S=0;S<w.length;S++){const N=Ra(u,w[S],f||c.handleEvent,!1,c.h||c);if(!N)break;c.g[N.key]=N}c=i.J?Ta(i.J):{},i.u?(i.v||(i.v="POST"),c["Content-Type"]="application/x-www-form-urlencoded",i.g.ea(i.B,i.v,i.u,c)):(i.v="GET",i.g.ea(i.B,i.v,null,c)),Kn(),af(i.i,i.v,i.B,i.l,i.S,i.u)}ft.prototype.ba=function(i){i=i.target;const c=this.O;c&&mt(i)==3?c.j():this.Y(i)},ft.prototype.Y=function(i){try{if(i==this.g)e:{const j=mt(this.g),le=this.g.ya(),Y=this.g.ca();if(!(j<3)&&(j!=3||this.g&&(this.h.h||this.g.la()||cc(this.g)))){this.K||j!=4||le==7||(le==8||Y<=0?Kn(3):Kn(2)),Si(this);var c=this.g.ca();this.X=c;var u=df(this);if(this.o=c==200,cf(this.i,this.v,this.B,this.l,this.S,j,c),this.o){if(this.U&&!this.L){t:{if(this.g){var f,w=this.g;if((f=w.g?w.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!m(f)){var S=f;break t}}S=null}if(i=S)fn(this.i,this.l,i,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Ci(this,i);else{this.o=!1,this.m=3,be(12),Wt(this),Xn(this);break e}}if(this.R){i=!0;let de;for(;!this.K&&this.C<u.length;)if(de=ff(this,u),de==Ai){j==4&&(this.m=4,be(14),i=!1),fn(this.i,this.l,null,"[Incomplete Response]");break}else if(de==ja){this.m=4,be(15),fn(this.i,this.l,u,"[Invalid Chunk]"),i=!1;break}else fn(this.i,this.l,de,null),Ci(this,de);if(qa(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),j!=4||u.length!=0||this.h.h||(this.m=1,be(16),i=!1),this.o=this.o&&i,!i)fn(this.i,this.l,u,"[Invalid Chunked Response]"),Wt(this),Xn(this);else if(u.length>0&&!this.W){this.W=!0;var N=this.j;N.g==this&&N.aa&&!N.P&&(N.j.info("Great, no buffering proxy detected. Bytes received: "+u.length),Mi(N),N.P=!0,be(11))}}else fn(this.i,this.l,u,null),Ci(this,u);j==4&&Wt(this),this.o&&!this.K&&(j==4?gc(this.j,this):(this.o=!1,Xr(this)))}else Cf(this.g),c==400&&u.indexOf("Unknown SID")>0?(this.m=3,be(12)):(this.m=0,be(13)),Wt(this),Xn(this)}}}catch{}};function df(i){if(!qa(i))return i.g.la();const c=cc(i.g);if(c==="")return"";let u="";const f=c.length,w=mt(i.g)==4;if(!i.h.i){if(typeof TextDecoder>"u")return Wt(i),Xn(i),"";i.h.i=new a.TextDecoder}for(let S=0;S<f;S++)i.h.h=!0,u+=i.h.i.decode(c[S],{stream:!(w&&S==f-1)});return c.length=0,i.h.g+=u,i.C=0,i.h.g}function qa(i){return i.g?i.v=="GET"&&i.M!=2&&i.j.Aa:!1}function ff(i,c){var u=i.C,f=c.indexOf(`
`,u);return f==-1?Ai:(u=Number(c.substring(u,f)),isNaN(u)?ja:(f+=1,f+u>c.length?Ai:(c=c.slice(f,f+u),i.C=f+u,c)))}ft.prototype.cancel=function(){this.K=!0,Wt(this)};function Xr(i){i.T=Date.now()+i.H,Ha(i,i.H)}function Ha(i,c){if(i.D!=null)throw Error("WatchDog timer not null");i.D=Qn(d(i.aa,i),c)}function Si(i){i.D&&(a.clearTimeout(i.D),i.D=null)}ft.prototype.aa=function(){this.D=null;const i=Date.now();i-this.T>=0?(lf(this.i,this.B),this.M!=2&&(Kn(),be(17)),Wt(this),this.m=2,Xn(this)):Ha(this,this.T-i)};function Xn(i){i.j.I==0||i.K||gc(i.j,i)}function Wt(i){Si(i);var c=i.O;c&&typeof c.dispose=="function"&&c.dispose(),i.O=null,Na(i.V),i.g&&(c=i.g,i.g=null,c.abort(),c.dispose())}function Ci(i,c){try{var u=i.j;if(u.I!=0&&(u.g==i||bi(u.h,i))){if(!i.L&&bi(u.h,i)&&u.I==3){try{var f=u.Ba.g.parse(c)}catch{f=null}if(Array.isArray(f)&&f.length==3){var w=f;if(w[0]==0){e:if(!u.v){if(u.g)if(u.g.F+3e3<i.F)ss(u),ns(u);else break e;Oi(u),be(18)}}else u.xa=w[1],0<u.xa-u.K&&w[2]<37500&&u.F&&u.A==0&&!u.C&&(u.C=Qn(d(u.Va,u),6e3));za(u.h)<=1&&u.ta&&(u.ta=void 0)}else Kt(u,11)}else if((i.L||u.g==i)&&ss(u),!m(c))for(w=u.Ba.g.parse(c),c=0;c<w.length;c++){let Y=w[c];const de=Y[0];if(!(de<=u.K))if(u.K=de,Y=Y[1],u.I==2)if(Y[0]=="c"){u.M=Y[1],u.ba=Y[2];const ze=Y[3];ze!=null&&(u.ka=ze,u.j.info("VER="+u.ka));const Qt=Y[4];Qt!=null&&(u.za=Qt,u.j.info("SVER="+u.za));const _t=Y[5];_t!=null&&typeof _t=="number"&&_t>0&&(f=1.5*_t,u.O=f,u.j.info("backChannelRequestTimeoutMs_="+f)),f=u;const yt=i.g;if(yt){const os=yt.g?yt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(os){var S=f.h;S.g||os.indexOf("spdy")==-1&&os.indexOf("quic")==-1&&os.indexOf("h2")==-1||(S.j=S.l,S.g=new Set,S.h&&(Pi(S,S.h),S.h=null))}if(f.G){const Li=yt.g?yt.g.getResponseHeader("X-HTTP-Session-Id"):null;Li&&(f.wa=Li,Z(f.J,f.G,Li))}}u.I=3,u.l&&u.l.ra(),u.aa&&(u.T=Date.now()-i.F,u.j.info("Handshake RTT: "+u.T+"ms")),f=u;var N=i;if(f.na=yc(f,f.L?f.ba:null,f.W),N.L){Ka(f.h,N);var j=N,le=f.O;le&&(j.H=le),j.D&&(Si(j),Xr(j)),f.g=N}else fc(f);u.i.length>0&&rs(u)}else Y[0]!="stop"&&Y[0]!="close"||Kt(u,7);else u.I==3&&(Y[0]=="stop"||Y[0]=="close"?Y[0]=="stop"?Kt(u,7):Vi(u):Y[0]!="noop"&&u.l&&u.l.qa(Y),u.A=0)}}Kn(4)}catch{}}var pf=class{constructor(i,c){this.g=i,this.map=c}};function Ga(i){this.l=i||10,a.PerformanceNavigationTiming?(i=a.performance.getEntriesByType("navigation"),i=i.length>0&&(i[0].nextHopProtocol=="hq"||i[0].nextHopProtocol=="h2")):i=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=i?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function Wa(i){return i.h?!0:i.g?i.g.size>=i.j:!1}function za(i){return i.h?1:i.g?i.g.size:0}function bi(i,c){return i.h?i.h==c:i.g?i.g.has(c):!1}function Pi(i,c){i.g?i.g.add(c):i.h=c}function Ka(i,c){i.h&&i.h==c?i.h=null:i.g&&i.g.has(c)&&i.g.delete(c)}Ga.prototype.cancel=function(){if(this.i=Qa(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const i of this.g.values())i.cancel();this.g.clear()}};function Qa(i){if(i.h!=null)return i.i.concat(i.h.G);if(i.g!=null&&i.g.size!==0){let c=i.i;for(const u of i.g.values())c=c.concat(u.G);return c}return C(i.i)}var Ya=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function gf(i,c){if(i){i=i.split("&");for(let u=0;u<i.length;u++){const f=i[u].indexOf("=");let w,S=null;f>=0?(w=i[u].substring(0,f),S=i[u].substring(f+1)):w=i[u],c(w,S?decodeURIComponent(S.replace(/\+/g," ")):"")}}}function pt(i){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let c;i instanceof pt?(this.l=i.l,Zn(this,i.j),this.o=i.o,this.g=i.g,er(this,i.u),this.h=i.h,ki(this,nc(i.i)),this.m=i.m):i&&(c=String(i).match(Ya))?(this.l=!1,Zn(this,c[1]||"",!0),this.o=tr(c[2]||""),this.g=tr(c[3]||"",!0),er(this,c[4]),this.h=tr(c[5]||"",!0),ki(this,c[6]||"",!0),this.m=tr(c[7]||"")):(this.l=!1,this.i=new rr(null,this.l))}pt.prototype.toString=function(){const i=[];var c=this.j;c&&i.push(nr(c,Ja,!0),":");var u=this.g;return(u||c=="file")&&(i.push("//"),(c=this.o)&&i.push(nr(c,Ja,!0),"@"),i.push(Jn(u).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),u=this.u,u!=null&&i.push(":",String(u))),(u=this.h)&&(this.g&&u.charAt(0)!="/"&&i.push("/"),i.push(nr(u,u.charAt(0)=="/"?yf:_f,!0))),(u=this.i.toString())&&i.push("?",u),(u=this.m)&&i.push("#",nr(u,If)),i.join("")},pt.prototype.resolve=function(i){const c=We(this);let u=!!i.j;u?Zn(c,i.j):u=!!i.o,u?c.o=i.o:u=!!i.g,u?c.g=i.g:u=i.u!=null;var f=i.h;if(u)er(c,i.u);else if(u=!!i.h){if(f.charAt(0)!="/")if(this.g&&!this.h)f="/"+f;else{var w=c.h.lastIndexOf("/");w!=-1&&(f=c.h.slice(0,w+1)+f)}if(w=f,w==".."||w==".")f="";else if(w.indexOf("./")!=-1||w.indexOf("/.")!=-1){f=w.lastIndexOf("/",0)==0,w=w.split("/");const S=[];for(let N=0;N<w.length;){const j=w[N++];j=="."?f&&N==w.length&&S.push(""):j==".."?((S.length>1||S.length==1&&S[0]!="")&&S.pop(),f&&N==w.length&&S.push("")):(S.push(j),f=!0)}f=S.join("/")}else f=w}return u?c.h=f:u=i.i.toString()!=="",u?ki(c,nc(i.i)):u=!!i.m,u&&(c.m=i.m),c};function We(i){return new pt(i)}function Zn(i,c,u){i.j=u?tr(c,!0):c,i.j&&(i.j=i.j.replace(/:$/,""))}function er(i,c){if(c){if(c=Number(c),isNaN(c)||c<0)throw Error("Bad port number "+c);i.u=c}else i.u=null}function ki(i,c,u){c instanceof rr?(i.i=c,vf(i.i,i.l)):(u||(c=nr(c,Ef)),i.i=new rr(c,i.l))}function Z(i,c,u){i.i.set(c,u)}function Zr(i){return Z(i,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),i}function tr(i,c){return i?c?decodeURI(i.replace(/%25/g,"%2525")):decodeURIComponent(i):""}function nr(i,c,u){return typeof i=="string"?(i=encodeURI(i).replace(c,mf),u&&(i=i.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),i):null}function mf(i){return i=i.charCodeAt(0),"%"+(i>>4&15).toString(16)+(i&15).toString(16)}var Ja=/[#\/\?@]/g,_f=/[#\?:]/g,yf=/[#\?]/g,Ef=/[#\?@]/g,If=/#/g;function rr(i,c){this.h=this.g=null,this.i=i||null,this.j=!!c}function zt(i){i.g||(i.g=new Map,i.h=0,i.i&&gf(i.i,function(c,u){i.add(decodeURIComponent(c.replace(/\+/g," ")),u)}))}n=rr.prototype,n.add=function(i,c){zt(this),this.i=null,i=pn(this,i);let u=this.g.get(i);return u||this.g.set(i,u=[]),u.push(c),this.h+=1,this};function Xa(i,c){zt(i),c=pn(i,c),i.g.has(c)&&(i.i=null,i.h-=i.g.get(c).length,i.g.delete(c))}function Za(i,c){return zt(i),c=pn(i,c),i.g.has(c)}n.forEach=function(i,c){zt(this),this.g.forEach(function(u,f){u.forEach(function(w){i.call(c,w,f,this)},this)},this)};function ec(i,c){zt(i);let u=[];if(typeof c=="string")Za(i,c)&&(u=u.concat(i.g.get(pn(i,c))));else for(i=Array.from(i.g.values()),c=0;c<i.length;c++)u=u.concat(i[c]);return u}n.set=function(i,c){return zt(this),this.i=null,i=pn(this,i),Za(this,i)&&(this.h-=this.g.get(i).length),this.g.set(i,[c]),this.h+=1,this},n.get=function(i,c){return i?(i=ec(this,i),i.length>0?String(i[0]):c):c};function tc(i,c,u){Xa(i,c),u.length>0&&(i.i=null,i.g.set(pn(i,c),C(u)),i.h+=u.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const i=[],c=Array.from(this.g.keys());for(let f=0;f<c.length;f++){var u=c[f];const w=Jn(u);u=ec(this,u);for(let S=0;S<u.length;S++){let N=w;u[S]!==""&&(N+="="+Jn(u[S])),i.push(N)}}return this.i=i.join("&")};function nc(i){const c=new rr;return c.i=i.i,i.g&&(c.g=new Map(i.g),c.h=i.h),c}function pn(i,c){return c=String(c),i.j&&(c=c.toLowerCase()),c}function vf(i,c){c&&!i.j&&(zt(i),i.i=null,i.g.forEach(function(u,f){const w=f.toLowerCase();f!=w&&(Xa(this,f),tc(this,w,u))},i)),i.j=c}function Tf(i,c){const u=new Yn;if(a.Image){const f=new Image;f.onload=p(gt,u,"TestLoadImage: loaded",!0,c,f),f.onerror=p(gt,u,"TestLoadImage: error",!1,c,f),f.onabort=p(gt,u,"TestLoadImage: abort",!1,c,f),f.ontimeout=p(gt,u,"TestLoadImage: timeout",!1,c,f),a.setTimeout(function(){f.ontimeout&&f.ontimeout()},1e4),f.src=i}else c(!1)}function wf(i,c){const u=new Yn,f=new AbortController,w=setTimeout(()=>{f.abort(),gt(u,"TestPingServer: timeout",!1,c)},1e4);fetch(i,{signal:f.signal}).then(S=>{clearTimeout(w),S.ok?gt(u,"TestPingServer: ok",!0,c):gt(u,"TestPingServer: server error",!1,c)}).catch(()=>{clearTimeout(w),gt(u,"TestPingServer: error",!1,c)})}function gt(i,c,u,f,w){try{w&&(w.onload=null,w.onerror=null,w.onabort=null,w.ontimeout=null),f(u)}catch{}}function Af(){this.g=new of}function Ni(i){this.i=i.Sb||null,this.h=i.ab||!1}_(Ni,Da),Ni.prototype.g=function(){return new es(this.i,this.h)};function es(i,c){ve.call(this),this.H=i,this.o=c,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}_(es,ve),n=es.prototype,n.open=function(i,c){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=i,this.D=c,this.readyState=1,ir(this)},n.send=function(i){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const c={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};i&&(c.body=i),(this.H||a).fetch(new Request(this.D,c)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,sr(this)),this.readyState=0},n.Pa=function(i){if(this.g&&(this.l=i,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=i.headers,this.readyState=2,ir(this)),this.g&&(this.readyState=3,ir(this),this.g)))if(this.responseType==="arraybuffer")i.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in i){if(this.j=i.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;rc(this)}else i.text().then(this.Oa.bind(this),this.ga.bind(this))};function rc(i){i.j.read().then(i.Ma.bind(i)).catch(i.ga.bind(i))}n.Ma=function(i){if(this.g){if(this.o&&i.value)this.response.push(i.value);else if(!this.o){var c=i.value?i.value:new Uint8Array(0);(c=this.B.decode(c,{stream:!i.done}))&&(this.response=this.responseText+=c)}i.done?sr(this):ir(this),this.readyState==3&&rc(this)}},n.Oa=function(i){this.g&&(this.response=this.responseText=i,sr(this))},n.Na=function(i){this.g&&(this.response=i,sr(this))},n.ga=function(){this.g&&sr(this)};function sr(i){i.readyState=4,i.l=null,i.j=null,i.B=null,ir(i)}n.setRequestHeader=function(i,c){this.A.append(i,c)},n.getResponseHeader=function(i){return this.h&&this.h.get(i.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const i=[],c=this.h.entries();for(var u=c.next();!u.done;)u=u.value,i.push(u[0]+": "+u[1]),u=c.next();return i.join(`\r
`)};function ir(i){i.onreadystatechange&&i.onreadystatechange.call(i)}Object.defineProperty(es.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(i){this.m=i?"include":"same-origin"}});function sc(i){let c="";return zr(i,function(u,f){c+=f,c+=":",c+=u,c+=`\r
`}),c}function Di(i,c,u){e:{for(f in u){var f=!1;break e}f=!0}f||(u=sc(u),typeof i=="string"?u!=null&&Jn(u):Z(i,c,u))}function ne(i){ve.call(this),this.headers=new Map,this.L=i||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}_(ne,ve);var Rf=/^https?$/i,Sf=["POST","PUT"];n=ne.prototype,n.Fa=function(i){this.H=i},n.ea=function(i,c,u,f){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+i);c=c?c.toUpperCase():"GET",this.D=i,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Ua.g(),this.g.onreadystatechange=E(d(this.Ca,this));try{this.B=!0,this.g.open(c,String(i),!0),this.B=!1}catch(S){ic(this,S);return}if(i=u||"",u=new Map(this.headers),f)if(Object.getPrototypeOf(f)===Object.prototype)for(var w in f)u.set(w,f[w]);else if(typeof f.keys=="function"&&typeof f.get=="function")for(const S of f.keys())u.set(S,f.get(S));else throw Error("Unknown input type for opt_headers: "+String(f));f=Array.from(u.keys()).find(S=>S.toLowerCase()=="content-type"),w=a.FormData&&i instanceof a.FormData,!(Array.prototype.indexOf.call(Sf,c,void 0)>=0)||f||w||u.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[S,N]of u)this.g.setRequestHeader(S,N);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(i),this.v=!1}catch(S){ic(this,S)}};function ic(i,c){i.h=!1,i.g&&(i.j=!0,i.g.abort(),i.j=!1),i.l=c,i.o=5,oc(i),ts(i)}function oc(i){i.A||(i.A=!0,Ce(i,"complete"),Ce(i,"error"))}n.abort=function(i){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=i||7,Ce(this,"complete"),Ce(this,"abort"),ts(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),ts(this,!0)),ne.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?ac(this):this.Xa())},n.Xa=function(){ac(this)};function ac(i){if(i.h&&typeof o<"u"){if(i.v&&mt(i)==4)setTimeout(i.Ca.bind(i),0);else if(Ce(i,"readystatechange"),mt(i)==4){i.h=!1;try{const S=i.ca();e:switch(S){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var c=!0;break e;default:c=!1}var u;if(!(u=c)){var f;if(f=S===0){let N=String(i.D).match(Ya)[1]||null;!N&&a.self&&a.self.location&&(N=a.self.location.protocol.slice(0,-1)),f=!Rf.test(N?N.toLowerCase():"")}u=f}if(u)Ce(i,"complete"),Ce(i,"success");else{i.o=6;try{var w=mt(i)>2?i.g.statusText:""}catch{w=""}i.l=w+" ["+i.ca()+"]",oc(i)}}finally{ts(i)}}}}function ts(i,c){if(i.g){i.m&&(clearTimeout(i.m),i.m=null);const u=i.g;i.g=null,c||Ce(i,"ready");try{u.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function mt(i){return i.g?i.g.readyState:0}n.ca=function(){try{return mt(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(i){if(this.g){var c=this.g.responseText;return i&&c.indexOf(i)==0&&(c=c.substring(i.length)),sf(c)}};function cc(i){try{if(!i.g)return null;if("response"in i.g)return i.g.response;switch(i.F){case"":case"text":return i.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in i.g)return i.g.mozResponseArrayBuffer}return null}catch{return null}}function Cf(i){const c={};i=(i.g&&mt(i)>=2&&i.g.getAllResponseHeaders()||"").split(`\r
`);for(let f=0;f<i.length;f++){if(m(i[f]))continue;var u=hf(i[f]);const w=u[0];if(u=u[1],typeof u!="string")continue;u=u.trim();const S=c[w]||[];c[w]=S,S.push(u)}Xd(c,function(f){return f.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function or(i,c,u){return u&&u.internalChannelParams&&u.internalChannelParams[i]||c}function lc(i){this.za=0,this.i=[],this.j=new Yn,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=or("failFast",!1,i),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=or("baseRetryDelayMs",5e3,i),this.Za=or("retryDelaySeedMs",1e4,i),this.Ta=or("forwardChannelMaxRetries",2,i),this.va=or("forwardChannelRequestTimeoutMs",2e4,i),this.ma=i&&i.xmlHttpFactory||void 0,this.Ua=i&&i.Rb||void 0,this.Aa=i&&i.useFetchStreams||!1,this.O=void 0,this.L=i&&i.supportsCrossDomainXhr||!1,this.M="",this.h=new Ga(i&&i.concurrentRequestLimit),this.Ba=new Af,this.S=i&&i.fastHandshake||!1,this.R=i&&i.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=i&&i.Pb||!1,i&&i.ua&&this.j.ua(),i&&i.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&i&&i.detectBufferingProxy||!1,this.ia=void 0,i&&i.longPollingTimeout&&i.longPollingTimeout>0&&(this.ia=i.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=lc.prototype,n.ka=8,n.I=1,n.connect=function(i,c,u,f){be(0),this.W=i,this.H=c||{},u&&f!==void 0&&(this.H.OSID=u,this.H.OAID=f),this.F=this.X,this.J=yc(this,null,this.W),rs(this)};function Vi(i){if(uc(i),i.I==3){var c=i.V++,u=We(i.J);if(Z(u,"SID",i.M),Z(u,"RID",c),Z(u,"TYPE","terminate"),ar(i,u),c=new ft(i,i.j,c),c.M=2,c.A=Zr(We(u)),u=!1,a.navigator&&a.navigator.sendBeacon)try{u=a.navigator.sendBeacon(c.A.toString(),"")}catch{}!u&&a.Image&&(new Image().src=c.A,u=!0),u||(c.g=Ec(c.j,null),c.g.ea(c.A)),c.F=Date.now(),Xr(c)}_c(i)}function ns(i){i.g&&(Mi(i),i.g.cancel(),i.g=null)}function uc(i){ns(i),i.v&&(a.clearTimeout(i.v),i.v=null),ss(i),i.h.cancel(),i.m&&(typeof i.m=="number"&&a.clearTimeout(i.m),i.m=null)}function rs(i){if(!Wa(i.h)&&!i.m){i.m=!0;var c=i.Ea;Ue||g(),ge||(Ue(),ge=!0),v.add(c,i),i.D=0}}function bf(i,c){return za(i.h)>=i.h.j-(i.m?1:0)?!1:i.m?(i.i=c.G.concat(i.i),!0):i.I==1||i.I==2||i.D>=(i.Sa?0:i.Ta)?!1:(i.m=Qn(d(i.Ea,i,c),mc(i,i.D)),i.D++,!0)}n.Ea=function(i){if(this.m)if(this.m=null,this.I==1){if(!i){this.V=Math.floor(Math.random()*1e5),i=this.V++;const w=new ft(this,this.j,i);let S=this.o;if(this.U&&(S?(S=Ta(S),Aa(S,this.U)):S=this.U),this.u!==null||this.R||(w.J=S,S=null),this.S)e:{for(var c=0,u=0;u<this.i.length;u++){t:{var f=this.i[u];if("__data__"in f.map&&(f=f.map.__data__,typeof f=="string")){f=f.length;break t}f=void 0}if(f===void 0)break;if(c+=f,c>4096){c=u;break e}if(c===4096||u===this.i.length-1){c=u+1;break e}}c=1e3}else c=1e3;c=dc(this,w,c),u=We(this.J),Z(u,"RID",i),Z(u,"CVER",22),this.G&&Z(u,"X-HTTP-Session-Id",this.G),ar(this,u),S&&(this.R?c="headers="+Jn(sc(S))+"&"+c:this.u&&Di(u,this.u,S)),Pi(this.h,w),this.Ra&&Z(u,"TYPE","init"),this.S?(Z(u,"$req",c),Z(u,"SID","null"),w.U=!0,Ri(w,u,null)):Ri(w,u,c),this.I=2}}else this.I==3&&(i?hc(this,i):this.i.length==0||Wa(this.h)||hc(this))};function hc(i,c){var u;c?u=c.l:u=i.V++;const f=We(i.J);Z(f,"SID",i.M),Z(f,"RID",u),Z(f,"AID",i.K),ar(i,f),i.u&&i.o&&Di(f,i.u,i.o),u=new ft(i,i.j,u,i.D+1),i.u===null&&(u.J=i.o),c&&(i.i=c.G.concat(i.i)),c=dc(i,u,1e3),u.H=Math.round(i.va*.5)+Math.round(i.va*.5*Math.random()),Pi(i.h,u),Ri(u,f,c)}function ar(i,c){i.H&&zr(i.H,function(u,f){Z(c,f,u)}),i.l&&zr({},function(u,f){Z(c,f,u)})}function dc(i,c,u){u=Math.min(i.i.length,u);const f=i.l?d(i.l.Ka,i.l,i):null;e:{var w=i.i;let j=-1;for(;;){const le=["count="+u];j==-1?u>0?(j=w[0].g,le.push("ofs="+j)):j=0:le.push("ofs="+j);let Y=!0;for(let de=0;de<u;de++){var S=w[de].g;const ze=w[de].map;if(S-=j,S<0)j=Math.max(0,w[de].g-100),Y=!1;else try{S="req"+S+"_"||"";try{var N=ze instanceof Map?ze:Object.entries(ze);for(const[Qt,_t]of N){let yt=_t;l(_t)&&(yt=Ii(_t)),le.push(S+Qt+"="+encodeURIComponent(yt))}}catch(Qt){throw le.push(S+"type="+encodeURIComponent("_badmap")),Qt}}catch{f&&f(ze)}}if(Y){N=le.join("&");break e}}N=void 0}return i=i.i.splice(0,u),c.G=i,N}function fc(i){if(!i.g&&!i.v){i.Y=1;var c=i.Da;Ue||g(),ge||(Ue(),ge=!0),v.add(c,i),i.A=0}}function Oi(i){return i.g||i.v||i.A>=3?!1:(i.Y++,i.v=Qn(d(i.Da,i),mc(i,i.A)),i.A++,!0)}n.Da=function(){if(this.v=null,pc(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var i=4*this.T;this.j.info("BP detection timer enabled: "+i),this.B=Qn(d(this.Wa,this),i)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,be(10),ns(this),pc(this))};function Mi(i){i.B!=null&&(a.clearTimeout(i.B),i.B=null)}function pc(i){i.g=new ft(i,i.j,"rpc",i.Y),i.u===null&&(i.g.J=i.o),i.g.P=0;var c=We(i.na);Z(c,"RID","rpc"),Z(c,"SID",i.M),Z(c,"AID",i.K),Z(c,"CI",i.F?"0":"1"),!i.F&&i.ia&&Z(c,"TO",i.ia),Z(c,"TYPE","xmlhttp"),ar(i,c),i.u&&i.o&&Di(c,i.u,i.o),i.O&&(i.g.H=i.O);var u=i.g;i=i.ba,u.M=1,u.A=Zr(We(c)),u.u=null,u.R=!0,$a(u,i)}n.Va=function(){this.C!=null&&(this.C=null,ns(this),Oi(this),be(19))};function ss(i){i.C!=null&&(a.clearTimeout(i.C),i.C=null)}function gc(i,c){var u=null;if(i.g==c){ss(i),Mi(i),i.g=null;var f=2}else if(bi(i.h,c))u=c.G,Ka(i.h,c),f=1;else return;if(i.I!=0){if(c.o)if(f==1){u=c.u?c.u.length:0,c=Date.now()-c.F;var w=i.D;f=Yr(),Ce(f,new xa(f,u)),rs(i)}else fc(i);else if(w=c.m,w==3||w==0&&c.X>0||!(f==1&&bf(i,c)||f==2&&Oi(i)))switch(u&&u.length>0&&(c=i.h,c.i=c.i.concat(u)),w){case 1:Kt(i,5);break;case 4:Kt(i,10);break;case 3:Kt(i,6);break;default:Kt(i,2)}}}function mc(i,c){let u=i.Qa+Math.floor(Math.random()*i.Za);return i.isActive()||(u*=2),u*c}function Kt(i,c){if(i.j.info("Error code "+c),c==2){var u=d(i.bb,i),f=i.Ua;const w=!f;f=new pt(f||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||Zn(f,"https"),Zr(f),w?Tf(f.toString(),u):wf(f.toString(),u)}else be(2);i.I=0,i.l&&i.l.pa(c),_c(i),uc(i)}n.bb=function(i){i?(this.j.info("Successfully pinged google.com"),be(2)):(this.j.info("Failed to ping google.com"),be(1))};function _c(i){if(i.I=0,i.ja=[],i.l){const c=Qa(i.h);(c.length!=0||i.i.length!=0)&&(k(i.ja,c),k(i.ja,i.i),i.h.i.length=0,C(i.i),i.i.length=0),i.l.oa()}}function yc(i,c,u){var f=u instanceof pt?We(u):new pt(u);if(f.g!="")c&&(f.g=c+"."+f.g),er(f,f.u);else{var w=a.location;f=w.protocol,c=c?c+"."+w.hostname:w.hostname,w=+w.port;const S=new pt(null);f&&Zn(S,f),c&&(S.g=c),w&&er(S,w),u&&(S.h=u),f=S}return u=i.G,c=i.wa,u&&c&&Z(f,u,c),Z(f,"VER",i.ka),ar(i,f),f}function Ec(i,c,u){if(c&&!i.L)throw Error("Can't create secondary domain capable XhrIo object.");return c=i.Aa&&!i.ma?new ne(new Ni({ab:u})):new ne(i.ma),c.Fa(i.L),c}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Ic(){}n=Ic.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function is(){}is.prototype.g=function(i,c){return new Me(i,c)};function Me(i,c){ve.call(this),this.g=new lc(c),this.l=i,this.h=c&&c.messageUrlParams||null,i=c&&c.messageHeaders||null,c&&c.clientProtocolHeaderRequired&&(i?i["X-Client-Protocol"]="webchannel":i={"X-Client-Protocol":"webchannel"}),this.g.o=i,i=c&&c.initMessageHeaders||null,c&&c.messageContentType&&(i?i["X-WebChannel-Content-Type"]=c.messageContentType:i={"X-WebChannel-Content-Type":c.messageContentType}),c&&c.sa&&(i?i["X-WebChannel-Client-Profile"]=c.sa:i={"X-WebChannel-Client-Profile":c.sa}),this.g.U=i,(i=c&&c.Qb)&&!m(i)&&(this.g.u=i),this.A=c&&c.supportsCrossDomainXhr||!1,this.v=c&&c.sendRawJson||!1,(c=c&&c.httpSessionIdParam)&&!m(c)&&(this.g.G=c,i=this.h,i!==null&&c in i&&(i=this.h,c in i&&delete i[c])),this.j=new gn(this)}_(Me,ve),Me.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},Me.prototype.close=function(){Vi(this.g)},Me.prototype.o=function(i){var c=this.g;if(typeof i=="string"){var u={};u.__data__=i,i=u}else this.v&&(u={},u.__data__=Ii(i),i=u);c.i.push(new pf(c.Ya++,i)),c.I==3&&rs(c)},Me.prototype.N=function(){this.g.l=null,delete this.j,Vi(this.g),delete this.g,Me.Z.N.call(this)};function vc(i){vi.call(this),i.__headers__&&(this.headers=i.__headers__,this.statusCode=i.__status__,delete i.__headers__,delete i.__status__);var c=i.__sm__;if(c){e:{for(const u in c){i=u;break e}i=void 0}(this.i=i)&&(i=this.i,c=c!==null&&i in c?c[i]:void 0),this.data=c}else this.data=i}_(vc,vi);function Tc(){Ti.call(this),this.status=1}_(Tc,Ti);function gn(i){this.g=i}_(gn,Ic),gn.prototype.ra=function(){Ce(this.g,"a")},gn.prototype.qa=function(i){Ce(this.g,new vc(i))},gn.prototype.pa=function(i){Ce(this.g,new Tc)},gn.prototype.oa=function(){Ce(this.g,"b")},is.prototype.createWebChannel=is.prototype.g,Me.prototype.send=Me.prototype.o,Me.prototype.open=Me.prototype.m,Me.prototype.close=Me.prototype.close,Lu=function(){return new is},Mu=function(){return Yr()},Ou=Gt,ro={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Jr.NO_ERROR=0,Jr.TIMEOUT=8,Jr.HTTP_ERROR=6,ps=Jr,Fa.COMPLETE="complete",Vu=Fa,Va.EventType=zn,zn.OPEN="a",zn.CLOSE="b",zn.ERROR="c",zn.MESSAGE="d",ve.prototype.listen=ve.prototype.J,dr=Va,ne.prototype.listenOnce=ne.prototype.K,ne.prototype.getLastError=ne.prototype.Ha,ne.prototype.getLastErrorCode=ne.prototype.ya,ne.prototype.getStatus=ne.prototype.ca,ne.prototype.getResponseJson=ne.prototype.La,ne.prototype.getResponseText=ne.prototype.la,ne.prototype.send=ne.prototype.ea,ne.prototype.setWithCredentials=ne.prototype.Fa,Du=ne}).apply(typeof as<"u"?as:typeof self<"u"?self:typeof window<"u"?window:{});class we{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}we.UNAUTHENTICATED=new we(null),we.GOOGLE_CREDENTIALS=new we("google-credentials-uid"),we.FIRST_PARTY=new we("first-party-uid"),we.MOCK_USER=new we("mock-user");let Bn="12.8.0";function pg(n){Bn=n}const rn=new Co("@firebase/firestore");function yn(){return rn.logLevel}function V(n,...e){if(rn.logLevel<=$.DEBUG){const t=e.map(ko);rn.debug(`Firestore (${Bn}): ${n}`,...t)}}function ct(n,...e){if(rn.logLevel<=$.ERROR){const t=e.map(ko);rn.error(`Firestore (${Bn}): ${n}`,...t)}}function kn(n,...e){if(rn.logLevel<=$.WARN){const t=e.map(ko);rn.warn(`Firestore (${Bn}): ${n}`,...t)}}function ko(n){if(typeof n=="string")return n;try{return(function(t){return JSON.stringify(t)})(n)}catch{return n}}function x(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,xu(n,r,t)}function xu(n,e,t){let r=`FIRESTORE (${Bn}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw ct(r),new Error(r)}function Q(n,e,t,r){let s="Unexpected state";typeof t=="string"?s=t:r=t,n||xu(e,s,r)}function B(n,e){return n}const b={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class D extends dt{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class ot{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class Fu{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class gg{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(we.UNAUTHENTICATED)))}shutdown(){}}class mg{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class _g{constructor(e){this.t=e,this.currentUser=we.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Q(this.o===void 0,42304);let r=this.i;const s=h=>this.i!==r?(r=this.i,t(h)):Promise.resolve();let o=new ot;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new ot,e.enqueueRetryable((()=>s(this.currentUser)))};const a=()=>{const h=o;e.enqueueRetryable((async()=>{await h.promise,await s(this.currentUser)}))},l=h=>{V("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit((h=>l(h))),setTimeout((()=>{if(!this.auth){const h=this.t.getImmediate({optional:!0});h?l(h):(V("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new ot)}}),0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((r=>this.i!==e?(V("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Q(typeof r.accessToken=="string",31837,{l:r}),new Fu(r.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Q(e===null||typeof e=="string",2055,{h:e}),new we(e)}}class yg{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=we.FIRST_PARTY,this.R=new Map}A(){return this.I?this.I():null}get headers(){this.R.set("X-Goog-AuthUser",this.P);const e=this.A();return e&&this.R.set("Authorization",e),this.T&&this.R.set("X-Goog-Iam-Authorization-Token",this.T),this.R}}class Eg{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new yg(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(we.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Mc{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Ig{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Be(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){Q(this.o===void 0,3512);const r=o=>{o.error!=null&&V("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);const a=o.token!==this.m;return this.m=o.token,V("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(o.token):Promise.resolve()};this.o=o=>{e.enqueueRetryable((()=>r(o)))};const s=o=>{V("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((o=>s(o))),setTimeout((()=>{if(!this.appCheck){const o=this.V.getImmediate({optional:!0});o?s(o):V("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new Mc(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((t=>t?(Q(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new Mc(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function vg(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}class No{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const s=vg(40);for(let o=0;o<s.length;++o)r.length<20&&s[o]<t&&(r+=e.charAt(s[o]%62))}return r}}function q(n,e){return n<e?-1:n>e?1:0}function so(n,e){const t=Math.min(n.length,e.length);for(let r=0;r<t;r++){const s=n.charAt(r),o=e.charAt(r);if(s!==o)return $i(s)===$i(o)?q(s,o):$i(s)?1:-1}return q(n.length,e.length)}const Tg=55296,wg=57343;function $i(n){const e=n.charCodeAt(0);return e>=Tg&&e<=wg}function Nn(n,e,t){return n.length===e.length&&n.every(((r,s)=>t(r,e[s])))}const Lc="__name__";class Ke{constructor(e,t,r){t===void 0?t=0:t>e.length&&x(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&x(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return Ke.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Ke?e.forEach((r=>{t.push(r)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const o=Ke.compareSegments(e.get(s),t.get(s));if(o!==0)return o}return q(e.length,t.length)}static compareSegments(e,t){const r=Ke.isNumericId(e),s=Ke.isNumericId(t);return r&&!s?-1:!r&&s?1:r&&s?Ke.extractNumericId(e).compare(Ke.extractNumericId(t)):so(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Vt.fromString(e.substring(4,e.length-2))}}class X extends Ke{construct(e,t,r){return new X(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new D(b.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter((s=>s.length>0)))}return new X(t)}static emptyPath(){return new X([])}}const Ag=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ye extends Ke{construct(e,t,r){return new ye(e,t,r)}static isValidIdentifier(e){return Ag.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ye.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Lc}static keyField(){return new ye([Lc])}static fromServerFormat(e){const t=[];let r="",s=0;const o=()=>{if(r.length===0)throw new D(b.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let a=!1;for(;s<e.length;){const l=e[s];if(l==="\\"){if(s+1===e.length)throw new D(b.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const h=e[s+1];if(h!=="\\"&&h!=="."&&h!=="`")throw new D(b.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=h,s+=2}else l==="`"?(a=!a,s++):l!=="."||a?(r+=l,s++):(o(),s++)}if(o(),a)throw new D(b.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new ye(t)}static emptyPath(){return new ye([])}}class L{constructor(e){this.path=e}static fromPath(e){return new L(X.fromString(e))}static fromName(e){return new L(X.fromString(e).popFirst(5))}static empty(){return new L(X.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&X.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return X.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new L(new X(e.slice()))}}function Uu(n,e,t){if(!t)throw new D(b.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function Rg(n,e,t,r){if(e===!0&&r===!0)throw new D(b.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function xc(n){if(!L.isDocumentKey(n))throw new D(b.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Fc(n){if(L.isDocumentKey(n))throw new D(b.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Bu(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function Gs(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=(function(r){return r.constructor?r.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":x(12329,{type:typeof n})}function He(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new D(b.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Gs(n);throw new D(b.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function ce(n,e){const t={typeString:n};return e&&(t.value=e),t}function Lr(n,e){if(!Bu(n))throw new D(b.INVALID_ARGUMENT,"JSON must be an object");let t;for(const r in e)if(e[r]){const s=e[r].typeString,o="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}const a=n[r];if(s&&typeof a!==s){t=`JSON field '${r}' must be a ${s}.`;break}if(o!==void 0&&a!==o.value){t=`Expected '${r}' field to equal '${o.value}'`;break}}if(t)throw new D(b.INVALID_ARGUMENT,t);return!0}const Uc=-62135596800,Bc=1e6;class ee{static now(){return ee.fromMillis(Date.now())}static fromDate(e){return ee.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*Bc);return new ee(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new D(b.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new D(b.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<Uc)throw new D(b.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new D(b.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Bc}_compareTo(e){return this.seconds===e.seconds?q(this.nanoseconds,e.nanoseconds):q(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:ee._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Lr(e,ee._jsonSchema))return new ee(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-Uc;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}ee._jsonSchemaVersion="firestore/timestamp/1.0",ee._jsonSchema={type:ce("string",ee._jsonSchemaVersion),seconds:ce("number"),nanoseconds:ce("number")};class U{static fromTimestamp(e){return new U(e)}static min(){return new U(new ee(0,0))}static max(){return new U(new ee(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const Ar=-1;function Sg(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=U.fromTimestamp(r===1e9?new ee(t+1,0):new ee(t,r));return new Lt(s,L.empty(),e)}function Cg(n){return new Lt(n.readTime,n.key,Ar)}class Lt{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new Lt(U.min(),L.empty(),Ar)}static max(){return new Lt(U.max(),L.empty(),Ar)}}function bg(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=L.comparator(n.documentKey,e.documentKey),t!==0?t:q(n.largestBatchId,e.largestBatchId))}const Pg="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class kg{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function jn(n){if(n.code!==b.FAILED_PRECONDITION||n.message!==Pg)throw n;V("LocalStore","Unexpectedly lost primary lease")}class P{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&x(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new P(((r,s)=>{this.nextCallback=o=>{this.wrapSuccess(e,o).next(r,s)},this.catchCallback=o=>{this.wrapFailure(t,o).next(r,s)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof P?t:P.resolve(t)}catch(t){return P.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):P.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):P.reject(t)}static resolve(e){return new P(((t,r)=>{t(e)}))}static reject(e){return new P(((t,r)=>{r(e)}))}static waitFor(e){return new P(((t,r)=>{let s=0,o=0,a=!1;e.forEach((l=>{++s,l.next((()=>{++o,a&&o===s&&t()}),(h=>r(h)))})),a=!0,o===s&&t()}))}static or(e){let t=P.resolve(!1);for(const r of e)t=t.next((s=>s?P.resolve(s):r()));return t}static forEach(e,t){const r=[];return e.forEach(((s,o)=>{r.push(t.call(this,s,o))})),this.waitFor(r)}static mapArray(e,t){return new P(((r,s)=>{const o=e.length,a=new Array(o);let l=0;for(let h=0;h<o;h++){const d=h;t(e[d]).next((p=>{a[d]=p,++l,l===o&&r(a)}),(p=>s(p)))}}))}static doWhile(e,t){return new P(((r,s)=>{const o=()=>{e()===!0?t().next((()=>{o()}),s):r()};o()}))}}function Ng(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function $n(n){return n.name==="IndexedDbTransactionError"}class Ws{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>t.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}Ws.ce=-1;const Do=-1;function zs(n){return n==null}function Cs(n){return n===0&&1/n==-1/0}function Dg(n){return typeof n=="number"&&Number.isInteger(n)&&!Cs(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}const ju="";function Vg(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=jc(e)),e=Og(n.get(t),e);return jc(e)}function Og(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const o=n.charAt(s);switch(o){case"\0":t+="";break;case ju:t+="";break;default:t+=o}}return t}function jc(n){return n+ju+""}function $c(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function $t(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function $u(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}class te{constructor(e,t){this.comparator=e,this.root=t||me.EMPTY}insert(e,t){return new te(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,me.BLACK,null,null))}remove(e){return new te(this.comparator,this.root.remove(e,this.comparator).copy(null,null,me.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,r)=>(e(t,r),!1)))}toString(){const e=[];return this.inorderTraversal(((t,r)=>(e.push(`${t}:${r}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new cs(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new cs(this.root,e,this.comparator,!1)}getReverseIterator(){return new cs(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new cs(this.root,e,this.comparator,!0)}}class cs{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let o=1;for(;!e.isEmpty();)if(o=t?r(e.key,t):1,t&&s&&(o*=-1),o<0)e=this.isReverse?e.left:e.right;else{if(o===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class me{constructor(e,t,r,s,o){this.key=e,this.value=t,this.color=r??me.RED,this.left=s??me.EMPTY,this.right=o??me.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,o){return new me(e??this.key,t??this.value,r??this.color,s??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const o=r(e,s.key);return s=o<0?s.copy(null,null,null,s.left.insert(e,t,r),null):o===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return me.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return me.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,me.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,me.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw x(43730,{key:this.key,value:this.value});if(this.right.isRed())throw x(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw x(27949);return e+(this.isRed()?0:1)}}me.EMPTY=null,me.RED=!0,me.BLACK=!1;me.EMPTY=new class{constructor(){this.size=0}get key(){throw x(57766)}get value(){throw x(16141)}get color(){throw x(16727)}get left(){throw x(29726)}get right(){throw x(36894)}copy(e,t,r,s,o){return this}insert(e,t,r){return new me(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class he{constructor(e){this.comparator=e,this.data=new te(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,r)=>(e(t),!1)))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new qc(this.data.getIterator())}getIteratorFrom(e){return new qc(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((r=>{t=t.add(r)})),t}isEqual(e){if(!(e instanceof he)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,o=r.getNext().key;if(this.comparator(s,o)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new he(this.comparator);return t.data=e,t}}class qc{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Le{constructor(e){this.fields=e,e.sort(ye.comparator)}static empty(){return new Le([])}unionWith(e){let t=new he(ye.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new Le(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Nn(this.fields,e.fields,((t,r)=>t.isEqual(r)))}}class qu extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Ie{constructor(e){this.binaryString=e}static fromBase64String(e){const t=(function(s){try{return atob(s)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new qu("Invalid base64 string: "+o):o}})(e);return new Ie(t)}static fromUint8Array(e){const t=(function(s){let o="";for(let a=0;a<s.length;++a)o+=String.fromCharCode(s[a]);return o})(e);return new Ie(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return q(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Ie.EMPTY_BYTE_STRING=new Ie("");const Mg=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function xt(n){if(Q(!!n,39018),typeof n=="string"){let e=0;const t=Mg.exec(n);if(Q(!!t,46558,{timestamp:n}),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:re(n.seconds),nanos:re(n.nanos)}}function re(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Ft(n){return typeof n=="string"?Ie.fromBase64String(n):Ie.fromUint8Array(n)}const Hu="server_timestamp",Gu="__type__",Wu="__previous_value__",zu="__local_write_time__";function Vo(n){return(n?.mapValue?.fields||{})[Gu]?.stringValue===Hu}function Ks(n){const e=n.mapValue.fields[Wu];return Vo(e)?Ks(e):e}function Rr(n){const e=xt(n.mapValue.fields[zu].timestampValue);return new ee(e.seconds,e.nanos)}class Lg{constructor(e,t,r,s,o,a,l,h,d,p,_){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=o,this.forceLongPolling=a,this.autoDetectLongPolling=l,this.longPollingOptions=h,this.useFetchStreams=d,this.isUsingEmulator=p,this.apiKey=_}}const bs="(default)";class Sr{constructor(e,t){this.projectId=e,this.database=t||bs}static empty(){return new Sr("","")}get isDefaultDatabase(){return this.database===bs}isEqual(e){return e instanceof Sr&&e.projectId===this.projectId&&e.database===this.database}}function xg(n,e){if(!Object.prototype.hasOwnProperty.apply(n.options,["projectId"]))throw new D(b.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Sr(n.options.projectId,e)}const Ku="__type__",Fg="__max__",ls={mapValue:{}},Qu="__vector__",Ps="value";function Ut(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Vo(n)?4:Bg(n)?9007199254740991:Ug(n)?10:11:x(28295,{value:n})}function et(n,e){if(n===e)return!0;const t=Ut(n);if(t!==Ut(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Rr(n).isEqual(Rr(e));case 3:return(function(s,o){if(typeof s.timestampValue=="string"&&typeof o.timestampValue=="string"&&s.timestampValue.length===o.timestampValue.length)return s.timestampValue===o.timestampValue;const a=xt(s.timestampValue),l=xt(o.timestampValue);return a.seconds===l.seconds&&a.nanos===l.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(s,o){return Ft(s.bytesValue).isEqual(Ft(o.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(s,o){return re(s.geoPointValue.latitude)===re(o.geoPointValue.latitude)&&re(s.geoPointValue.longitude)===re(o.geoPointValue.longitude)})(n,e);case 2:return(function(s,o){if("integerValue"in s&&"integerValue"in o)return re(s.integerValue)===re(o.integerValue);if("doubleValue"in s&&"doubleValue"in o){const a=re(s.doubleValue),l=re(o.doubleValue);return a===l?Cs(a)===Cs(l):isNaN(a)&&isNaN(l)}return!1})(n,e);case 9:return Nn(n.arrayValue.values||[],e.arrayValue.values||[],et);case 10:case 11:return(function(s,o){const a=s.mapValue.fields||{},l=o.mapValue.fields||{};if($c(a)!==$c(l))return!1;for(const h in a)if(a.hasOwnProperty(h)&&(l[h]===void 0||!et(a[h],l[h])))return!1;return!0})(n,e);default:return x(52216,{left:n})}}function Cr(n,e){return(n.values||[]).find((t=>et(t,e)))!==void 0}function Dn(n,e){if(n===e)return 0;const t=Ut(n),r=Ut(e);if(t!==r)return q(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return q(n.booleanValue,e.booleanValue);case 2:return(function(o,a){const l=re(o.integerValue||o.doubleValue),h=re(a.integerValue||a.doubleValue);return l<h?-1:l>h?1:l===h?0:isNaN(l)?isNaN(h)?0:-1:1})(n,e);case 3:return Hc(n.timestampValue,e.timestampValue);case 4:return Hc(Rr(n),Rr(e));case 5:return so(n.stringValue,e.stringValue);case 6:return(function(o,a){const l=Ft(o),h=Ft(a);return l.compareTo(h)})(n.bytesValue,e.bytesValue);case 7:return(function(o,a){const l=o.split("/"),h=a.split("/");for(let d=0;d<l.length&&d<h.length;d++){const p=q(l[d],h[d]);if(p!==0)return p}return q(l.length,h.length)})(n.referenceValue,e.referenceValue);case 8:return(function(o,a){const l=q(re(o.latitude),re(a.latitude));return l!==0?l:q(re(o.longitude),re(a.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return Gc(n.arrayValue,e.arrayValue);case 10:return(function(o,a){const l=o.fields||{},h=a.fields||{},d=l[Ps]?.arrayValue,p=h[Ps]?.arrayValue,_=q(d?.values?.length||0,p?.values?.length||0);return _!==0?_:Gc(d,p)})(n.mapValue,e.mapValue);case 11:return(function(o,a){if(o===ls.mapValue&&a===ls.mapValue)return 0;if(o===ls.mapValue)return 1;if(a===ls.mapValue)return-1;const l=o.fields||{},h=Object.keys(l),d=a.fields||{},p=Object.keys(d);h.sort(),p.sort();for(let _=0;_<h.length&&_<p.length;++_){const E=so(h[_],p[_]);if(E!==0)return E;const C=Dn(l[h[_]],d[p[_]]);if(C!==0)return C}return q(h.length,p.length)})(n.mapValue,e.mapValue);default:throw x(23264,{he:t})}}function Hc(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return q(n,e);const t=xt(n),r=xt(e),s=q(t.seconds,r.seconds);return s!==0?s:q(t.nanos,r.nanos)}function Gc(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const o=Dn(t[s],r[s]);if(o)return o}return q(t.length,r.length)}function Vn(n){return io(n)}function io(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(t){const r=xt(t);return`time(${r.seconds},${r.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(t){return Ft(t).toBase64()})(n.bytesValue):"referenceValue"in n?(function(t){return L.fromName(t).toString()})(n.referenceValue):"geoPointValue"in n?(function(t){return`geo(${t.latitude},${t.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(t){let r="[",s=!0;for(const o of t.values||[])s?s=!1:r+=",",r+=io(o);return r+"]"})(n.arrayValue):"mapValue"in n?(function(t){const r=Object.keys(t.fields||{}).sort();let s="{",o=!0;for(const a of r)o?o=!1:s+=",",s+=`${a}:${io(t.fields[a])}`;return s+"}"})(n.mapValue):x(61005,{value:n})}function gs(n){switch(Ut(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Ks(n);return e?16+gs(e):16;case 5:return 2*n.stringValue.length;case 6:return Ft(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(r){return(r.values||[]).reduce(((s,o)=>s+gs(o)),0)})(n.arrayValue);case 10:case 11:return(function(r){let s=0;return $t(r.fields,((o,a)=>{s+=o.length+gs(a)})),s})(n.mapValue);default:throw x(13486,{value:n})}}function Wc(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function oo(n){return!!n&&"integerValue"in n}function Oo(n){return!!n&&"arrayValue"in n}function zc(n){return!!n&&"nullValue"in n}function Kc(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function ms(n){return!!n&&"mapValue"in n}function Ug(n){return(n?.mapValue?.fields||{})[Ku]?.stringValue===Qu}function _r(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return $t(n.mapValue.fields,((t,r)=>e.mapValue.fields[t]=_r(r))),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=_r(n.arrayValue.values[t]);return e}return{...n}}function Bg(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===Fg}class Ve{constructor(e){this.value=e}static empty(){return new Ve({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!ms(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=_r(t)}setAll(e){let t=ye.emptyPath(),r={},s=[];e.forEach(((a,l)=>{if(!t.isImmediateParentOf(l)){const h=this.getFieldsMap(t);this.applyChanges(h,r,s),r={},s=[],t=l.popLast()}a?r[l.lastSegment()]=_r(a):s.push(l.lastSegment())}));const o=this.getFieldsMap(t);this.applyChanges(o,r,s)}delete(e){const t=this.field(e.popLast());ms(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return et(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];ms(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){$t(t,((s,o)=>e[s]=o));for(const s of r)delete e[s]}clone(){return new Ve(_r(this.value))}}function Yu(n){const e=[];return $t(n.fields,((t,r)=>{const s=new ye([t]);if(ms(r)){const o=Yu(r.mapValue).fields;if(o.length===0)e.push(s);else for(const a of o)e.push(s.child(a))}else e.push(s)})),new Le(e)}class Ae{constructor(e,t,r,s,o,a,l){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=o,this.data=a,this.documentState=l}static newInvalidDocument(e){return new Ae(e,0,U.min(),U.min(),U.min(),Ve.empty(),0)}static newFoundDocument(e,t,r,s){return new Ae(e,1,t,U.min(),r,s,0)}static newNoDocument(e,t){return new Ae(e,2,t,U.min(),U.min(),Ve.empty(),0)}static newUnknownDocument(e,t){return new Ae(e,3,t,U.min(),U.min(),Ve.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(U.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Ve.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Ve.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=U.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Ae&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Ae(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class ks{constructor(e,t){this.position=e,this.inclusive=t}}function Qc(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const o=e[s],a=n.position[s];if(o.field.isKeyField()?r=L.comparator(L.fromName(a.referenceValue),t.key):r=Dn(a,t.data.field(o.field)),o.dir==="desc"&&(r*=-1),r!==0)break}return r}function Yc(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!et(n.position[t],e.position[t]))return!1;return!0}class br{constructor(e,t="asc"){this.field=e,this.dir=t}}function jg(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class Ju{}class ae extends Ju{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new qg(e,t,r):t==="array-contains"?new Wg(e,r):t==="in"?new zg(e,r):t==="not-in"?new Kg(e,r):t==="array-contains-any"?new Qg(e,r):new ae(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new Hg(e,r):new Gg(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(Dn(t,this.value)):t!==null&&Ut(this.value)===Ut(t)&&this.matchesComparison(Dn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return x(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Ge extends Ju{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new Ge(e,t)}matches(e){return Xu(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function Xu(n){return n.op==="and"}function Zu(n){return $g(n)&&Xu(n)}function $g(n){for(const e of n.filters)if(e instanceof Ge)return!1;return!0}function ao(n){if(n instanceof ae)return n.field.canonicalString()+n.op.toString()+Vn(n.value);if(Zu(n))return n.filters.map((e=>ao(e))).join(",");{const e=n.filters.map((t=>ao(t))).join(",");return`${n.op}(${e})`}}function eh(n,e){return n instanceof ae?(function(r,s){return s instanceof ae&&r.op===s.op&&r.field.isEqual(s.field)&&et(r.value,s.value)})(n,e):n instanceof Ge?(function(r,s){return s instanceof Ge&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce(((o,a,l)=>o&&eh(a,s.filters[l])),!0):!1})(n,e):void x(19439)}function th(n){return n instanceof ae?(function(t){return`${t.field.canonicalString()} ${t.op} ${Vn(t.value)}`})(n):n instanceof Ge?(function(t){return t.op.toString()+" {"+t.getFilters().map(th).join(" ,")+"}"})(n):"Filter"}class qg extends ae{constructor(e,t,r){super(e,t,r),this.key=L.fromName(r.referenceValue)}matches(e){const t=L.comparator(e.key,this.key);return this.matchesComparison(t)}}class Hg extends ae{constructor(e,t){super(e,"in",t),this.keys=nh("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class Gg extends ae{constructor(e,t){super(e,"not-in",t),this.keys=nh("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function nh(n,e){return(e.arrayValue?.values||[]).map((t=>L.fromName(t.referenceValue)))}class Wg extends ae{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Oo(t)&&Cr(t.arrayValue,this.value)}}class zg extends ae{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Cr(this.value.arrayValue,t)}}class Kg extends ae{constructor(e,t){super(e,"not-in",t)}matches(e){if(Cr(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!Cr(this.value.arrayValue,t)}}class Qg extends ae{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Oo(t)||!t.arrayValue.values)&&t.arrayValue.values.some((r=>Cr(this.value.arrayValue,r)))}}class Yg{constructor(e,t=null,r=[],s=[],o=null,a=null,l=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=o,this.startAt=a,this.endAt=l,this.Te=null}}function Jc(n,e=null,t=[],r=[],s=null,o=null,a=null){return new Yg(n,e,t,r,s,o,a)}function Mo(n){const e=B(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((r=>ao(r))).join(","),t+="|ob:",t+=e.orderBy.map((r=>(function(o){return o.field.canonicalString()+o.dir})(r))).join(","),zs(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((r=>Vn(r))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((r=>Vn(r))).join(",")),e.Te=t}return e.Te}function Lo(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!jg(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!eh(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Yc(n.startAt,e.startAt)&&Yc(n.endAt,e.endAt)}function co(n){return L.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}class qn{constructor(e,t=null,r=[],s=[],o=null,a="F",l=null,h=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=o,this.limitType=a,this.startAt=l,this.endAt=h,this.Ie=null,this.Ee=null,this.Re=null,this.startAt,this.endAt}}function Jg(n,e,t,r,s,o,a,l){return new qn(n,e,t,r,s,o,a,l)}function xo(n){return new qn(n)}function Xc(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Xg(n){return L.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function rh(n){return n.collectionGroup!==null}function yr(n){const e=B(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const o of e.explicitOrderBy)e.Ie.push(o),t.add(o.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let l=new he(ye.comparator);return a.filters.forEach((h=>{h.getFlattenedFilters().forEach((d=>{d.isInequality()&&(l=l.add(d.field))}))})),l})(e).forEach((o=>{t.has(o.canonicalString())||o.isKeyField()||e.Ie.push(new br(o,r))})),t.has(ye.keyField().canonicalString())||e.Ie.push(new br(ye.keyField(),r))}return e.Ie}function Qe(n){const e=B(n);return e.Ee||(e.Ee=Zg(e,yr(n))),e.Ee}function Zg(n,e){if(n.limitType==="F")return Jc(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map((s=>{const o=s.dir==="desc"?"asc":"desc";return new br(s.field,o)}));const t=n.endAt?new ks(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new ks(n.startAt.position,n.startAt.inclusive):null;return Jc(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function lo(n,e){const t=n.filters.concat([e]);return new qn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function em(n,e){const t=n.explicitOrderBy.concat([e]);return new qn(n.path,n.collectionGroup,t,n.filters.slice(),n.limit,n.limitType,n.startAt,n.endAt)}function uo(n,e,t){return new qn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Qs(n,e){return Lo(Qe(n),Qe(e))&&n.limitType===e.limitType}function sh(n){return`${Mo(Qe(n))}|lt:${n.limitType}`}function En(n){return`Query(target=${(function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map((s=>th(s))).join(", ")}]`),zs(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map((s=>(function(a){return`${a.field.canonicalString()} (${a.dir})`})(s))).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map((s=>Vn(s))).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map((s=>Vn(s))).join(",")),`Target(${r})`})(Qe(n))}; limitType=${n.limitType})`}function Ys(n,e){return e.isFoundDocument()&&(function(r,s){const o=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(o):L.isDocumentKey(r.path)?r.path.isEqual(o):r.path.isImmediateParentOf(o)})(n,e)&&(function(r,s){for(const o of yr(r))if(!o.field.isKeyField()&&s.data.field(o.field)===null)return!1;return!0})(n,e)&&(function(r,s){for(const o of r.filters)if(!o.matches(s))return!1;return!0})(n,e)&&(function(r,s){return!(r.startAt&&!(function(a,l,h){const d=Qc(a,l,h);return a.inclusive?d<=0:d<0})(r.startAt,yr(r),s)||r.endAt&&!(function(a,l,h){const d=Qc(a,l,h);return a.inclusive?d>=0:d>0})(r.endAt,yr(r),s))})(n,e)}function tm(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function ih(n){return(e,t)=>{let r=!1;for(const s of yr(n)){const o=nm(s,e,t);if(o!==0)return o;r=r||s.field.isKeyField()}return 0}}function nm(n,e,t){const r=n.field.isKeyField()?L.comparator(e.key,t.key):(function(o,a,l){const h=a.data.field(o),d=l.data.field(o);return h!==null&&d!==null?Dn(h,d):x(42886)})(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return x(19790,{direction:n.dir})}}class ln{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,o]of r)if(this.equalsFn(s,e))return o}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let o=0;o<s.length;o++)if(this.equalsFn(s[o][0],e))return void(s[o]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){$t(this.inner,((t,r)=>{for(const[s,o]of r)e(s,o)}))}isEmpty(){return $u(this.inner)}size(){return this.innerSize}}const rm=new te(L.comparator);function lt(){return rm}const oh=new te(L.comparator);function fr(...n){let e=oh;for(const t of n)e=e.insert(t.key,t);return e}function ah(n){let e=oh;return n.forEach(((t,r)=>e=e.insert(t,r.overlayedDocument))),e}function Jt(){return Er()}function ch(){return Er()}function Er(){return new ln((n=>n.toString()),((n,e)=>n.isEqual(e)))}const sm=new te(L.comparator),im=new he(L.comparator);function H(...n){let e=im;for(const t of n)e=e.add(t);return e}const om=new he(q);function am(){return om}function Fo(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Cs(e)?"-0":e}}function lh(n){return{integerValue:""+n}}function cm(n,e){return Dg(e)?lh(e):Fo(n,e)}class Js{constructor(){this._=void 0}}function lm(n,e,t){return n instanceof Ns?(function(s,o){const a={fields:{[Gu]:{stringValue:Hu},[zu]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return o&&Vo(o)&&(o=Ks(o)),o&&(a.fields[Wu]=o),{mapValue:a}})(t,e):n instanceof Pr?hh(n,e):n instanceof kr?dh(n,e):(function(s,o){const a=uh(s,o),l=Zc(a)+Zc(s.Ae);return oo(a)&&oo(s.Ae)?lh(l):Fo(s.serializer,l)})(n,e)}function um(n,e,t){return n instanceof Pr?hh(n,e):n instanceof kr?dh(n,e):t}function uh(n,e){return n instanceof Ds?(function(r){return oo(r)||(function(o){return!!o&&"doubleValue"in o})(r)})(e)?e:{integerValue:0}:null}class Ns extends Js{}class Pr extends Js{constructor(e){super(),this.elements=e}}function hh(n,e){const t=fh(e);for(const r of n.elements)t.some((s=>et(s,r)))||t.push(r);return{arrayValue:{values:t}}}class kr extends Js{constructor(e){super(),this.elements=e}}function dh(n,e){let t=fh(e);for(const r of n.elements)t=t.filter((s=>!et(s,r)));return{arrayValue:{values:t}}}class Ds extends Js{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function Zc(n){return re(n.integerValue||n.doubleValue)}function fh(n){return Oo(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function hm(n,e){return n.field.isEqual(e.field)&&(function(r,s){return r instanceof Pr&&s instanceof Pr||r instanceof kr&&s instanceof kr?Nn(r.elements,s.elements,et):r instanceof Ds&&s instanceof Ds?et(r.Ae,s.Ae):r instanceof Ns&&s instanceof Ns})(n.transform,e.transform)}class dm{constructor(e,t){this.version=e,this.transformResults=t}}class Fe{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Fe}static exists(e){return new Fe(void 0,e)}static updateTime(e){return new Fe(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function _s(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class Xs{}function ph(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Uo(n.key,Fe.none()):new xr(n.key,n.data,Fe.none());{const t=n.data,r=Ve.empty();let s=new he(ye.comparator);for(let o of e.fields)if(!s.has(o)){let a=t.field(o);a===null&&o.length>1&&(o=o.popLast(),a=t.field(o)),a===null?r.delete(o):r.set(o,a),s=s.add(o)}return new qt(n.key,r,new Le(s.toArray()),Fe.none())}}function fm(n,e,t){n instanceof xr?(function(s,o,a){const l=s.value.clone(),h=tl(s.fieldTransforms,o,a.transformResults);l.setAll(h),o.convertToFoundDocument(a.version,l).setHasCommittedMutations()})(n,e,t):n instanceof qt?(function(s,o,a){if(!_s(s.precondition,o))return void o.convertToUnknownDocument(a.version);const l=tl(s.fieldTransforms,o,a.transformResults),h=o.data;h.setAll(gh(s)),h.setAll(l),o.convertToFoundDocument(a.version,h).setHasCommittedMutations()})(n,e,t):(function(s,o,a){o.convertToNoDocument(a.version).setHasCommittedMutations()})(0,e,t)}function Ir(n,e,t,r){return n instanceof xr?(function(o,a,l,h){if(!_s(o.precondition,a))return l;const d=o.value.clone(),p=nl(o.fieldTransforms,h,a);return d.setAll(p),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),null})(n,e,t,r):n instanceof qt?(function(o,a,l,h){if(!_s(o.precondition,a))return l;const d=nl(o.fieldTransforms,h,a),p=a.data;return p.setAll(gh(o)),p.setAll(d),a.convertToFoundDocument(a.version,p).setHasLocalMutations(),l===null?null:l.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map((_=>_.field)))})(n,e,t,r):(function(o,a,l){return _s(o.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):l})(n,e,t)}function pm(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),o=uh(r.transform,s||null);o!=null&&(t===null&&(t=Ve.empty()),t.set(r.field,o))}return t||null}function el(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!(function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&Nn(r,s,((o,a)=>hm(o,a)))})(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class xr extends Xs{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class qt extends Xs{constructor(e,t,r,s,o=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}}function gh(n){const e=new Map;return n.fieldMask.fields.forEach((t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}})),e}function tl(n,e,t){const r=new Map;Q(n.length===t.length,32656,{Ve:t.length,de:n.length});for(let s=0;s<t.length;s++){const o=n[s],a=o.transform,l=e.data.field(o.field);r.set(o.field,um(a,l,t[s]))}return r}function nl(n,e,t){const r=new Map;for(const s of n){const o=s.transform,a=t.data.field(s.field);r.set(s.field,lm(o,a,e))}return r}class Uo extends Xs{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class gm extends Xs{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class mm{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const o=this.mutations[s];o.key.isEqual(e.key)&&fm(o,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=Ir(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=Ir(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=ch();return this.mutations.forEach((s=>{const o=e.get(s.key),a=o.overlayedDocument;let l=this.applyToLocalView(a,o.mutatedFields);l=t.has(s.key)?null:l;const h=ph(a,l);h!==null&&r.set(s.key,h),a.isValidDocument()||a.convertToNoDocument(U.min())})),r}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),H())}isEqual(e){return this.batchId===e.batchId&&Nn(this.mutations,e.mutations,((t,r)=>el(t,r)))&&Nn(this.baseMutations,e.baseMutations,((t,r)=>el(t,r)))}}class Bo{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){Q(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let s=(function(){return sm})();const o=e.mutations;for(let a=0;a<o.length;a++)s=s.insert(o[a].key,r[a].version);return new Bo(e,t,r,s)}}class _m{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class ym{constructor(e,t){this.count=e,this.unchangedNames=t}}var ie,W;function Em(n){switch(n){case b.OK:return x(64938);case b.CANCELLED:case b.UNKNOWN:case b.DEADLINE_EXCEEDED:case b.RESOURCE_EXHAUSTED:case b.INTERNAL:case b.UNAVAILABLE:case b.UNAUTHENTICATED:return!1;case b.INVALID_ARGUMENT:case b.NOT_FOUND:case b.ALREADY_EXISTS:case b.PERMISSION_DENIED:case b.FAILED_PRECONDITION:case b.ABORTED:case b.OUT_OF_RANGE:case b.UNIMPLEMENTED:case b.DATA_LOSS:return!0;default:return x(15467,{code:n})}}function mh(n){if(n===void 0)return ct("GRPC error has no .code"),b.UNKNOWN;switch(n){case ie.OK:return b.OK;case ie.CANCELLED:return b.CANCELLED;case ie.UNKNOWN:return b.UNKNOWN;case ie.DEADLINE_EXCEEDED:return b.DEADLINE_EXCEEDED;case ie.RESOURCE_EXHAUSTED:return b.RESOURCE_EXHAUSTED;case ie.INTERNAL:return b.INTERNAL;case ie.UNAVAILABLE:return b.UNAVAILABLE;case ie.UNAUTHENTICATED:return b.UNAUTHENTICATED;case ie.INVALID_ARGUMENT:return b.INVALID_ARGUMENT;case ie.NOT_FOUND:return b.NOT_FOUND;case ie.ALREADY_EXISTS:return b.ALREADY_EXISTS;case ie.PERMISSION_DENIED:return b.PERMISSION_DENIED;case ie.FAILED_PRECONDITION:return b.FAILED_PRECONDITION;case ie.ABORTED:return b.ABORTED;case ie.OUT_OF_RANGE:return b.OUT_OF_RANGE;case ie.UNIMPLEMENTED:return b.UNIMPLEMENTED;case ie.DATA_LOSS:return b.DATA_LOSS;default:return x(39323,{code:n})}}(W=ie||(ie={}))[W.OK=0]="OK",W[W.CANCELLED=1]="CANCELLED",W[W.UNKNOWN=2]="UNKNOWN",W[W.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",W[W.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",W[W.NOT_FOUND=5]="NOT_FOUND",W[W.ALREADY_EXISTS=6]="ALREADY_EXISTS",W[W.PERMISSION_DENIED=7]="PERMISSION_DENIED",W[W.UNAUTHENTICATED=16]="UNAUTHENTICATED",W[W.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",W[W.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",W[W.ABORTED=10]="ABORTED",W[W.OUT_OF_RANGE=11]="OUT_OF_RANGE",W[W.UNIMPLEMENTED=12]="UNIMPLEMENTED",W[W.INTERNAL=13]="INTERNAL",W[W.UNAVAILABLE=14]="UNAVAILABLE",W[W.DATA_LOSS=15]="DATA_LOSS";function Im(){return new TextEncoder}const vm=new Vt([4294967295,4294967295],0);function rl(n){const e=Im().encode(n),t=new Nu;return t.update(e),new Uint8Array(t.digest())}function sl(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),o=e.getUint32(12,!0);return[new Vt([t,r],0),new Vt([s,o],0)]}class jo{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new pr(`Invalid padding: ${t}`);if(r<0)throw new pr(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new pr(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new pr(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=Vt.fromNumber(this.ge)}ye(e,t,r){let s=e.add(t.multiply(Vt.fromNumber(r)));return s.compare(vm)===1&&(s=new Vt([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=rl(e),[r,s]=sl(t);for(let o=0;o<this.hashCount;o++){const a=this.ye(r,s,o);if(!this.we(a))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,o=new Uint8Array(Math.ceil(e/8)),a=new jo(o,s,t);return r.forEach((l=>a.insert(l))),a}insert(e){if(this.ge===0)return;const t=rl(e),[r,s]=sl(t);for(let o=0;o<this.hashCount;o++){const a=this.ye(r,s,o);this.be(a)}}be(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class pr extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Zs{constructor(e,t,r,s,o){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,Fr.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new Zs(U.min(),s,new te(q),lt(),H())}}class Fr{constructor(e,t,r,s,o){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new Fr(r,t,H(),H(),H())}}class ys{constructor(e,t,r,s){this.Se=e,this.removedTargetIds=t,this.key=r,this.De=s}}class _h{constructor(e,t){this.targetId=e,this.Ce=t}}class yh{constructor(e,t,r=Ie.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class il{constructor(){this.ve=0,this.Fe=ol(),this.Me=Ie.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=H(),t=H(),r=H();return this.Fe.forEach(((s,o)=>{switch(o){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:x(38017,{changeType:o})}})),new Fr(this.Me,this.xe,e,t,r)}Ke(){this.Oe=!1,this.Fe=ol()}qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}Ue(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}$e(){this.ve+=1}We(){this.ve-=1,Q(this.ve>=0,3241,{ve:this.ve})}Qe(){this.Oe=!0,this.xe=!0}}class Tm{constructor(e){this.Ge=e,this.ze=new Map,this.je=lt(),this.He=us(),this.Je=us(),this.Ze=new te(q)}Xe(e){for(const t of e.Se)e.De&&e.De.isFoundDocument()?this.Ye(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,(t=>{const r=this.nt(t);switch(e.state){case 0:this.rt(t)&&r.Le(e.resumeToken);break;case 1:r.We(),r.Ne||r.Ke(),r.Le(e.resumeToken);break;case 2:r.We(),r.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(r.Qe(),r.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),r.Le(e.resumeToken));break;default:x(56790,{state:e.state})}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach(((r,s)=>{this.rt(s)&&t(s)}))}st(e){const t=e.targetId,r=e.Ce.count,s=this.ot(t);if(s){const o=s.target;if(co(o))if(r===0){const a=new L(o.path);this.et(t,a,Ae.newNoDocument(a,U.min()))}else Q(r===1,20013,{expectedCount:r});else{const a=this._t(t);if(a!==r){const l=this.ut(e),h=l?this.ct(l,e,a):1;if(h!==0){this.it(t);const d=h===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ze=this.Ze.insert(t,d)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:o=0}=t;let a,l;try{a=Ft(r).toUint8Array()}catch(h){if(h instanceof qu)return kn("Decoding the base64 bloom filter in existence filter failed ("+h.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw h}try{l=new jo(a,s,o)}catch(h){return kn(h instanceof pr?"BloomFilter error: ":"Applying bloom filter failed: ",h),null}return l.ge===0?null:l}ct(e,t,r){return t.Ce.count===r-this.Pt(e,t.targetId)?0:2}Pt(e,t){const r=this.Ge.getRemoteKeysForTarget(t);let s=0;return r.forEach((o=>{const a=this.Ge.ht(),l=`projects/${a.projectId}/databases/${a.database}/documents/${o.path.canonicalString()}`;e.mightContain(l)||(this.et(t,o,null),s++)})),s}Tt(e){const t=new Map;this.ze.forEach(((o,a)=>{const l=this.ot(a);if(l){if(o.current&&co(l.target)){const h=new L(l.target.path);this.It(h).has(a)||this.Et(a,h)||this.et(a,h,Ae.newNoDocument(h,e))}o.Be&&(t.set(a,o.ke()),o.Ke())}}));let r=H();this.Je.forEach(((o,a)=>{let l=!0;a.forEachWhile((h=>{const d=this.ot(h);return!d||d.purpose==="TargetPurposeLimboResolution"||(l=!1,!1)})),l&&(r=r.add(o))})),this.je.forEach(((o,a)=>a.setReadTime(e)));const s=new Zs(e,t,this.Ze,this.je,r);return this.je=lt(),this.He=us(),this.Je=us(),this.Ze=new te(q),s}Ye(e,t){if(!this.rt(e))return;const r=this.Et(e,t.key)?2:0;this.nt(e).qe(t.key,r),this.je=this.je.insert(t.key,t),this.He=this.He.insert(t.key,this.It(t.key).add(e)),this.Je=this.Je.insert(t.key,this.Rt(t.key).add(e))}et(e,t,r){if(!this.rt(e))return;const s=this.nt(e);this.Et(e,t)?s.qe(t,1):s.Ue(t),this.Je=this.Je.insert(t,this.Rt(t).delete(e)),this.Je=this.Je.insert(t,this.Rt(t).add(e)),r&&(this.je=this.je.insert(t,r))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}$e(e){this.nt(e).$e()}nt(e){let t=this.ze.get(e);return t||(t=new il,this.ze.set(e,t)),t}Rt(e){let t=this.Je.get(e);return t||(t=new he(q),this.Je=this.Je.insert(e,t)),t}It(e){let t=this.He.get(e);return t||(t=new he(q),this.He=this.He.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||V("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new il),this.Ge.getRemoteKeysForTarget(e).forEach((t=>{this.et(e,t,null)}))}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function us(){return new te(L.comparator)}function ol(){return new te(L.comparator)}const wm={asc:"ASCENDING",desc:"DESCENDING"},Am={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Rm={and:"AND",or:"OR"};class Sm{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function ho(n,e){return n.useProto3Json||zs(e)?e:{value:e}}function Vs(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Eh(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function Cm(n,e){return Vs(n,e.toTimestamp())}function Ye(n){return Q(!!n,49232),U.fromTimestamp((function(t){const r=xt(t);return new ee(r.seconds,r.nanos)})(n))}function $o(n,e){return fo(n,e).canonicalString()}function fo(n,e){const t=(function(s){return new X(["projects",s.projectId,"databases",s.database])})(n).child("documents");return e===void 0?t:t.child(e)}function Ih(n){const e=X.fromString(n);return Q(Rh(e),10190,{key:e.toString()}),e}function po(n,e){return $o(n.databaseId,e.path)}function qi(n,e){const t=Ih(e);if(t.get(1)!==n.databaseId.projectId)throw new D(b.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new D(b.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new L(Th(t))}function vh(n,e){return $o(n.databaseId,e)}function bm(n){const e=Ih(n);return e.length===4?X.emptyPath():Th(e)}function go(n){return new X(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Th(n){return Q(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function al(n,e,t){return{name:po(n,e),fields:t.value.mapValue.fields}}function Pm(n,e){let t;if("targetChange"in e){e.targetChange;const r=(function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:x(39313,{state:d})})(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],o=(function(d,p){return d.useProto3Json?(Q(p===void 0||typeof p=="string",58123),Ie.fromBase64String(p||"")):(Q(p===void 0||p instanceof Buffer||p instanceof Uint8Array,16193),Ie.fromUint8Array(p||new Uint8Array))})(n,e.targetChange.resumeToken),a=e.targetChange.cause,l=a&&(function(d){const p=d.code===void 0?b.UNKNOWN:mh(d.code);return new D(p,d.message||"")})(a);t=new yh(r,s,o,l||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=qi(n,r.document.name),o=Ye(r.document.updateTime),a=r.document.createTime?Ye(r.document.createTime):U.min(),l=new Ve({mapValue:{fields:r.document.fields}}),h=Ae.newFoundDocument(s,o,a,l),d=r.targetIds||[],p=r.removedTargetIds||[];t=new ys(d,p,h.key,h)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=qi(n,r.document),o=r.readTime?Ye(r.readTime):U.min(),a=Ae.newNoDocument(s,o),l=r.removedTargetIds||[];t=new ys([],l,a.key,a)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=qi(n,r.document),o=r.removedTargetIds||[];t=new ys([],o,s,null)}else{if(!("filter"in e))return x(11601,{Vt:e});{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:o}=r,a=new ym(s,o),l=r.targetId;t=new _h(l,a)}}return t}function km(n,e){let t;if(e instanceof xr)t={update:al(n,e.key,e.value)};else if(e instanceof Uo)t={delete:po(n,e.key)};else if(e instanceof qt)t={update:al(n,e.key,e.data),updateMask:Um(e.fieldMask)};else{if(!(e instanceof gm))return x(16599,{dt:e.type});t={verify:po(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map((r=>(function(o,a){const l=a.transform;if(l instanceof Ns)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(l instanceof Pr)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:l.elements}};if(l instanceof kr)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:l.elements}};if(l instanceof Ds)return{fieldPath:a.field.canonicalString(),increment:l.Ae};throw x(20930,{transform:a.transform})})(0,r)))),e.precondition.isNone||(t.currentDocument=(function(s,o){return o.updateTime!==void 0?{updateTime:Cm(s,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:x(27497)})(n,e.precondition)),t}function Nm(n,e){return n&&n.length>0?(Q(e!==void 0,14353),n.map((t=>(function(s,o){let a=s.updateTime?Ye(s.updateTime):Ye(o);return a.isEqual(U.min())&&(a=Ye(o)),new dm(a,s.transformResults||[])})(t,e)))):[]}function Dm(n,e){return{documents:[vh(n,e.path)]}}function Vm(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=vh(n,s);const o=(function(d){if(d.length!==0)return Ah(Ge.create(d,"and"))})(e.filters);o&&(t.structuredQuery.where=o);const a=(function(d){if(d.length!==0)return d.map((p=>(function(E){return{field:In(E.field),direction:Lm(E.dir)}})(p)))})(e.orderBy);a&&(t.structuredQuery.orderBy=a);const l=ho(n,e.limit);return l!==null&&(t.structuredQuery.limit=l),e.startAt&&(t.structuredQuery.startAt=(function(d){return{before:d.inclusive,values:d.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(d){return{before:!d.inclusive,values:d.position}})(e.endAt)),{ft:t,parent:s}}function Om(n){let e=bm(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){Q(r===1,65062);const p=t.from[0];p.allDescendants?s=p.collectionId:e=e.child(p.collectionId)}let o=[];t.where&&(o=(function(_){const E=wh(_);return E instanceof Ge&&Zu(E)?E.getFilters():[E]})(t.where));let a=[];t.orderBy&&(a=(function(_){return _.map((E=>(function(k){return new br(vn(k.field),(function(M){switch(M){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(k.direction))})(E)))})(t.orderBy));let l=null;t.limit&&(l=(function(_){let E;return E=typeof _=="object"?_.value:_,zs(E)?null:E})(t.limit));let h=null;t.startAt&&(h=(function(_){const E=!!_.before,C=_.values||[];return new ks(C,E)})(t.startAt));let d=null;return t.endAt&&(d=(function(_){const E=!_.before,C=_.values||[];return new ks(C,E)})(t.endAt)),Jg(e,s,a,o,l,"F",h,d)}function Mm(n,e){const t=(function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return x(28987,{purpose:s})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function wh(n){return n.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=vn(t.unaryFilter.field);return ae.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=vn(t.unaryFilter.field);return ae.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const o=vn(t.unaryFilter.field);return ae.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=vn(t.unaryFilter.field);return ae.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return x(61313);default:return x(60726)}})(n):n.fieldFilter!==void 0?(function(t){return ae.create(vn(t.fieldFilter.field),(function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return x(58110);default:return x(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(t){return Ge.create(t.compositeFilter.filters.map((r=>wh(r))),(function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return x(1026)}})(t.compositeFilter.op))})(n):x(30097,{filter:n})}function Lm(n){return wm[n]}function xm(n){return Am[n]}function Fm(n){return Rm[n]}function In(n){return{fieldPath:n.canonicalString()}}function vn(n){return ye.fromServerFormat(n.fieldPath)}function Ah(n){return n instanceof ae?(function(t){if(t.op==="=="){if(Kc(t.value))return{unaryFilter:{field:In(t.field),op:"IS_NAN"}};if(zc(t.value))return{unaryFilter:{field:In(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(Kc(t.value))return{unaryFilter:{field:In(t.field),op:"IS_NOT_NAN"}};if(zc(t.value))return{unaryFilter:{field:In(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:In(t.field),op:xm(t.op),value:t.value}}})(n):n instanceof Ge?(function(t){const r=t.getFilters().map((s=>Ah(s)));return r.length===1?r[0]:{compositeFilter:{op:Fm(t.op),filters:r}}})(n):x(54877,{filter:n})}function Um(n){const e=[];return n.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function Rh(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}function Sh(n){return!!n&&typeof n._toProto=="function"&&n._protoValueType==="ProtoValue"}class St{constructor(e,t,r,s,o=U.min(),a=U.min(),l=Ie.EMPTY_BYTE_STRING,h=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=l,this.expectedCount=h}withSequenceNumber(e){return new St(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new St(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new St(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new St(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class Bm{constructor(e){this.yt=e}}function jm(n){const e=Om({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?uo(e,e.limit,"L"):e}class $m{constructor(){this.Sn=new qm}addToCollectionParentIndex(e,t){return this.Sn.add(t),P.resolve()}getCollectionParents(e,t){return P.resolve(this.Sn.getEntries(t))}addFieldIndex(e,t){return P.resolve()}deleteFieldIndex(e,t){return P.resolve()}deleteAllFieldIndexes(e){return P.resolve()}createTargetIndexes(e,t){return P.resolve()}getDocumentsMatchingTarget(e,t){return P.resolve(null)}getIndexType(e,t){return P.resolve(0)}getFieldIndexes(e,t){return P.resolve([])}getNextCollectionGroupToUpdate(e){return P.resolve(null)}getMinOffset(e,t){return P.resolve(Lt.min())}getMinOffsetFromCollectionGroup(e,t){return P.resolve(Lt.min())}updateCollectionGroup(e,t,r){return P.resolve()}updateIndexEntries(e,t){return P.resolve()}}class qm{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new he(X.comparator),o=!s.has(r);return this.index[t]=s.add(r),o}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new he(X.comparator)).toArray()}}const cl={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Ch=41943040;class De{static withCacheSize(e){return new De(e,De.DEFAULT_COLLECTION_PERCENTILE,De.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}De.DEFAULT_COLLECTION_PERCENTILE=10,De.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,De.DEFAULT=new De(Ch,De.DEFAULT_COLLECTION_PERCENTILE,De.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),De.DISABLED=new De(-1,0,0);class On{constructor(e){this.sr=e}next(){return this.sr+=2,this.sr}static _r(){return new On(0)}static ar(){return new On(-1)}}const ll="LruGarbageCollector",Hm=1048576;function ul([n,e],[t,r]){const s=q(n,t);return s===0?q(e,r):s}class Gm{constructor(e){this.Pr=e,this.buffer=new he(ul),this.Tr=0}Ir(){return++this.Tr}Er(e){const t=[e,this.Ir()];if(this.buffer.size<this.Pr)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();ul(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Wm{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Ar(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Ar(e){V(ll,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){$n(t)?V(ll,"Ignoring IndexedDB error during garbage collection: ",t):await jn(t)}await this.Ar(3e5)}))}}class zm{constructor(e,t){this.Vr=e,this.params=t}calculateTargetCount(e,t){return this.Vr.dr(e).next((r=>Math.floor(t/100*r)))}nthSequenceNumber(e,t){if(t===0)return P.resolve(Ws.ce);const r=new Gm(t);return this.Vr.forEachTarget(e,(s=>r.Er(s.sequenceNumber))).next((()=>this.Vr.mr(e,(s=>r.Er(s))))).next((()=>r.maxValue))}removeTargets(e,t,r){return this.Vr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Vr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(V("LruGarbageCollector","Garbage collection skipped; disabled"),P.resolve(cl)):this.getCacheSize(e).next((r=>r<this.params.cacheSizeCollectionThreshold?(V("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),cl):this.gr(e,t)))}getCacheSize(e){return this.Vr.getCacheSize(e)}gr(e,t){let r,s,o,a,l,h,d;const p=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((_=>(_>this.params.maximumSequenceNumbersToCollect?(V("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${_}`),s=this.params.maximumSequenceNumbersToCollect):s=_,a=Date.now(),this.nthSequenceNumber(e,s)))).next((_=>(r=_,l=Date.now(),this.removeTargets(e,r,t)))).next((_=>(o=_,h=Date.now(),this.removeOrphanedDocuments(e,r)))).next((_=>(d=Date.now(),yn()<=$.DEBUG&&V("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-p}ms
	Determined least recently used ${s} in `+(l-a)+`ms
	Removed ${o} targets in `+(h-l)+`ms
	Removed ${_} documents in `+(d-h)+`ms
Total Duration: ${d-p}ms`),P.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:o,documentsRemoved:_}))))}}function Km(n,e){return new zm(n,e)}class Qm{constructor(){this.changes=new ln((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Ae.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?P.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Ym{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class Jm{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next((s=>(r=s,this.remoteDocumentCache.getEntry(e,t)))).next((s=>(r!==null&&Ir(r.mutation,s,Le.empty(),ee.now()),s)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((r=>this.getLocalViewOfDocuments(e,r,H()).next((()=>r))))}getLocalViewOfDocuments(e,t,r=H()){const s=Jt();return this.populateOverlays(e,s,t).next((()=>this.computeViews(e,t,s,r).next((o=>{let a=fr();return o.forEach(((l,h)=>{a=a.insert(l,h.overlayedDocument)})),a}))))}getOverlayedDocuments(e,t){const r=Jt();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,H())))}populateOverlays(e,t,r){const s=[];return r.forEach((o=>{t.has(o)||s.push(o)})),this.documentOverlayCache.getOverlays(e,s).next((o=>{o.forEach(((a,l)=>{t.set(a,l)}))}))}computeViews(e,t,r,s){let o=lt();const a=Er(),l=(function(){return Er()})();return t.forEach(((h,d)=>{const p=r.get(d.key);s.has(d.key)&&(p===void 0||p.mutation instanceof qt)?o=o.insert(d.key,d):p!==void 0?(a.set(d.key,p.mutation.getFieldMask()),Ir(p.mutation,d,p.mutation.getFieldMask(),ee.now())):a.set(d.key,Le.empty())})),this.recalculateAndSaveOverlays(e,o).next((h=>(h.forEach(((d,p)=>a.set(d,p))),t.forEach(((d,p)=>l.set(d,new Ym(p,a.get(d)??null)))),l)))}recalculateAndSaveOverlays(e,t){const r=Er();let s=new te(((a,l)=>a-l)),o=H();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((a=>{for(const l of a)l.keys().forEach((h=>{const d=t.get(h);if(d===null)return;let p=r.get(h)||Le.empty();p=l.applyToLocalView(d,p),r.set(h,p);const _=(s.get(l.batchId)||H()).add(h);s=s.insert(l.batchId,_)}))})).next((()=>{const a=[],l=s.getReverseIterator();for(;l.hasNext();){const h=l.getNext(),d=h.key,p=h.value,_=ch();p.forEach((E=>{if(!o.has(E)){const C=ph(t.get(E),r.get(E));C!==null&&_.set(E,C),o=o.add(E)}})),a.push(this.documentOverlayCache.saveOverlays(e,d,_))}return P.waitFor(a)})).next((()=>r))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((r=>this.recalculateAndSaveOverlays(e,r)))}getDocumentsMatchingQuery(e,t,r,s){return Xg(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):rh(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next((o=>{const a=s-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-o.size):P.resolve(Jt());let l=Ar,h=o;return a.next((d=>P.forEach(d,((p,_)=>(l<_.largestBatchId&&(l=_.largestBatchId),o.get(p)?P.resolve():this.remoteDocumentCache.getEntry(e,p).next((E=>{h=h.insert(p,E)}))))).next((()=>this.populateOverlays(e,d,o))).next((()=>this.computeViews(e,h,d,H()))).next((p=>({batchId:l,changes:ah(p)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new L(t)).next((r=>{let s=fr();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s}))}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const o=t.collectionGroup;let a=fr();return this.indexManager.getCollectionParents(e,o).next((l=>P.forEach(l,(h=>{const d=(function(_,E){return new qn(E,null,_.explicitOrderBy.slice(),_.filters.slice(),_.limit,_.limitType,_.startAt,_.endAt)})(t,h.child(o));return this.getDocumentsMatchingCollectionQuery(e,d,r,s).next((p=>{p.forEach(((_,E)=>{a=a.insert(_,E)}))}))})).next((()=>a))))}getDocumentsMatchingCollectionQuery(e,t,r,s){let o;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next((a=>(o=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,o,s)))).next((a=>{o.forEach(((h,d)=>{const p=d.getKey();a.get(p)===null&&(a=a.insert(p,Ae.newInvalidDocument(p)))}));let l=fr();return a.forEach(((h,d)=>{const p=o.get(h);p!==void 0&&Ir(p.mutation,d,Le.empty(),ee.now()),Ys(t,d)&&(l=l.insert(h,d))})),l}))}}class Xm{constructor(e){this.serializer=e,this.Nr=new Map,this.Br=new Map}getBundleMetadata(e,t){return P.resolve(this.Nr.get(t))}saveBundleMetadata(e,t){return this.Nr.set(t.id,(function(s){return{id:s.id,version:s.version,createTime:Ye(s.createTime)}})(t)),P.resolve()}getNamedQuery(e,t){return P.resolve(this.Br.get(t))}saveNamedQuery(e,t){return this.Br.set(t.name,(function(s){return{name:s.name,query:jm(s.bundledQuery),readTime:Ye(s.readTime)}})(t)),P.resolve()}}class Zm{constructor(){this.overlays=new te(L.comparator),this.Lr=new Map}getOverlay(e,t){return P.resolve(this.overlays.get(t))}getOverlays(e,t){const r=Jt();return P.forEach(t,(s=>this.getOverlay(e,s).next((o=>{o!==null&&r.set(s,o)})))).next((()=>r))}saveOverlays(e,t,r){return r.forEach(((s,o)=>{this.bt(e,t,o)})),P.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.Lr.get(r);return s!==void 0&&(s.forEach((o=>this.overlays=this.overlays.remove(o))),this.Lr.delete(r)),P.resolve()}getOverlaysForCollection(e,t,r){const s=Jt(),o=t.length+1,a=new L(t.child("")),l=this.overlays.getIteratorFrom(a);for(;l.hasNext();){const h=l.getNext().value,d=h.getKey();if(!t.isPrefixOf(d.path))break;d.path.length===o&&h.largestBatchId>r&&s.set(h.getKey(),h)}return P.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let o=new te(((d,p)=>d-p));const a=this.overlays.getIterator();for(;a.hasNext();){const d=a.getNext().value;if(d.getKey().getCollectionGroup()===t&&d.largestBatchId>r){let p=o.get(d.largestBatchId);p===null&&(p=Jt(),o=o.insert(d.largestBatchId,p)),p.set(d.getKey(),d)}}const l=Jt(),h=o.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach(((d,p)=>l.set(d,p))),!(l.size()>=s)););return P.resolve(l)}bt(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const a=this.Lr.get(s.largestBatchId).delete(r.key);this.Lr.set(s.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new _m(t,r));let o=this.Lr.get(t);o===void 0&&(o=H(),this.Lr.set(t,o)),this.Lr.set(t,o.add(r.key))}}class e_{constructor(){this.sessionToken=Ie.EMPTY_BYTE_STRING}getSessionToken(e){return P.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,P.resolve()}}class qo{constructor(){this.kr=new he(pe.Kr),this.qr=new he(pe.Ur)}isEmpty(){return this.kr.isEmpty()}addReference(e,t){const r=new pe(e,t);this.kr=this.kr.add(r),this.qr=this.qr.add(r)}$r(e,t){e.forEach((r=>this.addReference(r,t)))}removeReference(e,t){this.Wr(new pe(e,t))}Qr(e,t){e.forEach((r=>this.removeReference(r,t)))}Gr(e){const t=new L(new X([])),r=new pe(t,e),s=new pe(t,e+1),o=[];return this.qr.forEachInRange([r,s],(a=>{this.Wr(a),o.push(a.key)})),o}zr(){this.kr.forEach((e=>this.Wr(e)))}Wr(e){this.kr=this.kr.delete(e),this.qr=this.qr.delete(e)}jr(e){const t=new L(new X([])),r=new pe(t,e),s=new pe(t,e+1);let o=H();return this.qr.forEachInRange([r,s],(a=>{o=o.add(a.key)})),o}containsKey(e){const t=new pe(e,0),r=this.kr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class pe{constructor(e,t){this.key=e,this.Hr=t}static Kr(e,t){return L.comparator(e.key,t.key)||q(e.Hr,t.Hr)}static Ur(e,t){return q(e.Hr,t.Hr)||L.comparator(e.key,t.key)}}class t_{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Yn=1,this.Jr=new he(pe.Kr)}checkEmpty(e){return P.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const o=this.Yn;this.Yn++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new mm(o,t,r,s);this.mutationQueue.push(a);for(const l of s)this.Jr=this.Jr.add(new pe(l.key,o)),this.indexManager.addToCollectionParentIndex(e,l.key.path.popLast());return P.resolve(a)}lookupMutationBatch(e,t){return P.resolve(this.Zr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.Xr(r),o=s<0?0:s;return P.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return P.resolve(this.mutationQueue.length===0?Do:this.Yn-1)}getAllMutationBatches(e){return P.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new pe(t,0),s=new pe(t,Number.POSITIVE_INFINITY),o=[];return this.Jr.forEachInRange([r,s],(a=>{const l=this.Zr(a.Hr);o.push(l)})),P.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new he(q);return t.forEach((s=>{const o=new pe(s,0),a=new pe(s,Number.POSITIVE_INFINITY);this.Jr.forEachInRange([o,a],(l=>{r=r.add(l.Hr)}))})),P.resolve(this.Yr(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let o=r;L.isDocumentKey(o)||(o=o.child(""));const a=new pe(new L(o),0);let l=new he(q);return this.Jr.forEachWhile((h=>{const d=h.key.path;return!!r.isPrefixOf(d)&&(d.length===s&&(l=l.add(h.Hr)),!0)}),a),P.resolve(this.Yr(l))}Yr(e){const t=[];return e.forEach((r=>{const s=this.Zr(r);s!==null&&t.push(s)})),t}removeMutationBatch(e,t){Q(this.ei(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Jr;return P.forEach(t.mutations,(s=>{const o=new pe(s.key,t.batchId);return r=r.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)})).next((()=>{this.Jr=r}))}nr(e){}containsKey(e,t){const r=new pe(t,0),s=this.Jr.firstAfterOrEqual(r);return P.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,P.resolve()}ei(e,t){return this.Xr(e)}Xr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Zr(e){const t=this.Xr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class n_{constructor(e){this.ti=e,this.docs=(function(){return new te(L.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),o=s?s.size:0,a=this.ti(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:a}),this.size+=a-o,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return P.resolve(r?r.document.mutableCopy():Ae.newInvalidDocument(t))}getEntries(e,t){let r=lt();return t.forEach((s=>{const o=this.docs.get(s);r=r.insert(s,o?o.document.mutableCopy():Ae.newInvalidDocument(s))})),P.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let o=lt();const a=t.path,l=new L(a.child("__id-9223372036854775808__")),h=this.docs.getIteratorFrom(l);for(;h.hasNext();){const{key:d,value:{document:p}}=h.getNext();if(!a.isPrefixOf(d.path))break;d.path.length>a.length+1||bg(Cg(p),r)<=0||(s.has(p.key)||Ys(t,p))&&(o=o.insert(p.key,p.mutableCopy()))}return P.resolve(o)}getAllFromCollectionGroup(e,t,r,s){x(9500)}ni(e,t){return P.forEach(this.docs,(r=>t(r)))}newChangeBuffer(e){return new r_(this)}getSize(e){return P.resolve(this.size)}}class r_ extends Qm{constructor(e){super(),this.Mr=e}applyChanges(e){const t=[];return this.changes.forEach(((r,s)=>{s.isValidDocument()?t.push(this.Mr.addEntry(e,s)):this.Mr.removeEntry(r)})),P.waitFor(t)}getFromCache(e,t){return this.Mr.getEntry(e,t)}getAllFromCache(e,t){return this.Mr.getEntries(e,t)}}class s_{constructor(e){this.persistence=e,this.ri=new ln((t=>Mo(t)),Lo),this.lastRemoteSnapshotVersion=U.min(),this.highestTargetId=0,this.ii=0,this.si=new qo,this.targetCount=0,this.oi=On._r()}forEachTarget(e,t){return this.ri.forEach(((r,s)=>t(s))),P.resolve()}getLastRemoteSnapshotVersion(e){return P.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return P.resolve(this.ii)}allocateTargetId(e){return this.highestTargetId=this.oi.next(),P.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.ii&&(this.ii=t),P.resolve()}lr(e){this.ri.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.oi=new On(t),this.highestTargetId=t),e.sequenceNumber>this.ii&&(this.ii=e.sequenceNumber)}addTargetData(e,t){return this.lr(t),this.targetCount+=1,P.resolve()}updateTargetData(e,t){return this.lr(t),P.resolve()}removeTargetData(e,t){return this.ri.delete(t.target),this.si.Gr(t.targetId),this.targetCount-=1,P.resolve()}removeTargets(e,t,r){let s=0;const o=[];return this.ri.forEach(((a,l)=>{l.sequenceNumber<=t&&r.get(l.targetId)===null&&(this.ri.delete(a),o.push(this.removeMatchingKeysForTargetId(e,l.targetId)),s++)})),P.waitFor(o).next((()=>s))}getTargetCount(e){return P.resolve(this.targetCount)}getTargetData(e,t){const r=this.ri.get(t)||null;return P.resolve(r)}addMatchingKeys(e,t,r){return this.si.$r(t,r),P.resolve()}removeMatchingKeys(e,t,r){this.si.Qr(t,r);const s=this.persistence.referenceDelegate,o=[];return s&&t.forEach((a=>{o.push(s.markPotentiallyOrphaned(e,a))})),P.waitFor(o)}removeMatchingKeysForTargetId(e,t){return this.si.Gr(t),P.resolve()}getMatchingKeysForTargetId(e,t){const r=this.si.jr(t);return P.resolve(r)}containsKey(e,t){return P.resolve(this.si.containsKey(t))}}class bh{constructor(e,t){this._i={},this.overlays={},this.ai=new Ws(0),this.ui=!1,this.ui=!0,this.ci=new e_,this.referenceDelegate=e(this),this.li=new s_(this),this.indexManager=new $m,this.remoteDocumentCache=(function(s){return new n_(s)})((r=>this.referenceDelegate.hi(r))),this.serializer=new Bm(t),this.Pi=new Xm(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ui=!1,Promise.resolve()}get started(){return this.ui}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Zm,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this._i[e.toKey()];return r||(r=new t_(t,this.referenceDelegate),this._i[e.toKey()]=r),r}getGlobalsCache(){return this.ci}getTargetCache(){return this.li}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Pi}runTransaction(e,t,r){V("MemoryPersistence","Starting transaction:",e);const s=new i_(this.ai.next());return this.referenceDelegate.Ti(),r(s).next((o=>this.referenceDelegate.Ii(s).next((()=>o)))).toPromise().then((o=>(s.raiseOnCommittedEvent(),o)))}Ei(e,t){return P.or(Object.values(this._i).map((r=>()=>r.containsKey(e,t))))}}class i_ extends kg{constructor(e){super(),this.currentSequenceNumber=e}}class Ho{constructor(e){this.persistence=e,this.Ri=new qo,this.Ai=null}static Vi(e){return new Ho(e)}get di(){if(this.Ai)return this.Ai;throw x(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.di.delete(r.toString()),P.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.di.add(r.toString()),P.resolve()}markPotentiallyOrphaned(e,t){return this.di.add(t.toString()),P.resolve()}removeTarget(e,t){this.Ri.Gr(t.targetId).forEach((s=>this.di.add(s.toString())));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next((s=>{s.forEach((o=>this.di.add(o.toString())))})).next((()=>r.removeTargetData(e,t)))}Ti(){this.Ai=new Set}Ii(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return P.forEach(this.di,(r=>{const s=L.fromPath(r);return this.mi(e,s).next((o=>{o||t.removeEntry(s,U.min())}))})).next((()=>(this.Ai=null,t.apply(e))))}updateLimboDocument(e,t){return this.mi(e,t).next((r=>{r?this.di.delete(t.toString()):this.di.add(t.toString())}))}hi(e){return 0}mi(e,t){return P.or([()=>P.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ei(e,t)])}}class Os{constructor(e,t){this.persistence=e,this.fi=new ln((r=>Vg(r.path)),((r,s)=>r.isEqual(s))),this.garbageCollector=Km(this,t)}static Vi(e,t){return new Os(e,t)}Ti(){}Ii(e){return P.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}dr(e){const t=this.pr(e);return this.persistence.getTargetCache().getTargetCount(e).next((r=>t.next((s=>r+s))))}pr(e){let t=0;return this.mr(e,(r=>{t++})).next((()=>t))}mr(e,t){return P.forEach(this.fi,((r,s)=>this.wr(e,r,s).next((o=>o?P.resolve():t(s)))))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const s=this.persistence.getRemoteDocumentCache(),o=s.newChangeBuffer();return s.ni(e,(a=>this.wr(e,a,t).next((l=>{l||(r++,o.removeEntry(a,U.min()))})))).next((()=>o.apply(e))).next((()=>r))}markPotentiallyOrphaned(e,t){return this.fi.set(t,e.currentSequenceNumber),P.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.fi.set(r,e.currentSequenceNumber),P.resolve()}removeReference(e,t,r){return this.fi.set(r,e.currentSequenceNumber),P.resolve()}updateLimboDocument(e,t){return this.fi.set(t,e.currentSequenceNumber),P.resolve()}hi(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=gs(e.data.value)),t}wr(e,t,r){return P.or([()=>this.persistence.Ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.fi.get(t);return P.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class Go{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.Ts=r,this.Is=s}static Es(e,t){let r=H(),s=H();for(const o of t.docChanges)switch(o.type){case 0:r=r.add(o.doc.key);break;case 1:s=s.add(o.doc.key)}return new Go(e,t.fromCache,r,s)}}class o_{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class a_{constructor(){this.Rs=!1,this.As=!1,this.Vs=100,this.ds=(function(){return Kf()?8:Ng(Se())>0?6:4})()}initialize(e,t){this.fs=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,r,s){const o={result:null};return this.gs(e,t).next((a=>{o.result=a})).next((()=>{if(!o.result)return this.ps(e,t,s,r).next((a=>{o.result=a}))})).next((()=>{if(o.result)return;const a=new o_;return this.ys(e,t,a).next((l=>{if(o.result=l,this.As)return this.ws(e,t,a,l.size)}))})).next((()=>o.result))}ws(e,t,r,s){return r.documentReadCount<this.Vs?(yn()<=$.DEBUG&&V("QueryEngine","SDK will not create cache indexes for query:",En(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),P.resolve()):(yn()<=$.DEBUG&&V("QueryEngine","Query:",En(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.ds*s?(yn()<=$.DEBUG&&V("QueryEngine","The SDK decides to create cache indexes for query:",En(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Qe(t))):P.resolve())}gs(e,t){if(Xc(t))return P.resolve(null);let r=Qe(t);return this.indexManager.getIndexType(e,r).next((s=>s===0?null:(t.limit!==null&&s===1&&(t=uo(t,null,"F"),r=Qe(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next((o=>{const a=H(...o);return this.fs.getDocuments(e,a).next((l=>this.indexManager.getMinOffset(e,r).next((h=>{const d=this.bs(t,l);return this.Ss(t,d,a,h.readTime)?this.gs(e,uo(t,null,"F")):this.Ds(e,d,t,h)}))))})))))}ps(e,t,r,s){return Xc(t)||s.isEqual(U.min())?P.resolve(null):this.fs.getDocuments(e,r).next((o=>{const a=this.bs(t,o);return this.Ss(t,a,r,s)?P.resolve(null):(yn()<=$.DEBUG&&V("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),En(t)),this.Ds(e,a,t,Sg(s,Ar)).next((l=>l)))}))}bs(e,t){let r=new he(ih(e));return t.forEach(((s,o)=>{Ys(e,o)&&(r=r.add(o))})),r}Ss(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const o=e.limitType==="F"?t.last():t.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(s)>0)}ys(e,t,r){return yn()<=$.DEBUG&&V("QueryEngine","Using full collection scan to execute query:",En(t)),this.fs.getDocumentsMatchingQuery(e,t,Lt.min(),r)}Ds(e,t,r,s){return this.fs.getDocumentsMatchingQuery(e,r,s).next((o=>(t.forEach((a=>{o=o.insert(a.key,a)})),o)))}}const Wo="LocalStore",c_=3e8;class l_{constructor(e,t,r,s){this.persistence=e,this.Cs=t,this.serializer=s,this.vs=new te(q),this.Fs=new ln((o=>Mo(o)),Lo),this.Ms=new Map,this.xs=e.getRemoteDocumentCache(),this.li=e.getTargetCache(),this.Pi=e.getBundleCache(),this.Os(r)}Os(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Jm(this.xs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.xs.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.vs)))}}function u_(n,e,t,r){return new l_(n,e,t,r)}async function Ph(n,e){const t=B(n);return await t.persistence.runTransaction("Handle user change","readonly",(r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next((o=>(s=o,t.Os(e),t.mutationQueue.getAllMutationBatches(r)))).next((o=>{const a=[],l=[];let h=H();for(const d of s){a.push(d.batchId);for(const p of d.mutations)h=h.add(p.key)}for(const d of o){l.push(d.batchId);for(const p of d.mutations)h=h.add(p.key)}return t.localDocuments.getDocuments(r,h).next((d=>({Ns:d,removedBatchIds:a,addedBatchIds:l})))}))}))}function h_(n,e){const t=B(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",(r=>{const s=e.batch.keys(),o=t.xs.newChangeBuffer({trackRemovals:!0});return(function(l,h,d,p){const _=d.batch,E=_.keys();let C=P.resolve();return E.forEach((k=>{C=C.next((()=>p.getEntry(h,k))).next((O=>{const M=d.docVersions.get(k);Q(M!==null,48541),O.version.compareTo(M)<0&&(_.applyToRemoteDocument(O,d),O.isValidDocument()&&(O.setReadTime(d.commitVersion),p.addEntry(O)))}))})),C.next((()=>l.mutationQueue.removeMutationBatch(h,_)))})(t,r,e,o).next((()=>o.apply(r))).next((()=>t.mutationQueue.performConsistencyCheck(r))).next((()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId))).next((()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,(function(l){let h=H();for(let d=0;d<l.mutationResults.length;++d)l.mutationResults[d].transformResults.length>0&&(h=h.add(l.batch.mutations[d].key));return h})(e)))).next((()=>t.localDocuments.getDocuments(r,s)))}))}function kh(n){const e=B(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.li.getLastRemoteSnapshotVersion(t)))}function d_(n,e){const t=B(n),r=e.snapshotVersion;let s=t.vs;return t.persistence.runTransaction("Apply remote event","readwrite-primary",(o=>{const a=t.xs.newChangeBuffer({trackRemovals:!0});s=t.vs;const l=[];e.targetChanges.forEach(((p,_)=>{const E=s.get(_);if(!E)return;l.push(t.li.removeMatchingKeys(o,p.removedDocuments,_).next((()=>t.li.addMatchingKeys(o,p.addedDocuments,_))));let C=E.withSequenceNumber(o.currentSequenceNumber);e.targetMismatches.get(_)!==null?C=C.withResumeToken(Ie.EMPTY_BYTE_STRING,U.min()).withLastLimboFreeSnapshotVersion(U.min()):p.resumeToken.approximateByteSize()>0&&(C=C.withResumeToken(p.resumeToken,r)),s=s.insert(_,C),(function(O,M,G){return O.resumeToken.approximateByteSize()===0||M.snapshotVersion.toMicroseconds()-O.snapshotVersion.toMicroseconds()>=c_?!0:G.addedDocuments.size+G.modifiedDocuments.size+G.removedDocuments.size>0})(E,C,p)&&l.push(t.li.updateTargetData(o,C))}));let h=lt(),d=H();if(e.documentUpdates.forEach((p=>{e.resolvedLimboDocuments.has(p)&&l.push(t.persistence.referenceDelegate.updateLimboDocument(o,p))})),l.push(f_(o,a,e.documentUpdates).next((p=>{h=p.Bs,d=p.Ls}))),!r.isEqual(U.min())){const p=t.li.getLastRemoteSnapshotVersion(o).next((_=>t.li.setTargetsMetadata(o,o.currentSequenceNumber,r)));l.push(p)}return P.waitFor(l).next((()=>a.apply(o))).next((()=>t.localDocuments.getLocalViewOfDocuments(o,h,d))).next((()=>h))})).then((o=>(t.vs=s,o)))}function f_(n,e,t){let r=H(),s=H();return t.forEach((o=>r=r.add(o))),e.getEntries(n,r).next((o=>{let a=lt();return t.forEach(((l,h)=>{const d=o.get(l);h.isFoundDocument()!==d.isFoundDocument()&&(s=s.add(l)),h.isNoDocument()&&h.version.isEqual(U.min())?(e.removeEntry(l,h.readTime),a=a.insert(l,h)):!d.isValidDocument()||h.version.compareTo(d.version)>0||h.version.compareTo(d.version)===0&&d.hasPendingWrites?(e.addEntry(h),a=a.insert(l,h)):V(Wo,"Ignoring outdated watch update for ",l,". Current version:",d.version," Watch version:",h.version)})),{Bs:a,Ls:s}}))}function p_(n,e){const t=B(n);return t.persistence.runTransaction("Get next mutation batch","readonly",(r=>(e===void 0&&(e=Do),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e))))}function g_(n,e){const t=B(n);return t.persistence.runTransaction("Allocate target","readwrite",(r=>{let s;return t.li.getTargetData(r,e).next((o=>o?(s=o,P.resolve(s)):t.li.allocateTargetId(r).next((a=>(s=new St(e,a,"TargetPurposeListen",r.currentSequenceNumber),t.li.addTargetData(r,s).next((()=>s)))))))})).then((r=>{const s=t.vs.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.vs=t.vs.insert(r.targetId,r),t.Fs.set(e,r.targetId)),r}))}async function mo(n,e,t){const r=B(n),s=r.vs.get(e),o=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",o,(a=>r.persistence.referenceDelegate.removeTarget(a,s)))}catch(a){if(!$n(a))throw a;V(Wo,`Failed to update sequence numbers for target ${e}: ${a}`)}r.vs=r.vs.remove(e),r.Fs.delete(s.target)}function hl(n,e,t){const r=B(n);let s=U.min(),o=H();return r.persistence.runTransaction("Execute query","readwrite",(a=>(function(h,d,p){const _=B(h),E=_.Fs.get(p);return E!==void 0?P.resolve(_.vs.get(E)):_.li.getTargetData(d,p)})(r,a,Qe(e)).next((l=>{if(l)return s=l.lastLimboFreeSnapshotVersion,r.li.getMatchingKeysForTargetId(a,l.targetId).next((h=>{o=h}))})).next((()=>r.Cs.getDocumentsMatchingQuery(a,e,t?s:U.min(),t?o:H()))).next((l=>(m_(r,tm(e),l),{documents:l,ks:o})))))}function m_(n,e,t){let r=n.Ms.get(e)||U.min();t.forEach(((s,o)=>{o.readTime.compareTo(r)>0&&(r=o.readTime)})),n.Ms.set(e,r)}class dl{constructor(){this.activeTargetIds=am()}Qs(e){this.activeTargetIds=this.activeTargetIds.add(e)}Gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class __{constructor(){this.vo=new dl,this.Fo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.vo.Qs(e),this.Fo[e]||"not-current"}updateQueryState(e,t,r){this.Fo[e]=t}removeLocalQueryTarget(e){this.vo.Gs(e)}isLocalQueryTarget(e){return this.vo.activeTargetIds.has(e)}clearQueryState(e){delete this.Fo[e]}getAllActiveQueryTargets(){return this.vo.activeTargetIds}isActiveQueryTarget(e){return this.vo.activeTargetIds.has(e)}start(){return this.vo=new dl,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class y_{Mo(e){}shutdown(){}}const fl="ConnectivityMonitor";class pl{constructor(){this.xo=()=>this.Oo(),this.No=()=>this.Bo(),this.Lo=[],this.ko()}Mo(e){this.Lo.push(e)}shutdown(){window.removeEventListener("online",this.xo),window.removeEventListener("offline",this.No)}ko(){window.addEventListener("online",this.xo),window.addEventListener("offline",this.No)}Oo(){V(fl,"Network connectivity changed: AVAILABLE");for(const e of this.Lo)e(0)}Bo(){V(fl,"Network connectivity changed: UNAVAILABLE");for(const e of this.Lo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let hs=null;function _o(){return hs===null?hs=(function(){return 268435456+Math.round(2147483648*Math.random())})():hs++,"0x"+hs.toString(16)}const Hi="RestConnection",E_={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery",ExecutePipeline:"executePipeline"};class I_{get Ko(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.qo=t+"://"+e.host,this.Uo=`projects/${r}/databases/${s}`,this.$o=this.databaseId.database===bs?`project_id=${r}`:`project_id=${r}&database_id=${s}`}Wo(e,t,r,s,o){const a=_o(),l=this.Qo(e,t.toUriEncodedString());V(Hi,`Sending RPC '${e}' ${a}:`,l,r);const h={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.$o};this.Go(h,s,o);const{host:d}=new URL(l),p=Fn(d);return this.zo(e,l,h,r,p).then((_=>(V(Hi,`Received RPC '${e}' ${a}: `,_),_)),(_=>{throw kn(Hi,`RPC '${e}' ${a} failed with error: `,_,"url: ",l,"request:",r),_}))}jo(e,t,r,s,o,a){return this.Wo(e,t,r,s,o)}Go(e,t,r){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+Bn})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((s,o)=>e[o]=s)),r&&r.headers.forEach(((s,o)=>e[o]=s))}Qo(e,t){const r=E_[e];let s=`${this.qo}/v1/${t}:${r}`;return this.databaseInfo.apiKey&&(s=`${s}?key=${encodeURIComponent(this.databaseInfo.apiKey)}`),s}terminate(){}}class v_{constructor(e){this.Ho=e.Ho,this.Jo=e.Jo}Zo(e){this.Xo=e}Yo(e){this.e_=e}t_(e){this.n_=e}onMessage(e){this.r_=e}close(){this.Jo()}send(e){this.Ho(e)}i_(){this.Xo()}s_(){this.e_()}o_(e){this.n_(e)}__(e){this.r_(e)}}const Te="WebChannelConnection",cr=(n,e,t)=>{n.listen(e,(r=>{try{t(r)}catch(s){setTimeout((()=>{throw s}),0)}}))};class wn extends I_{constructor(e){super(e),this.a_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}static u_(){if(!wn.c_){const e=Mu();cr(e,Ou.STAT_EVENT,(t=>{t.stat===ro.PROXY?V(Te,"STAT_EVENT: detected buffering proxy"):t.stat===ro.NOPROXY&&V(Te,"STAT_EVENT: detected no buffering proxy")})),wn.c_=!0}}zo(e,t,r,s,o){const a=_o();return new Promise(((l,h)=>{const d=new Du;d.setWithCredentials(!0),d.listenOnce(Vu.COMPLETE,(()=>{try{switch(d.getLastErrorCode()){case ps.NO_ERROR:const _=d.getResponseJson();V(Te,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(_)),l(_);break;case ps.TIMEOUT:V(Te,`RPC '${e}' ${a} timed out`),h(new D(b.DEADLINE_EXCEEDED,"Request time out"));break;case ps.HTTP_ERROR:const E=d.getStatus();if(V(Te,`RPC '${e}' ${a} failed with status:`,E,"response text:",d.getResponseText()),E>0){let C=d.getResponseJson();Array.isArray(C)&&(C=C[0]);const k=C?.error;if(k&&k.status&&k.message){const O=(function(G){const z=G.toLowerCase().replace(/_/g,"-");return Object.values(b).indexOf(z)>=0?z:b.UNKNOWN})(k.status);h(new D(O,k.message))}else h(new D(b.UNKNOWN,"Server responded with status "+d.getStatus()))}else h(new D(b.UNAVAILABLE,"Connection failed."));break;default:x(9055,{l_:e,streamId:a,h_:d.getLastErrorCode(),P_:d.getLastError()})}}finally{V(Te,`RPC '${e}' ${a} completed.`)}}));const p=JSON.stringify(s);V(Te,`RPC '${e}' ${a} sending request:`,s),d.send(t,"POST",p,r,15)}))}T_(e,t,r){const s=_o(),o=[this.qo,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=this.createWebChannelTransport(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;h!==void 0&&(l.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(l.useFetchStreams=!0),this.Go(l.initMessageHeaders,t,r),l.encodeInitMessageHeaders=!0;const d=o.join("");V(Te,`Creating RPC '${e}' stream ${s}: ${d}`,l);const p=a.createWebChannel(d,l);this.I_(p);let _=!1,E=!1;const C=new v_({Ho:k=>{E?V(Te,`Not sending because RPC '${e}' stream ${s} is closed:`,k):(_||(V(Te,`Opening RPC '${e}' stream ${s} transport.`),p.open(),_=!0),V(Te,`RPC '${e}' stream ${s} sending:`,k),p.send(k))},Jo:()=>p.close()});return cr(p,dr.EventType.OPEN,(()=>{E||(V(Te,`RPC '${e}' stream ${s} transport opened.`),C.i_())})),cr(p,dr.EventType.CLOSE,(()=>{E||(E=!0,V(Te,`RPC '${e}' stream ${s} transport closed`),C.o_(),this.E_(p))})),cr(p,dr.EventType.ERROR,(k=>{E||(E=!0,kn(Te,`RPC '${e}' stream ${s} transport errored. Name:`,k.name,"Message:",k.message),C.o_(new D(b.UNAVAILABLE,"The operation could not be completed")))})),cr(p,dr.EventType.MESSAGE,(k=>{if(!E){const O=k.data[0];Q(!!O,16349);const M=O,G=M?.error||M[0]?.error;if(G){V(Te,`RPC '${e}' stream ${s} received error:`,G);const z=G.status;let J=(function(ge){const v=ie[ge];if(v!==void 0)return mh(v)})(z),Oe=G.message;J===void 0&&(J=b.INTERNAL,Oe="Unknown error status: "+z+" with message "+G.message),E=!0,C.o_(new D(J,Oe)),p.close()}else V(Te,`RPC '${e}' stream ${s} received:`,O),C.__(O)}})),wn.u_(),setTimeout((()=>{C.s_()}),0),C}terminate(){this.a_.forEach((e=>e.close())),this.a_=[]}I_(e){this.a_.push(e)}E_(e){this.a_=this.a_.filter((t=>t===e))}Go(e,t,r){super.Go(e,t,r),this.databaseInfo.apiKey&&(e["x-goog-api-key"]=this.databaseInfo.apiKey)}createWebChannelTransport(){return Lu()}}function T_(n){return new wn(n)}function Gi(){return typeof document<"u"?document:null}function ei(n){return new Sm(n,!0)}wn.c_=!1;class Nh{constructor(e,t,r=1e3,s=1.5,o=6e4){this.Ci=e,this.timerId=t,this.R_=r,this.A_=s,this.V_=o,this.d_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.d_=0}g_(){this.d_=this.V_}p_(e){this.cancel();const t=Math.floor(this.d_+this.y_()),r=Math.max(0,Date.now()-this.f_),s=Math.max(0,t-r);s>0&&V("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.d_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.m_=this.Ci.enqueueAfterDelay(this.timerId,s,(()=>(this.f_=Date.now(),e()))),this.d_*=this.A_,this.d_<this.R_&&(this.d_=this.R_),this.d_>this.V_&&(this.d_=this.V_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.d_}}const gl="PersistentStream";class Dh{constructor(e,t,r,s,o,a,l,h){this.Ci=e,this.b_=r,this.S_=s,this.connection=o,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=l,this.listener=h,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new Nh(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Ci.enqueueAfterDelay(this.b_,6e4,(()=>this.k_())))}K_(e){this.q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===b.RESOURCE_EXHAUSTED?(ct(t.toString()),ct("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===b.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.W_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.t_(t)}W_(){}auth(){this.state=1;const e=this.Q_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([r,s])=>{this.D_===t&&this.G_(r,s)}),(r=>{e((()=>{const s=new D(b.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(s)}))}))}G_(e,t){const r=this.Q_(this.D_);this.stream=this.j_(e,t),this.stream.Zo((()=>{r((()=>this.listener.Zo()))})),this.stream.Yo((()=>{r((()=>(this.state=2,this.v_=this.Ci.enqueueAfterDelay(this.S_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.Yo())))})),this.stream.t_((s=>{r((()=>this.z_(s)))})),this.stream.onMessage((s=>{r((()=>++this.F_==1?this.H_(s):this.onNext(s)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return V(gl,`close with error: ${e}`),this.stream=null,this.close(4,e)}Q_(e){return t=>{this.Ci.enqueueAndForget((()=>this.D_===e?t():(V(gl,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class w_ extends Dh{constructor(e,t,r,s,o,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,a),this.serializer=o}j_(e,t){return this.connection.T_("Listen",e,t)}H_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=Pm(this.serializer,e),r=(function(o){if(!("targetChange"in o))return U.min();const a=o.targetChange;return a.targetIds&&a.targetIds.length?U.min():a.readTime?Ye(a.readTime):U.min()})(e);return this.listener.J_(t,r)}Z_(e){const t={};t.database=go(this.serializer),t.addTarget=(function(o,a){let l;const h=a.target;if(l=co(h)?{documents:Dm(o,h)}:{query:Vm(o,h).ft},l.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){l.resumeToken=Eh(o,a.resumeToken);const d=ho(o,a.expectedCount);d!==null&&(l.expectedCount=d)}else if(a.snapshotVersion.compareTo(U.min())>0){l.readTime=Vs(o,a.snapshotVersion.toTimestamp());const d=ho(o,a.expectedCount);d!==null&&(l.expectedCount=d)}return l})(this.serializer,e);const r=Mm(this.serializer,e);r&&(t.labels=r),this.K_(t)}X_(e){const t={};t.database=go(this.serializer),t.removeTarget=e,this.K_(t)}}class A_ extends Dh{constructor(e,t,r,s,o,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,a),this.serializer=o}get Y_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}W_(){this.Y_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}H_(e){return Q(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,Q(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){Q(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=Nm(e.writeResults,e.commitTime),r=Ye(e.commitTime);return this.listener.na(r,t)}ra(){const e={};e.database=go(this.serializer),this.K_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map((r=>km(this.serializer,r)))};this.K_(t)}}class R_{}class S_ extends R_{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new D(b.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,t,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([o,a])=>this.connection.Wo(e,fo(t,r),s,o,a))).catch((o=>{throw o.name==="FirebaseError"?(o.code===b.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new D(b.UNKNOWN,o.toString())}))}jo(e,t,r,s,o){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([a,l])=>this.connection.jo(e,fo(t,r),s,a,l,o))).catch((a=>{throw a.name==="FirebaseError"?(a.code===b.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new D(b.UNKNOWN,a.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}function C_(n,e,t,r){return new S_(n,e,t,r)}class b_{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(ct(t),this.aa=!1):V("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const sn="RemoteStore";class P_{constructor(e,t,r,s,o){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.Ra=[],this.Aa=o,this.Aa.Mo((a=>{r.enqueueAndForget((async()=>{un(this)&&(V(sn,"Restarting streams for network reachability change."),await(async function(h){const d=B(h);d.Ea.add(4),await Ur(d),d.Va.set("Unknown"),d.Ea.delete(4),await ti(d)})(this))}))})),this.Va=new b_(r,s)}}async function ti(n){if(un(n))for(const e of n.Ra)await e(!0)}async function Ur(n){for(const e of n.Ra)await e(!1)}function Vh(n,e){const t=B(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),Yo(t)?Qo(t):Hn(t).O_()&&Ko(t,e))}function zo(n,e){const t=B(n),r=Hn(t);t.Ia.delete(e),r.O_()&&Oh(t,e),t.Ia.size===0&&(r.O_()?r.L_():un(t)&&t.Va.set("Unknown"))}function Ko(n,e){if(n.da.$e(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(U.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Hn(n).Z_(e)}function Oh(n,e){n.da.$e(e),Hn(n).X_(e)}function Qo(n){n.da=new Tm({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),Hn(n).start(),n.Va.ua()}function Yo(n){return un(n)&&!Hn(n).x_()&&n.Ia.size>0}function un(n){return B(n).Ea.size===0}function Mh(n){n.da=void 0}async function k_(n){n.Va.set("Online")}async function N_(n){n.Ia.forEach(((e,t)=>{Ko(n,e)}))}async function D_(n,e){Mh(n),Yo(n)?(n.Va.ha(e),Qo(n)):n.Va.set("Unknown")}async function V_(n,e,t){if(n.Va.set("Online"),e instanceof yh&&e.state===2&&e.cause)try{await(async function(s,o){const a=o.cause;for(const l of o.targetIds)s.Ia.has(l)&&(await s.remoteSyncer.rejectListen(l,a),s.Ia.delete(l),s.da.removeTarget(l))})(n,e)}catch(r){V(sn,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Ms(n,r)}else if(e instanceof ys?n.da.Xe(e):e instanceof _h?n.da.st(e):n.da.tt(e),!t.isEqual(U.min()))try{const r=await kh(n.localStore);t.compareTo(r)>=0&&await(function(o,a){const l=o.da.Tt(a);return l.targetChanges.forEach(((h,d)=>{if(h.resumeToken.approximateByteSize()>0){const p=o.Ia.get(d);p&&o.Ia.set(d,p.withResumeToken(h.resumeToken,a))}})),l.targetMismatches.forEach(((h,d)=>{const p=o.Ia.get(h);if(!p)return;o.Ia.set(h,p.withResumeToken(Ie.EMPTY_BYTE_STRING,p.snapshotVersion)),Oh(o,h);const _=new St(p.target,h,d,p.sequenceNumber);Ko(o,_)})),o.remoteSyncer.applyRemoteEvent(l)})(n,t)}catch(r){V(sn,"Failed to raise snapshot:",r),await Ms(n,r)}}async function Ms(n,e,t){if(!$n(e))throw e;n.Ea.add(1),await Ur(n),n.Va.set("Offline"),t||(t=()=>kh(n.localStore)),n.asyncQueue.enqueueRetryable((async()=>{V(sn,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await ti(n)}))}function Lh(n,e){return e().catch((t=>Ms(n,t,e)))}async function ni(n){const e=B(n),t=Bt(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:Do;for(;O_(e);)try{const s=await p_(e.localStore,r);if(s===null){e.Ta.length===0&&t.L_();break}r=s.batchId,M_(e,s)}catch(s){await Ms(e,s)}xh(e)&&Fh(e)}function O_(n){return un(n)&&n.Ta.length<10}function M_(n,e){n.Ta.push(e);const t=Bt(n);t.O_()&&t.Y_&&t.ea(e.mutations)}function xh(n){return un(n)&&!Bt(n).x_()&&n.Ta.length>0}function Fh(n){Bt(n).start()}async function L_(n){Bt(n).ra()}async function x_(n){const e=Bt(n);for(const t of n.Ta)e.ea(t.mutations)}async function F_(n,e,t){const r=n.Ta.shift(),s=Bo.from(r,e,t);await Lh(n,(()=>n.remoteSyncer.applySuccessfulWrite(s))),await ni(n)}async function U_(n,e){e&&Bt(n).Y_&&await(async function(r,s){if((function(a){return Em(a)&&a!==b.ABORTED})(s.code)){const o=r.Ta.shift();Bt(r).B_(),await Lh(r,(()=>r.remoteSyncer.rejectFailedWrite(o.batchId,s))),await ni(r)}})(n,e),xh(n)&&Fh(n)}async function ml(n,e){const t=B(n);t.asyncQueue.verifyOperationInProgress(),V(sn,"RemoteStore received new credentials");const r=un(t);t.Ea.add(3),await Ur(t),r&&t.Va.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await ti(t)}async function B_(n,e){const t=B(n);e?(t.Ea.delete(2),await ti(t)):e||(t.Ea.add(2),await Ur(t),t.Va.set("Unknown"))}function Hn(n){return n.ma||(n.ma=(function(t,r,s){const o=B(t);return o.sa(),new w_(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,s)})(n.datastore,n.asyncQueue,{Zo:k_.bind(null,n),Yo:N_.bind(null,n),t_:D_.bind(null,n),J_:V_.bind(null,n)}),n.Ra.push((async e=>{e?(n.ma.B_(),Yo(n)?Qo(n):n.Va.set("Unknown")):(await n.ma.stop(),Mh(n))}))),n.ma}function Bt(n){return n.fa||(n.fa=(function(t,r,s){const o=B(t);return o.sa(),new A_(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,s)})(n.datastore,n.asyncQueue,{Zo:()=>Promise.resolve(),Yo:L_.bind(null,n),t_:U_.bind(null,n),ta:x_.bind(null,n),na:F_.bind(null,n)}),n.Ra.push((async e=>{e?(n.fa.B_(),await ni(n)):(await n.fa.stop(),n.Ta.length>0&&(V(sn,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))}))),n.fa}class Jo{constructor(e,t,r,s,o){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=o,this.deferred=new ot,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((a=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,o){const a=Date.now()+r,l=new Jo(e,t,a,s,o);return l.start(r),l}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new D(b.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Xo(n,e){if(ct("AsyncQueue",`${e}: ${n}`),$n(n))return new D(b.UNAVAILABLE,`${e}: ${n}`);throw n}class An{static emptySet(e){return new An(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||L.comparator(t.key,r.key):(t,r)=>L.comparator(t.key,r.key),this.keyedMap=fr(),this.sortedSet=new te(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,r)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof An)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,o=r.getNext().key;if(!s.isEqual(o))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new An;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class _l{constructor(){this.ga=new te(L.comparator)}track(e){const t=e.doc.key,r=this.ga.get(t);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(t,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(t):e.type===1&&r.type===2?this.ga=this.ga.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):x(63341,{Vt:e,pa:r}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal(((t,r)=>{e.push(r)})),e}}class Mn{constructor(e,t,r,s,o,a,l,h,d){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=o,this.fromCache=a,this.syncStateChanged=l,this.excludesMetadataChanges=h,this.hasCachedResults=d}static fromInitialDocuments(e,t,r,s,o){const a=[];return t.forEach((l=>{a.push({type:0,doc:l})})),new Mn(e,t,An.emptySet(t),a,r,s,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Qs(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}class j_{constructor(){this.wa=void 0,this.ba=[]}Sa(){return this.ba.some((e=>e.Da()))}}class $_{constructor(){this.queries=yl(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,r){const s=B(t),o=s.queries;s.queries=yl(),o.forEach(((a,l)=>{for(const h of l.ba)h.onError(r)}))})(this,new D(b.ABORTED,"Firestore shutting down"))}}function yl(){return new ln((n=>sh(n)),Qs)}async function Uh(n,e){const t=B(n);let r=3;const s=e.query;let o=t.queries.get(s);o?!o.Sa()&&e.Da()&&(r=2):(o=new j_,r=e.Da()?0:1);try{switch(r){case 0:o.wa=await t.onListen(s,!0);break;case 1:o.wa=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(a){const l=Xo(a,`Initialization of query '${En(e.query)}' failed`);return void e.onError(l)}t.queries.set(s,o),o.ba.push(e),e.va(t.onlineState),o.wa&&e.Fa(o.wa)&&Zo(t)}async function Bh(n,e){const t=B(n),r=e.query;let s=3;const o=t.queries.get(r);if(o){const a=o.ba.indexOf(e);a>=0&&(o.ba.splice(a,1),o.ba.length===0?s=e.Da()?0:1:!o.Sa()&&e.Da()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function q_(n,e){const t=B(n);let r=!1;for(const s of e){const o=s.query,a=t.queries.get(o);if(a){for(const l of a.ba)l.Fa(s)&&(r=!0);a.wa=s}}r&&Zo(t)}function H_(n,e,t){const r=B(n),s=r.queries.get(e);if(s)for(const o of s.ba)o.onError(t);r.queries.delete(e)}function Zo(n){n.Ca.forEach((e=>{e.next()}))}var yo,El;(El=yo||(yo={})).Ma="default",El.Cache="cache";class jh{constructor(e,t,r){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new Mn(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const r=t!=="Offline";return(!this.options.Ka||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=Mn.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==yo.Cache}}class $h{constructor(e){this.key=e}}class qh{constructor(e){this.key=e}}class G_{constructor(e,t){this.query=e,this.Za=t,this.Xa=null,this.hasCachedResults=!1,this.current=!1,this.Ya=H(),this.mutatedKeys=H(),this.eu=ih(e),this.tu=new An(this.eu)}get nu(){return this.Za}ru(e,t){const r=t?t.iu:new _l,s=t?t.tu:this.tu;let o=t?t.mutatedKeys:this.mutatedKeys,a=s,l=!1;const h=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,d=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal(((p,_)=>{const E=s.get(p),C=Ys(this.query,_)?_:null,k=!!E&&this.mutatedKeys.has(E.key),O=!!C&&(C.hasLocalMutations||this.mutatedKeys.has(C.key)&&C.hasCommittedMutations);let M=!1;E&&C?E.data.isEqual(C.data)?k!==O&&(r.track({type:3,doc:C}),M=!0):this.su(E,C)||(r.track({type:2,doc:C}),M=!0,(h&&this.eu(C,h)>0||d&&this.eu(C,d)<0)&&(l=!0)):!E&&C?(r.track({type:0,doc:C}),M=!0):E&&!C&&(r.track({type:1,doc:E}),M=!0,(h||d)&&(l=!0)),M&&(C?(a=a.add(C),o=O?o.add(p):o.delete(p)):(a=a.delete(p),o=o.delete(p)))})),this.query.limit!==null)for(;a.size>this.query.limit;){const p=this.query.limitType==="F"?a.last():a.first();a=a.delete(p.key),o=o.delete(p.key),r.track({type:1,doc:p})}return{tu:a,iu:r,Ss:l,mutatedKeys:o}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const o=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const a=e.iu.ya();a.sort(((p,_)=>(function(C,k){const O=M=>{switch(M){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return x(20277,{Vt:M})}};return O(C)-O(k)})(p.type,_.type)||this.eu(p.doc,_.doc))),this.ou(r),s=s??!1;const l=t&&!s?this._u():[],h=this.Ya.size===0&&this.current&&!s?1:0,d=h!==this.Xa;return this.Xa=h,a.length!==0||d?{snapshot:new Mn(this.query,e.tu,o,a,e.mutatedKeys,h===0,d,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:l}:{au:l}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new _l,mutatedKeys:this.mutatedKeys,Ss:!1},!1)):{au:[]}}uu(e){return!this.Za.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((t=>this.Za=this.Za.add(t))),e.modifiedDocuments.forEach((t=>{})),e.removedDocuments.forEach((t=>this.Za=this.Za.delete(t))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Ya;this.Ya=H(),this.tu.forEach((r=>{this.uu(r.key)&&(this.Ya=this.Ya.add(r.key))}));const t=[];return e.forEach((r=>{this.Ya.has(r)||t.push(new qh(r))})),this.Ya.forEach((r=>{e.has(r)||t.push(new $h(r))})),t}cu(e){this.Za=e.ks,this.Ya=H();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return Mn.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Xa===0,this.hasCachedResults)}}const ea="SyncEngine";class W_{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class z_{constructor(e){this.key=e,this.hu=!1}}class K_{constructor(e,t,r,s,o,a){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=o,this.maxConcurrentLimboResolutions=a,this.Pu={},this.Tu=new ln((l=>sh(l)),Qs),this.Iu=new Map,this.Eu=new Set,this.Ru=new te(L.comparator),this.Au=new Map,this.Vu=new qo,this.du={},this.mu=new Map,this.fu=On.ar(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function Q_(n,e,t=!0){const r=Qh(n);let s;const o=r.Tu.get(e);return o?(r.sharedClientState.addLocalQueryTarget(o.targetId),s=o.view.lu()):s=await Hh(r,e,t,!0),s}async function Y_(n,e){const t=Qh(n);await Hh(t,e,!0,!1)}async function Hh(n,e,t,r){const s=await g_(n.localStore,Qe(e)),o=s.targetId,a=n.sharedClientState.addLocalQueryTarget(o,t);let l;return r&&(l=await J_(n,e,o,a==="current",s.resumeToken)),n.isPrimaryClient&&t&&Vh(n.remoteStore,s),l}async function J_(n,e,t,r,s){n.pu=(_,E,C)=>(async function(O,M,G,z){let J=M.view.ru(G);J.Ss&&(J=await hl(O.localStore,M.query,!1).then((({documents:v})=>M.view.ru(v,J))));const Oe=z&&z.targetChanges.get(M.targetId),Ue=z&&z.targetMismatches.get(M.targetId)!=null,ge=M.view.applyChanges(J,O.isPrimaryClient,Oe,Ue);return vl(O,M.targetId,ge.au),ge.snapshot})(n,_,E,C);const o=await hl(n.localStore,e,!0),a=new G_(e,o.ks),l=a.ru(o.documents),h=Fr.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),d=a.applyChanges(l,n.isPrimaryClient,h);vl(n,t,d.au);const p=new W_(e,t,a);return n.Tu.set(e,p),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),d.snapshot}async function X_(n,e,t){const r=B(n),s=r.Tu.get(e),o=r.Iu.get(s.targetId);if(o.length>1)return r.Iu.set(s.targetId,o.filter((a=>!Qs(a,e)))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await mo(r.localStore,s.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(s.targetId),t&&zo(r.remoteStore,s.targetId),Eo(r,s.targetId)})).catch(jn)):(Eo(r,s.targetId),await mo(r.localStore,s.targetId,!0))}async function Z_(n,e){const t=B(n),r=t.Tu.get(e),s=t.Iu.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),zo(t.remoteStore,r.targetId))}async function ey(n,e,t){const r=ay(n);try{const s=await(function(a,l){const h=B(a),d=ee.now(),p=l.reduce(((C,k)=>C.add(k.key)),H());let _,E;return h.persistence.runTransaction("Locally write mutations","readwrite",(C=>{let k=lt(),O=H();return h.xs.getEntries(C,p).next((M=>{k=M,k.forEach(((G,z)=>{z.isValidDocument()||(O=O.add(G))}))})).next((()=>h.localDocuments.getOverlayedDocuments(C,k))).next((M=>{_=M;const G=[];for(const z of l){const J=pm(z,_.get(z.key).overlayedDocument);J!=null&&G.push(new qt(z.key,J,Yu(J.value.mapValue),Fe.exists(!0)))}return h.mutationQueue.addMutationBatch(C,d,G,l)})).next((M=>{E=M;const G=M.applyToLocalDocumentSet(_,O);return h.documentOverlayCache.saveOverlays(C,M.batchId,G)}))})).then((()=>({batchId:E.batchId,changes:ah(_)})))})(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),(function(a,l,h){let d=a.du[a.currentUser.toKey()];d||(d=new te(q)),d=d.insert(l,h),a.du[a.currentUser.toKey()]=d})(r,s.batchId,t),await Br(r,s.changes),await ni(r.remoteStore)}catch(s){const o=Xo(s,"Failed to persist write");t.reject(o)}}async function Gh(n,e){const t=B(n);try{const r=await d_(t.localStore,e);e.targetChanges.forEach(((s,o)=>{const a=t.Au.get(o);a&&(Q(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?a.hu=!0:s.modifiedDocuments.size>0?Q(a.hu,14607):s.removedDocuments.size>0&&(Q(a.hu,42227),a.hu=!1))})),await Br(t,r,e)}catch(r){await jn(r)}}function Il(n,e,t){const r=B(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.Tu.forEach(((o,a)=>{const l=a.view.va(e);l.snapshot&&s.push(l.snapshot)})),(function(a,l){const h=B(a);h.onlineState=l;let d=!1;h.queries.forEach(((p,_)=>{for(const E of _.ba)E.va(l)&&(d=!0)})),d&&Zo(h)})(r.eventManager,e),s.length&&r.Pu.J_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function ty(n,e,t){const r=B(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Au.get(e),o=s&&s.key;if(o){let a=new te(L.comparator);a=a.insert(o,Ae.newNoDocument(o,U.min()));const l=H().add(o),h=new Zs(U.min(),new Map,new te(q),a,l);await Gh(r,h),r.Ru=r.Ru.remove(o),r.Au.delete(e),ta(r)}else await mo(r.localStore,e,!1).then((()=>Eo(r,e,t))).catch(jn)}async function ny(n,e){const t=B(n),r=e.batch.batchId;try{const s=await h_(t.localStore,e);zh(t,r,null),Wh(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await Br(t,s)}catch(s){await jn(s)}}async function ry(n,e,t){const r=B(n);try{const s=await(function(a,l){const h=B(a);return h.persistence.runTransaction("Reject batch","readwrite-primary",(d=>{let p;return h.mutationQueue.lookupMutationBatch(d,l).next((_=>(Q(_!==null,37113),p=_.keys(),h.mutationQueue.removeMutationBatch(d,_)))).next((()=>h.mutationQueue.performConsistencyCheck(d))).next((()=>h.documentOverlayCache.removeOverlaysForBatchId(d,p,l))).next((()=>h.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,p))).next((()=>h.localDocuments.getDocuments(d,p)))}))})(r.localStore,e);zh(r,e,t),Wh(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await Br(r,s)}catch(s){await jn(s)}}function Wh(n,e){(n.mu.get(e)||[]).forEach((t=>{t.resolve()})),n.mu.delete(e)}function zh(n,e,t){const r=B(n);let s=r.du[r.currentUser.toKey()];if(s){const o=s.get(e);o&&(t?o.reject(t):o.resolve(),s=s.remove(e)),r.du[r.currentUser.toKey()]=s}}function Eo(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Iu.get(e))n.Tu.delete(r),t&&n.Pu.yu(r,t);n.Iu.delete(e),n.isPrimaryClient&&n.Vu.Gr(e).forEach((r=>{n.Vu.containsKey(r)||Kh(n,r)}))}function Kh(n,e){n.Eu.delete(e.path.canonicalString());const t=n.Ru.get(e);t!==null&&(zo(n.remoteStore,t),n.Ru=n.Ru.remove(e),n.Au.delete(t),ta(n))}function vl(n,e,t){for(const r of t)r instanceof $h?(n.Vu.addReference(r.key,e),sy(n,r)):r instanceof qh?(V(ea,"Document no longer in limbo: "+r.key),n.Vu.removeReference(r.key,e),n.Vu.containsKey(r.key)||Kh(n,r.key)):x(19791,{wu:r})}function sy(n,e){const t=e.key,r=t.path.canonicalString();n.Ru.get(t)||n.Eu.has(r)||(V(ea,"New document in limbo: "+t),n.Eu.add(r),ta(n))}function ta(n){for(;n.Eu.size>0&&n.Ru.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new L(X.fromString(e)),r=n.fu.next();n.Au.set(r,new z_(t)),n.Ru=n.Ru.insert(t,r),Vh(n.remoteStore,new St(Qe(xo(t.path)),r,"TargetPurposeLimboResolution",Ws.ce))}}async function Br(n,e,t){const r=B(n),s=[],o=[],a=[];r.Tu.isEmpty()||(r.Tu.forEach(((l,h)=>{a.push(r.pu(h,e,t).then((d=>{if((d||t)&&r.isPrimaryClient){const p=d?!d.fromCache:t?.targetChanges.get(h.targetId)?.current;r.sharedClientState.updateQueryState(h.targetId,p?"current":"not-current")}if(d){s.push(d);const p=Go.Es(h.targetId,d);o.push(p)}})))})),await Promise.all(a),r.Pu.J_(s),await(async function(h,d){const p=B(h);try{await p.persistence.runTransaction("notifyLocalViewChanges","readwrite",(_=>P.forEach(d,(E=>P.forEach(E.Ts,(C=>p.persistence.referenceDelegate.addReference(_,E.targetId,C))).next((()=>P.forEach(E.Is,(C=>p.persistence.referenceDelegate.removeReference(_,E.targetId,C)))))))))}catch(_){if(!$n(_))throw _;V(Wo,"Failed to update sequence numbers: "+_)}for(const _ of d){const E=_.targetId;if(!_.fromCache){const C=p.vs.get(E),k=C.snapshotVersion,O=C.withLastLimboFreeSnapshotVersion(k);p.vs=p.vs.insert(E,O)}}})(r.localStore,o))}async function iy(n,e){const t=B(n);if(!t.currentUser.isEqual(e)){V(ea,"User change. New user:",e.toKey());const r=await Ph(t.localStore,e);t.currentUser=e,(function(o,a){o.mu.forEach((l=>{l.forEach((h=>{h.reject(new D(b.CANCELLED,a))}))})),o.mu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Br(t,r.Ns)}}function oy(n,e){const t=B(n),r=t.Au.get(e);if(r&&r.hu)return H().add(r.key);{let s=H();const o=t.Iu.get(e);if(!o)return s;for(const a of o){const l=t.Tu.get(a);s=s.unionWith(l.view.nu)}return s}}function Qh(n){const e=B(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Gh.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=oy.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=ty.bind(null,e),e.Pu.J_=q_.bind(null,e.eventManager),e.Pu.yu=H_.bind(null,e.eventManager),e}function ay(n){const e=B(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=ny.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=ry.bind(null,e),e}class Ls{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=ei(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return u_(this.persistence,new a_,e.initialUser,this.serializer)}Cu(e){return new bh(Ho.Vi,this.serializer)}Du(e){return new __}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Ls.provider={build:()=>new Ls};class cy extends Ls{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){Q(this.persistence.referenceDelegate instanceof Os,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new Wm(r,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?De.withCacheSize(this.cacheSizeBytes):De.DEFAULT;return new bh((r=>Os.Vi(r,t)),this.serializer)}}class Io{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>Il(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=iy.bind(null,this.syncEngine),await B_(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new $_})()}createDatastore(e){const t=ei(e.databaseInfo.databaseId),r=T_(e.databaseInfo);return C_(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return(function(r,s,o,a,l){return new P_(r,s,o,a,l)})(this.localStore,this.datastore,e.asyncQueue,(t=>Il(this.syncEngine,t,0)),(function(){return pl.v()?new pl:new y_})())}createSyncEngine(e,t){return(function(s,o,a,l,h,d,p){const _=new K_(s,o,a,l,h,d);return p&&(_.gu=!0),_})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await(async function(t){const r=B(t);V(sn,"RemoteStore shutting down."),r.Ea.add(5),await Ur(r),r.Aa.shutdown(),r.Va.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}Io.provider={build:()=>new Io};class Yh{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):ct("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}const jt="FirestoreClient";class ly{constructor(e,t,r,s,o){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this._databaseInfo=s,this.user=we.UNAUTHENTICATED,this.clientId=No.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(r,(async a=>{V(jt,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(r,(a=>(V(jt,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this._databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new ot;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=Xo(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}}async function Wi(n,e){n.asyncQueue.verifyOperationInProgress(),V(jt,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener((async s=>{r.isEqual(s)||(await Ph(e.localStore,s),r=s)})),e.persistence.setDatabaseDeletedListener((()=>n.terminate())),n._offlineComponents=e}async function Tl(n,e){n.asyncQueue.verifyOperationInProgress();const t=await uy(n);V(jt,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener((r=>ml(e.remoteStore,r))),n.setAppCheckTokenChangeListener(((r,s)=>ml(e.remoteStore,s))),n._onlineComponents=e}async function uy(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){V(jt,"Using user provided OfflineComponentProvider");try{await Wi(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!(function(s){return s.name==="FirebaseError"?s.code===b.FAILED_PRECONDITION||s.code===b.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11})(t))throw t;kn("Error using user provided cache. Falling back to memory cache: "+t),await Wi(n,new Ls)}}else V(jt,"Using default OfflineComponentProvider"),await Wi(n,new cy(void 0));return n._offlineComponents}async function Jh(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(V(jt,"Using user provided OnlineComponentProvider"),await Tl(n,n._uninitializedComponentsProvider._online)):(V(jt,"Using default OnlineComponentProvider"),await Tl(n,new Io))),n._onlineComponents}function hy(n){return Jh(n).then((e=>e.syncEngine))}async function Xh(n){const e=await Jh(n),t=e.eventManager;return t.onListen=Q_.bind(null,e.syncEngine),t.onUnlisten=X_.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=Y_.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=Z_.bind(null,e.syncEngine),t}function dy(n,e,t={}){const r=new ot;return n.asyncQueue.enqueueAndForget((async()=>(function(o,a,l,h,d){const p=new Yh({next:E=>{p.Nu(),a.enqueueAndForget((()=>Bh(o,_)));const C=E.docs.has(l);!C&&E.fromCache?d.reject(new D(b.UNAVAILABLE,"Failed to get document because the client is offline.")):C&&E.fromCache&&h&&h.source==="server"?d.reject(new D(b.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):d.resolve(E)},error:E=>d.reject(E)}),_=new jh(xo(l.path),p,{includeMetadataChanges:!0,Ka:!0});return Uh(o,_)})(await Xh(n),n.asyncQueue,e,t,r))),r.promise}function fy(n,e,t={}){const r=new ot;return n.asyncQueue.enqueueAndForget((async()=>(function(o,a,l,h,d){const p=new Yh({next:E=>{p.Nu(),a.enqueueAndForget((()=>Bh(o,_))),E.fromCache&&h.source==="server"?d.reject(new D(b.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(E)},error:E=>d.reject(E)}),_=new jh(l,p,{includeMetadataChanges:!0,Ka:!0});return Uh(o,_)})(await Xh(n),n.asyncQueue,e,t,r))),r.promise}function py(n,e){const t=new ot;return n.asyncQueue.enqueueAndForget((async()=>ey(await hy(n),e,t))),t.promise}function Zh(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}const gy="ComponentProvider",wl=new Map;function my(n,e,t,r,s){return new Lg(n,e,t,s.host,s.ssl,s.experimentalForceLongPolling,s.experimentalAutoDetectLongPolling,Zh(s.experimentalLongPollingOptions),s.useFetchStreams,s.isUsingEmulator,r)}const ed="firestore.googleapis.com",Al=!0;class Rl{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new D(b.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=ed,this.ssl=Al}else this.host=e.host,this.ssl=e.ssl??Al;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=Ch;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<Hm)throw new D(b.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Rg("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Zh(e.experimentalLongPollingOptions??{}),(function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new D(b.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new D(b.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new D(b.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(r,s){return r.timeoutSeconds===s.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class ri{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Rl({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new D(b.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new D(b.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Rl(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new gg;switch(r.type){case"firstParty":return new Eg(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new D(b.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){const r=wl.get(t);r&&(V(gy,"Removing Datastore"),wl.delete(t),r.terminate())})(this),Promise.resolve()}}function _y(n,e,t,r={}){n=He(n,ri);const s=Fn(e),o=n._getSettings(),a={...o,emulatorOptions:n._getEmulatorOptions()},l=`${e}:${t}`;s&&(wu(`https://${l}`),Au("Firestore",!0)),o.host!==ed&&o.host!==l&&kn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const h={...o,host:l,ssl:s,emulatorOptions:r};if(!tn(h,a)&&(n._setSettings(h),r.mockUserToken)){let d,p;if(typeof r.mockUserToken=="string")d=r.mockUserToken,p=we.MOCK_USER;else{d=Uf(r.mockUserToken,n._app?.options.projectId);const _=r.mockUserToken.sub||r.mockUserToken.user_id;if(!_)throw new D(b.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");p=new we(_)}n._authCredentials=new mg(new Fu(d,p))}}class hn{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new hn(this.firestore,e,this._query)}}class se{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ot(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new se(this.firestore,e,this._key)}toJSON(){return{type:se._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(Lr(t,se._jsonSchema))return new se(e,r||null,new L(X.fromString(t.referencePath)))}}se._jsonSchemaVersion="firestore/documentReference/1.0",se._jsonSchema={type:ce("string",se._jsonSchemaVersion),referencePath:ce("string")};class Ot extends hn{constructor(e,t,r){super(e,t,xo(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new se(this.firestore,null,new L(e))}withConverter(e){return new Ot(this.firestore,e,this._path)}}function Et(n,e,...t){if(n=Ee(n),Uu("collection","path",e),n instanceof ri){const r=X.fromString(e,...t);return Fc(r),new Ot(n,null,r)}{if(!(n instanceof se||n instanceof Ot))throw new D(b.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(X.fromString(e,...t));return Fc(r),new Ot(n.firestore,null,r)}}function vt(n,e,...t){if(n=Ee(n),arguments.length===1&&(e=No.newId()),Uu("doc","path",e),n instanceof ri){const r=X.fromString(e,...t);return xc(r),new se(n,null,new L(r))}{if(!(n instanceof se||n instanceof Ot))throw new D(b.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(X.fromString(e,...t));return xc(r),new se(n.firestore,n instanceof Ot?n.converter:null,new L(r))}}const Sl="AsyncQueue";class Cl{constructor(e=Promise.resolve()){this.Yu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new Nh(this,"async_queue_retry"),this._c=()=>{const r=Gi();r&&V(Sl,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const t=Gi();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=Gi();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const t=new ot;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Yu.push(e),this.lc())))}async lc(){if(this.Yu.length!==0){try{await this.Yu[0](),this.Yu.shift(),this.M_.reset()}catch(e){if(!$n(e))throw e;V(Sl,"Operation failed with retryable error: "+e)}this.Yu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const t=this.ac.then((()=>(this.rc=!0,e().catch((r=>{throw this.nc=r,this.rc=!1,ct("INTERNAL UNHANDLED ERROR: ",bl(r)),r})).then((r=>(this.rc=!1,r))))));return this.ac=t,t}enqueueAfterDelay(e,t,r){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const s=Jo.createAndSchedule(this,e,t,r,(o=>this.hc(o)));return this.tc.push(s),s}uc(){this.nc&&x(47125,{Pc:bl(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((t,r)=>t.targetTimeMs-r.targetTimeMs));for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()}))}Rc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function bl(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}class dn extends ri{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new Cl,this._persistenceKey=s?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new Cl(e),this._firestoreClient=void 0,await e}}}function yy(n,e){const t=typeof n=="object"?n:bu(),r=typeof n=="string"?n:bs,s=Po(t,"firestore").getImmediate({identifier:r});if(!s._initialized){const o=xf("firestore");o&&_y(s,...o)}return s}function na(n){if(n._terminated)throw new D(b.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||Ey(n),n._firestoreClient}function Ey(n){const e=n._freezeSettings(),t=my(n._databaseId,n._app?.options.appId||"",n._persistenceKey,n._app?.options.apiKey,e);n._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new ly(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&(function(s){const o=s?._online.build();return{_offline:s?._offline.build(o),_online:o}})(n._componentsProvider))}class xe{constructor(e){this._byteString=e}static fromBase64String(e){try{return new xe(Ie.fromBase64String(e))}catch(t){throw new D(b.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new xe(Ie.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:xe._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Lr(e,xe._jsonSchema))return xe.fromBase64String(e.bytes)}}xe._jsonSchemaVersion="firestore/bytes/1.0",xe._jsonSchema={type:ce("string",xe._jsonSchemaVersion),bytes:ce("string")};class ra{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new D(b.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ye(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class sa{constructor(e){this._methodName=e}}class Je{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new D(b.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new D(b.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return q(this._lat,e._lat)||q(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Je._jsonSchemaVersion}}static fromJSON(e){if(Lr(e,Je._jsonSchema))return new Je(e.latitude,e.longitude)}}Je._jsonSchemaVersion="firestore/geoPoint/1.0",Je._jsonSchema={type:ce("string",Je._jsonSchemaVersion),latitude:ce("number"),longitude:ce("number")};class $e{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(r,s){if(r.length!==s.length)return!1;for(let o=0;o<r.length;++o)if(r[o]!==s[o])return!1;return!0})(this._values,e._values)}toJSON(){return{type:$e._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Lr(e,$e._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((t=>typeof t=="number")))return new $e(e.vectorValues);throw new D(b.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}$e._jsonSchemaVersion="firestore/vectorValue/1.0",$e._jsonSchema={type:ce("string",$e._jsonSchemaVersion),vectorValues:ce("object")};const Iy=/^__.*__$/;class vy{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new qt(e,this.data,this.fieldMask,t,this.fieldTransforms):new xr(e,this.data,t,this.fieldTransforms)}}class td{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new qt(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function nd(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw x(40011,{dataSource:n})}}class ia{constructor(e,t,r,s,o,a){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,o===void 0&&this.validatePath(),this.fieldTransforms=o||[],this.fieldMask=a||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new ia({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){const t=this.path?.child(e),r=this.contextWith({path:t,arrayElement:!1});return r.validatePathSegment(e),r}childContextForFieldPath(e){const t=this.path?.child(e),r=this.contextWith({path:t,arrayElement:!1});return r.validatePath(),r}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return xs(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return this.fieldMask.find((t=>e.isPrefixOf(t)))!==void 0||this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))!==void 0}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(e.length===0)throw this.createError("Document fields must not be empty");if(nd(this.dataSource)&&Iy.test(e))throw this.createError('Document fields cannot begin and end with "__"')}}class Ty{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||ei(e)}createContext(e,t,r,s=!1){return new ia({dataSource:e,methodName:t,targetDoc:r,path:ye.emptyPath(),arrayElement:!1,hasConverter:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function si(n){const e=n._freezeSettings(),t=ei(n._databaseId);return new Ty(n._databaseId,!!e.ignoreUndefinedProperties,t)}function rd(n,e,t,r,s,o={}){const a=n.createContext(o.merge||o.mergeFields?2:0,e,t,s);oa("Data must be an object, but it was:",a,r);const l=sd(r,a);let h,d;if(o.merge)h=new Le(a.fieldMask),d=a.fieldTransforms;else if(o.mergeFields){const p=[];for(const _ of o.mergeFields){const E=on(e,_,t);if(!a.contains(E))throw new D(b.INVALID_ARGUMENT,`Field '${E}' is specified in your field mask but missing from your input data.`);ad(p,E)||p.push(E)}h=new Le(p),d=a.fieldTransforms.filter((_=>h.covers(_.field)))}else h=null,d=a.fieldTransforms;return new vy(new Ve(l),h,d)}class ii extends sa{_toFieldTransform(e){if(e.dataSource!==2)throw e.dataSource===1?e.createError(`${this._methodName}() can only appear at the top level of your update data`):e.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof ii}}function wy(n,e,t,r){const s=n.createContext(1,e,t);oa("Data must be an object, but it was:",s,r);const o=[],a=Ve.empty();$t(r,((h,d)=>{const p=od(e,h,t);d=Ee(d);const _=s.childContextForFieldPath(p);if(d instanceof ii)o.push(p);else{const E=jr(d,_);E!=null&&(o.push(p),a.set(p,E))}}));const l=new Le(o);return new td(a,l,s.fieldTransforms)}function Ay(n,e,t,r,s,o){const a=n.createContext(1,e,t),l=[on(e,r,t)],h=[s];if(o.length%2!=0)throw new D(b.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let E=0;E<o.length;E+=2)l.push(on(e,o[E])),h.push(o[E+1]);const d=[],p=Ve.empty();for(let E=l.length-1;E>=0;--E)if(!ad(d,l[E])){const C=l[E];let k=h[E];k=Ee(k);const O=a.childContextForFieldPath(C);if(k instanceof ii)d.push(C);else{const M=jr(k,O);M!=null&&(d.push(C),p.set(C,M))}}const _=new Le(d);return new td(p,_,a.fieldTransforms)}function Ry(n,e,t,r=!1){return jr(t,n.createContext(r?4:3,e))}function jr(n,e){if(id(n=Ee(n)))return oa("Unsupported field value:",e,n),sd(n,e);if(n instanceof sa)return(function(r,s){if(!nd(s.dataSource))throw s.createError(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.createError(`${r._methodName}() is not currently supported inside arrays`);const o=r._toFieldTransform(s);o&&s.fieldTransforms.push(o)})(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.arrayElement&&e.dataSource!==4)throw e.createError("Nested arrays are not supported");return(function(r,s){const o=[];let a=0;for(const l of r){let h=jr(l,s.childContextForArray(a));h==null&&(h={nullValue:"NULL_VALUE"}),o.push(h),a++}return{arrayValue:{values:o}}})(n,e)}return(function(r,s){if((r=Ee(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return cm(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const o=ee.fromDate(r);return{timestampValue:Vs(s.serializer,o)}}if(r instanceof ee){const o=new ee(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Vs(s.serializer,o)}}if(r instanceof Je)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof xe)return{bytesValue:Eh(s.serializer,r._byteString)};if(r instanceof se){const o=s.databaseId,a=r.firestore._databaseId;if(!a.isEqual(o))throw s.createError(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:$o(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof $e)return(function(a,l){const h=a instanceof $e?a.toArray():a;return{mapValue:{fields:{[Ku]:{stringValue:Qu},[Ps]:{arrayValue:{values:h.map((p=>{if(typeof p!="number")throw l.createError("VectorValues must only contain numeric values.");return Fo(l.serializer,p)}))}}}}}})(r,s);if(Sh(r))return r._toProto(s.serializer);throw s.createError(`Unsupported field value: ${Gs(r)}`)})(n,e)}function sd(n,e){const t={};return $u(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):$t(n,((r,s)=>{const o=jr(s,e.childContextForField(r));o!=null&&(t[r]=o)})),{mapValue:{fields:t}}}function id(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof ee||n instanceof Je||n instanceof xe||n instanceof se||n instanceof sa||n instanceof $e||Sh(n))}function oa(n,e,t){if(!id(t)||!Bu(t)){const r=Gs(t);throw r==="an object"?e.createError(n+" a custom object"):e.createError(n+" "+r)}}function on(n,e,t){if((e=Ee(e))instanceof ra)return e._internalPath;if(typeof e=="string")return od(n,e);throw xs("Field path arguments must be of type string or ",n,!1,void 0,t)}const Sy=new RegExp("[~\\*/\\[\\]]");function od(n,e,t){if(e.search(Sy)>=0)throw xs(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new ra(...e.split("."))._internalPath}catch{throw xs(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function xs(n,e,t,r,s){const o=r&&!r.isEmpty(),a=s!==void 0;let l=`Function ${e}() called with invalid data`;t&&(l+=" (via `toFirestore()`)"),l+=". ";let h="";return(o||a)&&(h+=" (found",o&&(h+=` in field ${r}`),a&&(h+=` in document ${s}`),h+=")"),new D(b.INVALID_ARGUMENT,l+n+h)}function ad(n,e){return n.some((t=>t.isEqual(e)))}class Cy{convertValue(e,t="none"){switch(Ut(e)){case 0:return null;case 1:return e.booleanValue;case 2:return re(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Ft(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw x(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return $t(e,((s,o)=>{r[s]=this.convertValue(o,t)})),r}convertVectorValue(e){const t=e.fields?.[Ps].arrayValue?.values?.map((r=>re(r.doubleValue)));return new $e(t)}convertGeoPoint(e){return new Je(re(e.latitude),re(e.longitude))}convertArray(e,t){return(e.values||[]).map((r=>this.convertValue(r,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const r=Ks(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Rr(e));default:return null}}convertTimestamp(e){const t=xt(e);return new ee(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=X.fromString(e);Q(Rh(r),9688,{name:e});const s=new Sr(r.get(1),r.get(3)),o=new L(r.popFirst(5));return s.isEqual(t)||ct(`Document ${o} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),o}}class cd extends Cy{constructor(e){super(),this.firestore=e}convertBytes(e){return new xe(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new se(this.firestore,null,t)}}const Pl="@firebase/firestore",kl="4.10.0";class ld{constructor(e,t,r,s,o){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new se(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new by(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}_fieldsProto(){return this._document?.data.clone().value.mapValue.fields??void 0}get(e){if(this._document){const t=this._document.data.field(on("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class by extends ld{data(){return super.data()}}function Py(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new D(b.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class aa{}class ud extends aa{}function lr(n,e,...t){let r=[];e instanceof aa&&r.push(e),r=r.concat(t),(function(o){const a=o.filter((h=>h instanceof ca)).length,l=o.filter((h=>h instanceof oi)).length;if(a>1||a>0&&l>0)throw new D(b.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(r);for(const s of r)n=s._apply(n);return n}class oi extends ud{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new oi(e,t,r)}_apply(e){const t=this._parse(e);return hd(e._query,t),new hn(e.firestore,e.converter,lo(e._query,t))}_parse(e){const t=si(e.firestore);return(function(o,a,l,h,d,p,_){let E;if(d.isKeyField()){if(p==="array-contains"||p==="array-contains-any")throw new D(b.INVALID_ARGUMENT,`Invalid Query. You can't perform '${p}' queries on documentId().`);if(p==="in"||p==="not-in"){Dl(_,p);const k=[];for(const O of _)k.push(Nl(h,o,O));E={arrayValue:{values:k}}}else E=Nl(h,o,_)}else p!=="in"&&p!=="not-in"&&p!=="array-contains-any"||Dl(_,p),E=Ry(l,a,_,p==="in"||p==="not-in");return ae.create(d,p,E)})(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function mn(n,e,t){const r=e,s=on("where",n);return oi._create(s,r,t)}class ca extends aa{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new ca(e,t)}_parse(e){const t=this._queryConstraints.map((r=>r._parse(e))).filter((r=>r.getFilters().length>0));return t.length===1?t[0]:Ge.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:((function(s,o){let a=s;const l=o.getFlattenedFilters();for(const h of l)hd(a,h),a=lo(a,h)})(e._query,t),new hn(e.firestore,e.converter,lo(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class la extends ud{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new la(e,t)}_apply(e){const t=(function(s,o,a){if(s.startAt!==null)throw new D(b.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new D(b.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new br(o,a)})(e._query,this._field,this._direction);return new hn(e.firestore,e.converter,em(e._query,t))}}function zi(n,e="asc"){const t=e,r=on("orderBy",n);return la._create(r,t)}function Nl(n,e,t){if(typeof(t=Ee(t))=="string"){if(t==="")throw new D(b.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!rh(e)&&t.indexOf("/")!==-1)throw new D(b.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(X.fromString(t));if(!L.isDocumentKey(r))throw new D(b.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Wc(n,new L(r))}if(t instanceof se)return Wc(n,t._key);throw new D(b.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Gs(t)}.`)}function Dl(n,e){if(!Array.isArray(n)||n.length===0)throw new D(b.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function hd(n,e){const t=(function(s,o){for(const a of s)for(const l of a.getFlattenedFilters())if(o.indexOf(l.op)>=0)return l.op;return null})(n.filters,(function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(t!==null)throw t===e.op?new D(b.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new D(b.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function dd(n,e,t){let r;return r=n?n.toFirestore(e):e,r}class gr{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Zt extends ld{constructor(e,t,r,s,o,a){super(e,t,r,s,a),this._firestore=e,this._firestoreImpl=e,this.metadata=o}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Es(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(on("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new D(b.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=Zt._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}Zt._jsonSchemaVersion="firestore/documentSnapshot/1.0",Zt._jsonSchema={type:ce("string",Zt._jsonSchemaVersion),bundleSource:ce("string","DocumentSnapshot"),bundleName:ce("string"),bundle:ce("string")};class Es extends Zt{data(e={}){return super.data(e)}}class Rn{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new gr(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((r=>{e.call(t,new Es(this._firestore,this._userDataWriter,r.key,r,new gr(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new D(b.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(s,o){if(s._snapshot.oldDocs.isEmpty()){let a=0;return s._snapshot.docChanges.map((l=>{const h=new Es(s._firestore,s._userDataWriter,l.doc.key,l.doc,new gr(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);return l.doc,{type:"added",doc:h,oldIndex:-1,newIndex:a++}}))}{let a=s._snapshot.oldDocs;return s._snapshot.docChanges.filter((l=>o||l.type!==3)).map((l=>{const h=new Es(s._firestore,s._userDataWriter,l.doc.key,l.doc,new gr(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);let d=-1,p=-1;return l.type!==0&&(d=a.indexOf(l.doc.key),a=a.delete(l.doc.key)),l.type!==1&&(a=a.add(l.doc),p=a.indexOf(l.doc.key)),{type:ky(l.type),doc:h,oldIndex:d,newIndex:p}}))}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new D(b.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=Rn._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=No.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],r=[],s=[];return this.docs.forEach((o=>{o._document!==null&&(t.push(o._document),r.push(this._userDataWriter.convertObjectMap(o._document.data.value.mapValue.fields,"previous")),s.push(o.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function ky(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return x(61501,{type:n})}}Rn._jsonSchemaVersion="firestore/querySnapshot/1.0",Rn._jsonSchema={type:ce("string",Rn._jsonSchemaVersion),bundleSource:ce("string","QuerySnapshot"),bundleName:ce("string"),bundle:ce("string")};function Ny(n){n=He(n,se);const e=He(n.firestore,dn),t=na(e);return dy(t,n._key).then((r=>Vy(e,n,r)))}function ur(n){n=He(n,hn);const e=He(n.firestore,dn),t=na(e),r=new cd(e);return Py(n._query),fy(t,n._query).then((s=>new Rn(e,r,n,s)))}function Vl(n,e,t){n=He(n,se);const r=He(n.firestore,dn),s=dd(n.converter,e),o=si(r);return ai(r,[rd(o,"setDoc",n._key,s,n.converter!==null,t).toMutation(n._key,Fe.none())])}function Dy(n,e,t,...r){n=He(n,se);const s=He(n.firestore,dn),o=si(s);let a;return a=typeof(e=Ee(e))=="string"||e instanceof ra?Ay(o,"updateDoc",n._key,e,t,r):wy(o,"updateDoc",n._key,e),ai(s,[a.toMutation(n._key,Fe.exists(!0))])}function Ki(n){return ai(He(n.firestore,dn),[new Uo(n._key,Fe.none())])}function Qi(n,e){const t=He(n.firestore,dn),r=vt(n),s=dd(n.converter,e),o=si(n.firestore);return ai(t,[rd(o,"addDoc",r._key,s,n.converter!==null,{}).toMutation(r._key,Fe.exists(!1))]).then((()=>r))}function ai(n,e){const t=na(n);return py(t,e)}function Vy(n,e,t){const r=t.docs.get(e._key),s=new cd(n);return new Zt(n,s,e._key,r,new gr(t.hasPendingWrites,t.fromCache),e.converter)}(function(e,t=!0){pg(Un),Pn(new nn("firestore",((r,{instanceIdentifier:s,options:o})=>{const a=r.getProvider("app").getImmediate(),l=new dn(new _g(r.getProvider("auth-internal")),new Ig(a,r.getProvider("app-check-internal")),xg(a,s),a);return o={useFetchStreams:t,...o},l._setSettings(o),l}),"PUBLIC").setMultipleInstances(!0)),Dt(Pl,kl,e),Dt(Pl,kl,"esm2020")})();function fd(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const Oy=fd,pd=new Or("auth","Firebase",fd());const Fs=new Co("@firebase/auth");function My(n,...e){Fs.logLevel<=$.WARN&&Fs.warn(`Auth (${Un}): ${n}`,...e)}function Is(n,...e){Fs.logLevel<=$.ERROR&&Fs.error(`Auth (${Un}): ${n}`,...e)}function tt(n,...e){throw ha(n,...e)}function qe(n,...e){return ha(n,...e)}function ua(n,e,t){const r={...Oy(),[e]:t};return new Or("auth","Firebase",r).create(e,{appName:n.name})}function en(n){return ua(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Ly(n,e,t){const r=t;if(!(e instanceof r))throw r.name!==e.constructor.name&&tt(n,"argument-error"),ua(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function ha(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return pd.create(n,...e)}function F(n,e,...t){if(!n)throw ha(e,...t)}function rt(n){const e="INTERNAL ASSERTION FAILED: "+n;throw Is(e),new Error(e)}function ut(n,e){n||rt(e)}function vo(){return typeof self<"u"&&self.location?.href||""}function xy(){return Ol()==="http:"||Ol()==="https:"}function Ol(){return typeof self<"u"&&self.location?.protocol||null}function Fy(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(xy()||Gf()||"connection"in navigator)?navigator.onLine:!0}function Uy(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}class $r{constructor(e,t){this.shortDelay=e,this.longDelay=t,ut(t>e,"Short delay should be less than long delay!"),this.isMobile=$f()||Wf()}get(){return Fy()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function da(n,e){ut(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}class gd{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;rt("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;rt("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;rt("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const By={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};const jy=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],$y=new $r(3e4,6e4);function fa(n,e){return n.tenantId&&!e.tenantId?{...e,tenantId:n.tenantId}:e}async function Gn(n,e,t,r,s={}){return md(n,s,async()=>{let o={},a={};r&&(e==="GET"?a=r:o={body:JSON.stringify(r)});const l=Mr({key:n.config.apiKey,...a}).slice(1),h=await n._getAdditionalHeaders();h["Content-Type"]="application/json",n.languageCode&&(h["X-Firebase-Locale"]=n.languageCode);const d={method:e,headers:h,...o};return Hf()||(d.referrerPolicy="no-referrer"),n.emulatorConfig&&Fn(n.emulatorConfig.host)&&(d.credentials="include"),gd.fetch()(await _d(n,n.config.apiHost,t,l),d)})}async function md(n,e,t){n._canInitEmulator=!1;const r={...By,...e};try{const s=new Hy(n),o=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const a=await o.json();if("needConfirmation"in a)throw ds(n,"account-exists-with-different-credential",a);if(o.ok&&!("errorMessage"in a))return a;{const l=o.ok?a.errorMessage:a.error.message,[h,d]=l.split(" : ");if(h==="FEDERATED_USER_ID_ALREADY_LINKED")throw ds(n,"credential-already-in-use",a);if(h==="EMAIL_EXISTS")throw ds(n,"email-already-in-use",a);if(h==="USER_DISABLED")throw ds(n,"user-disabled",a);const p=r[h]||h.toLowerCase().replace(/[_\s]+/g,"-");if(d)throw ua(n,p,d);tt(n,p)}}catch(s){if(s instanceof dt)throw s;tt(n,"network-request-failed",{message:String(s)})}}async function qy(n,e,t,r,s={}){const o=await Gn(n,e,t,r,s);return"mfaPendingCredential"in o&&tt(n,"multi-factor-auth-required",{_serverResponse:o}),o}async function _d(n,e,t,r){const s=`${e}${t}?${r}`,o=n,a=o.config.emulator?da(n.config,s):`${n.config.apiScheme}://${s}`;return jy.includes(t)&&(await o._persistenceManagerAvailable,o._getPersistenceType()==="COOKIE")?o._getPersistence()._getFinalTarget(a).toString():a}class Hy{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(qe(this.auth,"network-request-failed")),$y.get())})}}function ds(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const s=qe(n,e,r);return s.customData._tokenResponse=t,s}async function Gy(n,e){return Gn(n,"POST","/v1/accounts:delete",e)}async function Us(n,e){return Gn(n,"POST","/v1/accounts:lookup",e)}function vr(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function Wy(n,e=!1){const t=Ee(n),r=await t.getIdToken(e),s=pa(r);F(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const o=typeof s.firebase=="object"?s.firebase:void 0,a=o?.sign_in_provider;return{claims:s,token:r,authTime:vr(Yi(s.auth_time)),issuedAtTime:vr(Yi(s.iat)),expirationTime:vr(Yi(s.exp)),signInProvider:a||null,signInSecondFactor:o?.sign_in_second_factor||null}}function Yi(n){return Number(n)*1e3}function pa(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return Is("JWT malformed, contained fewer than 3 sections"),null;try{const s=Eu(t);return s?JSON.parse(s):(Is("Failed to decode base64 JWT payload"),null)}catch(s){return Is("Caught error parsing JWT payload as JSON",s?.toString()),null}}function Ml(n){const e=pa(n);return F(e,"internal-error"),F(typeof e.exp<"u","internal-error"),F(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}async function Nr(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof dt&&zy(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function zy({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}class Ky{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class To{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=vr(this.lastLoginAt),this.creationTime=vr(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function Bs(n){const e=n.auth,t=await n.getIdToken(),r=await Nr(n,Us(e,{idToken:t}));F(r?.users.length,e,"internal-error");const s=r.users[0];n._notifyReloadListener(s);const o=s.providerUserInfo?.length?yd(s.providerUserInfo):[],a=Yy(n.providerData,o),l=n.isAnonymous,h=!(n.email&&s.passwordHash)&&!a?.length,d=l?h:!1,p={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new To(s.createdAt,s.lastLoginAt),isAnonymous:d};Object.assign(n,p)}async function Qy(n){const e=Ee(n);await Bs(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function Yy(n,e){return[...n.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function yd(n){return n.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}async function Jy(n,e){const t=await md(n,{},async()=>{const r=Mr({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:o}=n.config,a=await _d(n,s,"/v1/token",`key=${o}`),l=await n._getAdditionalHeaders();l["Content-Type"]="application/x-www-form-urlencoded";const h={method:"POST",headers:l,body:r};return n.emulatorConfig&&Fn(n.emulatorConfig.host)&&(h.credentials="include"),gd.fetch()(a,h)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function Xy(n,e){return Gn(n,"POST","/v2/accounts:revokeToken",fa(n,e))}class Sn{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){F(e.idToken,"internal-error"),F(typeof e.idToken<"u","internal-error"),F(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Ml(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){F(e.length!==0,"internal-error");const t=Ml(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(F(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:s,expiresIn:o}=await Jy(e,t);this.updateTokensAndExpiration(r,s,Number(o))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:s,expirationTime:o}=t,a=new Sn;return r&&(F(typeof r=="string","internal-error",{appName:e}),a.refreshToken=r),s&&(F(typeof s=="string","internal-error",{appName:e}),a.accessToken=s),o&&(F(typeof o=="number","internal-error",{appName:e}),a.expirationTime=o),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Sn,this.toJSON())}_performRefresh(){return rt("not implemented")}}function It(n,e){F(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class je{constructor({uid:e,auth:t,stsTokenManager:r,...s}){this.providerId="firebase",this.proactiveRefresh=new Ky(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new To(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const t=await Nr(this,this.stsTokenManager.getToken(this.auth,e));return F(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return Wy(this,e)}reload(){return Qy(this)}_assign(e){this!==e&&(F(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new je({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){F(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await Bs(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Be(this.auth.app))return Promise.reject(en(this.auth));const e=await this.getIdToken();return await Nr(this,Gy(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const r=t.displayName??void 0,s=t.email??void 0,o=t.phoneNumber??void 0,a=t.photoURL??void 0,l=t.tenantId??void 0,h=t._redirectEventId??void 0,d=t.createdAt??void 0,p=t.lastLoginAt??void 0,{uid:_,emailVerified:E,isAnonymous:C,providerData:k,stsTokenManager:O}=t;F(_&&O,e,"internal-error");const M=Sn.fromJSON(this.name,O);F(typeof _=="string",e,"internal-error"),It(r,e.name),It(s,e.name),F(typeof E=="boolean",e,"internal-error"),F(typeof C=="boolean",e,"internal-error"),It(o,e.name),It(a,e.name),It(l,e.name),It(h,e.name),It(d,e.name),It(p,e.name);const G=new je({uid:_,auth:e,email:s,emailVerified:E,displayName:r,isAnonymous:C,photoURL:a,phoneNumber:o,tenantId:l,stsTokenManager:M,createdAt:d,lastLoginAt:p});return k&&Array.isArray(k)&&(G.providerData=k.map(z=>({...z}))),h&&(G._redirectEventId=h),G}static async _fromIdTokenResponse(e,t,r=!1){const s=new Sn;s.updateFromServerResponse(t);const o=new je({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await Bs(o),o}static async _fromGetAccountInfoResponse(e,t,r){const s=t.users[0];F(s.localId!==void 0,"internal-error");const o=s.providerUserInfo!==void 0?yd(s.providerUserInfo):[],a=!(s.email&&s.passwordHash)&&!o?.length,l=new Sn;l.updateFromIdToken(r);const h=new je({uid:s.localId,auth:e,stsTokenManager:l,isAnonymous:a}),d={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:o,metadata:new To(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!o?.length};return Object.assign(h,d),h}}const Ll=new Map;function st(n){ut(n instanceof Function,"Expected a class definition");let e=Ll.get(n);return e?(ut(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,Ll.set(n,e),e)}class Ed{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Ed.type="NONE";const xl=Ed;function vs(n,e,t){return`firebase:${n}:${e}:${t}`}class Cn{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:s,name:o}=this.auth;this.fullUserKey=vs(this.userKey,s.apiKey,o),this.fullPersistenceKey=vs("persistence",s.apiKey,o),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await Us(this.auth,{idToken:e}).catch(()=>{});return t?je._fromGetAccountInfoResponse(this.auth,t,e):null}return je._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new Cn(st(xl),e,r);const s=(await Promise.all(t.map(async d=>{if(await d._isAvailable())return d}))).filter(d=>d);let o=s[0]||st(xl);const a=vs(r,e.config.apiKey,e.name);let l=null;for(const d of t)try{const p=await d._get(a);if(p){let _;if(typeof p=="string"){const E=await Us(e,{idToken:p}).catch(()=>{});if(!E)break;_=await je._fromGetAccountInfoResponse(e,E,p)}else _=je._fromJSON(e,p);d!==o&&(l=_),o=d;break}}catch{}const h=s.filter(d=>d._shouldAllowMigration);return!o._shouldAllowMigration||!h.length?new Cn(o,e,r):(o=h[0],l&&await o._set(a,l.toJSON()),await Promise.all(t.map(async d=>{if(d!==o)try{await d._remove(a)}catch{}})),new Cn(o,e,r))}}function Fl(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(wd(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Id(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Rd(e))return"Blackberry";if(Sd(e))return"Webos";if(vd(e))return"Safari";if((e.includes("chrome/")||Td(e))&&!e.includes("edge/"))return"Chrome";if(Ad(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if(r?.length===2)return r[1]}return"Other"}function Id(n=Se()){return/firefox\//i.test(n)}function vd(n=Se()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Td(n=Se()){return/crios\//i.test(n)}function wd(n=Se()){return/iemobile/i.test(n)}function Ad(n=Se()){return/android/i.test(n)}function Rd(n=Se()){return/blackberry/i.test(n)}function Sd(n=Se()){return/webos/i.test(n)}function ga(n=Se()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function Zy(n=Se()){return ga(n)&&!!window.navigator?.standalone}function eE(){return zf()&&document.documentMode===10}function Cd(n=Se()){return ga(n)||Ad(n)||Sd(n)||Rd(n)||/windows phone/i.test(n)||wd(n)}function bd(n,e=[]){let t;switch(n){case"Browser":t=Fl(Se());break;case"Worker":t=`${Fl(Se())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Un}/${r}`}class tE{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=o=>new Promise((a,l)=>{try{const h=e(o);a(h)}catch(h){l(h)}});r.onAbort=t,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}}}async function nE(n,e={}){return Gn(n,"GET","/v2/passwordPolicy",fa(n,e))}const rE=6;class sE{constructor(e){const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??rE,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,s,o){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=o))}}class iE{constructor(e,t,r,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Ul(this),this.idTokenSubscription=new Ul(this),this.beforeStateQueue=new tE(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=pd,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion,this._persistenceManagerAvailable=new Promise(o=>this._resolvePersistenceManagerAvailable=o)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=st(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await Cn.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await Us(this,{idToken:e}),r=await je._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(Be(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let r=t,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=this.redirectUser?._redirectEventId,a=r?._redirectEventId,l=await this.tryRedirectSignIn(e);(!o||o===a)&&l?.user&&(r=l.user,s=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(r)}catch(o){r=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return F(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Bs(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=Uy()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Be(this.app))return Promise.reject(en(this));const t=e?Ee(e):null;return t&&F(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&F(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Be(this.app)?Promise.reject(en(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Be(this.app)?Promise.reject(en(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(st(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await nE(this),t=new sE(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Or("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await Xy(this,r)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&st(e)||this._popupRedirectResolver;F(t,this,"argument-error"),this.redirectPersistenceManager=await Cn.create(this,[st(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,s){if(this._deleted)return()=>{};const o=typeof t=="function"?t:t.next.bind(t);let a=!1;const l=this._isInitialized?Promise.resolve():this._initializationPromise;if(F(l,this,"internal-error"),l.then(()=>{a||o(this.currentUser)}),typeof t=="function"){const h=e.addObserver(t,r,s);return()=>{a=!0,h()}}else{const h=e.addObserver(t);return()=>{a=!0,h()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return F(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=bd(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){if(Be(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&My(`Error while retrieving App Check token: ${e.error}`),e?.token}}function ci(n){return Ee(n)}class Ul{constructor(e){this.auth=e,this.observer=null,this.addObserver=tp(t=>this.observer=t)}get next(){return F(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let ma={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function oE(n){ma=n}function aE(n){return ma.loadJS(n)}function cE(){return ma.gapiScript}function lE(n){return`__${n}${Math.floor(Math.random()*1e6)}`}function uE(n,e){const t=Po(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),o=t.getOptions();if(tn(o,e??{}))return s;tt(s,"already-initialized")}return t.initialize({options:e})}function hE(n,e){const t=e?.persistence||[],r=(Array.isArray(t)?t:[t]).map(st);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e?.popupRedirectResolver)}function dE(n,e,t){const r=ci(n);F(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!1,o=Pd(e),{host:a,port:l}=fE(e),h=l===null?"":`:${l}`,d={url:`${o}//${a}${h}/`},p=Object.freeze({host:a,port:l,protocol:o.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!r._canInitEmulator){F(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),F(tn(d,r.config.emulator)&&tn(p,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=d,r.emulatorConfig=p,r.settings.appVerificationDisabledForTesting=!0,Fn(a)?(wu(`${o}//${a}${h}`),Au("Auth",!0)):pE()}function Pd(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function fE(n){const e=Pd(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const o=s[1];return{host:o,port:Bl(r.substr(o.length+1))}}else{const[o,a]=r.split(":");return{host:o,port:Bl(a)}}}function Bl(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function pE(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}class kd{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return rt("not implemented")}_getIdTokenResponse(e){return rt("not implemented")}_linkToIdToken(e,t){return rt("not implemented")}_getReauthenticationResolver(e){return rt("not implemented")}}async function bn(n,e){return qy(n,"POST","/v1/accounts:signInWithIdp",fa(n,e))}const gE="http://localhost";class an extends kd{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new an(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):tt("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,...o}=t;if(!r||!s)return null;const a=new an(r,s);return a.idToken=o.idToken||void 0,a.accessToken=o.accessToken||void 0,a.secret=o.secret,a.nonce=o.nonce,a.pendingToken=o.pendingToken||null,a}_getIdTokenResponse(e){const t=this.buildRequest();return bn(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,bn(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,bn(e,t)}buildRequest(){const e={requestUri:gE,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Mr(t)}return e}}class _a{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class qr extends _a{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class wt extends qr{constructor(){super("facebook.com")}static credential(e){return an._fromParams({providerId:wt.PROVIDER_ID,signInMethod:wt.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return wt.credentialFromTaggedObject(e)}static credentialFromError(e){return wt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return wt.credential(e.oauthAccessToken)}catch{return null}}}wt.FACEBOOK_SIGN_IN_METHOD="facebook.com";wt.PROVIDER_ID="facebook.com";class nt extends qr{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return an._fromParams({providerId:nt.PROVIDER_ID,signInMethod:nt.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return nt.credentialFromTaggedObject(e)}static credentialFromError(e){return nt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return nt.credential(t,r)}catch{return null}}}nt.GOOGLE_SIGN_IN_METHOD="google.com";nt.PROVIDER_ID="google.com";class At extends qr{constructor(){super("github.com")}static credential(e){return an._fromParams({providerId:At.PROVIDER_ID,signInMethod:At.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return At.credentialFromTaggedObject(e)}static credentialFromError(e){return At.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return At.credential(e.oauthAccessToken)}catch{return null}}}At.GITHUB_SIGN_IN_METHOD="github.com";At.PROVIDER_ID="github.com";class Rt extends qr{constructor(){super("twitter.com")}static credential(e,t){return an._fromParams({providerId:Rt.PROVIDER_ID,signInMethod:Rt.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Rt.credentialFromTaggedObject(e)}static credentialFromError(e){return Rt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return Rt.credential(t,r)}catch{return null}}}Rt.TWITTER_SIGN_IN_METHOD="twitter.com";Rt.PROVIDER_ID="twitter.com";class Ln{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,s=!1){const o=await je._fromIdTokenResponse(e,r,s),a=jl(r);return new Ln({user:o,providerId:a,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const s=jl(r);return new Ln({user:e,providerId:s,_tokenResponse:r,operationType:t})}}function jl(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}class js extends dt{constructor(e,t,r,s){super(t.code,t.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,js.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,s){return new js(e,t,r,s)}}function Nd(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(o=>{throw o.code==="auth/multi-factor-auth-required"?js._fromErrorAndOperation(n,o,e,r):o})}async function mE(n,e,t=!1){const r=await Nr(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return Ln._forOperation(n,"link",r)}async function _E(n,e,t=!1){const{auth:r}=n;if(Be(r.app))return Promise.reject(en(r));const s="reauthenticate";try{const o=await Nr(n,Nd(r,s,e,n),t);F(o.idToken,r,"internal-error");const a=pa(o.idToken);F(a,r,"internal-error");const{sub:l}=a;return F(n.uid===l,r,"user-mismatch"),Ln._forOperation(n,s,o)}catch(o){throw o?.code==="auth/user-not-found"&&tt(r,"user-mismatch"),o}}async function yE(n,e,t=!1){if(Be(n.app))return Promise.reject(en(n));const r="signIn",s=await Nd(n,r,e),o=await Ln._fromIdTokenResponse(n,r,s);return t||await n._updateCurrentUser(o.user),o}function EE(n,e,t,r){return Ee(n).onIdTokenChanged(e,t,r)}function IE(n,e,t){return Ee(n).beforeAuthStateChanged(e,t)}function vE(n,e,t,r){return Ee(n).onAuthStateChanged(e,t,r)}function TE(n){return Ee(n).signOut()}const $s="__sak";class Dd{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem($s,"1"),this.storage.removeItem($s),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}const wE=1e3,AE=10;class Vd extends Dd{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Cd(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),s=this.localCache[t];r!==s&&e(t,s,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((a,l,h)=>{this.notifyListeners(a,h)});return}const r=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const a=this.storage.getItem(r);!t&&this.localCache[r]===a||this.notifyListeners(r,a)},o=this.storage.getItem(r);eE()&&o!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,AE):s()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},wE)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}Vd.type="LOCAL";const RE=Vd;class Od extends Dd{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}Od.type="SESSION";const Md=Od;function SE(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}class li{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const r=new li(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:s,data:o}=t.data,a=this.handlersMap[s];if(!a?.size)return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const l=Array.from(a).map(async d=>d(t.origin,o)),h=await SE(l);t.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:h})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}li.receivers=[];function ya(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}class CE{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let o,a;return new Promise((l,h)=>{const d=ya("",20);s.port1.start();const p=setTimeout(()=>{h(new Error("unsupported_event"))},r);a={messageChannel:s,onMessage(_){const E=_;if(E.data.eventId===d)switch(E.data.status){case"ack":clearTimeout(p),o=setTimeout(()=>{h(new Error("timeout"))},3e3);break;case"done":clearTimeout(o),l(E.data.response);break;default:clearTimeout(p),clearTimeout(o),h(new Error("invalid_response"));break}}},this.handlers.add(a),s.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:e,eventId:d,data:t},[s.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})}}function Xe(){return window}function bE(n){Xe().location.href=n}function Ld(){return typeof Xe().WorkerGlobalScope<"u"&&typeof Xe().importScripts=="function"}async function PE(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function kE(){return navigator?.serviceWorker?.controller||null}function NE(){return Ld()?self:null}const xd="firebaseLocalStorageDb",DE=1,qs="firebaseLocalStorage",Fd="fbase_key";class Hr{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function ui(n,e){return n.transaction([qs],e?"readwrite":"readonly").objectStore(qs)}function VE(){const n=indexedDB.deleteDatabase(xd);return new Hr(n).toPromise()}function wo(){const n=indexedDB.open(xd,DE);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(qs,{keyPath:Fd})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(qs)?e(r):(r.close(),await VE(),e(await wo()))})})}async function $l(n,e,t){const r=ui(n,!0).put({[Fd]:e,value:t});return new Hr(r).toPromise()}async function OE(n,e){const t=ui(n,!1).get(e),r=await new Hr(t).toPromise();return r===void 0?null:r.value}function ql(n,e){const t=ui(n,!0).delete(e);return new Hr(t).toPromise()}const ME=800,LE=3;class Ud{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await wo(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>LE)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Ld()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=li._getInstance(NE()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await PE(),!this.activeServiceWorker)return;this.sender=new CE(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||kE()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await wo();return await $l(e,$s,"1"),await ql(e,$s),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>$l(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>OE(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>ql(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const o=ui(s,!1).getAll();return new Hr(o).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:o}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(o)&&(this.notifyListeners(s,o),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),ME)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}Ud.type="LOCAL";const xE=Ud;new $r(3e4,6e4);function Bd(n,e){return e?st(e):(F(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}class Ea extends kd{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return bn(e,this._buildIdpRequest())}_linkToIdToken(e,t){return bn(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return bn(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function FE(n){return yE(n.auth,new Ea(n),n.bypassAuthState)}function UE(n){const{auth:e,user:t}=n;return F(t,e,"internal-error"),_E(t,new Ea(n),n.bypassAuthState)}async function BE(n){const{auth:e,user:t}=n;return F(t,e,"internal-error"),mE(t,new Ea(n),n.bypassAuthState)}class jd{constructor(e,t,r,s,o=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=o,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:s,tenantId:o,error:a,type:l}=e;if(a){this.reject(a);return}const h={auth:this.auth,requestUri:t,sessionId:r,tenantId:o||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(l)(h))}catch(d){this.reject(d)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return FE;case"linkViaPopup":case"linkViaRedirect":return BE;case"reauthViaPopup":case"reauthViaRedirect":return UE;default:tt(this.auth,"internal-error")}}resolve(e){ut(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){ut(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const jE=new $r(2e3,1e4);async function $E(n,e,t){if(Be(n.app))return Promise.reject(qe(n,"operation-not-supported-in-this-environment"));const r=ci(n);Ly(n,e,_a);const s=Bd(r,t);return new Xt(r,"signInViaPopup",e,s).executeNotNull()}class Xt extends jd{constructor(e,t,r,s,o){super(e,t,s,o),this.provider=r,this.authWindow=null,this.pollId=null,Xt.currentPopupAction&&Xt.currentPopupAction.cancel(),Xt.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return F(e,this.auth,"internal-error"),e}async onExecution(){ut(this.filter.length===1,"Popup operations only handle one event");const e=ya();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(qe(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(qe(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Xt.currentPopupAction=null}pollUserCancellation(){const e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(qe(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,jE.get())};e()}}Xt.currentPopupAction=null;const qE="pendingRedirect",Ts=new Map;class HE extends jd{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=Ts.get(this.auth._key());if(!e){try{const r=await GE(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}Ts.set(this.auth._key(),e)}return this.bypassAuthState||Ts.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function GE(n,e){const t=KE(e),r=zE(n);if(!await r._isAvailable())return!1;const s=await r._get(t)==="true";return await r._remove(t),s}function WE(n,e){Ts.set(n._key(),e)}function zE(n){return st(n._redirectPersistence)}function KE(n){return vs(qE,n.config.apiKey,n.name)}async function QE(n,e,t=!1){if(Be(n.app))return Promise.reject(en(n));const r=ci(n),s=Bd(r,e),a=await new HE(r,s,t).execute();return a&&!t&&(delete a.user._redirectEventId,await r._persistUserIfCurrent(a.user),await r._setRedirectUser(null,e)),a}const YE=600*1e3;class JE{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!XE(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!$d(e)){const r=e.error.code?.split("auth/")[1]||"internal-error";t.onError(qe(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=YE&&this.cachedEventUids.clear(),this.cachedEventUids.has(Hl(e))}saveEventToCache(e){this.cachedEventUids.add(Hl(e)),this.lastProcessedEventTime=Date.now()}}function Hl(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function $d({type:n,error:e}){return n==="unknown"&&e?.code==="auth/no-auth-event"}function XE(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return $d(n);default:return!1}}async function ZE(n,e={}){return Gn(n,"GET","/v1/projects",e)}const eI=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,tI=/^https?/;async function nI(n){if(n.config.emulator)return;const{authorizedDomains:e}=await ZE(n);for(const t of e)try{if(rI(t))return}catch{}tt(n,"unauthorized-domain")}function rI(n){const e=vo(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const a=new URL(n);return a.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&a.hostname===r}if(!tI.test(t))return!1;if(eI.test(n))return r===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}const sI=new $r(3e4,6e4);function Gl(){const n=Xe().___jsl;if(n?.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function iI(n){return new Promise((e,t)=>{function r(){Gl(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Gl(),t(qe(n,"network-request-failed"))},timeout:sI.get()})}if(Xe().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if(Xe().gapi?.load)r();else{const s=lE("iframefcb");return Xe()[s]=()=>{gapi.load?r():t(qe(n,"network-request-failed"))},aE(`${cE()}?onload=${s}`).catch(o=>t(o))}}).catch(e=>{throw ws=null,e})}let ws=null;function oI(n){return ws=ws||iI(n),ws}const aI=new $r(5e3,15e3),cI="__/auth/iframe",lI="emulator/auth/iframe",uI={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},hI=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function dI(n){const e=n.config;F(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?da(e,lI):`https://${n.config.authDomain}/${cI}`,r={apiKey:e.apiKey,appName:n.name,v:Un},s=hI.get(n.config.apiHost);s&&(r.eid=s);const o=n._getFrameworks();return o.length&&(r.fw=o.join(",")),`${t}?${Mr(r).slice(1)}`}async function fI(n){const e=await oI(n),t=Xe().gapi;return F(t,n,"internal-error"),e.open({where:document.body,url:dI(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:uI,dontclear:!0},r=>new Promise(async(s,o)=>{await r.restyle({setHideOnLeave:!1});const a=qe(n,"network-request-failed"),l=Xe().setTimeout(()=>{o(a)},aI.get());function h(){Xe().clearTimeout(l),s(r)}r.ping(h).then(h,()=>{o(a)})}))}const pI={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},gI=500,mI=600,_I="_blank",yI="http://localhost";class Wl{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function EI(n,e,t,r=gI,s=mI){const o=Math.max((window.screen.availHeight-s)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString();let l="";const h={...pI,width:r.toString(),height:s.toString(),top:o,left:a},d=Se().toLowerCase();t&&(l=Td(d)?_I:t),Id(d)&&(e=e||yI,h.scrollbars="yes");const p=Object.entries(h).reduce((E,[C,k])=>`${E}${C}=${k},`,"");if(Zy(d)&&l!=="_self")return II(e||"",l),new Wl(null);const _=window.open(e||"",l,p);F(_,n,"popup-blocked");try{_.focus()}catch{}return new Wl(_)}function II(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}const vI="__/auth/handler",TI="emulator/auth/handler",wI=encodeURIComponent("fac");async function zl(n,e,t,r,s,o){F(n.config.authDomain,n,"auth-domain-config-required"),F(n.config.apiKey,n,"invalid-api-key");const a={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:Un,eventId:s};if(e instanceof _a){e.setDefaultLanguage(n.languageCode),a.providerId=e.providerId||"",ep(e.getCustomParameters())||(a.customParameters=JSON.stringify(e.getCustomParameters()));for(const[p,_]of Object.entries({}))a[p]=_}if(e instanceof qr){const p=e.getScopes().filter(_=>_!=="");p.length>0&&(a.scopes=p.join(","))}n.tenantId&&(a.tid=n.tenantId);const l=a;for(const p of Object.keys(l))l[p]===void 0&&delete l[p];const h=await n._getAppCheckToken(),d=h?`#${wI}=${encodeURIComponent(h)}`:"";return`${AI(n)}?${Mr(l).slice(1)}${d}`}function AI({config:n}){return n.emulator?da(n,TI):`https://${n.authDomain}/${vI}`}const Ji="webStorageSupport";class RI{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Md,this._completeRedirectFn=QE,this._overrideRedirectResult=WE}async _openPopup(e,t,r,s){ut(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");const o=await zl(e,t,r,vo(),s);return EI(e,o,ya())}async _openRedirect(e,t,r,s){await this._originValidation(e);const o=await zl(e,t,r,vo(),s);return bE(o),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:o}=this.eventManagers[t];return s?Promise.resolve(s):(ut(o,"If manager is not set, promise should be"),o)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await fI(e),r=new JE(e);return t.register("authEvent",s=>(F(s?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Ji,{type:Ji},s=>{const o=s?.[0]?.[Ji];o!==void 0&&t(!!o),tt(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=nI(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Cd()||vd()||ga()}}const SI=RI;var Kl="@firebase/auth",Ql="1.12.0";class CI{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){F(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function bI(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function PI(n){Pn(new nn("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),o=e.getProvider("app-check-internal"),{apiKey:a,authDomain:l}=r.options;F(a&&!a.includes(":"),"invalid-api-key",{appName:r.name});const h={apiKey:a,authDomain:l,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:bd(n)},d=new iE(r,s,o,h);return hE(d,t),d},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),Pn(new nn("auth-internal",e=>{const t=ci(e.getProvider("auth").getImmediate());return(r=>new CI(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Dt(Kl,Ql,bI(n)),Dt(Kl,Ql,"esm2020")}const kI=300,NI=Tu("authIdTokenMaxAge")||kI;let Yl=null;const DI=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>NI)return;const s=t?.token;Yl!==s&&(Yl=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function VI(n=bu()){const e=Po(n,"auth");if(e.isInitialized())return e.getImmediate();const t=uE(n,{popupRedirectResolver:SI,persistence:[xE,RE,Md]}),r=Tu("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const o=new URL(r,location.origin);if(location.origin===o.origin){const a=DI(o.toString());IE(t,a,()=>a(t.currentUser)),EE(t,l=>a(l))}}const s=Iu("auth");return s&&dE(t,`http://${s}`),t}function OI(){return document.getElementsByTagName("head")?.[0]??document}oE({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=s=>{const o=qe("internal-error");o.customData=s,t(o)},r.type="text/javascript",r.charset="UTF-8",OI().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});PI("Browser");const MI={apiKey:"AIzaSyDYJnmOizWwLmdCxUAiEf9cwqCLL6NXvHs".trim(),authDomain:"aifoodjournal.firebaseapp.com".trim(),projectId:"aifoodjournal".trim(),storageBucket:"aifoodjournal.firebasestorage.app".trim(),messagingSenderId:"203981513764".trim(),appId:"1:203981513764:web:a7731a9de17a4c0c08e4b1".trim()},qd=Cu(MI),Pe=yy(qd),fe=VI(qd),ke={SETTINGS:"settings",MEALS:"meals",SHOPPING:"shopping",WATER:"water",FAVORITES:"favorites",CHECKINS:"checkins"},ue={getSettings:async()=>{const n=fe.currentUser;if(!n)return{};const e=await Ny(vt(Pe,ke.SETTINGS,n.uid));return e.exists()?e.data():{}},saveSettings:async n=>{const e=fe.currentUser;e&&await Vl(vt(Pe,ke.SETTINGS,e.uid),n)},getMeals:async n=>{const e=fe.currentUser;if(!e)return[];const t=lr(Et(Pe,ke.MEALS),mn("userId","==",e.uid),zi("timestamp","desc")),s=(await ur(t)).docs.map(o=>({...o.data(),id:o.id}));return n?s.filter(o=>o.timestamp.startsWith(n)):s},addMeal:async n=>{const e=fe.currentUser;if(e)return await Qi(Et(Pe,ke.MEALS),{...n,userId:e.uid})},updateMeal:async(n,e)=>{fe.currentUser&&await Dy(vt(Pe,ke.MEALS,n),e)},deleteMeal:async n=>{fe.currentUser&&await Ki(vt(Pe,ke.MEALS,n))},getFavorites:async()=>{const n=fe.currentUser;if(!n)return[];const e=lr(Et(Pe,ke.FAVORITES),mn("userId","==",n.uid));return(await ur(e)).docs.map(r=>({...r.data(),id:r.id}))},addFavorite:async n=>{const e=fe.currentUser;e&&await Qi(Et(Pe,ke.FAVORITES),{...n,userId:e.uid,createdAt:new Date().toISOString()})},deleteFavorite:async n=>{fe.currentUser&&await Ki(vt(Pe,ke.FAVORITES,n))},getWater:async n=>{const e=fe.currentUser;if(!e)return 0;const t=lr(Et(Pe,ke.WATER),mn("userId","==",e.uid),mn("date","==",n)),r=await ur(t);return r.empty?0:r.docs[0].data().amount||0},setWater:async(n,e)=>{const t=fe.currentUser;if(!t)return;const r=`${t.uid}_${n}`;await Vl(vt(Pe,ke.WATER,r),{userId:t.uid,date:n,amount:e,timestamp:new Date().toISOString()})},getCheckins:async()=>{const n=fe.currentUser;if(!n)return[];const e=lr(Et(Pe,ke.CHECKINS),mn("userId","==",n.uid),zi("timestamp","desc"));return(await ur(e)).docs.map(r=>({...r.data(),id:r.id}))},addCheckin:async n=>{const e=fe.currentUser;e&&await Qi(Et(Pe,ke.CHECKINS),{...n,userId:e.uid,timestamp:n.timestamp||new Date().toISOString()})},deleteCheckin:async n=>{fe.currentUser&&await Ki(vt(Pe,ke.CHECKINS,n))},getShoppingList:async()=>{const n=fe.currentUser;if(!n)return[];const e=lr(Et(Pe,ke.SHOPPING),mn("userId","==",n.uid),zi("timestamp","desc"));return(await ur(e)).docs.map(r=>({...r.data(),id:r.id}))}};var Jl;(function(n){n.STRING="string",n.NUMBER="number",n.INTEGER="integer",n.BOOLEAN="boolean",n.ARRAY="array",n.OBJECT="object"})(Jl||(Jl={}));var Xl;(function(n){n.LANGUAGE_UNSPECIFIED="language_unspecified",n.PYTHON="python"})(Xl||(Xl={}));var Zl;(function(n){n.OUTCOME_UNSPECIFIED="outcome_unspecified",n.OUTCOME_OK="outcome_ok",n.OUTCOME_FAILED="outcome_failed",n.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded"})(Zl||(Zl={}));const eu=["user","model","function","system"];var tu;(function(n){n.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",n.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",n.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",n.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",n.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",n.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY"})(tu||(tu={}));var nu;(function(n){n.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",n.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",n.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",n.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",n.BLOCK_NONE="BLOCK_NONE"})(nu||(nu={}));var ru;(function(n){n.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",n.NEGLIGIBLE="NEGLIGIBLE",n.LOW="LOW",n.MEDIUM="MEDIUM",n.HIGH="HIGH"})(ru||(ru={}));var su;(function(n){n.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",n.SAFETY="SAFETY",n.OTHER="OTHER"})(su||(su={}));var Tr;(function(n){n.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",n.STOP="STOP",n.MAX_TOKENS="MAX_TOKENS",n.SAFETY="SAFETY",n.RECITATION="RECITATION",n.LANGUAGE="LANGUAGE",n.BLOCKLIST="BLOCKLIST",n.PROHIBITED_CONTENT="PROHIBITED_CONTENT",n.SPII="SPII",n.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",n.OTHER="OTHER"})(Tr||(Tr={}));var iu;(function(n){n.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",n.RETRIEVAL_QUERY="RETRIEVAL_QUERY",n.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",n.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",n.CLASSIFICATION="CLASSIFICATION",n.CLUSTERING="CLUSTERING"})(iu||(iu={}));var ou;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.AUTO="AUTO",n.ANY="ANY",n.NONE="NONE"})(ou||(ou={}));var au;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.MODE_DYNAMIC="MODE_DYNAMIC"})(au||(au={}));class Re extends Error{constructor(e){super(`[GoogleGenerativeAI Error]: ${e}`)}}class _n extends Re{constructor(e,t){super(e),this.response=t}}class Hd extends Re{constructor(e,t,r,s){super(e),this.status=t,this.statusText=r,this.errorDetails=s}}class Mt extends Re{}class Gd extends Re{}const LI="https://generativelanguage.googleapis.com",xI="v1beta",FI="0.24.1",UI="genai-js";var cn;(function(n){n.GENERATE_CONTENT="generateContent",n.STREAM_GENERATE_CONTENT="streamGenerateContent",n.COUNT_TOKENS="countTokens",n.EMBED_CONTENT="embedContent",n.BATCH_EMBED_CONTENTS="batchEmbedContents"})(cn||(cn={}));class BI{constructor(e,t,r,s,o){this.model=e,this.task=t,this.apiKey=r,this.stream=s,this.requestOptions=o}toString(){var e,t;const r=((e=this.requestOptions)===null||e===void 0?void 0:e.apiVersion)||xI;let o=`${((t=this.requestOptions)===null||t===void 0?void 0:t.baseUrl)||LI}/${r}/${this.model}:${this.task}`;return this.stream&&(o+="?alt=sse"),o}}function jI(n){const e=[];return n?.apiClient&&e.push(n.apiClient),e.push(`${UI}/${FI}`),e.join(" ")}async function $I(n){var e;const t=new Headers;t.append("Content-Type","application/json"),t.append("x-goog-api-client",jI(n.requestOptions)),t.append("x-goog-api-key",n.apiKey);let r=(e=n.requestOptions)===null||e===void 0?void 0:e.customHeaders;if(r){if(!(r instanceof Headers))try{r=new Headers(r)}catch(s){throw new Mt(`unable to convert customHeaders value ${JSON.stringify(r)} to Headers: ${s.message}`)}for(const[s,o]of r.entries()){if(s==="x-goog-api-key")throw new Mt(`Cannot set reserved header name ${s}`);if(s==="x-goog-api-client")throw new Mt(`Header name ${s} can only be set using the apiClient field`);t.append(s,o)}}return t}async function qI(n,e,t,r,s,o){const a=new BI(n,e,t,r,o);return{url:a.toString(),fetchOptions:Object.assign(Object.assign({},zI(o)),{method:"POST",headers:await $I(a),body:s})}}async function Gr(n,e,t,r,s,o={},a=fetch){const{url:l,fetchOptions:h}=await qI(n,e,t,r,s,o);return HI(l,h,a)}async function HI(n,e,t=fetch){let r;try{r=await t(n,e)}catch(s){GI(s,n)}return r.ok||await WI(r,n),r}function GI(n,e){let t=n;throw t.name==="AbortError"?(t=new Gd(`Request aborted when fetching ${e.toString()}: ${n.message}`),t.stack=n.stack):n instanceof Hd||n instanceof Mt||(t=new Re(`Error fetching from ${e.toString()}: ${n.message}`),t.stack=n.stack),t}async function WI(n,e){let t="",r;try{const s=await n.json();t=s.error.message,s.error.details&&(t+=` ${JSON.stringify(s.error.details)}`,r=s.error.details)}catch{}throw new Hd(`Error fetching from ${e.toString()}: [${n.status} ${n.statusText}] ${t}`,n.status,n.statusText,r)}function zI(n){const e={};if(n?.signal!==void 0||n?.timeout>=0){const t=new AbortController;n?.timeout>=0&&setTimeout(()=>t.abort(),n.timeout),n?.signal&&n.signal.addEventListener("abort",()=>{t.abort()}),e.signal=t.signal}return e}function Ia(n){return n.text=()=>{if(n.candidates&&n.candidates.length>0){if(n.candidates.length>1&&console.warn(`This response had ${n.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),As(n.candidates[0]))throw new _n(`${Tt(n)}`,n);return KI(n)}else if(n.promptFeedback)throw new _n(`Text not available. ${Tt(n)}`,n);return""},n.functionCall=()=>{if(n.candidates&&n.candidates.length>0){if(n.candidates.length>1&&console.warn(`This response had ${n.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),As(n.candidates[0]))throw new _n(`${Tt(n)}`,n);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),cu(n)[0]}else if(n.promptFeedback)throw new _n(`Function call not available. ${Tt(n)}`,n)},n.functionCalls=()=>{if(n.candidates&&n.candidates.length>0){if(n.candidates.length>1&&console.warn(`This response had ${n.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),As(n.candidates[0]))throw new _n(`${Tt(n)}`,n);return cu(n)}else if(n.promptFeedback)throw new _n(`Function call not available. ${Tt(n)}`,n)},n}function KI(n){var e,t,r,s;const o=[];if(!((t=(e=n.candidates)===null||e===void 0?void 0:e[0].content)===null||t===void 0)&&t.parts)for(const a of(s=(r=n.candidates)===null||r===void 0?void 0:r[0].content)===null||s===void 0?void 0:s.parts)a.text&&o.push(a.text),a.executableCode&&o.push("\n```"+a.executableCode.language+`
`+a.executableCode.code+"\n```\n"),a.codeExecutionResult&&o.push("\n```\n"+a.codeExecutionResult.output+"\n```\n");return o.length>0?o.join(""):""}function cu(n){var e,t,r,s;const o=[];if(!((t=(e=n.candidates)===null||e===void 0?void 0:e[0].content)===null||t===void 0)&&t.parts)for(const a of(s=(r=n.candidates)===null||r===void 0?void 0:r[0].content)===null||s===void 0?void 0:s.parts)a.functionCall&&o.push(a.functionCall);if(o.length>0)return o}const QI=[Tr.RECITATION,Tr.SAFETY,Tr.LANGUAGE];function As(n){return!!n.finishReason&&QI.includes(n.finishReason)}function Tt(n){var e,t,r;let s="";if((!n.candidates||n.candidates.length===0)&&n.promptFeedback)s+="Response was blocked",!((e=n.promptFeedback)===null||e===void 0)&&e.blockReason&&(s+=` due to ${n.promptFeedback.blockReason}`),!((t=n.promptFeedback)===null||t===void 0)&&t.blockReasonMessage&&(s+=`: ${n.promptFeedback.blockReasonMessage}`);else if(!((r=n.candidates)===null||r===void 0)&&r[0]){const o=n.candidates[0];As(o)&&(s+=`Candidate was blocked due to ${o.finishReason}`,o.finishMessage&&(s+=`: ${o.finishMessage}`))}return s}function Dr(n){return this instanceof Dr?(this.v=n,this):new Dr(n)}function YI(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(n,e||[]),s,o=[];return s={},a("next"),a("throw"),a("return"),s[Symbol.asyncIterator]=function(){return this},s;function a(E){r[E]&&(s[E]=function(C){return new Promise(function(k,O){o.push([E,C,k,O])>1||l(E,C)})})}function l(E,C){try{h(r[E](C))}catch(k){_(o[0][3],k)}}function h(E){E.value instanceof Dr?Promise.resolve(E.value.v).then(d,p):_(o[0][2],E)}function d(E){l("next",E)}function p(E){l("throw",E)}function _(E,C){E(C),o.shift(),o.length&&l(o[0][0],o[0][1])}}const lu=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;function JI(n){const e=n.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})),t=ev(e),[r,s]=t.tee();return{stream:ZI(r),response:XI(s)}}async function XI(n){const e=[],t=n.getReader();for(;;){const{done:r,value:s}=await t.read();if(r)return Ia(tv(e));e.push(s)}}function ZI(n){return YI(this,arguments,function*(){const t=n.getReader();for(;;){const{value:r,done:s}=yield Dr(t.read());if(s)break;yield yield Dr(Ia(r))}})}function ev(n){const e=n.getReader();return new ReadableStream({start(r){let s="";return o();function o(){return e.read().then(({value:a,done:l})=>{if(l){if(s.trim()){r.error(new Re("Failed to parse stream"));return}r.close();return}s+=a;let h=s.match(lu),d;for(;h;){try{d=JSON.parse(h[1])}catch{r.error(new Re(`Error parsing JSON response: "${h[1]}"`));return}r.enqueue(d),s=s.substring(h[0].length),h=s.match(lu)}return o()}).catch(a=>{let l=a;throw l.stack=a.stack,l.name==="AbortError"?l=new Gd("Request aborted when reading from the stream"):l=new Re("Error reading from the stream"),l})}}})}function tv(n){const e=n[n.length-1],t={promptFeedback:e?.promptFeedback};for(const r of n){if(r.candidates){let s=0;for(const o of r.candidates)if(t.candidates||(t.candidates=[]),t.candidates[s]||(t.candidates[s]={index:s}),t.candidates[s].citationMetadata=o.citationMetadata,t.candidates[s].groundingMetadata=o.groundingMetadata,t.candidates[s].finishReason=o.finishReason,t.candidates[s].finishMessage=o.finishMessage,t.candidates[s].safetyRatings=o.safetyRatings,o.content&&o.content.parts){t.candidates[s].content||(t.candidates[s].content={role:o.content.role||"user",parts:[]});const a={};for(const l of o.content.parts)l.text&&(a.text=l.text),l.functionCall&&(a.functionCall=l.functionCall),l.executableCode&&(a.executableCode=l.executableCode),l.codeExecutionResult&&(a.codeExecutionResult=l.codeExecutionResult),Object.keys(a).length===0&&(a.text=""),t.candidates[s].content.parts.push(a)}s++}r.usageMetadata&&(t.usageMetadata=r.usageMetadata)}return t}async function Wd(n,e,t,r){const s=await Gr(e,cn.STREAM_GENERATE_CONTENT,n,!0,JSON.stringify(t),r);return JI(s)}async function zd(n,e,t,r){const o=await(await Gr(e,cn.GENERATE_CONTENT,n,!1,JSON.stringify(t),r)).json();return{response:Ia(o)}}function Kd(n){if(n!=null){if(typeof n=="string")return{role:"system",parts:[{text:n}]};if(n.text)return{role:"system",parts:[n]};if(n.parts)return n.role?n:{role:"system",parts:n.parts}}}function Vr(n){let e=[];if(typeof n=="string")e=[{text:n}];else for(const t of n)typeof t=="string"?e.push({text:t}):e.push(t);return nv(e)}function nv(n){const e={role:"user",parts:[]},t={role:"function",parts:[]};let r=!1,s=!1;for(const o of n)"functionResponse"in o?(t.parts.push(o),s=!0):(e.parts.push(o),r=!0);if(r&&s)throw new Re("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!r&&!s)throw new Re("No content is provided for sending chat message.");return r?e:t}function rv(n,e){var t;let r={model:e?.model,generationConfig:e?.generationConfig,safetySettings:e?.safetySettings,tools:e?.tools,toolConfig:e?.toolConfig,systemInstruction:e?.systemInstruction,cachedContent:(t=e?.cachedContent)===null||t===void 0?void 0:t.name,contents:[]};const s=n.generateContentRequest!=null;if(n.contents){if(s)throw new Mt("CountTokensRequest must have one of contents or generateContentRequest, not both.");r.contents=n.contents}else if(s)r=Object.assign(Object.assign({},r),n.generateContentRequest);else{const o=Vr(n);r.contents=[o]}return{generateContentRequest:r}}function uu(n){let e;return n.contents?e=n:e={contents:[Vr(n)]},n.systemInstruction&&(e.systemInstruction=Kd(n.systemInstruction)),e}function sv(n){return typeof n=="string"||Array.isArray(n)?{content:Vr(n)}:n}const hu=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],iv={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function ov(n){let e=!1;for(const t of n){const{role:r,parts:s}=t;if(!e&&r!=="user")throw new Re(`First content should be with role 'user', got ${r}`);if(!eu.includes(r))throw new Re(`Each item should include role field. Got ${r} but valid roles are: ${JSON.stringify(eu)}`);if(!Array.isArray(s))throw new Re("Content should have 'parts' property with an array of Parts");if(s.length===0)throw new Re("Each Content should have at least one part");const o={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(const l of s)for(const h of hu)h in l&&(o[h]+=1);const a=iv[r];for(const l of hu)if(!a.includes(l)&&o[l]>0)throw new Re(`Content with role '${r}' can't contain '${l}' part`);e=!0}}function du(n){var e;if(n.candidates===void 0||n.candidates.length===0)return!1;const t=(e=n.candidates[0])===null||e===void 0?void 0:e.content;if(t===void 0||t.parts===void 0||t.parts.length===0)return!1;for(const r of t.parts)if(r===void 0||Object.keys(r).length===0||r.text!==void 0&&r.text==="")return!1;return!0}const fu="SILENT_ERROR";class av{constructor(e,t,r,s={}){this.model=t,this.params=r,this._requestOptions=s,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=e,r?.history&&(ov(r.history),this._history=r.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(e,t={}){var r,s,o,a,l,h;await this._sendPromise;const d=Vr(e),p={safetySettings:(r=this.params)===null||r===void 0?void 0:r.safetySettings,generationConfig:(s=this.params)===null||s===void 0?void 0:s.generationConfig,tools:(o=this.params)===null||o===void 0?void 0:o.tools,toolConfig:(a=this.params)===null||a===void 0?void 0:a.toolConfig,systemInstruction:(l=this.params)===null||l===void 0?void 0:l.systemInstruction,cachedContent:(h=this.params)===null||h===void 0?void 0:h.cachedContent,contents:[...this._history,d]},_=Object.assign(Object.assign({},this._requestOptions),t);let E;return this._sendPromise=this._sendPromise.then(()=>zd(this._apiKey,this.model,p,_)).then(C=>{var k;if(du(C.response)){this._history.push(d);const O=Object.assign({parts:[],role:"model"},(k=C.response.candidates)===null||k===void 0?void 0:k[0].content);this._history.push(O)}else{const O=Tt(C.response);O&&console.warn(`sendMessage() was unsuccessful. ${O}. Inspect response object for details.`)}E=C}).catch(C=>{throw this._sendPromise=Promise.resolve(),C}),await this._sendPromise,E}async sendMessageStream(e,t={}){var r,s,o,a,l,h;await this._sendPromise;const d=Vr(e),p={safetySettings:(r=this.params)===null||r===void 0?void 0:r.safetySettings,generationConfig:(s=this.params)===null||s===void 0?void 0:s.generationConfig,tools:(o=this.params)===null||o===void 0?void 0:o.tools,toolConfig:(a=this.params)===null||a===void 0?void 0:a.toolConfig,systemInstruction:(l=this.params)===null||l===void 0?void 0:l.systemInstruction,cachedContent:(h=this.params)===null||h===void 0?void 0:h.cachedContent,contents:[...this._history,d]},_=Object.assign(Object.assign({},this._requestOptions),t),E=Wd(this._apiKey,this.model,p,_);return this._sendPromise=this._sendPromise.then(()=>E).catch(C=>{throw new Error(fu)}).then(C=>C.response).then(C=>{if(du(C)){this._history.push(d);const k=Object.assign({},C.candidates[0].content);k.role||(k.role="model"),this._history.push(k)}else{const k=Tt(C);k&&console.warn(`sendMessageStream() was unsuccessful. ${k}. Inspect response object for details.`)}}).catch(C=>{C.message!==fu&&console.error(C)}),E}}async function cv(n,e,t,r){return(await Gr(e,cn.COUNT_TOKENS,n,!1,JSON.stringify(t),r)).json()}async function lv(n,e,t,r){return(await Gr(e,cn.EMBED_CONTENT,n,!1,JSON.stringify(t),r)).json()}async function uv(n,e,t,r){const s=t.requests.map(a=>Object.assign(Object.assign({},a),{model:e}));return(await Gr(e,cn.BATCH_EMBED_CONTENTS,n,!1,JSON.stringify({requests:s}),r)).json()}class pu{constructor(e,t,r={}){this.apiKey=e,this._requestOptions=r,t.model.includes("/")?this.model=t.model:this.model=`models/${t.model}`,this.generationConfig=t.generationConfig||{},this.safetySettings=t.safetySettings||[],this.tools=t.tools,this.toolConfig=t.toolConfig,this.systemInstruction=Kd(t.systemInstruction),this.cachedContent=t.cachedContent}async generateContent(e,t={}){var r;const s=uu(e),o=Object.assign(Object.assign({},this._requestOptions),t);return zd(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(r=this.cachedContent)===null||r===void 0?void 0:r.name},s),o)}async generateContentStream(e,t={}){var r;const s=uu(e),o=Object.assign(Object.assign({},this._requestOptions),t);return Wd(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(r=this.cachedContent)===null||r===void 0?void 0:r.name},s),o)}startChat(e){var t;return new av(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(t=this.cachedContent)===null||t===void 0?void 0:t.name},e),this._requestOptions)}async countTokens(e,t={}){const r=rv(e,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),s=Object.assign(Object.assign({},this._requestOptions),t);return cv(this.apiKey,this.model,r,s)}async embedContent(e,t={}){const r=sv(e),s=Object.assign(Object.assign({},this._requestOptions),t);return lv(this.apiKey,this.model,r,s)}async batchEmbedContents(e,t={}){const r=Object.assign(Object.assign({},this._requestOptions),t);return uv(this.apiKey,this.model,e,r)}}class hv{constructor(e){this.apiKey=e}getGenerativeModel(e,t){if(!e.model)throw new Re("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new pu(this.apiKey,e,t)}getGenerativeModelFromCachedContent(e,t,r){if(!e.name)throw new Mt("Cached content must contain a `name` field.");if(!e.model)throw new Mt("Cached content must contain a `model` field.");const s=["model","systemInstruction"];for(const a of s)if(t?.[a]&&e[a]&&t?.[a]!==e[a]){if(a==="model"){const l=t.model.startsWith("models/")?t.model.replace("models/",""):t.model,h=e.model.startsWith("models/")?e.model.replace("models/",""):e.model;if(l===h)continue}throw new Mt(`Different value for "${a}" specified in modelParams (${t[a]}) and cachedContent (${e[a]})`)}const o=Object.assign(Object.assign({},t),{model:e.model,tools:e.tools,toolConfig:e.toolConfig,systemInstruction:e.systemInstruction,cachedContent:e});return new pu(this.apiKey,o,r)}}const dv=n=>new Promise(e=>setTimeout(e,n)),Qd=async(n,e,t)=>{if(!n)return null;const r=new hv(n.trim()),s=["gemini-1.5-flash","gemini-2.0-flash"];for(const o of s)for(let a=0;a<2;a++)try{console.log("Checking "+o);const l=r.getGenerativeModel({model:o,tools:[{googleSearchRetrieval:{}}]}),h="Find EXACT MACROS for: "+e+". Return JSON {name, calories, protein, carbs, fat, category, serving_size}",d=t==="photo"?[{text:h},{inlineData:{data:e,mimeType:"image/jpeg"}}]:h,E=(await l.generateContent(d)).response.text().match(/\{[\s\S]*\}/);if(E)return JSON.parse(E[0])}catch(l){console.warn(l),l.message.includes("429")&&await dv(5e3)}return null};let _e=null,Ze=new Date().toISOString().split("T")[0],K={geminiKey:"",calGoal:2e3,startWeight:180,goalWeight:160},Ao={Breakfast:!0,Lunch:!0,Dinner:!0,Snack:!0},hi=[],xn=[],it="history",Tn=!1,Ct=new Set,ht=[],R={};function fv(){R={authScreen:document.getElementById("auth-screen"),app:document.getElementById("app"),loginBtn:document.getElementById("login-btn"),logoutBtn:document.getElementById("logout-btn"),settingsBtn:document.getElementById("settings-btn"),searchBtn:document.getElementById("search-btn"),navItems:document.querySelectorAll(".nav-item"),views:{journal:document.getElementById("journal-view"),weight:document.getElementById("weight-view"),favorites:document.getElementById("favorites-view"),shopping:document.getElementById("shopping-view")},prevDay:document.getElementById("prev-day"),nextDay:document.getElementById("next-day"),dateDisplay:document.getElementById("current-date-display"),datePickerHidden:document.getElementById("date-picker-hidden"),totalCals:document.getElementById("total-calories"),goalCals:document.getElementById("goal-calories-display"),totalPro:document.getElementById("total-protein"),goalPro:document.getElementById("goal-protein-display"),calBar:document.getElementById("cal-progress-bar"),proBar:document.getElementById("pro-progress-bar"),waterCard:document.getElementById("water-card"),currentWater:document.getElementById("current-water"),goalWater:document.getElementById("goal-water"),waterBar:document.getElementById("water-progress-bar"),waterBtns:document.querySelectorAll(".water-btn"),resetWater:document.getElementById("reset-water"),logBtn:document.getElementById("log-btn"),textLog:document.getElementById("text-log"),voiceBtn:document.getElementById("voice-btn"),photoBtn:document.getElementById("photo-btn"),openFavsLogBtn:document.getElementById("open-favs-log-btn"),favsDropdown:document.getElementById("favs-dropdown"),favsDropdownList:document.getElementById("favs-dropdown-list"),categorizedMeals:document.getElementById("categorized-meals"),favoritesList:document.getElementById("favorites-list"),confirmModal:document.getElementById("confirm-modal"),confirmImgPreview:document.getElementById("confirm-img-preview"),confirmName:document.getElementById("confirm-name"),confirmCalories:document.getElementById("confirm-calories"),confirmProtein:document.getElementById("confirm-protein"),confirmCarbs:document.getElementById("confirm-carbs"),confirmFat:document.getElementById("confirm-fat"),confirmCategory:document.getElementById("confirm-category"),saveConfirm:document.getElementById("save-confirm"),saveAsFavBtn:document.getElementById("save-as-fav-btn"),deleteBtn:document.getElementById("delete-btn"),loadingOverlay:document.getElementById("loading-overlay"),searchModal:document.getElementById("search-modal"),globalSearchInput:document.getElementById("global-search-input"),searchResults:document.getElementById("search-results"),closeSearch:document.getElementById("close-search"),addCheckinBtn:document.getElementById("add-checkin-btn"),checkinHistoryList:document.getElementById("checkin-history"),goalProgress:document.getElementById("goal-progress"),currentWeightDisplay:document.getElementById("current-weight"),goalWeightDisplay:document.getElementById("goal-weight"),logSearchBtn:document.getElementById("log-search-btn"),searchTabHistory:document.getElementById("search-tab-history"),searchTabWeb:document.getElementById("search-tab-web"),triggerAiSearch:document.getElementById("trigger-ai-search"),aiSearchPrompt:document.getElementById("ai-search-prompt"),confirmTitle:document.getElementById("confirm-title")}}function pv(){fv(),gv(),vE(fe,async n=>{n?(R.authScreen&&(R.authScreen.style.display="none"),R.app&&(R.app.style.display="block"),await bt()):(R.authScreen&&(R.authScreen.style.display="flex"),R.app&&(R.app.style.display="none"))})}function gv(){R.loginBtn&&(R.loginBtn.onclick=()=>$E(fe,new nt)),R.logoutBtn&&(R.logoutBtn.onclick=()=>TE(fe)),R.prevDay&&(R.prevDay.onclick=()=>mu(-1)),R.nextDay&&(R.nextDay.onclick=()=>mu(1)),R.dateDisplay&&(R.dateDisplay.onclick=()=>R.datePickerHidden.showPicker()),R.datePickerHidden&&(R.datePickerHidden.onchange=h=>{Ze=h.target.value,va(),Pt()}),R.navItems&&R.navItems.forEach(h=>{h.onclick=d=>{d.preventDefault(),_v(h.getAttribute("data-tab"))}}),R.logBtn&&(R.logBtn.onclick=()=>Ro("text")),R.textLog&&(R.textLog.onkeypress=h=>{h.key==="Enter"&&Ro("text")}),R.voiceBtn&&(R.voiceBtn.onclick=Tv),R.photoBtn&&(R.photoBtn.onclick=()=>document.getElementById("photo-modal").style.display="flex");const n=document.getElementById("close-photo-modal");n&&(n.onclick=()=>document.getElementById("photo-modal").style.display="none");const e=document.getElementById("take-photo-btn"),t=document.getElementById("choose-photo-btn");e&&(e.onclick=()=>{document.getElementById("photo-modal").style.display="none",document.getElementById("camera-input").click()}),t&&(t.onclick=()=>{document.getElementById("photo-modal").style.display="none",document.getElementById("file-input").click()});const r=document.getElementById("cancel-confirm");r&&(r.onclick=()=>R.confirmModal.style.display="none"),R.openFavsLogBtn&&(R.openFavsLogBtn.onclick=h=>{h.stopPropagation();const d=R.favsDropdown;if(!d)return;const p=d.style.display==="block";d.style.display=p?"none":"block",p||Ev()}),document.addEventListener("click",()=>{R.favsDropdown&&(R.favsDropdown.style.display="none")}),R.saveConfirm&&(R.saveConfirm.onclick=async()=>{if(!_e)return;const h=gu();oe(!0),_e.id?await ue.updateMeal(_e.id,h):await ue.addMeal(h),await Pt(),oe(!1),R.confirmModal.style.display="none"}),R.saveAsFavBtn&&(R.saveAsFavBtn.onclick=async()=>{if(!_e)return;const h=prompt("Name favorite:",_e.name);if(!h)return;const d=gu();oe(!0),await ue.addFavorite({...d,name:h}),await bt(),oe(!1)}),R.deleteBtn&&(R.deleteBtn.onclick=async()=>{!_e||!_e.id||confirm("Delete?")&&(oe(!0),await ue.deleteMeal(_e.id),await Pt(),oe(!1),R.confirmModal.style.display="none")}),R.searchBtn&&(R.searchBtn.onclick=()=>{R.searchModal.style.display="flex",it="history",fs(),hr("")}),R.logSearchBtn&&(R.logSearchBtn.onclick=()=>{R.searchModal.style.display="flex",it="history",fs(),hr("")}),R.searchTabHistory&&(R.searchTabHistory.onclick=()=>{it="history",fs(),hr(R.globalSearchInput.value)}),R.searchTabWeb&&(R.searchTabWeb.onclick=()=>{it="web",fs(),hr(R.globalSearchInput.value)}),R.triggerAiSearch&&(R.triggerAiSearch.onclick=()=>mv()),R.closeSearch&&(R.closeSearch.onclick=()=>R.searchModal.style.display="none"),R.globalSearchInput&&(R.globalSearchInput.oninput=h=>hr(h.target.value)),R.settingsBtn&&(R.settingsBtn.onclick=()=>{document.getElementById("settings-modal").style.display="flex",document.getElementById("api-key").value=K.geminiKey,document.getElementById("cal-goal-input").value=K.calGoal,document.getElementById("goal-weight-input").value=K.goalWeight,document.getElementById("start-weight-input").value=K.startWeight});const s=document.getElementById("close-settings");s&&(s.onclick=()=>document.getElementById("settings-modal").style.display="none");const o=document.getElementById("save-settings");o&&(o.onclick=async()=>{K.geminiKey=document.getElementById("api-key").value.trim(),K.calGoal=parseInt(document.getElementById("cal-goal-input").value)||2e3,K.goalWeight=parseFloat(document.getElementById("goal-weight-input").value)||160,K.startWeight=parseFloat(document.getElementById("start-weight-input").value)||180,await ue.saveSettings(K),localStorage.setItem("gemini_key",K.geminiKey),await bt(),document.getElementById("settings-modal").style.display="none"}),R.waterBtns&&R.waterBtns.forEach(h=>{h.onclick=async d=>{d.stopPropagation();const p=parseInt(h.getAttribute("data-amt")),_=Math.max(0,parseInt(R.currentWater.textContent)+p);R.currentWater.textContent=_,So(_),await ue.setWater(Ze,_)}}),R.resetWater&&(R.resetWater.onclick=async h=>{h.stopPropagation(),confirm("Reset water?")&&(R.currentWater.textContent=0,So(0),await ue.setWater(Ze,0))});const a=document.getElementById("bulk-select-btn");a&&(a.onclick=()=>{Tn=!Tn,Ct.clear(),document.getElementById("bulk-actions").style.display=Tn?"block":"none",Pt()});const l=document.getElementById("save-bulk-fav-btn");l&&(l.onclick=async()=>{if(Ct.size===0)return;const h=prompt("Group name:");if(!h)return;const p=xn.filter(_=>Ct.has(_.id)).reduce((_,E)=>({calories:_.calories+E.calories,protein:_.protein+(E.protein||0),carbs:_.carbs+(E.carbs||0),fat:_.fat+(E.fat||0)}),{calories:0,protein:0,carbs:0,fat:0});oe(!0),await ue.addFavorite({...p,name:h,category:"Lunch",stockPhoto:`https://source.unsplash.com/featured/?${encodeURIComponent(res.photoSearchQuery||res.name)},food`}),Tn=!1,Ct.clear(),document.getElementById("bulk-actions").style.display="none",await bt(),oe(!1)}),R.addCheckinBtn&&(R.addCheckinBtn.onclick=async()=>{const h=prompt("Weight:");if(!h||isNaN(h))return;const d=new Date,p=new Date(d);p.setDate(d.getDate()-d.getDay()),oe(!0),await ue.addCheckin({weight:parseFloat(h),date:p.toISOString().split("T")[0]}),await bt(),oe(!1)})}function gu(){return{name:R.confirmName.value,calories:parseInt(R.confirmCalories.value),protein:parseInt(R.confirmProtein.value)||0,carbs:parseInt(R.confirmCarbs.value)||0,fat:parseInt(R.confirmFat.value)||0,category:R.confirmCategory.value,stockPhoto:_e.stockPhoto,timestamp:_e.timestamp||new Date().toISOString()}}async function Ro(n,e=null){if(!K.geminiKey)return alert("API Key missing");oe(!0);try{let t=n==="text"?R.textLog.value:e;const r=await Qd(K.geminiKey,t,n);r&&(_e={...r,stockPhoto:`https://source.unsplash.com/featured/?${encodeURIComponent(r.photoSearchQuery||r.name)},food`},di(_e,!1))}catch(t){console.error(t)}finally{oe(!1)}}function di(n,e){R.confirmTitle.textContent=e?"Edit":"Confirm",R.confirmName.value=n.name,R.confirmCalories.value=n.calories,R.confirmProtein.value=n.protein||0,R.confirmCarbs.value=n.carbs||0,R.confirmFat.value=n.fat||0,R.confirmCategory.value=n.category||"Lunch",R.confirmImgPreview.style.backgroundImage=`url('${n.stockPhoto}')`,R.deleteBtn.style.display=e?"flex":"none",R.confirmModal.style.display="flex"}function fs(){R.searchTabHistory.classList.toggle("active-tab",it==="history"),R.searchTabWeb.classList.toggle("active-tab",it==="web"),R.aiSearchPrompt.style.display=it==="web"?"block":"none",R.searchResults.style.display=it==="history"?"flex":"none"}async function hr(n){if(it==="web")return;let e=[];n.length<1?e=xn.slice().sort((s,o)=>new Date(o.timestamp)-new Date(s.timestamp)).slice(0,10):e=xn.filter(s=>s.name.toLowerCase().includes(n.toLowerCase())).slice(0,10);const t=[],r=new Set;e.forEach(s=>{r.has(s.name.toLowerCase())||(r.add(s.name.toLowerCase()),t.push(s))}),R.searchResults.innerHTML=t.map(s=>`
    <div class="search-item glass" onclick="window.quickLog('${s.id}')">
      <div><strong>${s.name}</strong><small>${s.calories} kcal | ${s.category}</small></div>
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>
    </div>`).join("")||"<p style='text-align:center; padding: 20px; color: var(--text-dim)'>No recent history found.</p>"}async function mv(){const n=R.globalSearchInput.value.trim();if(!n)return alert("Type what you're looking for first!");oe(!0);try{const e=await Qd(K.geminiKey,n,"text");e&&(_e={...e,stockPhoto:`https://source.unsplash.com/featured/?${encodeURIComponent(e.photoSearchQuery||e.name)},food`},di(_e,!1),R.searchModal.style.display="none")}catch(e){console.error(e),alert("AI Search failed. Check API Key.")}finally{oe(!1)}}window.quickLog=n=>{const e=xn.find(t=>t.id===n);e&&(_e={...e,timestamp:new Date().toISOString()},di(_e,!1),R.searchModal.style.display="none")};async function bt(){const n=await ue.getSettings();n.calGoal&&(K={...K,...n});const e="AIzaSyD6s0xCW1r55msAUQAnO_LQ2EqHUwuefMI";(!K.geminiKey||K.geminiKey.length<10)&&(console.log("AI: Syncing new API key from environment..."),K.geminiKey=e,ue.saveSettings(K)),hi=await ue.getFavorites(),xn=await ue.getMeals(),ht=await ue.getCheckins(),va(),await Pt(),await yv(),vv(),Iv()}function _v(n){Object.keys(R.views).forEach(e=>{R.views[e]&&(R.views[e].style.display=e===n?"block":"none")}),R.navItems&&R.navItems.forEach(e=>e.classList.toggle("active",e&&e.getAttribute("data-tab")===n))}async function Pt(){const n=await ue.getMeals(Ze),e=await ue.getWater(Ze);R.currentWater&&(R.currentWater.textContent=e),So(e);const t={Breakfast:[],Lunch:[],Dinner:[],Snack:[]};let r=0,s=0;n.forEach(l=>{r+=l.calories,s+=l.protein||0,t[l.category]?t[l.category].push(l):t.Snack.push(l)});const o=ht.length>0?ht[0].weight:K.startWeight||180,a=Math.round(o*.825);R.totalCals&&(R.totalCals.textContent=r),R.totalPro&&(R.totalPro.textContent=s),R.goalCals&&(R.goalCals.textContent=K.calGoal),R.goalPro&&(R.goalPro.textContent=a),R.calBar&&(R.calBar.style.width=`${Math.min(100,r/K.calGoal*100)}%`),R.proBar&&(R.proBar.style.width=`${Math.min(100,s/a*100)}%`),R.categorizedMeals&&(R.categorizedMeals.innerHTML=Object.keys(t).map(l=>`
    <div class="category-section glass ${Ao[l]?"":"collapsed"}">
      <div class="category-header" onclick="window.toggleCat('${l}')">
        <h4><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="chevron"><polyline points="6 9 12 15 18 9"></polyline></svg> ${l}</h4>
        <span>${t[l].length} items  ${t[l].reduce((h,d)=>h+d.calories,0)} kcal</span>
      </div>
      <div class="category-content">
        ${t[l].map(h=>`
          <div class="meal-item glass" onclick="${Tn?`window.toggleSelect('${h.id}')`:`window.editMeal('${h.id}')`}">
            ${Tn?`<div style="padding:15px; border-right:1px solid var(--glass-border)"><input type="checkbox" ${Ct.has(h.id)?"checked":""} /></div>`:""}
            <div class="meal-photo" style="background-image: url('${h.stockPhoto}')"></div>
            <div class="meal-details"><strong>${h.name}</strong><br><small>${h.calories} kcal | P:${h.protein}g</small></div>
          </div>
        `).join("")}
      </div>
    </div>`).join(""))}window.toggleCat=n=>{Ao[n]=!Ao[n],Pt()};window.editMeal=n=>{const e=xn.find(t=>t.id===n);e&&(_e=e,di(e,!0))};window.toggleSelect=n=>{Ct.has(n)?Ct.delete(n):Ct.add(n),Pt()};window.logFav=async n=>{const e=hi.find(t=>t.id===n);e&&(oe(!0),await ue.addMeal({...e,timestamp:new Date().toISOString(),id:null}),await bt(),oe(!1))};window.deleteFav=async n=>{confirm("Delete?")&&(oe(!0),await ue.deleteFavorite(n),await bt(),oe(!1))};async function yv(){R.favoritesList&&(R.favoritesList.innerHTML=hi.map(n=>`
    <div class="fav-item glass" style="padding:15px; margin-bottom:10px; display:flex; justify-content:space-between; align-items:center;">
      <div><strong>${n.name}</strong><br><small>${n.calories} kcal</small></div>
      <div style="display:flex; gap:10px;"><button class="primary" onclick="window.logFav('${n.id}')">Add</button><button class="glass" onclick="window.deleteFav('${n.id}')">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"></path><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
      </button></div>
    </div>`).join("")||"<p style='text-align:center; padding:20px;'>None</p>")}function Ev(){R.favsDropdownList&&(R.favsDropdownList.innerHTML=hi.map(n=>`<div class="fav-drop-item" onclick="window.logFav('${n.id}')" style="padding:10px; cursor:pointer; border-bottom:1px solid rgba(255,255,255,0.05)">${n.name}</div>`).join("")||"<div style='padding:10px'>Empty</div>")}function Iv(){if(R.checkinHistoryList){if(ht.length===0){R.checkinHistoryList.innerHTML='<p style="text-align: center; color: var(--text-dim); padding: 20px;">No check-ins.</p>';return}R.checkinHistoryList.innerHTML=ht.map(n=>`
    <div class="checkin-item glass" style="display: flex; justify-content: space-between; align-items: center; padding: 12px 16px; margin-bottom: 10px;">
      <div><strong>${n.weight} lbs</strong><br><small>${new Date(n.date+"T12:00:00").toLocaleDateString()}</small></div>
      <button class="icon-sm glass" style="color: #ef4444;" onclick="window.deleteCheckin('${n.id}')">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"></path><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
      </button>
    </div>`).join("")}}window.deleteCheckin=async n=>{confirm("Delete?")&&(oe(!0),await ue.deleteCheckin(n),await bt(),oe(!1))};function va(){R.dateDisplay&&(R.dateDisplay.textContent=Ze===new Date().toISOString().split("T")[0]?"Today":new Date(Ze+"T12:00:00").toLocaleDateString()),R.datePickerHidden&&(R.datePickerHidden.value=Ze)}function mu(n){const e=new Date(Ze+"T12:00:00");e.setDate(e.getDate()+n),Ze=e.toISOString().split("T")[0],va(),Pt()}function So(n){const e=ht.length>0?ht[0].weight:K.startWeight||180,t=Math.round(e*.5);R.goalWater&&(R.goalWater.textContent=t),R.waterBar&&(R.waterBar.style.width=`${Math.min(100,n/t*100)}%`)}function vv(){const n=ht.length>0?ht[0].weight:K.startWeight||"--";if(R.currentWeightDisplay&&(R.currentWeightDisplay.textContent=n+(n!=="--"?" lbs":"")),R.goalWeightDisplay&&(R.goalWeightDisplay.textContent=K.goalWeight+" lbs"),K.goalWeight&&K.startWeight&&n!=="--"&&R.goalProgress){const e=Math.min(100,Math.abs(K.startWeight-n)/Math.abs(K.startWeight-K.goalWeight)*100);R.goalProgress.style.width=e+"%"}}function oe(n){R.loadingOverlay&&(R.loadingOverlay.style.display=n?"flex":"none")}function Tv(){const n=window.SpeechRecognition||window.webkitSpeechRecognition;if(!n)return alert("No support");const e=new n;e.onresult=t=>{R.textLog.value=t.results[0][0].transcript,Ro("text")},e.start()}pv();
