(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();const Gf=()=>{};var Mc={};const Du=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},Wf=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=n[t++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=n[t++],a=n[t++],l=n[t++],u=((s&7)<<18|(i&63)<<12|(a&63)<<6|l&63)-65536;e[r++]=String.fromCharCode(55296+(u>>10)),e[r++]=String.fromCharCode(56320+(u&1023))}else{const i=n[t++],a=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|a&63)}}return e.join("")},Ou={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const i=n[s],a=s+1<n.length,l=a?n[s+1]:0,u=s+2<n.length,d=u?n[s+2]:0,f=i>>2,_=(i&3)<<4|l>>4;let g=(l&15)<<2|d>>6,C=d&63;u||(C=64,a||(g=64)),r.push(t[f],t[_],t[g],t[C])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(Du(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):Wf(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const i=t[n.charAt(s++)],l=s<n.length?t[n.charAt(s)]:0;++s;const d=s<n.length?t[n.charAt(s)]:64;++s;const _=s<n.length?t[n.charAt(s)]:64;if(++s,i==null||l==null||d==null||_==null)throw new zf;const g=i<<2|l>>4;if(r.push(g),d!==64){const C=l<<4&240|d>>2;if(r.push(C),_!==64){const k=d<<6&192|_;r.push(k)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class zf extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Kf=function(n){const e=Du(n);return Ou.encodeByteArray(e,!0)},Ps=function(n){return Kf(n).replace(/\./g,"")},Vu=function(n){try{return Ou.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function Qf(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const Yf=()=>Qf().__FIREBASE_DEFAULTS__,Jf=()=>{if(typeof process>"u"||typeof Mc>"u")return;const n=Mc.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},Xf=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&Vu(n[1]);return e&&JSON.parse(e)},Js=()=>{try{return Gf()||Yf()||Jf()||Xf()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Mu=n=>Js()?.emulatorHosts?.[n],Lu=n=>{const e=Mu(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},xu=()=>Js()?.config,Fu=n=>Js()?.[`_${n}`];class Zf{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}function Ht(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Mo(n){return(await fetch(n,{credentials:"include"})).ok}function ep(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a={iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...n};return[Ps(JSON.stringify(t)),Ps(JSON.stringify(a)),""].join(".")}const yr={};function tp(){const n={prod:[],emulator:[]};for(const e of Object.keys(yr))yr[e]?n.emulator.push(e):n.prod.push(e);return n}function np(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let Lc=!1;function Lo(n,e){if(typeof window>"u"||typeof document>"u"||!Ht(window.location.host)||yr[n]===e||yr[n]||Lc)return;yr[n]=e;function t(g){return`__firebase__banner__${g}`}const r="__firebase__banner",i=tp().prod.length>0;function a(){const g=document.getElementById(r);g&&g.remove()}function l(g){g.style.display="flex",g.style.background="#7faaf0",g.style.position="fixed",g.style.bottom="5px",g.style.left="5px",g.style.padding=".5em",g.style.borderRadius="5px",g.style.alignItems="center"}function u(g,C){g.setAttribute("width","24"),g.setAttribute("id",C),g.setAttribute("height","24"),g.setAttribute("viewBox","0 0 24 24"),g.setAttribute("fill","none"),g.style.marginLeft="-6px"}function d(){const g=document.createElement("span");return g.style.cursor="pointer",g.style.marginLeft="16px",g.style.fontSize="24px",g.innerHTML=" &times;",g.onclick=()=>{Lc=!0,a()},g}function f(g,C){g.setAttribute("id",C),g.innerText="Learn more",g.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",g.setAttribute("target","__blank"),g.style.paddingLeft="5px",g.style.textDecoration="underline"}function _(){const g=np(r),C=t("text"),k=document.getElementById(C)||document.createElement("span"),V=t("learnmore"),M=document.getElementById(V)||document.createElement("a"),G=t("preprendIcon"),K=document.getElementById(G)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(g.created){const J=g.element;l(J),f(M,V);const Me=d();u(K,G),J.append(K,k,M,Me),document.body.appendChild(J)}i?(k.innerText="Preview backend disconnected.",K.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(K.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,k.innerText="Preview backend running in this workspace."),k.setAttribute("id",C)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",_):_()}function Re(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function rp(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Re())}function sp(){const n=Js()?.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function ip(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function op(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function ap(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function cp(){const n=Re();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function lp(){return!sp()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function up(){try{return typeof indexedDB=="object"}catch{return!1}}function hp(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{e(s.error?.message||"")}}catch(t){e(t)}})}const dp="FirebaseError";class st extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=dp,Object.setPrototypeOf(this,st.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,xr.prototype.create)}}class xr{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,i=this.errors[e],a=i?fp(i,r):"Error",l=`${this.serviceName}: ${a} (${s}).`;return new st(s,l,r)}}function fp(n,e){return n.replace(pp,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const pp=/\{\$([^}]+)}/g;function mp(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function sn(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const i=n[s],a=e[s];if(xc(i)&&xc(a)){if(!sn(i,a))return!1}else if(i!==a)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function xc(n){return n!==null&&typeof n=="object"}function Fr(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function gp(n,e){const t=new _p(n,e);return t.subscribe.bind(t)}class _p{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");yp(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=Hi),s.error===void 0&&(s.error=Hi),s.complete===void 0&&(s.complete=Hi);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function yp(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function Hi(){}function le(n){return n&&n._delegate?n._delegate:n}class xt{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const Zt="[DEFAULT]";class Ep{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new Zf;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e?.identifier),r=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Tp(e))try{this.getOrInitializeService({instanceIdentifier:Zt})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=Zt){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Zt){return this.instances.has(e)}getOptions(e=Zt){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[i,a]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(i);r===l&&a.resolve(s)}return s}onInit(e,t){const r=this.normalizeInstanceIdentifier(t),s=this.onInitCallbacks.get(r)??new Set;s.add(e),this.onInitCallbacks.set(r,s);const i=this.instances.get(r);return i&&e(i,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:Ip(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Zt){return this.component?this.component.multipleInstances?e:Zt:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Ip(n){return n===Zt?void 0:n}function Tp(n){return n.instantiationMode==="EAGER"}class vp{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new Ep(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}var j;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(j||(j={}));const wp={debug:j.DEBUG,verbose:j.VERBOSE,info:j.INFO,warn:j.WARN,error:j.ERROR,silent:j.SILENT},Ap=j.INFO,Sp={[j.DEBUG]:"log",[j.VERBOSE]:"log",[j.INFO]:"info",[j.WARN]:"warn",[j.ERROR]:"error"},Rp=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=Sp[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class xo{constructor(e){this.name=e,this._logLevel=Ap,this._logHandler=Rp,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in j))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?wp[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,j.DEBUG,...e),this._logHandler(this,j.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,j.VERBOSE,...e),this._logHandler(this,j.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,j.INFO,...e),this._logHandler(this,j.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,j.WARN,...e),this._logHandler(this,j.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,j.ERROR,...e),this._logHandler(this,j.ERROR,...e)}}const Cp=(n,e)=>e.some(t=>n instanceof t);let Fc,Uc;function bp(){return Fc||(Fc=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Pp(){return Uc||(Uc=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Uu=new WeakMap,io=new WeakMap,Bu=new WeakMap,Gi=new WeakMap,Fo=new WeakMap;function kp(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",i),n.removeEventListener("error",a)},i=()=>{t(Dt(n.result)),s()},a=()=>{r(n.error),s()};n.addEventListener("success",i),n.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&Uu.set(t,n)}).catch(()=>{}),Fo.set(e,n),e}function Np(n){if(io.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",a),n.removeEventListener("abort",a)},i=()=>{t(),s()},a=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",i),n.addEventListener("error",a),n.addEventListener("abort",a)});io.set(n,e)}let oo={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return io.get(n);if(e==="objectStoreNames")return n.objectStoreNames||Bu.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Dt(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function Dp(n){oo=n(oo)}function Op(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(Wi(this),e,...t);return Bu.set(r,e.sort?e.sort():[e]),Dt(r)}:Pp().includes(n)?function(...e){return n.apply(Wi(this),e),Dt(Uu.get(this))}:function(...e){return Dt(n.apply(Wi(this),e))}}function Vp(n){return typeof n=="function"?Op(n):(n instanceof IDBTransaction&&Np(n),Cp(n,bp())?new Proxy(n,oo):n)}function Dt(n){if(n instanceof IDBRequest)return kp(n);if(Gi.has(n))return Gi.get(n);const e=Vp(n);return e!==n&&(Gi.set(n,e),Fo.set(e,n)),e}const Wi=n=>Fo.get(n);function Mp(n,e,{blocked:t,upgrade:r,blocking:s,terminated:i}={}){const a=indexedDB.open(n,e),l=Dt(a);return r&&a.addEventListener("upgradeneeded",u=>{r(Dt(a.result),u.oldVersion,u.newVersion,Dt(a.transaction),u)}),t&&a.addEventListener("blocked",u=>t(u.oldVersion,u.newVersion,u)),l.then(u=>{i&&u.addEventListener("close",()=>i()),s&&u.addEventListener("versionchange",d=>s(d.oldVersion,d.newVersion,d))}).catch(()=>{}),l}const Lp=["get","getKey","getAll","getAllKeys","count"],xp=["put","add","delete","clear"],zi=new Map;function Bc(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(zi.get(e))return zi.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=xp.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||Lp.includes(t)))return;const i=async function(a,...l){const u=this.transaction(a,s?"readwrite":"readonly");let d=u.store;return r&&(d=d.index(l.shift())),(await Promise.all([d[t](...l),s&&u.done]))[0]};return zi.set(e,i),i}Dp(n=>({...n,get:(e,t,r)=>Bc(e,t)||n.get(e,t,r),has:(e,t)=>!!Bc(e,t)||n.has(e,t)}));class Fp{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(Up(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function Up(n){return n.getComponent()?.type==="VERSION"}const ao="@firebase/app",$c="0.14.7";const ut=new xo("@firebase/app"),Bp="@firebase/app-compat",$p="@firebase/analytics-compat",jp="@firebase/analytics",qp="@firebase/app-check-compat",Hp="@firebase/app-check",Gp="@firebase/auth",Wp="@firebase/auth-compat",zp="@firebase/database",Kp="@firebase/data-connect",Qp="@firebase/database-compat",Yp="@firebase/functions",Jp="@firebase/functions-compat",Xp="@firebase/installations",Zp="@firebase/installations-compat",em="@firebase/messaging",tm="@firebase/messaging-compat",nm="@firebase/performance",rm="@firebase/performance-compat",sm="@firebase/remote-config",im="@firebase/remote-config-compat",om="@firebase/storage",am="@firebase/storage-compat",cm="@firebase/firestore",lm="@firebase/ai",um="@firebase/firestore-compat",hm="firebase",dm="12.8.0";const co="[DEFAULT]",fm={[ao]:"fire-core",[Bp]:"fire-core-compat",[jp]:"fire-analytics",[$p]:"fire-analytics-compat",[Hp]:"fire-app-check",[qp]:"fire-app-check-compat",[Gp]:"fire-auth",[Wp]:"fire-auth-compat",[zp]:"fire-rtdb",[Kp]:"fire-data-connect",[Qp]:"fire-rtdb-compat",[Yp]:"fire-fn",[Jp]:"fire-fn-compat",[Xp]:"fire-iid",[Zp]:"fire-iid-compat",[em]:"fire-fcm",[tm]:"fire-fcm-compat",[nm]:"fire-perf",[rm]:"fire-perf-compat",[sm]:"fire-rc",[im]:"fire-rc-compat",[om]:"fire-gcs",[am]:"fire-gcs-compat",[cm]:"fire-fst",[um]:"fire-fst-compat",[lm]:"fire-vertex","fire-js":"fire-js",[hm]:"fire-js-all"};const ks=new Map,pm=new Map,lo=new Map;function jc(n,e){try{n.container.addComponent(e)}catch(t){ut.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function on(n){const e=n.name;if(lo.has(e))return ut.debug(`There were multiple attempts to register component ${e}.`),!1;lo.set(e,n);for(const t of ks.values())jc(t,n);for(const t of pm.values())jc(t,n);return!0}function Xs(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function Fe(n){return n==null?!1:n.settings!==void 0}const mm={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Ot=new xr("app","Firebase",mm);class gm{constructor(e,t,r){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new xt("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Ot.create("app-deleted",{appName:this._name})}}const $n=dm;function $u(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r={name:co,automaticDataCollectionEnabled:!0,...e},s=r.name;if(typeof s!="string"||!s)throw Ot.create("bad-app-name",{appName:String(s)});if(t||(t=xu()),!t)throw Ot.create("no-options");const i=ks.get(s);if(i){if(sn(t,i.options)&&sn(r,i.config))return i;throw Ot.create("duplicate-app",{appName:s})}const a=new vp(s);for(const u of lo.values())a.addComponent(u);const l=new gm(t,r,a);return ks.set(s,l),l}function Uo(n=co){const e=ks.get(n);if(!e&&n===co&&xu())return $u();if(!e)throw Ot.create("no-app",{appName:n});return e}function Ye(n,e,t){let r=fm[n]??n;t&&(r+=`-${t}`);const s=r.match(/\s|\//),i=e.match(/\s|\//);if(s||i){const a=[`Unable to register library "${r}" with version "${e}":`];s&&a.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&i&&a.push("and"),i&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),ut.warn(a.join(" "));return}on(new xt(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}const _m="firebase-heartbeat-database",ym=1,Rr="firebase-heartbeat-store";let Ki=null;function ju(){return Ki||(Ki=Mp(_m,ym,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Rr)}catch(t){console.warn(t)}}}}).catch(n=>{throw Ot.create("idb-open",{originalErrorMessage:n.message})})),Ki}async function Em(n){try{const t=(await ju()).transaction(Rr),r=await t.objectStore(Rr).get(qu(n));return await t.done,r}catch(e){if(e instanceof st)ut.warn(e.message);else{const t=Ot.create("idb-get",{originalErrorMessage:e?.message});ut.warn(t.message)}}}async function qc(n,e){try{const r=(await ju()).transaction(Rr,"readwrite");await r.objectStore(Rr).put(e,qu(n)),await r.done}catch(t){if(t instanceof st)ut.warn(t.message);else{const r=Ot.create("idb-set",{originalErrorMessage:t?.message});ut.warn(r.message)}}}function qu(n){return`${n.name}!${n.options.appId}`}const Im=1024,Tm=30;class vm{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Am(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){try{const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=Hc();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(s=>s.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:t}),this._heartbeatsCache.heartbeats.length>Tm){const s=Sm(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(s,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){ut.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=Hc(),{heartbeatsToSend:t,unsentEntries:r}=wm(this._heartbeatsCache.heartbeats),s=Ps(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(e){return ut.warn(e),""}}}function Hc(){return new Date().toISOString().substring(0,10)}function wm(n,e=Im){const t=[];let r=n.slice();for(const s of n){const i=t.find(a=>a.agent===s.agent);if(i){if(i.dates.push(s.date),Gc(t)>e){i.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),Gc(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class Am{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return up()?hp().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await Em(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return qc(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return qc(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function Gc(n){return Ps(JSON.stringify({version:2,heartbeats:n})).length}function Sm(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}function Rm(n){on(new xt("platform-logger",e=>new Fp(e),"PRIVATE")),on(new xt("heartbeat",e=>new vm(e),"PRIVATE")),Ye(ao,$c,n),Ye(ao,$c,"esm2020"),Ye("fire-js","")}Rm("");var Cm="firebase",bm="12.8.0";Ye(Cm,bm,"app");var Wc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var Vt,Hu;(function(){var n;function e(T,m){function E(){}E.prototype=m.prototype,T.F=m.prototype,T.prototype=new E,T.prototype.constructor=T,T.D=function(v,I,S){for(var y=Array(arguments.length-2),Ne=2;Ne<arguments.length;Ne++)y[Ne-2]=arguments[Ne];return m.prototype[I].apply(v,y)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,t),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(T,m,E){E||(E=0);const v=Array(16);if(typeof m=="string")for(var I=0;I<16;++I)v[I]=m.charCodeAt(E++)|m.charCodeAt(E++)<<8|m.charCodeAt(E++)<<16|m.charCodeAt(E++)<<24;else for(I=0;I<16;++I)v[I]=m[E++]|m[E++]<<8|m[E++]<<16|m[E++]<<24;m=T.g[0],E=T.g[1],I=T.g[2];let S=T.g[3],y;y=m+(S^E&(I^S))+v[0]+3614090360&4294967295,m=E+(y<<7&4294967295|y>>>25),y=S+(I^m&(E^I))+v[1]+3905402710&4294967295,S=m+(y<<12&4294967295|y>>>20),y=I+(E^S&(m^E))+v[2]+606105819&4294967295,I=S+(y<<17&4294967295|y>>>15),y=E+(m^I&(S^m))+v[3]+3250441966&4294967295,E=I+(y<<22&4294967295|y>>>10),y=m+(S^E&(I^S))+v[4]+4118548399&4294967295,m=E+(y<<7&4294967295|y>>>25),y=S+(I^m&(E^I))+v[5]+1200080426&4294967295,S=m+(y<<12&4294967295|y>>>20),y=I+(E^S&(m^E))+v[6]+2821735955&4294967295,I=S+(y<<17&4294967295|y>>>15),y=E+(m^I&(S^m))+v[7]+4249261313&4294967295,E=I+(y<<22&4294967295|y>>>10),y=m+(S^E&(I^S))+v[8]+1770035416&4294967295,m=E+(y<<7&4294967295|y>>>25),y=S+(I^m&(E^I))+v[9]+2336552879&4294967295,S=m+(y<<12&4294967295|y>>>20),y=I+(E^S&(m^E))+v[10]+4294925233&4294967295,I=S+(y<<17&4294967295|y>>>15),y=E+(m^I&(S^m))+v[11]+2304563134&4294967295,E=I+(y<<22&4294967295|y>>>10),y=m+(S^E&(I^S))+v[12]+1804603682&4294967295,m=E+(y<<7&4294967295|y>>>25),y=S+(I^m&(E^I))+v[13]+4254626195&4294967295,S=m+(y<<12&4294967295|y>>>20),y=I+(E^S&(m^E))+v[14]+2792965006&4294967295,I=S+(y<<17&4294967295|y>>>15),y=E+(m^I&(S^m))+v[15]+1236535329&4294967295,E=I+(y<<22&4294967295|y>>>10),y=m+(I^S&(E^I))+v[1]+4129170786&4294967295,m=E+(y<<5&4294967295|y>>>27),y=S+(E^I&(m^E))+v[6]+3225465664&4294967295,S=m+(y<<9&4294967295|y>>>23),y=I+(m^E&(S^m))+v[11]+643717713&4294967295,I=S+(y<<14&4294967295|y>>>18),y=E+(S^m&(I^S))+v[0]+3921069994&4294967295,E=I+(y<<20&4294967295|y>>>12),y=m+(I^S&(E^I))+v[5]+3593408605&4294967295,m=E+(y<<5&4294967295|y>>>27),y=S+(E^I&(m^E))+v[10]+38016083&4294967295,S=m+(y<<9&4294967295|y>>>23),y=I+(m^E&(S^m))+v[15]+3634488961&4294967295,I=S+(y<<14&4294967295|y>>>18),y=E+(S^m&(I^S))+v[4]+3889429448&4294967295,E=I+(y<<20&4294967295|y>>>12),y=m+(I^S&(E^I))+v[9]+568446438&4294967295,m=E+(y<<5&4294967295|y>>>27),y=S+(E^I&(m^E))+v[14]+3275163606&4294967295,S=m+(y<<9&4294967295|y>>>23),y=I+(m^E&(S^m))+v[3]+4107603335&4294967295,I=S+(y<<14&4294967295|y>>>18),y=E+(S^m&(I^S))+v[8]+1163531501&4294967295,E=I+(y<<20&4294967295|y>>>12),y=m+(I^S&(E^I))+v[13]+2850285829&4294967295,m=E+(y<<5&4294967295|y>>>27),y=S+(E^I&(m^E))+v[2]+4243563512&4294967295,S=m+(y<<9&4294967295|y>>>23),y=I+(m^E&(S^m))+v[7]+1735328473&4294967295,I=S+(y<<14&4294967295|y>>>18),y=E+(S^m&(I^S))+v[12]+2368359562&4294967295,E=I+(y<<20&4294967295|y>>>12),y=m+(E^I^S)+v[5]+4294588738&4294967295,m=E+(y<<4&4294967295|y>>>28),y=S+(m^E^I)+v[8]+2272392833&4294967295,S=m+(y<<11&4294967295|y>>>21),y=I+(S^m^E)+v[11]+1839030562&4294967295,I=S+(y<<16&4294967295|y>>>16),y=E+(I^S^m)+v[14]+4259657740&4294967295,E=I+(y<<23&4294967295|y>>>9),y=m+(E^I^S)+v[1]+2763975236&4294967295,m=E+(y<<4&4294967295|y>>>28),y=S+(m^E^I)+v[4]+1272893353&4294967295,S=m+(y<<11&4294967295|y>>>21),y=I+(S^m^E)+v[7]+4139469664&4294967295,I=S+(y<<16&4294967295|y>>>16),y=E+(I^S^m)+v[10]+3200236656&4294967295,E=I+(y<<23&4294967295|y>>>9),y=m+(E^I^S)+v[13]+681279174&4294967295,m=E+(y<<4&4294967295|y>>>28),y=S+(m^E^I)+v[0]+3936430074&4294967295,S=m+(y<<11&4294967295|y>>>21),y=I+(S^m^E)+v[3]+3572445317&4294967295,I=S+(y<<16&4294967295|y>>>16),y=E+(I^S^m)+v[6]+76029189&4294967295,E=I+(y<<23&4294967295|y>>>9),y=m+(E^I^S)+v[9]+3654602809&4294967295,m=E+(y<<4&4294967295|y>>>28),y=S+(m^E^I)+v[12]+3873151461&4294967295,S=m+(y<<11&4294967295|y>>>21),y=I+(S^m^E)+v[15]+530742520&4294967295,I=S+(y<<16&4294967295|y>>>16),y=E+(I^S^m)+v[2]+3299628645&4294967295,E=I+(y<<23&4294967295|y>>>9),y=m+(I^(E|~S))+v[0]+4096336452&4294967295,m=E+(y<<6&4294967295|y>>>26),y=S+(E^(m|~I))+v[7]+1126891415&4294967295,S=m+(y<<10&4294967295|y>>>22),y=I+(m^(S|~E))+v[14]+2878612391&4294967295,I=S+(y<<15&4294967295|y>>>17),y=E+(S^(I|~m))+v[5]+4237533241&4294967295,E=I+(y<<21&4294967295|y>>>11),y=m+(I^(E|~S))+v[12]+1700485571&4294967295,m=E+(y<<6&4294967295|y>>>26),y=S+(E^(m|~I))+v[3]+2399980690&4294967295,S=m+(y<<10&4294967295|y>>>22),y=I+(m^(S|~E))+v[10]+4293915773&4294967295,I=S+(y<<15&4294967295|y>>>17),y=E+(S^(I|~m))+v[1]+2240044497&4294967295,E=I+(y<<21&4294967295|y>>>11),y=m+(I^(E|~S))+v[8]+1873313359&4294967295,m=E+(y<<6&4294967295|y>>>26),y=S+(E^(m|~I))+v[15]+4264355552&4294967295,S=m+(y<<10&4294967295|y>>>22),y=I+(m^(S|~E))+v[6]+2734768916&4294967295,I=S+(y<<15&4294967295|y>>>17),y=E+(S^(I|~m))+v[13]+1309151649&4294967295,E=I+(y<<21&4294967295|y>>>11),y=m+(I^(E|~S))+v[4]+4149444226&4294967295,m=E+(y<<6&4294967295|y>>>26),y=S+(E^(m|~I))+v[11]+3174756917&4294967295,S=m+(y<<10&4294967295|y>>>22),y=I+(m^(S|~E))+v[2]+718787259&4294967295,I=S+(y<<15&4294967295|y>>>17),y=E+(S^(I|~m))+v[9]+3951481745&4294967295,T.g[0]=T.g[0]+m&4294967295,T.g[1]=T.g[1]+(I+(y<<21&4294967295|y>>>11))&4294967295,T.g[2]=T.g[2]+I&4294967295,T.g[3]=T.g[3]+S&4294967295}r.prototype.v=function(T,m){m===void 0&&(m=T.length);const E=m-this.blockSize,v=this.C;let I=this.h,S=0;for(;S<m;){if(I==0)for(;S<=E;)s(this,T,S),S+=this.blockSize;if(typeof T=="string"){for(;S<m;)if(v[I++]=T.charCodeAt(S++),I==this.blockSize){s(this,v),I=0;break}}else for(;S<m;)if(v[I++]=T[S++],I==this.blockSize){s(this,v),I=0;break}}this.h=I,this.o+=m},r.prototype.A=function(){var T=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);T[0]=128;for(var m=1;m<T.length-8;++m)T[m]=0;m=this.o*8;for(var E=T.length-8;E<T.length;++E)T[E]=m&255,m/=256;for(this.v(T),T=Array(16),m=0,E=0;E<4;++E)for(let v=0;v<32;v+=8)T[m++]=this.g[E]>>>v&255;return T};function i(T,m){var E=l;return Object.prototype.hasOwnProperty.call(E,T)?E[T]:E[T]=m(T)}function a(T,m){this.h=m;const E=[];let v=!0;for(let I=T.length-1;I>=0;I--){const S=T[I]|0;v&&S==m||(E[I]=S,v=!1)}this.g=E}var l={};function u(T){return-128<=T&&T<128?i(T,function(m){return new a([m|0],m<0?-1:0)}):new a([T|0],T<0?-1:0)}function d(T){if(isNaN(T)||!isFinite(T))return _;if(T<0)return M(d(-T));const m=[];let E=1;for(let v=0;T>=E;v++)m[v]=T/E|0,E*=4294967296;return new a(m,0)}function f(T,m){if(T.length==0)throw Error("number format error: empty string");if(m=m||10,m<2||36<m)throw Error("radix out of range: "+m);if(T.charAt(0)=="-")return M(f(T.substring(1),m));if(T.indexOf("-")>=0)throw Error('number format error: interior "-" character');const E=d(Math.pow(m,8));let v=_;for(let S=0;S<T.length;S+=8){var I=Math.min(8,T.length-S);const y=parseInt(T.substring(S,S+I),m);I<8?(I=d(Math.pow(m,I)),v=v.j(I).add(d(y))):(v=v.j(E),v=v.add(d(y)))}return v}var _=u(0),g=u(1),C=u(16777216);n=a.prototype,n.m=function(){if(V(this))return-M(this).m();let T=0,m=1;for(let E=0;E<this.g.length;E++){const v=this.i(E);T+=(v>=0?v:4294967296+v)*m,m*=4294967296}return T},n.toString=function(T){if(T=T||10,T<2||36<T)throw Error("radix out of range: "+T);if(k(this))return"0";if(V(this))return"-"+M(this).toString(T);const m=d(Math.pow(T,6));var E=this;let v="";for(;;){const I=Me(E,m).g;E=G(E,I.j(m));let S=((E.g.length>0?E.g[0]:E.h)>>>0).toString(T);if(E=I,k(E))return S+v;for(;S.length<6;)S="0"+S;v=S+v}},n.i=function(T){return T<0?0:T<this.g.length?this.g[T]:this.h};function k(T){if(T.h!=0)return!1;for(let m=0;m<T.g.length;m++)if(T.g[m]!=0)return!1;return!0}function V(T){return T.h==-1}n.l=function(T){return T=G(this,T),V(T)?-1:k(T)?0:1};function M(T){const m=T.g.length,E=[];for(let v=0;v<m;v++)E[v]=~T.g[v];return new a(E,~T.h).add(g)}n.abs=function(){return V(this)?M(this):this},n.add=function(T){const m=Math.max(this.g.length,T.g.length),E=[];let v=0;for(let I=0;I<=m;I++){let S=v+(this.i(I)&65535)+(T.i(I)&65535),y=(S>>>16)+(this.i(I)>>>16)+(T.i(I)>>>16);v=y>>>16,S&=65535,y&=65535,E[I]=y<<16|S}return new a(E,E[E.length-1]&-2147483648?-1:0)};function G(T,m){return T.add(M(m))}n.j=function(T){if(k(this)||k(T))return _;if(V(this))return V(T)?M(this).j(M(T)):M(M(this).j(T));if(V(T))return M(this.j(M(T)));if(this.l(C)<0&&T.l(C)<0)return d(this.m()*T.m());const m=this.g.length+T.g.length,E=[];for(var v=0;v<2*m;v++)E[v]=0;for(v=0;v<this.g.length;v++)for(let I=0;I<T.g.length;I++){const S=this.i(v)>>>16,y=this.i(v)&65535,Ne=T.i(I)>>>16,zt=T.i(I)&65535;E[2*v+2*I]+=y*zt,K(E,2*v+2*I),E[2*v+2*I+1]+=S*zt,K(E,2*v+2*I+1),E[2*v+2*I+1]+=y*Ne,K(E,2*v+2*I+1),E[2*v+2*I+2]+=S*Ne,K(E,2*v+2*I+2)}for(T=0;T<m;T++)E[T]=E[2*T+1]<<16|E[2*T];for(T=m;T<2*m;T++)E[T]=0;return new a(E,0)};function K(T,m){for(;(T[m]&65535)!=T[m];)T[m+1]+=T[m]>>>16,T[m]&=65535,m++}function J(T,m){this.g=T,this.h=m}function Me(T,m){if(k(m))throw Error("division by zero");if(k(T))return new J(_,_);if(V(T))return m=Me(M(T),m),new J(M(m.g),M(m.h));if(V(m))return m=Me(T,M(m)),new J(M(m.g),m.h);if(T.g.length>30){if(V(T)||V(m))throw Error("slowDivide_ only works with positive integers.");for(var E=g,v=m;v.l(T)<=0;)E=$e(E),v=$e(v);var I=_e(E,1),S=_e(v,1);for(v=_e(v,2),E=_e(E,2);!k(v);){var y=S.add(v);y.l(T)<=0&&(I=I.add(E),S=y),v=_e(v,1),E=_e(E,1)}return m=G(T,I.j(m)),new J(I,m)}for(I=_;T.l(m)>=0;){for(E=Math.max(1,Math.floor(T.m()/m.m())),v=Math.ceil(Math.log(E)/Math.LN2),v=v<=48?1:Math.pow(2,v-48),S=d(E),y=S.j(m);V(y)||y.l(T)>0;)E-=v,S=d(E),y=S.j(m);k(S)&&(S=g),I=I.add(S),T=G(T,y)}return new J(I,T)}n.B=function(T){return Me(this,T).h},n.and=function(T){const m=Math.max(this.g.length,T.g.length),E=[];for(let v=0;v<m;v++)E[v]=this.i(v)&T.i(v);return new a(E,this.h&T.h)},n.or=function(T){const m=Math.max(this.g.length,T.g.length),E=[];for(let v=0;v<m;v++)E[v]=this.i(v)|T.i(v);return new a(E,this.h|T.h)},n.xor=function(T){const m=Math.max(this.g.length,T.g.length),E=[];for(let v=0;v<m;v++)E[v]=this.i(v)^T.i(v);return new a(E,this.h^T.h)};function $e(T){const m=T.g.length+1,E=[];for(let v=0;v<m;v++)E[v]=T.i(v)<<1|T.i(v-1)>>>31;return new a(E,T.h)}function _e(T,m){const E=m>>5;m%=32;const v=T.g.length-E,I=[];for(let S=0;S<v;S++)I[S]=m>0?T.i(S+E)>>>m|T.i(S+E+1)<<32-m:T.i(S+E);return new a(I,T.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,Hu=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.B,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=f,Vt=a}).apply(typeof Wc<"u"?Wc:typeof self<"u"?self:typeof window<"u"?window:{});var hs=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var Gu,pr,Wu,ys,uo,zu,Ku,Qu;(function(){var n,e=Object.defineProperty;function t(o){o=[typeof globalThis=="object"&&globalThis,o,typeof window=="object"&&window,typeof self=="object"&&self,typeof hs=="object"&&hs];for(var c=0;c<o.length;++c){var h=o[c];if(h&&h.Math==Math)return h}throw Error("Cannot find global object")}var r=t(this);function s(o,c){if(c)e:{var h=r;o=o.split(".");for(var p=0;p<o.length-1;p++){var w=o[p];if(!(w in h))break e;h=h[w]}o=o[o.length-1],p=h[o],c=c(p),c!=p&&c!=null&&e(h,o,{configurable:!0,writable:!0,value:c})}}s("Symbol.dispose",function(o){return o||Symbol("Symbol.dispose")}),s("Array.prototype.values",function(o){return o||function(){return this[Symbol.iterator]()}}),s("Object.entries",function(o){return o||function(c){var h=[],p;for(p in c)Object.prototype.hasOwnProperty.call(c,p)&&h.push([p,c[p]]);return h}});var i=i||{},a=this||self;function l(o){var c=typeof o;return c=="object"&&o!=null||c=="function"}function u(o,c,h){return o.call.apply(o.bind,arguments)}function d(o,c,h){return d=u,d.apply(null,arguments)}function f(o,c){var h=Array.prototype.slice.call(arguments,1);return function(){var p=h.slice();return p.push.apply(p,arguments),o.apply(this,p)}}function _(o,c){function h(){}h.prototype=c.prototype,o.Z=c.prototype,o.prototype=new h,o.prototype.constructor=o,o.Ob=function(p,w,R){for(var N=Array(arguments.length-2),$=2;$<arguments.length;$++)N[$-2]=arguments[$];return c.prototype[w].apply(p,N)}}var g=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?o=>o&&AsyncContext.Snapshot.wrap(o):o=>o;function C(o){const c=o.length;if(c>0){const h=Array(c);for(let p=0;p<c;p++)h[p]=o[p];return h}return[]}function k(o,c){for(let p=1;p<arguments.length;p++){const w=arguments[p];var h=typeof w;if(h=h!="object"?h:w?Array.isArray(w)?"array":h:"null",h=="array"||h=="object"&&typeof w.length=="number"){h=o.length||0;const R=w.length||0;o.length=h+R;for(let N=0;N<R;N++)o[h+N]=w[N]}else o.push(w)}}class V{constructor(c,h){this.i=c,this.j=h,this.h=0,this.g=null}get(){let c;return this.h>0?(this.h--,c=this.g,this.g=c.next,c.next=null):c=this.i(),c}}function M(o){a.setTimeout(()=>{throw o},0)}function G(){var o=T;let c=null;return o.g&&(c=o.g,o.g=o.g.next,o.g||(o.h=null),c.next=null),c}class K{constructor(){this.h=this.g=null}add(c,h){const p=J.get();p.set(c,h),this.h?this.h.next=p:this.g=p,this.h=p}}var J=new V(()=>new Me,o=>o.reset());class Me{constructor(){this.next=this.g=this.h=null}set(c,h){this.h=c,this.g=h,this.next=null}reset(){this.next=this.g=this.h=null}}let $e,_e=!1,T=new K,m=()=>{const o=Promise.resolve(void 0);$e=()=>{o.then(E)}};function E(){for(var o;o=G();){try{o.h.call(o.g)}catch(h){M(h)}var c=J;c.j(o),c.h<100&&(c.h++,o.next=c.g,c.g=o)}_e=!1}function v(){this.u=this.u,this.C=this.C}v.prototype.u=!1,v.prototype.dispose=function(){this.u||(this.u=!0,this.N())},v.prototype[Symbol.dispose]=function(){this.dispose()},v.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function I(o,c){this.type=o,this.g=this.target=c,this.defaultPrevented=!1}I.prototype.h=function(){this.defaultPrevented=!0};var S=(function(){if(!a.addEventListener||!Object.defineProperty)return!1;var o=!1,c=Object.defineProperty({},"passive",{get:function(){o=!0}});try{const h=()=>{};a.addEventListener("test",h,c),a.removeEventListener("test",h,c)}catch{}return o})();function y(o){return/^[\s\xa0]*$/.test(o)}function Ne(o,c){I.call(this,o?o.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,o&&this.init(o,c)}_(Ne,I),Ne.prototype.init=function(o,c){const h=this.type=o.type,p=o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:null;this.target=o.target||o.srcElement,this.g=c,c=o.relatedTarget,c||(h=="mouseover"?c=o.fromElement:h=="mouseout"&&(c=o.toElement)),this.relatedTarget=c,p?(this.clientX=p.clientX!==void 0?p.clientX:p.pageX,this.clientY=p.clientY!==void 0?p.clientY:p.pageY,this.screenX=p.screenX||0,this.screenY=p.screenY||0):(this.clientX=o.clientX!==void 0?o.clientX:o.pageX,this.clientY=o.clientY!==void 0?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0),this.button=o.button,this.key=o.key||"",this.ctrlKey=o.ctrlKey,this.altKey=o.altKey,this.shiftKey=o.shiftKey,this.metaKey=o.metaKey,this.pointerId=o.pointerId||0,this.pointerType=o.pointerType,this.state=o.state,this.i=o,o.defaultPrevented&&Ne.Z.h.call(this)},Ne.prototype.h=function(){Ne.Z.h.call(this);const o=this.i;o.preventDefault?o.preventDefault():o.returnValue=!1};var zt="closure_listenable_"+(Math.random()*1e6|0),ff=0;function pf(o,c,h,p,w){this.listener=o,this.proxy=null,this.src=c,this.type=h,this.capture=!!p,this.ha=w,this.key=++ff,this.da=this.fa=!1}function Yr(o){o.da=!0,o.listener=null,o.proxy=null,o.src=null,o.ha=null}function Jr(o,c,h){for(const p in o)c.call(h,o[p],p,o)}function mf(o,c){for(const h in o)c.call(void 0,o[h],h,o)}function Va(o){const c={};for(const h in o)c[h]=o[h];return c}const Ma="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function La(o,c){let h,p;for(let w=1;w<arguments.length;w++){p=arguments[w];for(h in p)o[h]=p[h];for(let R=0;R<Ma.length;R++)h=Ma[R],Object.prototype.hasOwnProperty.call(p,h)&&(o[h]=p[h])}}function Xr(o){this.src=o,this.g={},this.h=0}Xr.prototype.add=function(o,c,h,p,w){const R=o.toString();o=this.g[R],o||(o=this.g[R]=[],this.h++);const N=Ti(o,c,p,w);return N>-1?(c=o[N],h||(c.fa=!1)):(c=new pf(c,this.src,R,!!p,w),c.fa=h,o.push(c)),c};function Ii(o,c){const h=c.type;if(h in o.g){var p=o.g[h],w=Array.prototype.indexOf.call(p,c,void 0),R;(R=w>=0)&&Array.prototype.splice.call(p,w,1),R&&(Yr(c),o.g[h].length==0&&(delete o.g[h],o.h--))}}function Ti(o,c,h,p){for(let w=0;w<o.length;++w){const R=o[w];if(!R.da&&R.listener==c&&R.capture==!!h&&R.ha==p)return w}return-1}var vi="closure_lm_"+(Math.random()*1e6|0),wi={};function xa(o,c,h,p,w){if(Array.isArray(c)){for(let R=0;R<c.length;R++)xa(o,c[R],h,p,w);return null}return h=Ba(h),o&&o[zt]?o.J(c,h,l(p)?!!p.capture:!1,w):gf(o,c,h,!1,p,w)}function gf(o,c,h,p,w,R){if(!c)throw Error("Invalid event type");const N=l(w)?!!w.capture:!!w;let $=Si(o);if($||(o[vi]=$=new Xr(o)),h=$.add(c,h,p,N,R),h.proxy)return h;if(p=_f(),h.proxy=p,p.src=o,p.listener=h,o.addEventListener)S||(w=N),w===void 0&&(w=!1),o.addEventListener(c.toString(),p,w);else if(o.attachEvent)o.attachEvent(Ua(c.toString()),p);else if(o.addListener&&o.removeListener)o.addListener(p);else throw Error("addEventListener and attachEvent are unavailable.");return h}function _f(){function o(h){return c.call(o.src,o.listener,h)}const c=yf;return o}function Fa(o,c,h,p,w){if(Array.isArray(c))for(var R=0;R<c.length;R++)Fa(o,c[R],h,p,w);else p=l(p)?!!p.capture:!!p,h=Ba(h),o&&o[zt]?(o=o.i,R=String(c).toString(),R in o.g&&(c=o.g[R],h=Ti(c,h,p,w),h>-1&&(Yr(c[h]),Array.prototype.splice.call(c,h,1),c.length==0&&(delete o.g[R],o.h--)))):o&&(o=Si(o))&&(c=o.g[c.toString()],o=-1,c&&(o=Ti(c,h,p,w)),(h=o>-1?c[o]:null)&&Ai(h))}function Ai(o){if(typeof o!="number"&&o&&!o.da){var c=o.src;if(c&&c[zt])Ii(c.i,o);else{var h=o.type,p=o.proxy;c.removeEventListener?c.removeEventListener(h,p,o.capture):c.detachEvent?c.detachEvent(Ua(h),p):c.addListener&&c.removeListener&&c.removeListener(p),(h=Si(c))?(Ii(h,o),h.h==0&&(h.src=null,c[vi]=null)):Yr(o)}}}function Ua(o){return o in wi?wi[o]:wi[o]="on"+o}function yf(o,c){if(o.da)o=!0;else{c=new Ne(c,this);const h=o.listener,p=o.ha||o.src;o.fa&&Ai(o),o=h.call(p,c)}return o}function Si(o){return o=o[vi],o instanceof Xr?o:null}var Ri="__closure_events_fn_"+(Math.random()*1e9>>>0);function Ba(o){return typeof o=="function"?o:(o[Ri]||(o[Ri]=function(c){return o.handleEvent(c)}),o[Ri])}function Te(){v.call(this),this.i=new Xr(this),this.M=this,this.G=null}_(Te,v),Te.prototype[zt]=!0,Te.prototype.removeEventListener=function(o,c,h,p){Fa(this,o,c,h,p)};function Ce(o,c){var h,p=o.G;if(p)for(h=[];p;p=p.G)h.push(p);if(o=o.M,p=c.type||c,typeof c=="string")c=new I(c,o);else if(c instanceof I)c.target=c.target||o;else{var w=c;c=new I(p,o),La(c,w)}w=!0;let R,N;if(h)for(N=h.length-1;N>=0;N--)R=c.g=h[N],w=Zr(R,p,!0,c)&&w;if(R=c.g=o,w=Zr(R,p,!0,c)&&w,w=Zr(R,p,!1,c)&&w,h)for(N=0;N<h.length;N++)R=c.g=h[N],w=Zr(R,p,!1,c)&&w}Te.prototype.N=function(){if(Te.Z.N.call(this),this.i){var o=this.i;for(const c in o.g){const h=o.g[c];for(let p=0;p<h.length;p++)Yr(h[p]);delete o.g[c],o.h--}}this.G=null},Te.prototype.J=function(o,c,h,p){return this.i.add(String(o),c,!1,h,p)},Te.prototype.K=function(o,c,h,p){return this.i.add(String(o),c,!0,h,p)};function Zr(o,c,h,p){if(c=o.i.g[String(c)],!c)return!0;c=c.concat();let w=!0;for(let R=0;R<c.length;++R){const N=c[R];if(N&&!N.da&&N.capture==h){const $=N.listener,ue=N.ha||N.src;N.fa&&Ii(o.i,N),w=$.call(ue,p)!==!1&&w}}return w&&!p.defaultPrevented}function Ef(o,c){if(typeof o!="function")if(o&&typeof o.handleEvent=="function")o=d(o.handleEvent,o);else throw Error("Invalid listener argument");return Number(c)>2147483647?-1:a.setTimeout(o,c||0)}function $a(o){o.g=Ef(()=>{o.g=null,o.i&&(o.i=!1,$a(o))},o.l);const c=o.h;o.h=null,o.m.apply(null,c)}class If extends v{constructor(c,h){super(),this.m=c,this.l=h,this.h=null,this.i=!1,this.g=null}j(c){this.h=arguments,this.g?this.i=!0:$a(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Kn(o){v.call(this),this.h=o,this.g={}}_(Kn,v);var ja=[];function qa(o){Jr(o.g,function(c,h){this.g.hasOwnProperty(h)&&Ai(c)},o),o.g={}}Kn.prototype.N=function(){Kn.Z.N.call(this),qa(this)},Kn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Ci=a.JSON.stringify,Tf=a.JSON.parse,vf=class{stringify(o){return a.JSON.stringify(o,void 0)}parse(o){return a.JSON.parse(o,void 0)}};function Ha(){}function Ga(){}var Qn={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function bi(){I.call(this,"d")}_(bi,I);function Pi(){I.call(this,"c")}_(Pi,I);var Kt={},Wa=null;function es(){return Wa=Wa||new Te}Kt.Ia="serverreachability";function za(o){I.call(this,Kt.Ia,o)}_(za,I);function Yn(o){const c=es();Ce(c,new za(c))}Kt.STAT_EVENT="statevent";function Ka(o,c){I.call(this,Kt.STAT_EVENT,o),this.stat=c}_(Ka,I);function be(o){const c=es();Ce(c,new Ka(c,o))}Kt.Ja="timingevent";function Qa(o,c){I.call(this,Kt.Ja,o),this.size=c}_(Qa,I);function Jn(o,c){if(typeof o!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){o()},c)}function Xn(){this.g=!0}Xn.prototype.ua=function(){this.g=!1};function wf(o,c,h,p,w,R){o.info(function(){if(o.g)if(R){var N="",$=R.split("&");for(let Y=0;Y<$.length;Y++){var ue=$[Y].split("=");if(ue.length>1){const pe=ue[0];ue=ue[1];const Ke=pe.split("_");N=Ke.length>=2&&Ke[1]=="type"?N+(pe+"="+ue+"&"):N+(pe+"=redacted&")}}}else N=null;else N=R;return"XMLHTTP REQ ("+p+") [attempt "+w+"]: "+c+`
`+h+`
`+N})}function Af(o,c,h,p,w,R,N){o.info(function(){return"XMLHTTP RESP ("+p+") [ attempt "+w+"]: "+c+`
`+h+`
`+R+" "+N})}function gn(o,c,h,p){o.info(function(){return"XMLHTTP TEXT ("+c+"): "+Rf(o,h)+(p?" "+p:"")})}function Sf(o,c){o.info(function(){return"TIMEOUT: "+c})}Xn.prototype.info=function(){};function Rf(o,c){if(!o.g)return c;if(!c)return null;try{const R=JSON.parse(c);if(R){for(o=0;o<R.length;o++)if(Array.isArray(R[o])){var h=R[o];if(!(h.length<2)){var p=h[1];if(Array.isArray(p)&&!(p.length<1)){var w=p[0];if(w!="noop"&&w!="stop"&&w!="close")for(let N=1;N<p.length;N++)p[N]=""}}}}return Ci(R)}catch{return c}}var ts={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Ya={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},Ja;function ki(){}_(ki,Ha),ki.prototype.g=function(){return new XMLHttpRequest},Ja=new ki;function Zn(o){return encodeURIComponent(String(o))}function Cf(o){var c=1;o=o.split(":");const h=[];for(;c>0&&o.length;)h.push(o.shift()),c--;return o.length&&h.push(o.join(":")),h}function mt(o,c,h,p){this.j=o,this.i=c,this.l=h,this.S=p||1,this.V=new Kn(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Xa}function Xa(){this.i=null,this.g="",this.h=!1}var Za={},Ni={};function Di(o,c,h){o.M=1,o.A=rs(ze(c)),o.u=h,o.R=!0,ec(o,null)}function ec(o,c){o.F=Date.now(),ns(o),o.B=ze(o.A);var h=o.B,p=o.S;Array.isArray(p)||(p=[String(p)]),fc(h.i,"t",p),o.C=0,h=o.j.L,o.h=new Xa,o.g=Nc(o.j,h?c:null,!o.u),o.P>0&&(o.O=new If(d(o.Y,o,o.g),o.P)),c=o.V,h=o.g,p=o.ba;var w="readystatechange";Array.isArray(w)||(w&&(ja[0]=w.toString()),w=ja);for(let R=0;R<w.length;R++){const N=xa(h,w[R],p||c.handleEvent,!1,c.h||c);if(!N)break;c.g[N.key]=N}c=o.J?Va(o.J):{},o.u?(o.v||(o.v="POST"),c["Content-Type"]="application/x-www-form-urlencoded",o.g.ea(o.B,o.v,o.u,c)):(o.v="GET",o.g.ea(o.B,o.v,null,c)),Yn(),wf(o.i,o.v,o.B,o.l,o.S,o.u)}mt.prototype.ba=function(o){o=o.target;const c=this.O;c&&yt(o)==3?c.j():this.Y(o)},mt.prototype.Y=function(o){try{if(o==this.g)e:{const $=yt(this.g),ue=this.g.ya(),Y=this.g.ca();if(!($<3)&&($!=3||this.g&&(this.h.h||this.g.la()||Ic(this.g)))){this.K||$!=4||ue==7||(ue==8||Y<=0?Yn(3):Yn(2)),Oi(this);var c=this.g.ca();this.X=c;var h=bf(this);if(this.o=c==200,Af(this.i,this.v,this.B,this.l,this.S,$,c),this.o){if(this.U&&!this.L){t:{if(this.g){var p,w=this.g;if((p=w.g?w.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!y(p)){var R=p;break t}}R=null}if(o=R)gn(this.i,this.l,o,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Vi(this,o);else{this.o=!1,this.m=3,be(12),Qt(this),er(this);break e}}if(this.R){o=!0;let pe;for(;!this.K&&this.C<h.length;)if(pe=Pf(this,h),pe==Ni){$==4&&(this.m=4,be(14),o=!1),gn(this.i,this.l,null,"[Incomplete Response]");break}else if(pe==Za){this.m=4,be(15),gn(this.i,this.l,h,"[Invalid Chunk]"),o=!1;break}else gn(this.i,this.l,pe,null),Vi(this,pe);if(tc(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),$!=4||h.length!=0||this.h.h||(this.m=1,be(16),o=!1),this.o=this.o&&o,!o)gn(this.i,this.l,h,"[Invalid Chunked Response]"),Qt(this),er(this);else if(h.length>0&&!this.W){this.W=!0;var N=this.j;N.g==this&&N.aa&&!N.P&&(N.j.info("Great, no buffering proxy detected. Bytes received: "+h.length),ji(N),N.P=!0,be(11))}}else gn(this.i,this.l,h,null),Vi(this,h);$==4&&Qt(this),this.o&&!this.K&&($==4?Cc(this.j,this):(this.o=!1,ns(this)))}else qf(this.g),c==400&&h.indexOf("Unknown SID")>0?(this.m=3,be(12)):(this.m=0,be(13)),Qt(this),er(this)}}}catch{}};function bf(o){if(!tc(o))return o.g.la();const c=Ic(o.g);if(c==="")return"";let h="";const p=c.length,w=yt(o.g)==4;if(!o.h.i){if(typeof TextDecoder>"u")return Qt(o),er(o),"";o.h.i=new a.TextDecoder}for(let R=0;R<p;R++)o.h.h=!0,h+=o.h.i.decode(c[R],{stream:!(w&&R==p-1)});return c.length=0,o.h.g+=h,o.C=0,o.h.g}function tc(o){return o.g?o.v=="GET"&&o.M!=2&&o.j.Aa:!1}function Pf(o,c){var h=o.C,p=c.indexOf(`
`,h);return p==-1?Ni:(h=Number(c.substring(h,p)),isNaN(h)?Za:(p+=1,p+h>c.length?Ni:(c=c.slice(p,p+h),o.C=p+h,c)))}mt.prototype.cancel=function(){this.K=!0,Qt(this)};function ns(o){o.T=Date.now()+o.H,nc(o,o.H)}function nc(o,c){if(o.D!=null)throw Error("WatchDog timer not null");o.D=Jn(d(o.aa,o),c)}function Oi(o){o.D&&(a.clearTimeout(o.D),o.D=null)}mt.prototype.aa=function(){this.D=null;const o=Date.now();o-this.T>=0?(Sf(this.i,this.B),this.M!=2&&(Yn(),be(17)),Qt(this),this.m=2,er(this)):nc(this,this.T-o)};function er(o){o.j.I==0||o.K||Cc(o.j,o)}function Qt(o){Oi(o);var c=o.O;c&&typeof c.dispose=="function"&&c.dispose(),o.O=null,qa(o.V),o.g&&(c=o.g,o.g=null,c.abort(),c.dispose())}function Vi(o,c){try{var h=o.j;if(h.I!=0&&(h.g==o||Mi(h.h,o))){if(!o.L&&Mi(h.h,o)&&h.I==3){try{var p=h.Ba.g.parse(c)}catch{p=null}if(Array.isArray(p)&&p.length==3){var w=p;if(w[0]==0){e:if(!h.v){if(h.g)if(h.g.F+3e3<o.F)cs(h),os(h);else break e;$i(h),be(18)}}else h.xa=w[1],0<h.xa-h.K&&w[2]<37500&&h.F&&h.A==0&&!h.C&&(h.C=Jn(d(h.Va,h),6e3));ic(h.h)<=1&&h.ta&&(h.ta=void 0)}else Jt(h,11)}else if((o.L||h.g==o)&&cs(h),!y(c))for(w=h.Ba.g.parse(c),c=0;c<w.length;c++){let Y=w[c];const pe=Y[0];if(!(pe<=h.K))if(h.K=pe,Y=Y[1],h.I==2)if(Y[0]=="c"){h.M=Y[1],h.ba=Y[2];const Ke=Y[3];Ke!=null&&(h.ka=Ke,h.j.info("VER="+h.ka));const Xt=Y[4];Xt!=null&&(h.za=Xt,h.j.info("SVER="+h.za));const Et=Y[5];Et!=null&&typeof Et=="number"&&Et>0&&(p=1.5*Et,h.O=p,h.j.info("backChannelRequestTimeoutMs_="+p)),p=h;const It=o.g;if(It){const us=It.g?It.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(us){var R=p.h;R.g||us.indexOf("spdy")==-1&&us.indexOf("quic")==-1&&us.indexOf("h2")==-1||(R.j=R.l,R.g=new Set,R.h&&(Li(R,R.h),R.h=null))}if(p.G){const qi=It.g?It.g.getResponseHeader("X-HTTP-Session-Id"):null;qi&&(p.wa=qi,Z(p.J,p.G,qi))}}h.I=3,h.l&&h.l.ra(),h.aa&&(h.T=Date.now()-o.F,h.j.info("Handshake RTT: "+h.T+"ms")),p=h;var N=o;if(p.na=kc(p,p.L?p.ba:null,p.W),N.L){oc(p.h,N);var $=N,ue=p.O;ue&&($.H=ue),$.D&&(Oi($),ns($)),p.g=N}else Sc(p);h.i.length>0&&as(h)}else Y[0]!="stop"&&Y[0]!="close"||Jt(h,7);else h.I==3&&(Y[0]=="stop"||Y[0]=="close"?Y[0]=="stop"?Jt(h,7):Bi(h):Y[0]!="noop"&&h.l&&h.l.qa(Y),h.A=0)}}Yn(4)}catch{}}var kf=class{constructor(o,c){this.g=o,this.map=c}};function rc(o){this.l=o||10,a.PerformanceNavigationTiming?(o=a.performance.getEntriesByType("navigation"),o=o.length>0&&(o[0].nextHopProtocol=="hq"||o[0].nextHopProtocol=="h2")):o=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=o?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function sc(o){return o.h?!0:o.g?o.g.size>=o.j:!1}function ic(o){return o.h?1:o.g?o.g.size:0}function Mi(o,c){return o.h?o.h==c:o.g?o.g.has(c):!1}function Li(o,c){o.g?o.g.add(c):o.h=c}function oc(o,c){o.h&&o.h==c?o.h=null:o.g&&o.g.has(c)&&o.g.delete(c)}rc.prototype.cancel=function(){if(this.i=ac(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const o of this.g.values())o.cancel();this.g.clear()}};function ac(o){if(o.h!=null)return o.i.concat(o.h.G);if(o.g!=null&&o.g.size!==0){let c=o.i;for(const h of o.g.values())c=c.concat(h.G);return c}return C(o.i)}var cc=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Nf(o,c){if(o){o=o.split("&");for(let h=0;h<o.length;h++){const p=o[h].indexOf("=");let w,R=null;p>=0?(w=o[h].substring(0,p),R=o[h].substring(p+1)):w=o[h],c(w,R?decodeURIComponent(R.replace(/\+/g," ")):"")}}}function gt(o){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let c;o instanceof gt?(this.l=o.l,tr(this,o.j),this.o=o.o,this.g=o.g,nr(this,o.u),this.h=o.h,xi(this,pc(o.i)),this.m=o.m):o&&(c=String(o).match(cc))?(this.l=!1,tr(this,c[1]||"",!0),this.o=rr(c[2]||""),this.g=rr(c[3]||"",!0),nr(this,c[4]),this.h=rr(c[5]||"",!0),xi(this,c[6]||"",!0),this.m=rr(c[7]||"")):(this.l=!1,this.i=new ir(null,this.l))}gt.prototype.toString=function(){const o=[];var c=this.j;c&&o.push(sr(c,lc,!0),":");var h=this.g;return(h||c=="file")&&(o.push("//"),(c=this.o)&&o.push(sr(c,lc,!0),"@"),o.push(Zn(h).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),h=this.u,h!=null&&o.push(":",String(h))),(h=this.h)&&(this.g&&h.charAt(0)!="/"&&o.push("/"),o.push(sr(h,h.charAt(0)=="/"?Vf:Of,!0))),(h=this.i.toString())&&o.push("?",h),(h=this.m)&&o.push("#",sr(h,Lf)),o.join("")},gt.prototype.resolve=function(o){const c=ze(this);let h=!!o.j;h?tr(c,o.j):h=!!o.o,h?c.o=o.o:h=!!o.g,h?c.g=o.g:h=o.u!=null;var p=o.h;if(h)nr(c,o.u);else if(h=!!o.h){if(p.charAt(0)!="/")if(this.g&&!this.h)p="/"+p;else{var w=c.h.lastIndexOf("/");w!=-1&&(p=c.h.slice(0,w+1)+p)}if(w=p,w==".."||w==".")p="";else if(w.indexOf("./")!=-1||w.indexOf("/.")!=-1){p=w.lastIndexOf("/",0)==0,w=w.split("/");const R=[];for(let N=0;N<w.length;){const $=w[N++];$=="."?p&&N==w.length&&R.push(""):$==".."?((R.length>1||R.length==1&&R[0]!="")&&R.pop(),p&&N==w.length&&R.push("")):(R.push($),p=!0)}p=R.join("/")}else p=w}return h?c.h=p:h=o.i.toString()!=="",h?xi(c,pc(o.i)):h=!!o.m,h&&(c.m=o.m),c};function ze(o){return new gt(o)}function tr(o,c,h){o.j=h?rr(c,!0):c,o.j&&(o.j=o.j.replace(/:$/,""))}function nr(o,c){if(c){if(c=Number(c),isNaN(c)||c<0)throw Error("Bad port number "+c);o.u=c}else o.u=null}function xi(o,c,h){c instanceof ir?(o.i=c,xf(o.i,o.l)):(h||(c=sr(c,Mf)),o.i=new ir(c,o.l))}function Z(o,c,h){o.i.set(c,h)}function rs(o){return Z(o,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),o}function rr(o,c){return o?c?decodeURI(o.replace(/%25/g,"%2525")):decodeURIComponent(o):""}function sr(o,c,h){return typeof o=="string"?(o=encodeURI(o).replace(c,Df),h&&(o=o.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),o):null}function Df(o){return o=o.charCodeAt(0),"%"+(o>>4&15).toString(16)+(o&15).toString(16)}var lc=/[#\/\?@]/g,Of=/[#\?:]/g,Vf=/[#\?]/g,Mf=/[#\?@]/g,Lf=/#/g;function ir(o,c){this.h=this.g=null,this.i=o||null,this.j=!!c}function Yt(o){o.g||(o.g=new Map,o.h=0,o.i&&Nf(o.i,function(c,h){o.add(decodeURIComponent(c.replace(/\+/g," ")),h)}))}n=ir.prototype,n.add=function(o,c){Yt(this),this.i=null,o=_n(this,o);let h=this.g.get(o);return h||this.g.set(o,h=[]),h.push(c),this.h+=1,this};function uc(o,c){Yt(o),c=_n(o,c),o.g.has(c)&&(o.i=null,o.h-=o.g.get(c).length,o.g.delete(c))}function hc(o,c){return Yt(o),c=_n(o,c),o.g.has(c)}n.forEach=function(o,c){Yt(this),this.g.forEach(function(h,p){h.forEach(function(w){o.call(c,w,p,this)},this)},this)};function dc(o,c){Yt(o);let h=[];if(typeof c=="string")hc(o,c)&&(h=h.concat(o.g.get(_n(o,c))));else for(o=Array.from(o.g.values()),c=0;c<o.length;c++)h=h.concat(o[c]);return h}n.set=function(o,c){return Yt(this),this.i=null,o=_n(this,o),hc(this,o)&&(this.h-=this.g.get(o).length),this.g.set(o,[c]),this.h+=1,this},n.get=function(o,c){return o?(o=dc(this,o),o.length>0?String(o[0]):c):c};function fc(o,c,h){uc(o,c),h.length>0&&(o.i=null,o.g.set(_n(o,c),C(h)),o.h+=h.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const o=[],c=Array.from(this.g.keys());for(let p=0;p<c.length;p++){var h=c[p];const w=Zn(h);h=dc(this,h);for(let R=0;R<h.length;R++){let N=w;h[R]!==""&&(N+="="+Zn(h[R])),o.push(N)}}return this.i=o.join("&")};function pc(o){const c=new ir;return c.i=o.i,o.g&&(c.g=new Map(o.g),c.h=o.h),c}function _n(o,c){return c=String(c),o.j&&(c=c.toLowerCase()),c}function xf(o,c){c&&!o.j&&(Yt(o),o.i=null,o.g.forEach(function(h,p){const w=p.toLowerCase();p!=w&&(uc(this,p),fc(this,w,h))},o)),o.j=c}function Ff(o,c){const h=new Xn;if(a.Image){const p=new Image;p.onload=f(_t,h,"TestLoadImage: loaded",!0,c,p),p.onerror=f(_t,h,"TestLoadImage: error",!1,c,p),p.onabort=f(_t,h,"TestLoadImage: abort",!1,c,p),p.ontimeout=f(_t,h,"TestLoadImage: timeout",!1,c,p),a.setTimeout(function(){p.ontimeout&&p.ontimeout()},1e4),p.src=o}else c(!1)}function Uf(o,c){const h=new Xn,p=new AbortController,w=setTimeout(()=>{p.abort(),_t(h,"TestPingServer: timeout",!1,c)},1e4);fetch(o,{signal:p.signal}).then(R=>{clearTimeout(w),R.ok?_t(h,"TestPingServer: ok",!0,c):_t(h,"TestPingServer: server error",!1,c)}).catch(()=>{clearTimeout(w),_t(h,"TestPingServer: error",!1,c)})}function _t(o,c,h,p,w){try{w&&(w.onload=null,w.onerror=null,w.onabort=null,w.ontimeout=null),p(h)}catch{}}function Bf(){this.g=new vf}function Fi(o){this.i=o.Sb||null,this.h=o.ab||!1}_(Fi,Ha),Fi.prototype.g=function(){return new ss(this.i,this.h)};function ss(o,c){Te.call(this),this.H=o,this.o=c,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}_(ss,Te),n=ss.prototype,n.open=function(o,c){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=o,this.D=c,this.readyState=1,ar(this)},n.send=function(o){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const c={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};o&&(c.body=o),(this.H||a).fetch(new Request(this.D,c)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,or(this)),this.readyState=0},n.Pa=function(o){if(this.g&&(this.l=o,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=o.headers,this.readyState=2,ar(this)),this.g&&(this.readyState=3,ar(this),this.g)))if(this.responseType==="arraybuffer")o.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in o){if(this.j=o.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;mc(this)}else o.text().then(this.Oa.bind(this),this.ga.bind(this))};function mc(o){o.j.read().then(o.Ma.bind(o)).catch(o.ga.bind(o))}n.Ma=function(o){if(this.g){if(this.o&&o.value)this.response.push(o.value);else if(!this.o){var c=o.value?o.value:new Uint8Array(0);(c=this.B.decode(c,{stream:!o.done}))&&(this.response=this.responseText+=c)}o.done?or(this):ar(this),this.readyState==3&&mc(this)}},n.Oa=function(o){this.g&&(this.response=this.responseText=o,or(this))},n.Na=function(o){this.g&&(this.response=o,or(this))},n.ga=function(){this.g&&or(this)};function or(o){o.readyState=4,o.l=null,o.j=null,o.B=null,ar(o)}n.setRequestHeader=function(o,c){this.A.append(o,c)},n.getResponseHeader=function(o){return this.h&&this.h.get(o.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const o=[],c=this.h.entries();for(var h=c.next();!h.done;)h=h.value,o.push(h[0]+": "+h[1]),h=c.next();return o.join(`\r
`)};function ar(o){o.onreadystatechange&&o.onreadystatechange.call(o)}Object.defineProperty(ss.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(o){this.m=o?"include":"same-origin"}});function gc(o){let c="";return Jr(o,function(h,p){c+=p,c+=":",c+=h,c+=`\r
`}),c}function Ui(o,c,h){e:{for(p in h){var p=!1;break e}p=!0}p||(h=gc(h),typeof o=="string"?h!=null&&Zn(h):Z(o,c,h))}function ne(o){Te.call(this),this.headers=new Map,this.L=o||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}_(ne,Te);var $f=/^https?$/i,jf=["POST","PUT"];n=ne.prototype,n.Fa=function(o){this.H=o},n.ea=function(o,c,h,p){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+o);c=c?c.toUpperCase():"GET",this.D=o,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Ja.g(),this.g.onreadystatechange=g(d(this.Ca,this));try{this.B=!0,this.g.open(c,String(o),!0),this.B=!1}catch(R){_c(this,R);return}if(o=h||"",h=new Map(this.headers),p)if(Object.getPrototypeOf(p)===Object.prototype)for(var w in p)h.set(w,p[w]);else if(typeof p.keys=="function"&&typeof p.get=="function")for(const R of p.keys())h.set(R,p.get(R));else throw Error("Unknown input type for opt_headers: "+String(p));p=Array.from(h.keys()).find(R=>R.toLowerCase()=="content-type"),w=a.FormData&&o instanceof a.FormData,!(Array.prototype.indexOf.call(jf,c,void 0)>=0)||p||w||h.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[R,N]of h)this.g.setRequestHeader(R,N);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(o),this.v=!1}catch(R){_c(this,R)}};function _c(o,c){o.h=!1,o.g&&(o.j=!0,o.g.abort(),o.j=!1),o.l=c,o.o=5,yc(o),is(o)}function yc(o){o.A||(o.A=!0,Ce(o,"complete"),Ce(o,"error"))}n.abort=function(o){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=o||7,Ce(this,"complete"),Ce(this,"abort"),is(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),is(this,!0)),ne.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?Ec(this):this.Xa())},n.Xa=function(){Ec(this)};function Ec(o){if(o.h&&typeof i<"u"){if(o.v&&yt(o)==4)setTimeout(o.Ca.bind(o),0);else if(Ce(o,"readystatechange"),yt(o)==4){o.h=!1;try{const R=o.ca();e:switch(R){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var c=!0;break e;default:c=!1}var h;if(!(h=c)){var p;if(p=R===0){let N=String(o.D).match(cc)[1]||null;!N&&a.self&&a.self.location&&(N=a.self.location.protocol.slice(0,-1)),p=!$f.test(N?N.toLowerCase():"")}h=p}if(h)Ce(o,"complete"),Ce(o,"success");else{o.o=6;try{var w=yt(o)>2?o.g.statusText:""}catch{w=""}o.l=w+" ["+o.ca()+"]",yc(o)}}finally{is(o)}}}}function is(o,c){if(o.g){o.m&&(clearTimeout(o.m),o.m=null);const h=o.g;o.g=null,c||Ce(o,"ready");try{h.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function yt(o){return o.g?o.g.readyState:0}n.ca=function(){try{return yt(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(o){if(this.g){var c=this.g.responseText;return o&&c.indexOf(o)==0&&(c=c.substring(o.length)),Tf(c)}};function Ic(o){try{if(!o.g)return null;if("response"in o.g)return o.g.response;switch(o.F){case"":case"text":return o.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in o.g)return o.g.mozResponseArrayBuffer}return null}catch{return null}}function qf(o){const c={};o=(o.g&&yt(o)>=2&&o.g.getAllResponseHeaders()||"").split(`\r
`);for(let p=0;p<o.length;p++){if(y(o[p]))continue;var h=Cf(o[p]);const w=h[0];if(h=h[1],typeof h!="string")continue;h=h.trim();const R=c[w]||[];c[w]=R,R.push(h)}mf(c,function(p){return p.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function cr(o,c,h){return h&&h.internalChannelParams&&h.internalChannelParams[o]||c}function Tc(o){this.za=0,this.i=[],this.j=new Xn,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=cr("failFast",!1,o),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=cr("baseRetryDelayMs",5e3,o),this.Za=cr("retryDelaySeedMs",1e4,o),this.Ta=cr("forwardChannelMaxRetries",2,o),this.va=cr("forwardChannelRequestTimeoutMs",2e4,o),this.ma=o&&o.xmlHttpFactory||void 0,this.Ua=o&&o.Rb||void 0,this.Aa=o&&o.useFetchStreams||!1,this.O=void 0,this.L=o&&o.supportsCrossDomainXhr||!1,this.M="",this.h=new rc(o&&o.concurrentRequestLimit),this.Ba=new Bf,this.S=o&&o.fastHandshake||!1,this.R=o&&o.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=o&&o.Pb||!1,o&&o.ua&&this.j.ua(),o&&o.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&o&&o.detectBufferingProxy||!1,this.ia=void 0,o&&o.longPollingTimeout&&o.longPollingTimeout>0&&(this.ia=o.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=Tc.prototype,n.ka=8,n.I=1,n.connect=function(o,c,h,p){be(0),this.W=o,this.H=c||{},h&&p!==void 0&&(this.H.OSID=h,this.H.OAID=p),this.F=this.X,this.J=kc(this,null,this.W),as(this)};function Bi(o){if(vc(o),o.I==3){var c=o.V++,h=ze(o.J);if(Z(h,"SID",o.M),Z(h,"RID",c),Z(h,"TYPE","terminate"),lr(o,h),c=new mt(o,o.j,c),c.M=2,c.A=rs(ze(h)),h=!1,a.navigator&&a.navigator.sendBeacon)try{h=a.navigator.sendBeacon(c.A.toString(),"")}catch{}!h&&a.Image&&(new Image().src=c.A,h=!0),h||(c.g=Nc(c.j,null),c.g.ea(c.A)),c.F=Date.now(),ns(c)}Pc(o)}function os(o){o.g&&(ji(o),o.g.cancel(),o.g=null)}function vc(o){os(o),o.v&&(a.clearTimeout(o.v),o.v=null),cs(o),o.h.cancel(),o.m&&(typeof o.m=="number"&&a.clearTimeout(o.m),o.m=null)}function as(o){if(!sc(o.h)&&!o.m){o.m=!0;var c=o.Ea;$e||m(),_e||($e(),_e=!0),T.add(c,o),o.D=0}}function Hf(o,c){return ic(o.h)>=o.h.j-(o.m?1:0)?!1:o.m?(o.i=c.G.concat(o.i),!0):o.I==1||o.I==2||o.D>=(o.Sa?0:o.Ta)?!1:(o.m=Jn(d(o.Ea,o,c),bc(o,o.D)),o.D++,!0)}n.Ea=function(o){if(this.m)if(this.m=null,this.I==1){if(!o){this.V=Math.floor(Math.random()*1e5),o=this.V++;const w=new mt(this,this.j,o);let R=this.o;if(this.U&&(R?(R=Va(R),La(R,this.U)):R=this.U),this.u!==null||this.R||(w.J=R,R=null),this.S)e:{for(var c=0,h=0;h<this.i.length;h++){t:{var p=this.i[h];if("__data__"in p.map&&(p=p.map.__data__,typeof p=="string")){p=p.length;break t}p=void 0}if(p===void 0)break;if(c+=p,c>4096){c=h;break e}if(c===4096||h===this.i.length-1){c=h+1;break e}}c=1e3}else c=1e3;c=Ac(this,w,c),h=ze(this.J),Z(h,"RID",o),Z(h,"CVER",22),this.G&&Z(h,"X-HTTP-Session-Id",this.G),lr(this,h),R&&(this.R?c="headers="+Zn(gc(R))+"&"+c:this.u&&Ui(h,this.u,R)),Li(this.h,w),this.Ra&&Z(h,"TYPE","init"),this.S?(Z(h,"$req",c),Z(h,"SID","null"),w.U=!0,Di(w,h,null)):Di(w,h,c),this.I=2}}else this.I==3&&(o?wc(this,o):this.i.length==0||sc(this.h)||wc(this))};function wc(o,c){var h;c?h=c.l:h=o.V++;const p=ze(o.J);Z(p,"SID",o.M),Z(p,"RID",h),Z(p,"AID",o.K),lr(o,p),o.u&&o.o&&Ui(p,o.u,o.o),h=new mt(o,o.j,h,o.D+1),o.u===null&&(h.J=o.o),c&&(o.i=c.G.concat(o.i)),c=Ac(o,h,1e3),h.H=Math.round(o.va*.5)+Math.round(o.va*.5*Math.random()),Li(o.h,h),Di(h,p,c)}function lr(o,c){o.H&&Jr(o.H,function(h,p){Z(c,p,h)}),o.l&&Jr({},function(h,p){Z(c,p,h)})}function Ac(o,c,h){h=Math.min(o.i.length,h);const p=o.l?d(o.l.Ka,o.l,o):null;e:{var w=o.i;let $=-1;for(;;){const ue=["count="+h];$==-1?h>0?($=w[0].g,ue.push("ofs="+$)):$=0:ue.push("ofs="+$);let Y=!0;for(let pe=0;pe<h;pe++){var R=w[pe].g;const Ke=w[pe].map;if(R-=$,R<0)$=Math.max(0,w[pe].g-100),Y=!1;else try{R="req"+R+"_"||"";try{var N=Ke instanceof Map?Ke:Object.entries(Ke);for(const[Xt,Et]of N){let It=Et;l(Et)&&(It=Ci(Et)),ue.push(R+Xt+"="+encodeURIComponent(It))}}catch(Xt){throw ue.push(R+"type="+encodeURIComponent("_badmap")),Xt}}catch{p&&p(Ke)}}if(Y){N=ue.join("&");break e}}N=void 0}return o=o.i.splice(0,h),c.G=o,N}function Sc(o){if(!o.g&&!o.v){o.Y=1;var c=o.Da;$e||m(),_e||($e(),_e=!0),T.add(c,o),o.A=0}}function $i(o){return o.g||o.v||o.A>=3?!1:(o.Y++,o.v=Jn(d(o.Da,o),bc(o,o.A)),o.A++,!0)}n.Da=function(){if(this.v=null,Rc(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var o=4*this.T;this.j.info("BP detection timer enabled: "+o),this.B=Jn(d(this.Wa,this),o)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,be(10),os(this),Rc(this))};function ji(o){o.B!=null&&(a.clearTimeout(o.B),o.B=null)}function Rc(o){o.g=new mt(o,o.j,"rpc",o.Y),o.u===null&&(o.g.J=o.o),o.g.P=0;var c=ze(o.na);Z(c,"RID","rpc"),Z(c,"SID",o.M),Z(c,"AID",o.K),Z(c,"CI",o.F?"0":"1"),!o.F&&o.ia&&Z(c,"TO",o.ia),Z(c,"TYPE","xmlhttp"),lr(o,c),o.u&&o.o&&Ui(c,o.u,o.o),o.O&&(o.g.H=o.O);var h=o.g;o=o.ba,h.M=1,h.A=rs(ze(c)),h.u=null,h.R=!0,ec(h,o)}n.Va=function(){this.C!=null&&(this.C=null,os(this),$i(this),be(19))};function cs(o){o.C!=null&&(a.clearTimeout(o.C),o.C=null)}function Cc(o,c){var h=null;if(o.g==c){cs(o),ji(o),o.g=null;var p=2}else if(Mi(o.h,c))h=c.G,oc(o.h,c),p=1;else return;if(o.I!=0){if(c.o)if(p==1){h=c.u?c.u.length:0,c=Date.now()-c.F;var w=o.D;p=es(),Ce(p,new Qa(p,h)),as(o)}else Sc(o);else if(w=c.m,w==3||w==0&&c.X>0||!(p==1&&Hf(o,c)||p==2&&$i(o)))switch(h&&h.length>0&&(c=o.h,c.i=c.i.concat(h)),w){case 1:Jt(o,5);break;case 4:Jt(o,10);break;case 3:Jt(o,6);break;default:Jt(o,2)}}}function bc(o,c){let h=o.Qa+Math.floor(Math.random()*o.Za);return o.isActive()||(h*=2),h*c}function Jt(o,c){if(o.j.info("Error code "+c),c==2){var h=d(o.bb,o),p=o.Ua;const w=!p;p=new gt(p||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||tr(p,"https"),rs(p),w?Ff(p.toString(),h):Uf(p.toString(),h)}else be(2);o.I=0,o.l&&o.l.pa(c),Pc(o),vc(o)}n.bb=function(o){o?(this.j.info("Successfully pinged google.com"),be(2)):(this.j.info("Failed to ping google.com"),be(1))};function Pc(o){if(o.I=0,o.ja=[],o.l){const c=ac(o.h);(c.length!=0||o.i.length!=0)&&(k(o.ja,c),k(o.ja,o.i),o.h.i.length=0,C(o.i),o.i.length=0),o.l.oa()}}function kc(o,c,h){var p=h instanceof gt?ze(h):new gt(h);if(p.g!="")c&&(p.g=c+"."+p.g),nr(p,p.u);else{var w=a.location;p=w.protocol,c=c?c+"."+w.hostname:w.hostname,w=+w.port;const R=new gt(null);p&&tr(R,p),c&&(R.g=c),w&&nr(R,w),h&&(R.h=h),p=R}return h=o.G,c=o.wa,h&&c&&Z(p,h,c),Z(p,"VER",o.ka),lr(o,p),p}function Nc(o,c,h){if(c&&!o.L)throw Error("Can't create secondary domain capable XhrIo object.");return c=o.Aa&&!o.ma?new ne(new Fi({ab:h})):new ne(o.ma),c.Fa(o.L),c}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Dc(){}n=Dc.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function ls(){}ls.prototype.g=function(o,c){return new Le(o,c)};function Le(o,c){Te.call(this),this.g=new Tc(c),this.l=o,this.h=c&&c.messageUrlParams||null,o=c&&c.messageHeaders||null,c&&c.clientProtocolHeaderRequired&&(o?o["X-Client-Protocol"]="webchannel":o={"X-Client-Protocol":"webchannel"}),this.g.o=o,o=c&&c.initMessageHeaders||null,c&&c.messageContentType&&(o?o["X-WebChannel-Content-Type"]=c.messageContentType:o={"X-WebChannel-Content-Type":c.messageContentType}),c&&c.sa&&(o?o["X-WebChannel-Client-Profile"]=c.sa:o={"X-WebChannel-Client-Profile":c.sa}),this.g.U=o,(o=c&&c.Qb)&&!y(o)&&(this.g.u=o),this.A=c&&c.supportsCrossDomainXhr||!1,this.v=c&&c.sendRawJson||!1,(c=c&&c.httpSessionIdParam)&&!y(c)&&(this.g.G=c,o=this.h,o!==null&&c in o&&(o=this.h,c in o&&delete o[c])),this.j=new yn(this)}_(Le,Te),Le.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},Le.prototype.close=function(){Bi(this.g)},Le.prototype.o=function(o){var c=this.g;if(typeof o=="string"){var h={};h.__data__=o,o=h}else this.v&&(h={},h.__data__=Ci(o),o=h);c.i.push(new kf(c.Ya++,o)),c.I==3&&as(c)},Le.prototype.N=function(){this.g.l=null,delete this.j,Bi(this.g),delete this.g,Le.Z.N.call(this)};function Oc(o){bi.call(this),o.__headers__&&(this.headers=o.__headers__,this.statusCode=o.__status__,delete o.__headers__,delete o.__status__);var c=o.__sm__;if(c){e:{for(const h in c){o=h;break e}o=void 0}(this.i=o)&&(o=this.i,c=c!==null&&o in c?c[o]:void 0),this.data=c}else this.data=o}_(Oc,bi);function Vc(){Pi.call(this),this.status=1}_(Vc,Pi);function yn(o){this.g=o}_(yn,Dc),yn.prototype.ra=function(){Ce(this.g,"a")},yn.prototype.qa=function(o){Ce(this.g,new Oc(o))},yn.prototype.pa=function(o){Ce(this.g,new Vc)},yn.prototype.oa=function(){Ce(this.g,"b")},ls.prototype.createWebChannel=ls.prototype.g,Le.prototype.send=Le.prototype.o,Le.prototype.open=Le.prototype.m,Le.prototype.close=Le.prototype.close,Qu=function(){return new ls},Ku=function(){return es()},zu=Kt,uo={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},ts.NO_ERROR=0,ts.TIMEOUT=8,ts.HTTP_ERROR=6,ys=ts,Ya.COMPLETE="complete",Wu=Ya,Ga.EventType=Qn,Qn.OPEN="a",Qn.CLOSE="b",Qn.ERROR="c",Qn.MESSAGE="d",Te.prototype.listen=Te.prototype.J,pr=Ga,ne.prototype.listenOnce=ne.prototype.K,ne.prototype.getLastError=ne.prototype.Ha,ne.prototype.getLastErrorCode=ne.prototype.ya,ne.prototype.getStatus=ne.prototype.ca,ne.prototype.getResponseJson=ne.prototype.La,ne.prototype.getResponseText=ne.prototype.la,ne.prototype.send=ne.prototype.ea,ne.prototype.setWithCredentials=ne.prototype.Fa,Gu=ne}).apply(typeof hs<"u"?hs:typeof self<"u"?self:typeof window<"u"?window:{});class we{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}we.UNAUTHENTICATED=new we(null),we.GOOGLE_CREDENTIALS=new we("google-credentials-uid"),we.FIRST_PARTY=new we("first-party-uid"),we.MOCK_USER=new we("mock-user");let jn="12.8.0";function Pm(n){jn=n}const an=new xo("@firebase/firestore");function Tn(){return an.logLevel}function O(n,...e){if(an.logLevel<=j.DEBUG){const t=e.map(Bo);an.debug(`Firestore (${jn}): ${n}`,...t)}}function ht(n,...e){if(an.logLevel<=j.ERROR){const t=e.map(Bo);an.error(`Firestore (${jn}): ${n}`,...t)}}function Dn(n,...e){if(an.logLevel<=j.WARN){const t=e.map(Bo);an.warn(`Firestore (${jn}): ${n}`,...t)}}function Bo(n){if(typeof n=="string")return n;try{return(function(t){return JSON.stringify(t)})(n)}catch{return n}}function x(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,Yu(n,r,t)}function Yu(n,e,t){let r=`FIRESTORE (${jn}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw ht(r),new Error(r)}function Q(n,e,t,r){let s="Unexpected state";typeof t=="string"?s=t:r=t,n||Yu(e,s,r)}function B(n,e){return n}const b={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class D extends st{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class lt{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class Ju{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class km{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(we.UNAUTHENTICATED)))}shutdown(){}}class Nm{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class Dm{constructor(e){this.t=e,this.currentUser=we.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Q(this.o===void 0,42304);let r=this.i;const s=u=>this.i!==r?(r=this.i,t(u)):Promise.resolve();let i=new lt;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new lt,e.enqueueRetryable((()=>s(this.currentUser)))};const a=()=>{const u=i;e.enqueueRetryable((async()=>{await u.promise,await s(this.currentUser)}))},l=u=>{O("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit((u=>l(u))),setTimeout((()=>{if(!this.auth){const u=this.t.getImmediate({optional:!0});u?l(u):(O("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new lt)}}),0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((r=>this.i!==e?(O("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Q(typeof r.accessToken=="string",31837,{l:r}),new Ju(r.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Q(e===null||typeof e=="string",2055,{h:e}),new we(e)}}class Om{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=we.FIRST_PARTY,this.R=new Map}A(){return this.I?this.I():null}get headers(){this.R.set("X-Goog-AuthUser",this.P);const e=this.A();return e&&this.R.set("Authorization",e),this.T&&this.R.set("X-Goog-Iam-Authorization-Token",this.T),this.R}}class Vm{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new Om(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(we.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class zc{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Mm{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Fe(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){Q(this.o===void 0,3512);const r=i=>{i.error!=null&&O("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const a=i.token!==this.m;return this.m=i.token,O("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable((()=>r(i)))};const s=i=>{O("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((i=>s(i))),setTimeout((()=>{if(!this.appCheck){const i=this.V.getImmediate({optional:!0});i?s(i):O("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new zc(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((t=>t?(Q(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new zc(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function Lm(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}class $o{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const s=Lm(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<t&&(r+=e.charAt(s[i]%62))}return r}}function q(n,e){return n<e?-1:n>e?1:0}function ho(n,e){const t=Math.min(n.length,e.length);for(let r=0;r<t;r++){const s=n.charAt(r),i=e.charAt(r);if(s!==i)return Qi(s)===Qi(i)?q(s,i):Qi(s)?1:-1}return q(n.length,e.length)}const xm=55296,Fm=57343;function Qi(n){const e=n.charCodeAt(0);return e>=xm&&e<=Fm}function On(n,e,t){return n.length===e.length&&n.every(((r,s)=>t(r,e[s])))}const Kc="__name__";class Qe{constructor(e,t,r){t===void 0?t=0:t>e.length&&x(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&x(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return Qe.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Qe?e.forEach((r=>{t.push(r)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const i=Qe.compareSegments(e.get(s),t.get(s));if(i!==0)return i}return q(e.length,t.length)}static compareSegments(e,t){const r=Qe.isNumericId(e),s=Qe.isNumericId(t);return r&&!s?-1:!r&&s?1:r&&s?Qe.extractNumericId(e).compare(Qe.extractNumericId(t)):ho(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Vt.fromString(e.substring(4,e.length-2))}}class X extends Qe{construct(e,t,r){return new X(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new D(b.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter((s=>s.length>0)))}return new X(t)}static emptyPath(){return new X([])}}const Um=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Ee extends Qe{construct(e,t,r){return new Ee(e,t,r)}static isValidIdentifier(e){return Um.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Ee.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Kc}static keyField(){return new Ee([Kc])}static fromServerFormat(e){const t=[];let r="",s=0;const i=()=>{if(r.length===0)throw new D(b.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let a=!1;for(;s<e.length;){const l=e[s];if(l==="\\"){if(s+1===e.length)throw new D(b.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const u=e[s+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new D(b.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=u,s+=2}else l==="`"?(a=!a,s++):l!=="."||a?(r+=l,s++):(i(),s++)}if(i(),a)throw new D(b.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Ee(t)}static emptyPath(){return new Ee([])}}class L{constructor(e){this.path=e}static fromPath(e){return new L(X.fromString(e))}static fromName(e){return new L(X.fromString(e).popFirst(5))}static empty(){return new L(X.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&X.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return X.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new L(new X(e.slice()))}}function Xu(n,e,t){if(!t)throw new D(b.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function Bm(n,e,t,r){if(e===!0&&r===!0)throw new D(b.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function Qc(n){if(!L.isDocumentKey(n))throw new D(b.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Yc(n){if(L.isDocumentKey(n))throw new D(b.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Zu(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function Zs(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=(function(r){return r.constructor?r.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":x(12329,{type:typeof n})}function Ge(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new D(b.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Zs(n);throw new D(b.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function ce(n,e){const t={typeString:n};return e&&(t.value=e),t}function Ur(n,e){if(!Zu(n))throw new D(b.INVALID_ARGUMENT,"JSON must be an object");let t;for(const r in e)if(e[r]){const s=e[r].typeString,i="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}const a=n[r];if(s&&typeof a!==s){t=`JSON field '${r}' must be a ${s}.`;break}if(i!==void 0&&a!==i.value){t=`Expected '${r}' field to equal '${i.value}'`;break}}if(t)throw new D(b.INVALID_ARGUMENT,t);return!0}const Jc=-62135596800,Xc=1e6;class ee{static now(){return ee.fromMillis(Date.now())}static fromDate(e){return ee.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*Xc);return new ee(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new D(b.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new D(b.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<Jc)throw new D(b.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new D(b.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Xc}_compareTo(e){return this.seconds===e.seconds?q(this.nanoseconds,e.nanoseconds):q(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:ee._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Ur(e,ee._jsonSchema))return new ee(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-Jc;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}ee._jsonSchemaVersion="firestore/timestamp/1.0",ee._jsonSchema={type:ce("string",ee._jsonSchemaVersion),seconds:ce("number"),nanoseconds:ce("number")};class U{static fromTimestamp(e){return new U(e)}static min(){return new U(new ee(0,0))}static max(){return new U(new ee(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const Cr=-1;function $m(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=U.fromTimestamp(r===1e9?new ee(t+1,0):new ee(t,r));return new Ft(s,L.empty(),e)}function jm(n){return new Ft(n.readTime,n.key,Cr)}class Ft{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new Ft(U.min(),L.empty(),Cr)}static max(){return new Ft(U.max(),L.empty(),Cr)}}function qm(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=L.comparator(n.documentKey,e.documentKey),t!==0?t:q(n.largestBatchId,e.largestBatchId))}const Hm="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Gm{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function qn(n){if(n.code!==b.FAILED_PRECONDITION||n.message!==Hm)throw n;O("LocalStore","Unexpectedly lost primary lease")}class P{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&x(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new P(((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,s)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof P?t:P.resolve(t)}catch(t){return P.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):P.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):P.reject(t)}static resolve(e){return new P(((t,r)=>{t(e)}))}static reject(e){return new P(((t,r)=>{r(e)}))}static waitFor(e){return new P(((t,r)=>{let s=0,i=0,a=!1;e.forEach((l=>{++s,l.next((()=>{++i,a&&i===s&&t()}),(u=>r(u)))})),a=!0,i===s&&t()}))}static or(e){let t=P.resolve(!1);for(const r of e)t=t.next((s=>s?P.resolve(s):r()));return t}static forEach(e,t){const r=[];return e.forEach(((s,i)=>{r.push(t.call(this,s,i))})),this.waitFor(r)}static mapArray(e,t){return new P(((r,s)=>{const i=e.length,a=new Array(i);let l=0;for(let u=0;u<i;u++){const d=u;t(e[d]).next((f=>{a[d]=f,++l,l===i&&r(a)}),(f=>s(f)))}}))}static doWhile(e,t){return new P(((r,s)=>{const i=()=>{e()===!0?t().next((()=>{i()}),s):r()};i()}))}}function Wm(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function Hn(n){return n.name==="IndexedDbTransactionError"}class ei{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>t.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}ei.ce=-1;const jo=-1;function ti(n){return n==null}function Ns(n){return n===0&&1/n==-1/0}function zm(n){return typeof n=="number"&&Number.isInteger(n)&&!Ns(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}const eh="";function Km(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=Zc(e)),e=Qm(n.get(t),e);return Zc(e)}function Qm(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const i=n.charAt(s);switch(i){case"\0":t+="";break;case eh:t+="";break;default:t+=i}}return t}function Zc(n){return n+eh+""}function el(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Gt(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function th(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}class te{constructor(e,t){this.comparator=e,this.root=t||ye.EMPTY}insert(e,t){return new te(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,ye.BLACK,null,null))}remove(e){return new te(this.comparator,this.root.remove(e,this.comparator).copy(null,null,ye.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,r)=>(e(t,r),!1)))}toString(){const e=[];return this.inorderTraversal(((t,r)=>(e.push(`${t}:${r}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new ds(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new ds(this.root,e,this.comparator,!1)}getReverseIterator(){return new ds(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new ds(this.root,e,this.comparator,!0)}}class ds{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class ye{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??ye.RED,this.left=s??ye.EMPTY,this.right=i??ye.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,i){return new ye(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return ye.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return ye.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,ye.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,ye.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw x(43730,{key:this.key,value:this.value});if(this.right.isRed())throw x(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw x(27949);return e+(this.isRed()?0:1)}}ye.EMPTY=null,ye.RED=!0,ye.BLACK=!1;ye.EMPTY=new class{constructor(){this.size=0}get key(){throw x(57766)}get value(){throw x(16141)}get color(){throw x(16727)}get left(){throw x(29726)}get right(){throw x(36894)}copy(e,t,r,s,i){return this}insert(e,t,r){return new ye(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class fe{constructor(e){this.comparator=e,this.data=new te(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,r)=>(e(t),!1)))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new tl(this.data.getIterator())}getIteratorFrom(e){return new tl(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((r=>{t=t.add(r)})),t}isEqual(e){if(!(e instanceof fe)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new fe(this.comparator);return t.data=e,t}}class tl{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class xe{constructor(e){this.fields=e,e.sort(Ee.comparator)}static empty(){return new xe([])}unionWith(e){let t=new fe(Ee.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new xe(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return On(this.fields,e.fields,((t,r)=>t.isEqual(r)))}}class nh extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Ie{constructor(e){this.binaryString=e}static fromBase64String(e){const t=(function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new nh("Invalid base64 string: "+i):i}})(e);return new Ie(t)}static fromUint8Array(e){const t=(function(s){let i="";for(let a=0;a<s.length;++a)i+=String.fromCharCode(s[a]);return i})(e);return new Ie(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return q(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Ie.EMPTY_BYTE_STRING=new Ie("");const Ym=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ut(n){if(Q(!!n,39018),typeof n=="string"){let e=0;const t=Ym.exec(n);if(Q(!!t,46558,{timestamp:n}),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:re(n.seconds),nanos:re(n.nanos)}}function re(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Bt(n){return typeof n=="string"?Ie.fromBase64String(n):Ie.fromUint8Array(n)}const rh="server_timestamp",sh="__type__",ih="__previous_value__",oh="__local_write_time__";function qo(n){return(n?.mapValue?.fields||{})[sh]?.stringValue===rh}function ni(n){const e=n.mapValue.fields[ih];return qo(e)?ni(e):e}function br(n){const e=Ut(n.mapValue.fields[oh].timestampValue);return new ee(e.seconds,e.nanos)}class Jm{constructor(e,t,r,s,i,a,l,u,d,f,_){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=a,this.autoDetectLongPolling=l,this.longPollingOptions=u,this.useFetchStreams=d,this.isUsingEmulator=f,this.apiKey=_}}const Ds="(default)";class Pr{constructor(e,t){this.projectId=e,this.database=t||Ds}static empty(){return new Pr("","")}get isDefaultDatabase(){return this.database===Ds}isEqual(e){return e instanceof Pr&&e.projectId===this.projectId&&e.database===this.database}}function Xm(n,e){if(!Object.prototype.hasOwnProperty.apply(n.options,["projectId"]))throw new D(b.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Pr(n.options.projectId,e)}const ah="__type__",Zm="__max__",fs={mapValue:{}},ch="__vector__",Os="value";function $t(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?qo(n)?4:tg(n)?9007199254740991:eg(n)?10:11:x(28295,{value:n})}function nt(n,e){if(n===e)return!0;const t=$t(n);if(t!==$t(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return br(n).isEqual(br(e));case 3:return(function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const a=Ut(s.timestampValue),l=Ut(i.timestampValue);return a.seconds===l.seconds&&a.nanos===l.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(s,i){return Bt(s.bytesValue).isEqual(Bt(i.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(s,i){return re(s.geoPointValue.latitude)===re(i.geoPointValue.latitude)&&re(s.geoPointValue.longitude)===re(i.geoPointValue.longitude)})(n,e);case 2:return(function(s,i){if("integerValue"in s&&"integerValue"in i)return re(s.integerValue)===re(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const a=re(s.doubleValue),l=re(i.doubleValue);return a===l?Ns(a)===Ns(l):isNaN(a)&&isNaN(l)}return!1})(n,e);case 9:return On(n.arrayValue.values||[],e.arrayValue.values||[],nt);case 10:case 11:return(function(s,i){const a=s.mapValue.fields||{},l=i.mapValue.fields||{};if(el(a)!==el(l))return!1;for(const u in a)if(a.hasOwnProperty(u)&&(l[u]===void 0||!nt(a[u],l[u])))return!1;return!0})(n,e);default:return x(52216,{left:n})}}function kr(n,e){return(n.values||[]).find((t=>nt(t,e)))!==void 0}function Vn(n,e){if(n===e)return 0;const t=$t(n),r=$t(e);if(t!==r)return q(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return q(n.booleanValue,e.booleanValue);case 2:return(function(i,a){const l=re(i.integerValue||i.doubleValue),u=re(a.integerValue||a.doubleValue);return l<u?-1:l>u?1:l===u?0:isNaN(l)?isNaN(u)?0:-1:1})(n,e);case 3:return nl(n.timestampValue,e.timestampValue);case 4:return nl(br(n),br(e));case 5:return ho(n.stringValue,e.stringValue);case 6:return(function(i,a){const l=Bt(i),u=Bt(a);return l.compareTo(u)})(n.bytesValue,e.bytesValue);case 7:return(function(i,a){const l=i.split("/"),u=a.split("/");for(let d=0;d<l.length&&d<u.length;d++){const f=q(l[d],u[d]);if(f!==0)return f}return q(l.length,u.length)})(n.referenceValue,e.referenceValue);case 8:return(function(i,a){const l=q(re(i.latitude),re(a.latitude));return l!==0?l:q(re(i.longitude),re(a.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return rl(n.arrayValue,e.arrayValue);case 10:return(function(i,a){const l=i.fields||{},u=a.fields||{},d=l[Os]?.arrayValue,f=u[Os]?.arrayValue,_=q(d?.values?.length||0,f?.values?.length||0);return _!==0?_:rl(d,f)})(n.mapValue,e.mapValue);case 11:return(function(i,a){if(i===fs.mapValue&&a===fs.mapValue)return 0;if(i===fs.mapValue)return 1;if(a===fs.mapValue)return-1;const l=i.fields||{},u=Object.keys(l),d=a.fields||{},f=Object.keys(d);u.sort(),f.sort();for(let _=0;_<u.length&&_<f.length;++_){const g=ho(u[_],f[_]);if(g!==0)return g;const C=Vn(l[u[_]],d[f[_]]);if(C!==0)return C}return q(u.length,f.length)})(n.mapValue,e.mapValue);default:throw x(23264,{he:t})}}function nl(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return q(n,e);const t=Ut(n),r=Ut(e),s=q(t.seconds,r.seconds);return s!==0?s:q(t.nanos,r.nanos)}function rl(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const i=Vn(t[s],r[s]);if(i)return i}return q(t.length,r.length)}function Mn(n){return fo(n)}function fo(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(t){const r=Ut(t);return`time(${r.seconds},${r.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(t){return Bt(t).toBase64()})(n.bytesValue):"referenceValue"in n?(function(t){return L.fromName(t).toString()})(n.referenceValue):"geoPointValue"in n?(function(t){return`geo(${t.latitude},${t.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(t){let r="[",s=!0;for(const i of t.values||[])s?s=!1:r+=",",r+=fo(i);return r+"]"})(n.arrayValue):"mapValue"in n?(function(t){const r=Object.keys(t.fields||{}).sort();let s="{",i=!0;for(const a of r)i?i=!1:s+=",",s+=`${a}:${fo(t.fields[a])}`;return s+"}"})(n.mapValue):x(61005,{value:n})}function Es(n){switch($t(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=ni(n);return e?16+Es(e):16;case 5:return 2*n.stringValue.length;case 6:return Bt(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(r){return(r.values||[]).reduce(((s,i)=>s+Es(i)),0)})(n.arrayValue);case 10:case 11:return(function(r){let s=0;return Gt(r.fields,((i,a)=>{s+=i.length+Es(a)})),s})(n.mapValue);default:throw x(13486,{value:n})}}function sl(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function po(n){return!!n&&"integerValue"in n}function Ho(n){return!!n&&"arrayValue"in n}function il(n){return!!n&&"nullValue"in n}function ol(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Is(n){return!!n&&"mapValue"in n}function eg(n){return(n?.mapValue?.fields||{})[ah]?.stringValue===ch}function Er(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return Gt(n.mapValue.fields,((t,r)=>e.mapValue.fields[t]=Er(r))),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Er(n.arrayValue.values[t]);return e}return{...n}}function tg(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===Zm}class Oe{constructor(e){this.value=e}static empty(){return new Oe({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Is(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Er(t)}setAll(e){let t=Ee.emptyPath(),r={},s=[];e.forEach(((a,l)=>{if(!t.isImmediateParentOf(l)){const u=this.getFieldsMap(t);this.applyChanges(u,r,s),r={},s=[],t=l.popLast()}a?r[l.lastSegment()]=Er(a):s.push(l.lastSegment())}));const i=this.getFieldsMap(t);this.applyChanges(i,r,s)}delete(e){const t=this.field(e.popLast());Is(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return nt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];Is(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){Gt(t,((s,i)=>e[s]=i));for(const s of r)delete e[s]}clone(){return new Oe(Er(this.value))}}function lh(n){const e=[];return Gt(n.fields,((t,r)=>{const s=new Ee([t]);if(Is(r)){const i=lh(r.mapValue).fields;if(i.length===0)e.push(s);else for(const a of i)e.push(s.child(a))}else e.push(s)})),new xe(e)}class Ae{constructor(e,t,r,s,i,a,l){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=i,this.data=a,this.documentState=l}static newInvalidDocument(e){return new Ae(e,0,U.min(),U.min(),U.min(),Oe.empty(),0)}static newFoundDocument(e,t,r,s){return new Ae(e,1,t,U.min(),r,s,0)}static newNoDocument(e,t){return new Ae(e,2,t,U.min(),U.min(),Oe.empty(),0)}static newUnknownDocument(e,t){return new Ae(e,3,t,U.min(),U.min(),Oe.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(U.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Oe.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Oe.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=U.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Ae&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Ae(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Vs{constructor(e,t){this.position=e,this.inclusive=t}}function al(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const i=e[s],a=n.position[s];if(i.field.isKeyField()?r=L.comparator(L.fromName(a.referenceValue),t.key):r=Vn(a,t.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function cl(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!nt(n.position[t],e.position[t]))return!1;return!0}class Nr{constructor(e,t="asc"){this.field=e,this.dir=t}}function ng(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class uh{}class ae extends uh{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new sg(e,t,r):t==="array-contains"?new ag(e,r):t==="in"?new cg(e,r):t==="not-in"?new lg(e,r):t==="array-contains-any"?new ug(e,r):new ae(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new ig(e,r):new og(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(Vn(t,this.value)):t!==null&&$t(this.value)===$t(t)&&this.matchesComparison(Vn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return x(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class We extends uh{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new We(e,t)}matches(e){return hh(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function hh(n){return n.op==="and"}function dh(n){return rg(n)&&hh(n)}function rg(n){for(const e of n.filters)if(e instanceof We)return!1;return!0}function mo(n){if(n instanceof ae)return n.field.canonicalString()+n.op.toString()+Mn(n.value);if(dh(n))return n.filters.map((e=>mo(e))).join(",");{const e=n.filters.map((t=>mo(t))).join(",");return`${n.op}(${e})`}}function fh(n,e){return n instanceof ae?(function(r,s){return s instanceof ae&&r.op===s.op&&r.field.isEqual(s.field)&&nt(r.value,s.value)})(n,e):n instanceof We?(function(r,s){return s instanceof We&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce(((i,a,l)=>i&&fh(a,s.filters[l])),!0):!1})(n,e):void x(19439)}function ph(n){return n instanceof ae?(function(t){return`${t.field.canonicalString()} ${t.op} ${Mn(t.value)}`})(n):n instanceof We?(function(t){return t.op.toString()+" {"+t.getFilters().map(ph).join(" ,")+"}"})(n):"Filter"}class sg extends ae{constructor(e,t,r){super(e,t,r),this.key=L.fromName(r.referenceValue)}matches(e){const t=L.comparator(e.key,this.key);return this.matchesComparison(t)}}class ig extends ae{constructor(e,t){super(e,"in",t),this.keys=mh("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class og extends ae{constructor(e,t){super(e,"not-in",t),this.keys=mh("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function mh(n,e){return(e.arrayValue?.values||[]).map((t=>L.fromName(t.referenceValue)))}class ag extends ae{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Ho(t)&&kr(t.arrayValue,this.value)}}class cg extends ae{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&kr(this.value.arrayValue,t)}}class lg extends ae{constructor(e,t){super(e,"not-in",t)}matches(e){if(kr(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!kr(this.value.arrayValue,t)}}class ug extends ae{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Ho(t)||!t.arrayValue.values)&&t.arrayValue.values.some((r=>kr(this.value.arrayValue,r)))}}class hg{constructor(e,t=null,r=[],s=[],i=null,a=null,l=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=a,this.endAt=l,this.Te=null}}function ll(n,e=null,t=[],r=[],s=null,i=null,a=null){return new hg(n,e,t,r,s,i,a)}function Go(n){const e=B(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((r=>mo(r))).join(","),t+="|ob:",t+=e.orderBy.map((r=>(function(i){return i.field.canonicalString()+i.dir})(r))).join(","),ti(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((r=>Mn(r))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((r=>Mn(r))).join(",")),e.Te=t}return e.Te}function Wo(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!ng(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!fh(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!cl(n.startAt,e.startAt)&&cl(n.endAt,e.endAt)}function go(n){return L.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}class Gn{constructor(e,t=null,r=[],s=[],i=null,a="F",l=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=a,this.startAt=l,this.endAt=u,this.Ie=null,this.Ee=null,this.Re=null,this.startAt,this.endAt}}function dg(n,e,t,r,s,i,a,l){return new Gn(n,e,t,r,s,i,a,l)}function zo(n){return new Gn(n)}function ul(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function fg(n){return L.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function gh(n){return n.collectionGroup!==null}function Ir(n){const e=B(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const i of e.explicitOrderBy)e.Ie.push(i),t.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let l=new fe(Ee.comparator);return a.filters.forEach((u=>{u.getFlattenedFilters().forEach((d=>{d.isInequality()&&(l=l.add(d.field))}))})),l})(e).forEach((i=>{t.has(i.canonicalString())||i.isKeyField()||e.Ie.push(new Nr(i,r))})),t.has(Ee.keyField().canonicalString())||e.Ie.push(new Nr(Ee.keyField(),r))}return e.Ie}function Je(n){const e=B(n);return e.Ee||(e.Ee=pg(e,Ir(n))),e.Ee}function pg(n,e){if(n.limitType==="F")return ll(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map((s=>{const i=s.dir==="desc"?"asc":"desc";return new Nr(s.field,i)}));const t=n.endAt?new Vs(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Vs(n.startAt.position,n.startAt.inclusive):null;return ll(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function _o(n,e){const t=n.filters.concat([e]);return new Gn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function mg(n,e){const t=n.explicitOrderBy.concat([e]);return new Gn(n.path,n.collectionGroup,t,n.filters.slice(),n.limit,n.limitType,n.startAt,n.endAt)}function yo(n,e,t){return new Gn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function ri(n,e){return Wo(Je(n),Je(e))&&n.limitType===e.limitType}function _h(n){return`${Go(Je(n))}|lt:${n.limitType}`}function vn(n){return`Query(target=${(function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map((s=>ph(s))).join(", ")}]`),ti(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map((s=>(function(a){return`${a.field.canonicalString()} (${a.dir})`})(s))).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map((s=>Mn(s))).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map((s=>Mn(s))).join(",")),`Target(${r})`})(Je(n))}; limitType=${n.limitType})`}function si(n,e){return e.isFoundDocument()&&(function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):L.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)})(n,e)&&(function(r,s){for(const i of Ir(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0})(n,e)&&(function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0})(n,e)&&(function(r,s){return!(r.startAt&&!(function(a,l,u){const d=al(a,l,u);return a.inclusive?d<=0:d<0})(r.startAt,Ir(r),s)||r.endAt&&!(function(a,l,u){const d=al(a,l,u);return a.inclusive?d>=0:d>0})(r.endAt,Ir(r),s))})(n,e)}function gg(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function yh(n){return(e,t)=>{let r=!1;for(const s of Ir(n)){const i=_g(s,e,t);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function _g(n,e,t){const r=n.field.isKeyField()?L.comparator(e.key,t.key):(function(i,a,l){const u=a.data.field(i),d=l.data.field(i);return u!==null&&d!==null?Vn(u,d):x(42886)})(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return x(19790,{direction:n.dir})}}class dn{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){Gt(this.inner,((t,r)=>{for(const[s,i]of r)e(s,i)}))}isEmpty(){return th(this.inner)}size(){return this.innerSize}}const yg=new te(L.comparator);function dt(){return yg}const Eh=new te(L.comparator);function mr(...n){let e=Eh;for(const t of n)e=e.insert(t.key,t);return e}function Ih(n){let e=Eh;return n.forEach(((t,r)=>e=e.insert(t,r.overlayedDocument))),e}function en(){return Tr()}function Th(){return Tr()}function Tr(){return new dn((n=>n.toString()),((n,e)=>n.isEqual(e)))}const Eg=new te(L.comparator),Ig=new fe(L.comparator);function H(...n){let e=Ig;for(const t of n)e=e.add(t);return e}const Tg=new fe(q);function vg(){return Tg}function Ko(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ns(e)?"-0":e}}function vh(n){return{integerValue:""+n}}function wg(n,e){return zm(e)?vh(e):Ko(n,e)}class ii{constructor(){this._=void 0}}function Ag(n,e,t){return n instanceof Ms?(function(s,i){const a={fields:{[sh]:{stringValue:rh},[oh]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&qo(i)&&(i=ni(i)),i&&(a.fields[ih]=i),{mapValue:a}})(t,e):n instanceof Dr?Ah(n,e):n instanceof Or?Sh(n,e):(function(s,i){const a=wh(s,i),l=hl(a)+hl(s.Ae);return po(a)&&po(s.Ae)?vh(l):Ko(s.serializer,l)})(n,e)}function Sg(n,e,t){return n instanceof Dr?Ah(n,e):n instanceof Or?Sh(n,e):t}function wh(n,e){return n instanceof Ls?(function(r){return po(r)||(function(i){return!!i&&"doubleValue"in i})(r)})(e)?e:{integerValue:0}:null}class Ms extends ii{}class Dr extends ii{constructor(e){super(),this.elements=e}}function Ah(n,e){const t=Rh(e);for(const r of n.elements)t.some((s=>nt(s,r)))||t.push(r);return{arrayValue:{values:t}}}class Or extends ii{constructor(e){super(),this.elements=e}}function Sh(n,e){let t=Rh(e);for(const r of n.elements)t=t.filter((s=>!nt(s,r)));return{arrayValue:{values:t}}}class Ls extends ii{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function hl(n){return re(n.integerValue||n.doubleValue)}function Rh(n){return Ho(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function Rg(n,e){return n.field.isEqual(e.field)&&(function(r,s){return r instanceof Dr&&s instanceof Dr||r instanceof Or&&s instanceof Or?On(r.elements,s.elements,nt):r instanceof Ls&&s instanceof Ls?nt(r.Ae,s.Ae):r instanceof Ms&&s instanceof Ms})(n.transform,e.transform)}class Cg{constructor(e,t){this.version=e,this.transformResults=t}}class Be{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Be}static exists(e){return new Be(void 0,e)}static updateTime(e){return new Be(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Ts(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class oi{}function Ch(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Qo(n.key,Be.none()):new Br(n.key,n.data,Be.none());{const t=n.data,r=Oe.empty();let s=new fe(Ee.comparator);for(let i of e.fields)if(!s.has(i)){let a=t.field(i);a===null&&i.length>1&&(i=i.popLast(),a=t.field(i)),a===null?r.delete(i):r.set(i,a),s=s.add(i)}return new Wt(n.key,r,new xe(s.toArray()),Be.none())}}function bg(n,e,t){n instanceof Br?(function(s,i,a){const l=s.value.clone(),u=fl(s.fieldTransforms,i,a.transformResults);l.setAll(u),i.convertToFoundDocument(a.version,l).setHasCommittedMutations()})(n,e,t):n instanceof Wt?(function(s,i,a){if(!Ts(s.precondition,i))return void i.convertToUnknownDocument(a.version);const l=fl(s.fieldTransforms,i,a.transformResults),u=i.data;u.setAll(bh(s)),u.setAll(l),i.convertToFoundDocument(a.version,u).setHasCommittedMutations()})(n,e,t):(function(s,i,a){i.convertToNoDocument(a.version).setHasCommittedMutations()})(0,e,t)}function vr(n,e,t,r){return n instanceof Br?(function(i,a,l,u){if(!Ts(i.precondition,a))return l;const d=i.value.clone(),f=pl(i.fieldTransforms,u,a);return d.setAll(f),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),null})(n,e,t,r):n instanceof Wt?(function(i,a,l,u){if(!Ts(i.precondition,a))return l;const d=pl(i.fieldTransforms,u,a),f=a.data;return f.setAll(bh(i)),f.setAll(d),a.convertToFoundDocument(a.version,f).setHasLocalMutations(),l===null?null:l.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map((_=>_.field)))})(n,e,t,r):(function(i,a,l){return Ts(i.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):l})(n,e,t)}function Pg(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),i=wh(r.transform,s||null);i!=null&&(t===null&&(t=Oe.empty()),t.set(r.field,i))}return t||null}function dl(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!(function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&On(r,s,((i,a)=>Rg(i,a)))})(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class Br extends oi{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Wt extends oi{constructor(e,t,r,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function bh(n){const e=new Map;return n.fieldMask.fields.forEach((t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}})),e}function fl(n,e,t){const r=new Map;Q(n.length===t.length,32656,{Ve:t.length,de:n.length});for(let s=0;s<t.length;s++){const i=n[s],a=i.transform,l=e.data.field(i.field);r.set(i.field,Sg(a,l,t[s]))}return r}function pl(n,e,t){const r=new Map;for(const s of n){const i=s.transform,a=t.data.field(s.field);r.set(s.field,Ag(i,a,e))}return r}class Qo extends oi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class kg extends oi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Ng{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&bg(i,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=vr(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=vr(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=Th();return this.mutations.forEach((s=>{const i=e.get(s.key),a=i.overlayedDocument;let l=this.applyToLocalView(a,i.mutatedFields);l=t.has(s.key)?null:l;const u=Ch(a,l);u!==null&&r.set(s.key,u),a.isValidDocument()||a.convertToNoDocument(U.min())})),r}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),H())}isEqual(e){return this.batchId===e.batchId&&On(this.mutations,e.mutations,((t,r)=>dl(t,r)))&&On(this.baseMutations,e.baseMutations,((t,r)=>dl(t,r)))}}class Yo{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){Q(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let s=(function(){return Eg})();const i=e.mutations;for(let a=0;a<i.length;a++)s=s.insert(i[a].key,r[a].version);return new Yo(e,t,r,s)}}class Dg{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class Og{constructor(e,t){this.count=e,this.unchangedNames=t}}var ie,W;function Vg(n){switch(n){case b.OK:return x(64938);case b.CANCELLED:case b.UNKNOWN:case b.DEADLINE_EXCEEDED:case b.RESOURCE_EXHAUSTED:case b.INTERNAL:case b.UNAVAILABLE:case b.UNAUTHENTICATED:return!1;case b.INVALID_ARGUMENT:case b.NOT_FOUND:case b.ALREADY_EXISTS:case b.PERMISSION_DENIED:case b.FAILED_PRECONDITION:case b.ABORTED:case b.OUT_OF_RANGE:case b.UNIMPLEMENTED:case b.DATA_LOSS:return!0;default:return x(15467,{code:n})}}function Ph(n){if(n===void 0)return ht("GRPC error has no .code"),b.UNKNOWN;switch(n){case ie.OK:return b.OK;case ie.CANCELLED:return b.CANCELLED;case ie.UNKNOWN:return b.UNKNOWN;case ie.DEADLINE_EXCEEDED:return b.DEADLINE_EXCEEDED;case ie.RESOURCE_EXHAUSTED:return b.RESOURCE_EXHAUSTED;case ie.INTERNAL:return b.INTERNAL;case ie.UNAVAILABLE:return b.UNAVAILABLE;case ie.UNAUTHENTICATED:return b.UNAUTHENTICATED;case ie.INVALID_ARGUMENT:return b.INVALID_ARGUMENT;case ie.NOT_FOUND:return b.NOT_FOUND;case ie.ALREADY_EXISTS:return b.ALREADY_EXISTS;case ie.PERMISSION_DENIED:return b.PERMISSION_DENIED;case ie.FAILED_PRECONDITION:return b.FAILED_PRECONDITION;case ie.ABORTED:return b.ABORTED;case ie.OUT_OF_RANGE:return b.OUT_OF_RANGE;case ie.UNIMPLEMENTED:return b.UNIMPLEMENTED;case ie.DATA_LOSS:return b.DATA_LOSS;default:return x(39323,{code:n})}}(W=ie||(ie={}))[W.OK=0]="OK",W[W.CANCELLED=1]="CANCELLED",W[W.UNKNOWN=2]="UNKNOWN",W[W.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",W[W.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",W[W.NOT_FOUND=5]="NOT_FOUND",W[W.ALREADY_EXISTS=6]="ALREADY_EXISTS",W[W.PERMISSION_DENIED=7]="PERMISSION_DENIED",W[W.UNAUTHENTICATED=16]="UNAUTHENTICATED",W[W.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",W[W.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",W[W.ABORTED=10]="ABORTED",W[W.OUT_OF_RANGE=11]="OUT_OF_RANGE",W[W.UNIMPLEMENTED=12]="UNIMPLEMENTED",W[W.INTERNAL=13]="INTERNAL",W[W.UNAVAILABLE=14]="UNAVAILABLE",W[W.DATA_LOSS=15]="DATA_LOSS";function Mg(){return new TextEncoder}const Lg=new Vt([4294967295,4294967295],0);function ml(n){const e=Mg().encode(n),t=new Hu;return t.update(e),new Uint8Array(t.digest())}function gl(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new Vt([t,r],0),new Vt([s,i],0)]}class Jo{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new gr(`Invalid padding: ${t}`);if(r<0)throw new gr(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new gr(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new gr(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=Vt.fromNumber(this.ge)}ye(e,t,r){let s=e.add(t.multiply(Vt.fromNumber(r)));return s.compare(Lg)===1&&(s=new Vt([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=ml(e),[r,s]=gl(t);for(let i=0;i<this.hashCount;i++){const a=this.ye(r,s,i);if(!this.we(a))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),a=new Jo(i,s,t);return r.forEach((l=>a.insert(l))),a}insert(e){if(this.ge===0)return;const t=ml(e),[r,s]=gl(t);for(let i=0;i<this.hashCount;i++){const a=this.ye(r,s,i);this.be(a)}}be(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class gr extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class ai{constructor(e,t,r,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,$r.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new ai(U.min(),s,new te(q),dt(),H())}}class $r{constructor(e,t,r,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new $r(r,t,H(),H(),H())}}class vs{constructor(e,t,r,s){this.Se=e,this.removedTargetIds=t,this.key=r,this.De=s}}class kh{constructor(e,t){this.targetId=e,this.Ce=t}}class Nh{constructor(e,t,r=Ie.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class _l{constructor(){this.ve=0,this.Fe=yl(),this.Me=Ie.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=H(),t=H(),r=H();return this.Fe.forEach(((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:x(38017,{changeType:i})}})),new $r(this.Me,this.xe,e,t,r)}Ke(){this.Oe=!1,this.Fe=yl()}qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}Ue(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}$e(){this.ve+=1}We(){this.ve-=1,Q(this.ve>=0,3241,{ve:this.ve})}Qe(){this.Oe=!0,this.xe=!0}}class xg{constructor(e){this.Ge=e,this.ze=new Map,this.je=dt(),this.He=ps(),this.Je=ps(),this.Ze=new te(q)}Xe(e){for(const t of e.Se)e.De&&e.De.isFoundDocument()?this.Ye(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,(t=>{const r=this.nt(t);switch(e.state){case 0:this.rt(t)&&r.Le(e.resumeToken);break;case 1:r.We(),r.Ne||r.Ke(),r.Le(e.resumeToken);break;case 2:r.We(),r.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(r.Qe(),r.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),r.Le(e.resumeToken));break;default:x(56790,{state:e.state})}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach(((r,s)=>{this.rt(s)&&t(s)}))}st(e){const t=e.targetId,r=e.Ce.count,s=this.ot(t);if(s){const i=s.target;if(go(i))if(r===0){const a=new L(i.path);this.et(t,a,Ae.newNoDocument(a,U.min()))}else Q(r===1,20013,{expectedCount:r});else{const a=this._t(t);if(a!==r){const l=this.ut(e),u=l?this.ct(l,e,a):1;if(u!==0){this.it(t);const d=u===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ze=this.Ze.insert(t,d)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=t;let a,l;try{a=Bt(r).toUint8Array()}catch(u){if(u instanceof nh)return Dn("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{l=new Jo(a,s,i)}catch(u){return Dn(u instanceof gr?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return l.ge===0?null:l}ct(e,t,r){return t.Ce.count===r-this.Pt(e,t.targetId)?0:2}Pt(e,t){const r=this.Ge.getRemoteKeysForTarget(t);let s=0;return r.forEach((i=>{const a=this.Ge.ht(),l=`projects/${a.projectId}/databases/${a.database}/documents/${i.path.canonicalString()}`;e.mightContain(l)||(this.et(t,i,null),s++)})),s}Tt(e){const t=new Map;this.ze.forEach(((i,a)=>{const l=this.ot(a);if(l){if(i.current&&go(l.target)){const u=new L(l.target.path);this.It(u).has(a)||this.Et(a,u)||this.et(a,u,Ae.newNoDocument(u,e))}i.Be&&(t.set(a,i.ke()),i.Ke())}}));let r=H();this.Je.forEach(((i,a)=>{let l=!0;a.forEachWhile((u=>{const d=this.ot(u);return!d||d.purpose==="TargetPurposeLimboResolution"||(l=!1,!1)})),l&&(r=r.add(i))})),this.je.forEach(((i,a)=>a.setReadTime(e)));const s=new ai(e,t,this.Ze,this.je,r);return this.je=dt(),this.He=ps(),this.Je=ps(),this.Ze=new te(q),s}Ye(e,t){if(!this.rt(e))return;const r=this.Et(e,t.key)?2:0;this.nt(e).qe(t.key,r),this.je=this.je.insert(t.key,t),this.He=this.He.insert(t.key,this.It(t.key).add(e)),this.Je=this.Je.insert(t.key,this.Rt(t.key).add(e))}et(e,t,r){if(!this.rt(e))return;const s=this.nt(e);this.Et(e,t)?s.qe(t,1):s.Ue(t),this.Je=this.Je.insert(t,this.Rt(t).delete(e)),this.Je=this.Je.insert(t,this.Rt(t).add(e)),r&&(this.je=this.je.insert(t,r))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}$e(e){this.nt(e).$e()}nt(e){let t=this.ze.get(e);return t||(t=new _l,this.ze.set(e,t)),t}Rt(e){let t=this.Je.get(e);return t||(t=new fe(q),this.Je=this.Je.insert(e,t)),t}It(e){let t=this.He.get(e);return t||(t=new fe(q),this.He=this.He.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||O("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new _l),this.Ge.getRemoteKeysForTarget(e).forEach((t=>{this.et(e,t,null)}))}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function ps(){return new te(L.comparator)}function yl(){return new te(L.comparator)}const Fg={asc:"ASCENDING",desc:"DESCENDING"},Ug={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Bg={and:"AND",or:"OR"};class $g{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Eo(n,e){return n.useProto3Json||ti(e)?e:{value:e}}function xs(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Dh(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function jg(n,e){return xs(n,e.toTimestamp())}function Xe(n){return Q(!!n,49232),U.fromTimestamp((function(t){const r=Ut(t);return new ee(r.seconds,r.nanos)})(n))}function Xo(n,e){return Io(n,e).canonicalString()}function Io(n,e){const t=(function(s){return new X(["projects",s.projectId,"databases",s.database])})(n).child("documents");return e===void 0?t:t.child(e)}function Oh(n){const e=X.fromString(n);return Q(Fh(e),10190,{key:e.toString()}),e}function To(n,e){return Xo(n.databaseId,e.path)}function Yi(n,e){const t=Oh(e);if(t.get(1)!==n.databaseId.projectId)throw new D(b.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new D(b.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new L(Mh(t))}function Vh(n,e){return Xo(n.databaseId,e)}function qg(n){const e=Oh(n);return e.length===4?X.emptyPath():Mh(e)}function vo(n){return new X(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Mh(n){return Q(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function El(n,e,t){return{name:To(n,e),fields:t.value.mapValue.fields}}function Hg(n,e){let t;if("targetChange"in e){e.targetChange;const r=(function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:x(39313,{state:d})})(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=(function(d,f){return d.useProto3Json?(Q(f===void 0||typeof f=="string",58123),Ie.fromBase64String(f||"")):(Q(f===void 0||f instanceof Buffer||f instanceof Uint8Array,16193),Ie.fromUint8Array(f||new Uint8Array))})(n,e.targetChange.resumeToken),a=e.targetChange.cause,l=a&&(function(d){const f=d.code===void 0?b.UNKNOWN:Ph(d.code);return new D(f,d.message||"")})(a);t=new Nh(r,s,i,l||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=Yi(n,r.document.name),i=Xe(r.document.updateTime),a=r.document.createTime?Xe(r.document.createTime):U.min(),l=new Oe({mapValue:{fields:r.document.fields}}),u=Ae.newFoundDocument(s,i,a,l),d=r.targetIds||[],f=r.removedTargetIds||[];t=new vs(d,f,u.key,u)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=Yi(n,r.document),i=r.readTime?Xe(r.readTime):U.min(),a=Ae.newNoDocument(s,i),l=r.removedTargetIds||[];t=new vs([],l,a.key,a)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=Yi(n,r.document),i=r.removedTargetIds||[];t=new vs([],i,s,null)}else{if(!("filter"in e))return x(11601,{Vt:e});{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,a=new Og(s,i),l=r.targetId;t=new kh(l,a)}}return t}function Gg(n,e){let t;if(e instanceof Br)t={update:El(n,e.key,e.value)};else if(e instanceof Qo)t={delete:To(n,e.key)};else if(e instanceof Wt)t={update:El(n,e.key,e.data),updateMask:e_(e.fieldMask)};else{if(!(e instanceof kg))return x(16599,{dt:e.type});t={verify:To(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map((r=>(function(i,a){const l=a.transform;if(l instanceof Ms)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(l instanceof Dr)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:l.elements}};if(l instanceof Or)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:l.elements}};if(l instanceof Ls)return{fieldPath:a.field.canonicalString(),increment:l.Ae};throw x(20930,{transform:a.transform})})(0,r)))),e.precondition.isNone||(t.currentDocument=(function(s,i){return i.updateTime!==void 0?{updateTime:jg(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:x(27497)})(n,e.precondition)),t}function Wg(n,e){return n&&n.length>0?(Q(e!==void 0,14353),n.map((t=>(function(s,i){let a=s.updateTime?Xe(s.updateTime):Xe(i);return a.isEqual(U.min())&&(a=Xe(i)),new Cg(a,s.transformResults||[])})(t,e)))):[]}function zg(n,e){return{documents:[Vh(n,e.path)]}}function Kg(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=Vh(n,s);const i=(function(d){if(d.length!==0)return xh(We.create(d,"and"))})(e.filters);i&&(t.structuredQuery.where=i);const a=(function(d){if(d.length!==0)return d.map((f=>(function(g){return{field:wn(g.field),direction:Jg(g.dir)}})(f)))})(e.orderBy);a&&(t.structuredQuery.orderBy=a);const l=Eo(n,e.limit);return l!==null&&(t.structuredQuery.limit=l),e.startAt&&(t.structuredQuery.startAt=(function(d){return{before:d.inclusive,values:d.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(d){return{before:!d.inclusive,values:d.position}})(e.endAt)),{ft:t,parent:s}}function Qg(n){let e=qg(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){Q(r===1,65062);const f=t.from[0];f.allDescendants?s=f.collectionId:e=e.child(f.collectionId)}let i=[];t.where&&(i=(function(_){const g=Lh(_);return g instanceof We&&dh(g)?g.getFilters():[g]})(t.where));let a=[];t.orderBy&&(a=(function(_){return _.map((g=>(function(k){return new Nr(An(k.field),(function(M){switch(M){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(k.direction))})(g)))})(t.orderBy));let l=null;t.limit&&(l=(function(_){let g;return g=typeof _=="object"?_.value:_,ti(g)?null:g})(t.limit));let u=null;t.startAt&&(u=(function(_){const g=!!_.before,C=_.values||[];return new Vs(C,g)})(t.startAt));let d=null;return t.endAt&&(d=(function(_){const g=!_.before,C=_.values||[];return new Vs(C,g)})(t.endAt)),dg(e,s,a,i,l,"F",u,d)}function Yg(n,e){const t=(function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return x(28987,{purpose:s})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function Lh(n){return n.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=An(t.unaryFilter.field);return ae.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=An(t.unaryFilter.field);return ae.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=An(t.unaryFilter.field);return ae.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=An(t.unaryFilter.field);return ae.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return x(61313);default:return x(60726)}})(n):n.fieldFilter!==void 0?(function(t){return ae.create(An(t.fieldFilter.field),(function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return x(58110);default:return x(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(t){return We.create(t.compositeFilter.filters.map((r=>Lh(r))),(function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return x(1026)}})(t.compositeFilter.op))})(n):x(30097,{filter:n})}function Jg(n){return Fg[n]}function Xg(n){return Ug[n]}function Zg(n){return Bg[n]}function wn(n){return{fieldPath:n.canonicalString()}}function An(n){return Ee.fromServerFormat(n.fieldPath)}function xh(n){return n instanceof ae?(function(t){if(t.op==="=="){if(ol(t.value))return{unaryFilter:{field:wn(t.field),op:"IS_NAN"}};if(il(t.value))return{unaryFilter:{field:wn(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(ol(t.value))return{unaryFilter:{field:wn(t.field),op:"IS_NOT_NAN"}};if(il(t.value))return{unaryFilter:{field:wn(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:wn(t.field),op:Xg(t.op),value:t.value}}})(n):n instanceof We?(function(t){const r=t.getFilters().map((s=>xh(s)));return r.length===1?r[0]:{compositeFilter:{op:Zg(t.op),filters:r}}})(n):x(54877,{filter:n})}function e_(n){const e=[];return n.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function Fh(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}function Uh(n){return!!n&&typeof n._toProto=="function"&&n._protoValueType==="ProtoValue"}class bt{constructor(e,t,r,s,i=U.min(),a=U.min(),l=Ie.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=l,this.expectedCount=u}withSequenceNumber(e){return new bt(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new bt(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new bt(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new bt(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class t_{constructor(e){this.yt=e}}function n_(n){const e=Qg({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?yo(e,e.limit,"L"):e}class r_{constructor(){this.Sn=new s_}addToCollectionParentIndex(e,t){return this.Sn.add(t),P.resolve()}getCollectionParents(e,t){return P.resolve(this.Sn.getEntries(t))}addFieldIndex(e,t){return P.resolve()}deleteFieldIndex(e,t){return P.resolve()}deleteAllFieldIndexes(e){return P.resolve()}createTargetIndexes(e,t){return P.resolve()}getDocumentsMatchingTarget(e,t){return P.resolve(null)}getIndexType(e,t){return P.resolve(0)}getFieldIndexes(e,t){return P.resolve([])}getNextCollectionGroupToUpdate(e){return P.resolve(null)}getMinOffset(e,t){return P.resolve(Ft.min())}getMinOffsetFromCollectionGroup(e,t){return P.resolve(Ft.min())}updateCollectionGroup(e,t,r){return P.resolve()}updateIndexEntries(e,t){return P.resolve()}}class s_{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new fe(X.comparator),i=!s.has(r);return this.index[t]=s.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new fe(X.comparator)).toArray()}}const Il={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Bh=41943040;class De{static withCacheSize(e){return new De(e,De.DEFAULT_COLLECTION_PERCENTILE,De.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}De.DEFAULT_COLLECTION_PERCENTILE=10,De.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,De.DEFAULT=new De(Bh,De.DEFAULT_COLLECTION_PERCENTILE,De.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),De.DISABLED=new De(-1,0,0);class Ln{constructor(e){this.sr=e}next(){return this.sr+=2,this.sr}static _r(){return new Ln(0)}static ar(){return new Ln(-1)}}const Tl="LruGarbageCollector",i_=1048576;function vl([n,e],[t,r]){const s=q(n,t);return s===0?q(e,r):s}class o_{constructor(e){this.Pr=e,this.buffer=new fe(vl),this.Tr=0}Ir(){return++this.Tr}Er(e){const t=[e,this.Ir()];if(this.buffer.size<this.Pr)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();vl(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class a_{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Ar(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Ar(e){O(Tl,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Hn(t)?O(Tl,"Ignoring IndexedDB error during garbage collection: ",t):await qn(t)}await this.Ar(3e5)}))}}class c_{constructor(e,t){this.Vr=e,this.params=t}calculateTargetCount(e,t){return this.Vr.dr(e).next((r=>Math.floor(t/100*r)))}nthSequenceNumber(e,t){if(t===0)return P.resolve(ei.ce);const r=new o_(t);return this.Vr.forEachTarget(e,(s=>r.Er(s.sequenceNumber))).next((()=>this.Vr.mr(e,(s=>r.Er(s))))).next((()=>r.maxValue))}removeTargets(e,t,r){return this.Vr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Vr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(O("LruGarbageCollector","Garbage collection skipped; disabled"),P.resolve(Il)):this.getCacheSize(e).next((r=>r<this.params.cacheSizeCollectionThreshold?(O("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Il):this.gr(e,t)))}getCacheSize(e){return this.Vr.getCacheSize(e)}gr(e,t){let r,s,i,a,l,u,d;const f=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((_=>(_>this.params.maximumSequenceNumbersToCollect?(O("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${_}`),s=this.params.maximumSequenceNumbersToCollect):s=_,a=Date.now(),this.nthSequenceNumber(e,s)))).next((_=>(r=_,l=Date.now(),this.removeTargets(e,r,t)))).next((_=>(i=_,u=Date.now(),this.removeOrphanedDocuments(e,r)))).next((_=>(d=Date.now(),Tn()<=j.DEBUG&&O("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-f}ms
	Determined least recently used ${s} in `+(l-a)+`ms
	Removed ${i} targets in `+(u-l)+`ms
	Removed ${_} documents in `+(d-u)+`ms
Total Duration: ${d-f}ms`),P.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:_}))))}}function l_(n,e){return new c_(n,e)}class u_{constructor(){this.changes=new dn((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Ae.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?P.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class h_{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class d_{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next((s=>(r=s,this.remoteDocumentCache.getEntry(e,t)))).next((s=>(r!==null&&vr(r.mutation,s,xe.empty(),ee.now()),s)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((r=>this.getLocalViewOfDocuments(e,r,H()).next((()=>r))))}getLocalViewOfDocuments(e,t,r=H()){const s=en();return this.populateOverlays(e,s,t).next((()=>this.computeViews(e,t,s,r).next((i=>{let a=mr();return i.forEach(((l,u)=>{a=a.insert(l,u.overlayedDocument)})),a}))))}getOverlayedDocuments(e,t){const r=en();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,H())))}populateOverlays(e,t,r){const s=[];return r.forEach((i=>{t.has(i)||s.push(i)})),this.documentOverlayCache.getOverlays(e,s).next((i=>{i.forEach(((a,l)=>{t.set(a,l)}))}))}computeViews(e,t,r,s){let i=dt();const a=Tr(),l=(function(){return Tr()})();return t.forEach(((u,d)=>{const f=r.get(d.key);s.has(d.key)&&(f===void 0||f.mutation instanceof Wt)?i=i.insert(d.key,d):f!==void 0?(a.set(d.key,f.mutation.getFieldMask()),vr(f.mutation,d,f.mutation.getFieldMask(),ee.now())):a.set(d.key,xe.empty())})),this.recalculateAndSaveOverlays(e,i).next((u=>(u.forEach(((d,f)=>a.set(d,f))),t.forEach(((d,f)=>l.set(d,new h_(f,a.get(d)??null)))),l)))}recalculateAndSaveOverlays(e,t){const r=Tr();let s=new te(((a,l)=>a-l)),i=H();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((a=>{for(const l of a)l.keys().forEach((u=>{const d=t.get(u);if(d===null)return;let f=r.get(u)||xe.empty();f=l.applyToLocalView(d,f),r.set(u,f);const _=(s.get(l.batchId)||H()).add(u);s=s.insert(l.batchId,_)}))})).next((()=>{const a=[],l=s.getReverseIterator();for(;l.hasNext();){const u=l.getNext(),d=u.key,f=u.value,_=Th();f.forEach((g=>{if(!i.has(g)){const C=Ch(t.get(g),r.get(g));C!==null&&_.set(g,C),i=i.add(g)}})),a.push(this.documentOverlayCache.saveOverlays(e,d,_))}return P.waitFor(a)})).next((()=>r))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((r=>this.recalculateAndSaveOverlays(e,r)))}getDocumentsMatchingQuery(e,t,r,s){return fg(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):gh(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next((i=>{const a=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-i.size):P.resolve(en());let l=Cr,u=i;return a.next((d=>P.forEach(d,((f,_)=>(l<_.largestBatchId&&(l=_.largestBatchId),i.get(f)?P.resolve():this.remoteDocumentCache.getEntry(e,f).next((g=>{u=u.insert(f,g)}))))).next((()=>this.populateOverlays(e,d,i))).next((()=>this.computeViews(e,u,d,H()))).next((f=>({batchId:l,changes:Ih(f)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new L(t)).next((r=>{let s=mr();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s}))}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const i=t.collectionGroup;let a=mr();return this.indexManager.getCollectionParents(e,i).next((l=>P.forEach(l,(u=>{const d=(function(_,g){return new Gn(g,null,_.explicitOrderBy.slice(),_.filters.slice(),_.limit,_.limitType,_.startAt,_.endAt)})(t,u.child(i));return this.getDocumentsMatchingCollectionQuery(e,d,r,s).next((f=>{f.forEach(((_,g)=>{a=a.insert(_,g)}))}))})).next((()=>a))))}getDocumentsMatchingCollectionQuery(e,t,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next((a=>(i=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,s)))).next((a=>{i.forEach(((u,d)=>{const f=d.getKey();a.get(f)===null&&(a=a.insert(f,Ae.newInvalidDocument(f)))}));let l=mr();return a.forEach(((u,d)=>{const f=i.get(u);f!==void 0&&vr(f.mutation,d,xe.empty(),ee.now()),si(t,d)&&(l=l.insert(u,d))})),l}))}}class f_{constructor(e){this.serializer=e,this.Nr=new Map,this.Br=new Map}getBundleMetadata(e,t){return P.resolve(this.Nr.get(t))}saveBundleMetadata(e,t){return this.Nr.set(t.id,(function(s){return{id:s.id,version:s.version,createTime:Xe(s.createTime)}})(t)),P.resolve()}getNamedQuery(e,t){return P.resolve(this.Br.get(t))}saveNamedQuery(e,t){return this.Br.set(t.name,(function(s){return{name:s.name,query:n_(s.bundledQuery),readTime:Xe(s.readTime)}})(t)),P.resolve()}}class p_{constructor(){this.overlays=new te(L.comparator),this.Lr=new Map}getOverlay(e,t){return P.resolve(this.overlays.get(t))}getOverlays(e,t){const r=en();return P.forEach(t,(s=>this.getOverlay(e,s).next((i=>{i!==null&&r.set(s,i)})))).next((()=>r))}saveOverlays(e,t,r){return r.forEach(((s,i)=>{this.bt(e,t,i)})),P.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.Lr.get(r);return s!==void 0&&(s.forEach((i=>this.overlays=this.overlays.remove(i))),this.Lr.delete(r)),P.resolve()}getOverlaysForCollection(e,t,r){const s=en(),i=t.length+1,a=new L(t.child("")),l=this.overlays.getIteratorFrom(a);for(;l.hasNext();){const u=l.getNext().value,d=u.getKey();if(!t.isPrefixOf(d.path))break;d.path.length===i&&u.largestBatchId>r&&s.set(u.getKey(),u)}return P.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let i=new te(((d,f)=>d-f));const a=this.overlays.getIterator();for(;a.hasNext();){const d=a.getNext().value;if(d.getKey().getCollectionGroup()===t&&d.largestBatchId>r){let f=i.get(d.largestBatchId);f===null&&(f=en(),i=i.insert(d.largestBatchId,f)),f.set(d.getKey(),d)}}const l=en(),u=i.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach(((d,f)=>l.set(d,f))),!(l.size()>=s)););return P.resolve(l)}bt(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const a=this.Lr.get(s.largestBatchId).delete(r.key);this.Lr.set(s.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new Dg(t,r));let i=this.Lr.get(t);i===void 0&&(i=H(),this.Lr.set(t,i)),this.Lr.set(t,i.add(r.key))}}class m_{constructor(){this.sessionToken=Ie.EMPTY_BYTE_STRING}getSessionToken(e){return P.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,P.resolve()}}class Zo{constructor(){this.kr=new fe(ge.Kr),this.qr=new fe(ge.Ur)}isEmpty(){return this.kr.isEmpty()}addReference(e,t){const r=new ge(e,t);this.kr=this.kr.add(r),this.qr=this.qr.add(r)}$r(e,t){e.forEach((r=>this.addReference(r,t)))}removeReference(e,t){this.Wr(new ge(e,t))}Qr(e,t){e.forEach((r=>this.removeReference(r,t)))}Gr(e){const t=new L(new X([])),r=new ge(t,e),s=new ge(t,e+1),i=[];return this.qr.forEachInRange([r,s],(a=>{this.Wr(a),i.push(a.key)})),i}zr(){this.kr.forEach((e=>this.Wr(e)))}Wr(e){this.kr=this.kr.delete(e),this.qr=this.qr.delete(e)}jr(e){const t=new L(new X([])),r=new ge(t,e),s=new ge(t,e+1);let i=H();return this.qr.forEachInRange([r,s],(a=>{i=i.add(a.key)})),i}containsKey(e){const t=new ge(e,0),r=this.kr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class ge{constructor(e,t){this.key=e,this.Hr=t}static Kr(e,t){return L.comparator(e.key,t.key)||q(e.Hr,t.Hr)}static Ur(e,t){return q(e.Hr,t.Hr)||L.comparator(e.key,t.key)}}class g_{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Yn=1,this.Jr=new fe(ge.Kr)}checkEmpty(e){return P.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const i=this.Yn;this.Yn++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new Ng(i,t,r,s);this.mutationQueue.push(a);for(const l of s)this.Jr=this.Jr.add(new ge(l.key,i)),this.indexManager.addToCollectionParentIndex(e,l.key.path.popLast());return P.resolve(a)}lookupMutationBatch(e,t){return P.resolve(this.Zr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.Xr(r),i=s<0?0:s;return P.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return P.resolve(this.mutationQueue.length===0?jo:this.Yn-1)}getAllMutationBatches(e){return P.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new ge(t,0),s=new ge(t,Number.POSITIVE_INFINITY),i=[];return this.Jr.forEachInRange([r,s],(a=>{const l=this.Zr(a.Hr);i.push(l)})),P.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new fe(q);return t.forEach((s=>{const i=new ge(s,0),a=new ge(s,Number.POSITIVE_INFINITY);this.Jr.forEachInRange([i,a],(l=>{r=r.add(l.Hr)}))})),P.resolve(this.Yr(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let i=r;L.isDocumentKey(i)||(i=i.child(""));const a=new ge(new L(i),0);let l=new fe(q);return this.Jr.forEachWhile((u=>{const d=u.key.path;return!!r.isPrefixOf(d)&&(d.length===s&&(l=l.add(u.Hr)),!0)}),a),P.resolve(this.Yr(l))}Yr(e){const t=[];return e.forEach((r=>{const s=this.Zr(r);s!==null&&t.push(s)})),t}removeMutationBatch(e,t){Q(this.ei(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Jr;return P.forEach(t.mutations,(s=>{const i=new ge(s.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)})).next((()=>{this.Jr=r}))}nr(e){}containsKey(e,t){const r=new ge(t,0),s=this.Jr.firstAfterOrEqual(r);return P.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,P.resolve()}ei(e,t){return this.Xr(e)}Xr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Zr(e){const t=this.Xr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class __{constructor(e){this.ti=e,this.docs=(function(){return new te(L.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),i=s?s.size:0,a=this.ti(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:a}),this.size+=a-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return P.resolve(r?r.document.mutableCopy():Ae.newInvalidDocument(t))}getEntries(e,t){let r=dt();return t.forEach((s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():Ae.newInvalidDocument(s))})),P.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let i=dt();const a=t.path,l=new L(a.child("__id-9223372036854775808__")),u=this.docs.getIteratorFrom(l);for(;u.hasNext();){const{key:d,value:{document:f}}=u.getNext();if(!a.isPrefixOf(d.path))break;d.path.length>a.length+1||qm(jm(f),r)<=0||(s.has(f.key)||si(t,f))&&(i=i.insert(f.key,f.mutableCopy()))}return P.resolve(i)}getAllFromCollectionGroup(e,t,r,s){x(9500)}ni(e,t){return P.forEach(this.docs,(r=>t(r)))}newChangeBuffer(e){return new y_(this)}getSize(e){return P.resolve(this.size)}}class y_ extends u_{constructor(e){super(),this.Mr=e}applyChanges(e){const t=[];return this.changes.forEach(((r,s)=>{s.isValidDocument()?t.push(this.Mr.addEntry(e,s)):this.Mr.removeEntry(r)})),P.waitFor(t)}getFromCache(e,t){return this.Mr.getEntry(e,t)}getAllFromCache(e,t){return this.Mr.getEntries(e,t)}}class E_{constructor(e){this.persistence=e,this.ri=new dn((t=>Go(t)),Wo),this.lastRemoteSnapshotVersion=U.min(),this.highestTargetId=0,this.ii=0,this.si=new Zo,this.targetCount=0,this.oi=Ln._r()}forEachTarget(e,t){return this.ri.forEach(((r,s)=>t(s))),P.resolve()}getLastRemoteSnapshotVersion(e){return P.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return P.resolve(this.ii)}allocateTargetId(e){return this.highestTargetId=this.oi.next(),P.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.ii&&(this.ii=t),P.resolve()}lr(e){this.ri.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.oi=new Ln(t),this.highestTargetId=t),e.sequenceNumber>this.ii&&(this.ii=e.sequenceNumber)}addTargetData(e,t){return this.lr(t),this.targetCount+=1,P.resolve()}updateTargetData(e,t){return this.lr(t),P.resolve()}removeTargetData(e,t){return this.ri.delete(t.target),this.si.Gr(t.targetId),this.targetCount-=1,P.resolve()}removeTargets(e,t,r){let s=0;const i=[];return this.ri.forEach(((a,l)=>{l.sequenceNumber<=t&&r.get(l.targetId)===null&&(this.ri.delete(a),i.push(this.removeMatchingKeysForTargetId(e,l.targetId)),s++)})),P.waitFor(i).next((()=>s))}getTargetCount(e){return P.resolve(this.targetCount)}getTargetData(e,t){const r=this.ri.get(t)||null;return P.resolve(r)}addMatchingKeys(e,t,r){return this.si.$r(t,r),P.resolve()}removeMatchingKeys(e,t,r){this.si.Qr(t,r);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach((a=>{i.push(s.markPotentiallyOrphaned(e,a))})),P.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.si.Gr(t),P.resolve()}getMatchingKeysForTargetId(e,t){const r=this.si.jr(t);return P.resolve(r)}containsKey(e,t){return P.resolve(this.si.containsKey(t))}}class $h{constructor(e,t){this._i={},this.overlays={},this.ai=new ei(0),this.ui=!1,this.ui=!0,this.ci=new m_,this.referenceDelegate=e(this),this.li=new E_(this),this.indexManager=new r_,this.remoteDocumentCache=(function(s){return new __(s)})((r=>this.referenceDelegate.hi(r))),this.serializer=new t_(t),this.Pi=new f_(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ui=!1,Promise.resolve()}get started(){return this.ui}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new p_,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this._i[e.toKey()];return r||(r=new g_(t,this.referenceDelegate),this._i[e.toKey()]=r),r}getGlobalsCache(){return this.ci}getTargetCache(){return this.li}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Pi}runTransaction(e,t,r){O("MemoryPersistence","Starting transaction:",e);const s=new I_(this.ai.next());return this.referenceDelegate.Ti(),r(s).next((i=>this.referenceDelegate.Ii(s).next((()=>i)))).toPromise().then((i=>(s.raiseOnCommittedEvent(),i)))}Ei(e,t){return P.or(Object.values(this._i).map((r=>()=>r.containsKey(e,t))))}}class I_ extends Gm{constructor(e){super(),this.currentSequenceNumber=e}}class ea{constructor(e){this.persistence=e,this.Ri=new Zo,this.Ai=null}static Vi(e){return new ea(e)}get di(){if(this.Ai)return this.Ai;throw x(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.di.delete(r.toString()),P.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.di.add(r.toString()),P.resolve()}markPotentiallyOrphaned(e,t){return this.di.add(t.toString()),P.resolve()}removeTarget(e,t){this.Ri.Gr(t.targetId).forEach((s=>this.di.add(s.toString())));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next((s=>{s.forEach((i=>this.di.add(i.toString())))})).next((()=>r.removeTargetData(e,t)))}Ti(){this.Ai=new Set}Ii(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return P.forEach(this.di,(r=>{const s=L.fromPath(r);return this.mi(e,s).next((i=>{i||t.removeEntry(s,U.min())}))})).next((()=>(this.Ai=null,t.apply(e))))}updateLimboDocument(e,t){return this.mi(e,t).next((r=>{r?this.di.delete(t.toString()):this.di.add(t.toString())}))}hi(e){return 0}mi(e,t){return P.or([()=>P.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ei(e,t)])}}class Fs{constructor(e,t){this.persistence=e,this.fi=new dn((r=>Km(r.path)),((r,s)=>r.isEqual(s))),this.garbageCollector=l_(this,t)}static Vi(e,t){return new Fs(e,t)}Ti(){}Ii(e){return P.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}dr(e){const t=this.pr(e);return this.persistence.getTargetCache().getTargetCount(e).next((r=>t.next((s=>r+s))))}pr(e){let t=0;return this.mr(e,(r=>{t++})).next((()=>t))}mr(e,t){return P.forEach(this.fi,((r,s)=>this.wr(e,r,s).next((i=>i?P.resolve():t(s)))))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.ni(e,(a=>this.wr(e,a,t).next((l=>{l||(r++,i.removeEntry(a,U.min()))})))).next((()=>i.apply(e))).next((()=>r))}markPotentiallyOrphaned(e,t){return this.fi.set(t,e.currentSequenceNumber),P.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.fi.set(r,e.currentSequenceNumber),P.resolve()}removeReference(e,t,r){return this.fi.set(r,e.currentSequenceNumber),P.resolve()}updateLimboDocument(e,t){return this.fi.set(t,e.currentSequenceNumber),P.resolve()}hi(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Es(e.data.value)),t}wr(e,t,r){return P.or([()=>this.persistence.Ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.fi.get(t);return P.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class ta{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.Ts=r,this.Is=s}static Es(e,t){let r=H(),s=H();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new ta(e,t.fromCache,r,s)}}class T_{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class v_{constructor(){this.Rs=!1,this.As=!1,this.Vs=100,this.ds=(function(){return lp()?8:Wm(Re())>0?6:4})()}initialize(e,t){this.fs=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,r,s){const i={result:null};return this.gs(e,t).next((a=>{i.result=a})).next((()=>{if(!i.result)return this.ps(e,t,s,r).next((a=>{i.result=a}))})).next((()=>{if(i.result)return;const a=new T_;return this.ys(e,t,a).next((l=>{if(i.result=l,this.As)return this.ws(e,t,a,l.size)}))})).next((()=>i.result))}ws(e,t,r,s){return r.documentReadCount<this.Vs?(Tn()<=j.DEBUG&&O("QueryEngine","SDK will not create cache indexes for query:",vn(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),P.resolve()):(Tn()<=j.DEBUG&&O("QueryEngine","Query:",vn(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.ds*s?(Tn()<=j.DEBUG&&O("QueryEngine","The SDK decides to create cache indexes for query:",vn(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Je(t))):P.resolve())}gs(e,t){if(ul(t))return P.resolve(null);let r=Je(t);return this.indexManager.getIndexType(e,r).next((s=>s===0?null:(t.limit!==null&&s===1&&(t=yo(t,null,"F"),r=Je(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next((i=>{const a=H(...i);return this.fs.getDocuments(e,a).next((l=>this.indexManager.getMinOffset(e,r).next((u=>{const d=this.bs(t,l);return this.Ss(t,d,a,u.readTime)?this.gs(e,yo(t,null,"F")):this.Ds(e,d,t,u)}))))})))))}ps(e,t,r,s){return ul(t)||s.isEqual(U.min())?P.resolve(null):this.fs.getDocuments(e,r).next((i=>{const a=this.bs(t,i);return this.Ss(t,a,r,s)?P.resolve(null):(Tn()<=j.DEBUG&&O("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),vn(t)),this.Ds(e,a,t,$m(s,Cr)).next((l=>l)))}))}bs(e,t){let r=new fe(yh(e));return t.forEach(((s,i)=>{si(e,i)&&(r=r.add(i))})),r}Ss(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}ys(e,t,r){return Tn()<=j.DEBUG&&O("QueryEngine","Using full collection scan to execute query:",vn(t)),this.fs.getDocumentsMatchingQuery(e,t,Ft.min(),r)}Ds(e,t,r,s){return this.fs.getDocumentsMatchingQuery(e,r,s).next((i=>(t.forEach((a=>{i=i.insert(a.key,a)})),i)))}}const na="LocalStore",w_=3e8;class A_{constructor(e,t,r,s){this.persistence=e,this.Cs=t,this.serializer=s,this.vs=new te(q),this.Fs=new dn((i=>Go(i)),Wo),this.Ms=new Map,this.xs=e.getRemoteDocumentCache(),this.li=e.getTargetCache(),this.Pi=e.getBundleCache(),this.Os(r)}Os(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new d_(this.xs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.xs.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.vs)))}}function S_(n,e,t,r){return new A_(n,e,t,r)}async function jh(n,e){const t=B(n);return await t.persistence.runTransaction("Handle user change","readonly",(r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next((i=>(s=i,t.Os(e),t.mutationQueue.getAllMutationBatches(r)))).next((i=>{const a=[],l=[];let u=H();for(const d of s){a.push(d.batchId);for(const f of d.mutations)u=u.add(f.key)}for(const d of i){l.push(d.batchId);for(const f of d.mutations)u=u.add(f.key)}return t.localDocuments.getDocuments(r,u).next((d=>({Ns:d,removedBatchIds:a,addedBatchIds:l})))}))}))}function R_(n,e){const t=B(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",(r=>{const s=e.batch.keys(),i=t.xs.newChangeBuffer({trackRemovals:!0});return(function(l,u,d,f){const _=d.batch,g=_.keys();let C=P.resolve();return g.forEach((k=>{C=C.next((()=>f.getEntry(u,k))).next((V=>{const M=d.docVersions.get(k);Q(M!==null,48541),V.version.compareTo(M)<0&&(_.applyToRemoteDocument(V,d),V.isValidDocument()&&(V.setReadTime(d.commitVersion),f.addEntry(V)))}))})),C.next((()=>l.mutationQueue.removeMutationBatch(u,_)))})(t,r,e,i).next((()=>i.apply(r))).next((()=>t.mutationQueue.performConsistencyCheck(r))).next((()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId))).next((()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,(function(l){let u=H();for(let d=0;d<l.mutationResults.length;++d)l.mutationResults[d].transformResults.length>0&&(u=u.add(l.batch.mutations[d].key));return u})(e)))).next((()=>t.localDocuments.getDocuments(r,s)))}))}function qh(n){const e=B(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.li.getLastRemoteSnapshotVersion(t)))}function C_(n,e){const t=B(n),r=e.snapshotVersion;let s=t.vs;return t.persistence.runTransaction("Apply remote event","readwrite-primary",(i=>{const a=t.xs.newChangeBuffer({trackRemovals:!0});s=t.vs;const l=[];e.targetChanges.forEach(((f,_)=>{const g=s.get(_);if(!g)return;l.push(t.li.removeMatchingKeys(i,f.removedDocuments,_).next((()=>t.li.addMatchingKeys(i,f.addedDocuments,_))));let C=g.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(_)!==null?C=C.withResumeToken(Ie.EMPTY_BYTE_STRING,U.min()).withLastLimboFreeSnapshotVersion(U.min()):f.resumeToken.approximateByteSize()>0&&(C=C.withResumeToken(f.resumeToken,r)),s=s.insert(_,C),(function(V,M,G){return V.resumeToken.approximateByteSize()===0||M.snapshotVersion.toMicroseconds()-V.snapshotVersion.toMicroseconds()>=w_?!0:G.addedDocuments.size+G.modifiedDocuments.size+G.removedDocuments.size>0})(g,C,f)&&l.push(t.li.updateTargetData(i,C))}));let u=dt(),d=H();if(e.documentUpdates.forEach((f=>{e.resolvedLimboDocuments.has(f)&&l.push(t.persistence.referenceDelegate.updateLimboDocument(i,f))})),l.push(b_(i,a,e.documentUpdates).next((f=>{u=f.Bs,d=f.Ls}))),!r.isEqual(U.min())){const f=t.li.getLastRemoteSnapshotVersion(i).next((_=>t.li.setTargetsMetadata(i,i.currentSequenceNumber,r)));l.push(f)}return P.waitFor(l).next((()=>a.apply(i))).next((()=>t.localDocuments.getLocalViewOfDocuments(i,u,d))).next((()=>u))})).then((i=>(t.vs=s,i)))}function b_(n,e,t){let r=H(),s=H();return t.forEach((i=>r=r.add(i))),e.getEntries(n,r).next((i=>{let a=dt();return t.forEach(((l,u)=>{const d=i.get(l);u.isFoundDocument()!==d.isFoundDocument()&&(s=s.add(l)),u.isNoDocument()&&u.version.isEqual(U.min())?(e.removeEntry(l,u.readTime),a=a.insert(l,u)):!d.isValidDocument()||u.version.compareTo(d.version)>0||u.version.compareTo(d.version)===0&&d.hasPendingWrites?(e.addEntry(u),a=a.insert(l,u)):O(na,"Ignoring outdated watch update for ",l,". Current version:",d.version," Watch version:",u.version)})),{Bs:a,Ls:s}}))}function P_(n,e){const t=B(n);return t.persistence.runTransaction("Get next mutation batch","readonly",(r=>(e===void 0&&(e=jo),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e))))}function k_(n,e){const t=B(n);return t.persistence.runTransaction("Allocate target","readwrite",(r=>{let s;return t.li.getTargetData(r,e).next((i=>i?(s=i,P.resolve(s)):t.li.allocateTargetId(r).next((a=>(s=new bt(e,a,"TargetPurposeListen",r.currentSequenceNumber),t.li.addTargetData(r,s).next((()=>s)))))))})).then((r=>{const s=t.vs.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.vs=t.vs.insert(r.targetId,r),t.Fs.set(e,r.targetId)),r}))}async function wo(n,e,t){const r=B(n),s=r.vs.get(e),i=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",i,(a=>r.persistence.referenceDelegate.removeTarget(a,s)))}catch(a){if(!Hn(a))throw a;O(na,`Failed to update sequence numbers for target ${e}: ${a}`)}r.vs=r.vs.remove(e),r.Fs.delete(s.target)}function wl(n,e,t){const r=B(n);let s=U.min(),i=H();return r.persistence.runTransaction("Execute query","readwrite",(a=>(function(u,d,f){const _=B(u),g=_.Fs.get(f);return g!==void 0?P.resolve(_.vs.get(g)):_.li.getTargetData(d,f)})(r,a,Je(e)).next((l=>{if(l)return s=l.lastLimboFreeSnapshotVersion,r.li.getMatchingKeysForTargetId(a,l.targetId).next((u=>{i=u}))})).next((()=>r.Cs.getDocumentsMatchingQuery(a,e,t?s:U.min(),t?i:H()))).next((l=>(N_(r,gg(e),l),{documents:l,ks:i})))))}function N_(n,e,t){let r=n.Ms.get(e)||U.min();t.forEach(((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)})),n.Ms.set(e,r)}class Al{constructor(){this.activeTargetIds=vg()}Qs(e){this.activeTargetIds=this.activeTargetIds.add(e)}Gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class D_{constructor(){this.vo=new Al,this.Fo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.vo.Qs(e),this.Fo[e]||"not-current"}updateQueryState(e,t,r){this.Fo[e]=t}removeLocalQueryTarget(e){this.vo.Gs(e)}isLocalQueryTarget(e){return this.vo.activeTargetIds.has(e)}clearQueryState(e){delete this.Fo[e]}getAllActiveQueryTargets(){return this.vo.activeTargetIds}isActiveQueryTarget(e){return this.vo.activeTargetIds.has(e)}start(){return this.vo=new Al,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class O_{Mo(e){}shutdown(){}}const Sl="ConnectivityMonitor";class Rl{constructor(){this.xo=()=>this.Oo(),this.No=()=>this.Bo(),this.Lo=[],this.ko()}Mo(e){this.Lo.push(e)}shutdown(){window.removeEventListener("online",this.xo),window.removeEventListener("offline",this.No)}ko(){window.addEventListener("online",this.xo),window.addEventListener("offline",this.No)}Oo(){O(Sl,"Network connectivity changed: AVAILABLE");for(const e of this.Lo)e(0)}Bo(){O(Sl,"Network connectivity changed: UNAVAILABLE");for(const e of this.Lo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let ms=null;function Ao(){return ms===null?ms=(function(){return 268435456+Math.round(2147483648*Math.random())})():ms++,"0x"+ms.toString(16)}const Ji="RestConnection",V_={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery",ExecutePipeline:"executePipeline"};class M_{get Ko(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.qo=t+"://"+e.host,this.Uo=`projects/${r}/databases/${s}`,this.$o=this.databaseId.database===Ds?`project_id=${r}`:`project_id=${r}&database_id=${s}`}Wo(e,t,r,s,i){const a=Ao(),l=this.Qo(e,t.toUriEncodedString());O(Ji,`Sending RPC '${e}' ${a}:`,l,r);const u={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.$o};this.Go(u,s,i);const{host:d}=new URL(l),f=Ht(d);return this.zo(e,l,u,r,f).then((_=>(O(Ji,`Received RPC '${e}' ${a}: `,_),_)),(_=>{throw Dn(Ji,`RPC '${e}' ${a} failed with error: `,_,"url: ",l,"request:",r),_}))}jo(e,t,r,s,i,a){return this.Wo(e,t,r,s,i)}Go(e,t,r){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+jn})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((s,i)=>e[i]=s)),r&&r.headers.forEach(((s,i)=>e[i]=s))}Qo(e,t){const r=V_[e];let s=`${this.qo}/v1/${t}:${r}`;return this.databaseInfo.apiKey&&(s=`${s}?key=${encodeURIComponent(this.databaseInfo.apiKey)}`),s}terminate(){}}class L_{constructor(e){this.Ho=e.Ho,this.Jo=e.Jo}Zo(e){this.Xo=e}Yo(e){this.e_=e}t_(e){this.n_=e}onMessage(e){this.r_=e}close(){this.Jo()}send(e){this.Ho(e)}i_(){this.Xo()}s_(){this.e_()}o_(e){this.n_(e)}__(e){this.r_(e)}}const ve="WebChannelConnection",ur=(n,e,t)=>{n.listen(e,(r=>{try{t(r)}catch(s){setTimeout((()=>{throw s}),0)}}))};class Rn extends M_{constructor(e){super(e),this.a_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}static u_(){if(!Rn.c_){const e=Ku();ur(e,zu.STAT_EVENT,(t=>{t.stat===uo.PROXY?O(ve,"STAT_EVENT: detected buffering proxy"):t.stat===uo.NOPROXY&&O(ve,"STAT_EVENT: detected no buffering proxy")})),Rn.c_=!0}}zo(e,t,r,s,i){const a=Ao();return new Promise(((l,u)=>{const d=new Gu;d.setWithCredentials(!0),d.listenOnce(Wu.COMPLETE,(()=>{try{switch(d.getLastErrorCode()){case ys.NO_ERROR:const _=d.getResponseJson();O(ve,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(_)),l(_);break;case ys.TIMEOUT:O(ve,`RPC '${e}' ${a} timed out`),u(new D(b.DEADLINE_EXCEEDED,"Request time out"));break;case ys.HTTP_ERROR:const g=d.getStatus();if(O(ve,`RPC '${e}' ${a} failed with status:`,g,"response text:",d.getResponseText()),g>0){let C=d.getResponseJson();Array.isArray(C)&&(C=C[0]);const k=C?.error;if(k&&k.status&&k.message){const V=(function(G){const K=G.toLowerCase().replace(/_/g,"-");return Object.values(b).indexOf(K)>=0?K:b.UNKNOWN})(k.status);u(new D(V,k.message))}else u(new D(b.UNKNOWN,"Server responded with status "+d.getStatus()))}else u(new D(b.UNAVAILABLE,"Connection failed."));break;default:x(9055,{l_:e,streamId:a,h_:d.getLastErrorCode(),P_:d.getLastError()})}}finally{O(ve,`RPC '${e}' ${a} completed.`)}}));const f=JSON.stringify(s);O(ve,`RPC '${e}' ${a} sending request:`,s),d.send(t,"POST",f,r,15)}))}T_(e,t,r){const s=Ao(),i=[this.qo,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=this.createWebChannelTransport(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;u!==void 0&&(l.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(l.useFetchStreams=!0),this.Go(l.initMessageHeaders,t,r),l.encodeInitMessageHeaders=!0;const d=i.join("");O(ve,`Creating RPC '${e}' stream ${s}: ${d}`,l);const f=a.createWebChannel(d,l);this.I_(f);let _=!1,g=!1;const C=new L_({Ho:k=>{g?O(ve,`Not sending because RPC '${e}' stream ${s} is closed:`,k):(_||(O(ve,`Opening RPC '${e}' stream ${s} transport.`),f.open(),_=!0),O(ve,`RPC '${e}' stream ${s} sending:`,k),f.send(k))},Jo:()=>f.close()});return ur(f,pr.EventType.OPEN,(()=>{g||(O(ve,`RPC '${e}' stream ${s} transport opened.`),C.i_())})),ur(f,pr.EventType.CLOSE,(()=>{g||(g=!0,O(ve,`RPC '${e}' stream ${s} transport closed`),C.o_(),this.E_(f))})),ur(f,pr.EventType.ERROR,(k=>{g||(g=!0,Dn(ve,`RPC '${e}' stream ${s} transport errored. Name:`,k.name,"Message:",k.message),C.o_(new D(b.UNAVAILABLE,"The operation could not be completed")))})),ur(f,pr.EventType.MESSAGE,(k=>{if(!g){const V=k.data[0];Q(!!V,16349);const M=V,G=M?.error||M[0]?.error;if(G){O(ve,`RPC '${e}' stream ${s} received error:`,G);const K=G.status;let J=(function(_e){const T=ie[_e];if(T!==void 0)return Ph(T)})(K),Me=G.message;J===void 0&&(J=b.INTERNAL,Me="Unknown error status: "+K+" with message "+G.message),g=!0,C.o_(new D(J,Me)),f.close()}else O(ve,`RPC '${e}' stream ${s} received:`,V),C.__(V)}})),Rn.u_(),setTimeout((()=>{C.s_()}),0),C}terminate(){this.a_.forEach((e=>e.close())),this.a_=[]}I_(e){this.a_.push(e)}E_(e){this.a_=this.a_.filter((t=>t===e))}Go(e,t,r){super.Go(e,t,r),this.databaseInfo.apiKey&&(e["x-goog-api-key"]=this.databaseInfo.apiKey)}createWebChannelTransport(){return Qu()}}function x_(n){return new Rn(n)}function Xi(){return typeof document<"u"?document:null}function ci(n){return new $g(n,!0)}Rn.c_=!1;class Hh{constructor(e,t,r=1e3,s=1.5,i=6e4){this.Ci=e,this.timerId=t,this.R_=r,this.A_=s,this.V_=i,this.d_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.d_=0}g_(){this.d_=this.V_}p_(e){this.cancel();const t=Math.floor(this.d_+this.y_()),r=Math.max(0,Date.now()-this.f_),s=Math.max(0,t-r);s>0&&O("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.d_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.m_=this.Ci.enqueueAfterDelay(this.timerId,s,(()=>(this.f_=Date.now(),e()))),this.d_*=this.A_,this.d_<this.R_&&(this.d_=this.R_),this.d_>this.V_&&(this.d_=this.V_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.d_}}const Cl="PersistentStream";class Gh{constructor(e,t,r,s,i,a,l,u){this.Ci=e,this.b_=r,this.S_=s,this.connection=i,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=l,this.listener=u,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new Hh(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Ci.enqueueAfterDelay(this.b_,6e4,(()=>this.k_())))}K_(e){this.q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===b.RESOURCE_EXHAUSTED?(ht(t.toString()),ht("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===b.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.W_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.t_(t)}W_(){}auth(){this.state=1;const e=this.Q_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([r,s])=>{this.D_===t&&this.G_(r,s)}),(r=>{e((()=>{const s=new D(b.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(s)}))}))}G_(e,t){const r=this.Q_(this.D_);this.stream=this.j_(e,t),this.stream.Zo((()=>{r((()=>this.listener.Zo()))})),this.stream.Yo((()=>{r((()=>(this.state=2,this.v_=this.Ci.enqueueAfterDelay(this.S_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.Yo())))})),this.stream.t_((s=>{r((()=>this.z_(s)))})),this.stream.onMessage((s=>{r((()=>++this.F_==1?this.H_(s):this.onNext(s)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return O(Cl,`close with error: ${e}`),this.stream=null,this.close(4,e)}Q_(e){return t=>{this.Ci.enqueueAndForget((()=>this.D_===e?t():(O(Cl,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class F_ extends Gh{constructor(e,t,r,s,i,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,a),this.serializer=i}j_(e,t){return this.connection.T_("Listen",e,t)}H_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=Hg(this.serializer,e),r=(function(i){if(!("targetChange"in i))return U.min();const a=i.targetChange;return a.targetIds&&a.targetIds.length?U.min():a.readTime?Xe(a.readTime):U.min()})(e);return this.listener.J_(t,r)}Z_(e){const t={};t.database=vo(this.serializer),t.addTarget=(function(i,a){let l;const u=a.target;if(l=go(u)?{documents:zg(i,u)}:{query:Kg(i,u).ft},l.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){l.resumeToken=Dh(i,a.resumeToken);const d=Eo(i,a.expectedCount);d!==null&&(l.expectedCount=d)}else if(a.snapshotVersion.compareTo(U.min())>0){l.readTime=xs(i,a.snapshotVersion.toTimestamp());const d=Eo(i,a.expectedCount);d!==null&&(l.expectedCount=d)}return l})(this.serializer,e);const r=Yg(this.serializer,e);r&&(t.labels=r),this.K_(t)}X_(e){const t={};t.database=vo(this.serializer),t.removeTarget=e,this.K_(t)}}class U_ extends Gh{constructor(e,t,r,s,i,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,a),this.serializer=i}get Y_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}W_(){this.Y_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}H_(e){return Q(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,Q(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){Q(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=Wg(e.writeResults,e.commitTime),r=Xe(e.commitTime);return this.listener.na(r,t)}ra(){const e={};e.database=vo(this.serializer),this.K_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map((r=>Gg(this.serializer,r)))};this.K_(t)}}class B_{}class $_ extends B_{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new D(b.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,t,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,a])=>this.connection.Wo(e,Io(t,r),s,i,a))).catch((i=>{throw i.name==="FirebaseError"?(i.code===b.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new D(b.UNKNOWN,i.toString())}))}jo(e,t,r,s,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([a,l])=>this.connection.jo(e,Io(t,r),s,a,l,i))).catch((a=>{throw a.name==="FirebaseError"?(a.code===b.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new D(b.UNKNOWN,a.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}function j_(n,e,t,r){return new $_(n,e,t,r)}class q_{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(ht(t),this.aa=!1):O("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const cn="RemoteStore";class H_{constructor(e,t,r,s,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.Ra=[],this.Aa=i,this.Aa.Mo((a=>{r.enqueueAndForget((async()=>{fn(this)&&(O(cn,"Restarting streams for network reachability change."),await(async function(u){const d=B(u);d.Ea.add(4),await jr(d),d.Va.set("Unknown"),d.Ea.delete(4),await li(d)})(this))}))})),this.Va=new q_(r,s)}}async function li(n){if(fn(n))for(const e of n.Ra)await e(!0)}async function jr(n){for(const e of n.Ra)await e(!1)}function Wh(n,e){const t=B(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),oa(t)?ia(t):Wn(t).O_()&&sa(t,e))}function ra(n,e){const t=B(n),r=Wn(t);t.Ia.delete(e),r.O_()&&zh(t,e),t.Ia.size===0&&(r.O_()?r.L_():fn(t)&&t.Va.set("Unknown"))}function sa(n,e){if(n.da.$e(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(U.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Wn(n).Z_(e)}function zh(n,e){n.da.$e(e),Wn(n).X_(e)}function ia(n){n.da=new xg({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),Wn(n).start(),n.Va.ua()}function oa(n){return fn(n)&&!Wn(n).x_()&&n.Ia.size>0}function fn(n){return B(n).Ea.size===0}function Kh(n){n.da=void 0}async function G_(n){n.Va.set("Online")}async function W_(n){n.Ia.forEach(((e,t)=>{sa(n,e)}))}async function z_(n,e){Kh(n),oa(n)?(n.Va.ha(e),ia(n)):n.Va.set("Unknown")}async function K_(n,e,t){if(n.Va.set("Online"),e instanceof Nh&&e.state===2&&e.cause)try{await(async function(s,i){const a=i.cause;for(const l of i.targetIds)s.Ia.has(l)&&(await s.remoteSyncer.rejectListen(l,a),s.Ia.delete(l),s.da.removeTarget(l))})(n,e)}catch(r){O(cn,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Us(n,r)}else if(e instanceof vs?n.da.Xe(e):e instanceof kh?n.da.st(e):n.da.tt(e),!t.isEqual(U.min()))try{const r=await qh(n.localStore);t.compareTo(r)>=0&&await(function(i,a){const l=i.da.Tt(a);return l.targetChanges.forEach(((u,d)=>{if(u.resumeToken.approximateByteSize()>0){const f=i.Ia.get(d);f&&i.Ia.set(d,f.withResumeToken(u.resumeToken,a))}})),l.targetMismatches.forEach(((u,d)=>{const f=i.Ia.get(u);if(!f)return;i.Ia.set(u,f.withResumeToken(Ie.EMPTY_BYTE_STRING,f.snapshotVersion)),zh(i,u);const _=new bt(f.target,u,d,f.sequenceNumber);sa(i,_)})),i.remoteSyncer.applyRemoteEvent(l)})(n,t)}catch(r){O(cn,"Failed to raise snapshot:",r),await Us(n,r)}}async function Us(n,e,t){if(!Hn(e))throw e;n.Ea.add(1),await jr(n),n.Va.set("Offline"),t||(t=()=>qh(n.localStore)),n.asyncQueue.enqueueRetryable((async()=>{O(cn,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await li(n)}))}function Qh(n,e){return e().catch((t=>Us(n,t,e)))}async function ui(n){const e=B(n),t=jt(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:jo;for(;Q_(e);)try{const s=await P_(e.localStore,r);if(s===null){e.Ta.length===0&&t.L_();break}r=s.batchId,Y_(e,s)}catch(s){await Us(e,s)}Yh(e)&&Jh(e)}function Q_(n){return fn(n)&&n.Ta.length<10}function Y_(n,e){n.Ta.push(e);const t=jt(n);t.O_()&&t.Y_&&t.ea(e.mutations)}function Yh(n){return fn(n)&&!jt(n).x_()&&n.Ta.length>0}function Jh(n){jt(n).start()}async function J_(n){jt(n).ra()}async function X_(n){const e=jt(n);for(const t of n.Ta)e.ea(t.mutations)}async function Z_(n,e,t){const r=n.Ta.shift(),s=Yo.from(r,e,t);await Qh(n,(()=>n.remoteSyncer.applySuccessfulWrite(s))),await ui(n)}async function ey(n,e){e&&jt(n).Y_&&await(async function(r,s){if((function(a){return Vg(a)&&a!==b.ABORTED})(s.code)){const i=r.Ta.shift();jt(r).B_(),await Qh(r,(()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s))),await ui(r)}})(n,e),Yh(n)&&Jh(n)}async function bl(n,e){const t=B(n);t.asyncQueue.verifyOperationInProgress(),O(cn,"RemoteStore received new credentials");const r=fn(t);t.Ea.add(3),await jr(t),r&&t.Va.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await li(t)}async function ty(n,e){const t=B(n);e?(t.Ea.delete(2),await li(t)):e||(t.Ea.add(2),await jr(t),t.Va.set("Unknown"))}function Wn(n){return n.ma||(n.ma=(function(t,r,s){const i=B(t);return i.sa(),new F_(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)})(n.datastore,n.asyncQueue,{Zo:G_.bind(null,n),Yo:W_.bind(null,n),t_:z_.bind(null,n),J_:K_.bind(null,n)}),n.Ra.push((async e=>{e?(n.ma.B_(),oa(n)?ia(n):n.Va.set("Unknown")):(await n.ma.stop(),Kh(n))}))),n.ma}function jt(n){return n.fa||(n.fa=(function(t,r,s){const i=B(t);return i.sa(),new U_(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)})(n.datastore,n.asyncQueue,{Zo:()=>Promise.resolve(),Yo:J_.bind(null,n),t_:ey.bind(null,n),ta:X_.bind(null,n),na:Z_.bind(null,n)}),n.Ra.push((async e=>{e?(n.fa.B_(),await ui(n)):(await n.fa.stop(),n.Ta.length>0&&(O(cn,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))}))),n.fa}class aa{constructor(e,t,r,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new lt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((a=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,i){const a=Date.now()+r,l=new aa(e,t,a,s,i);return l.start(r),l}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new D(b.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function ca(n,e){if(ht("AsyncQueue",`${e}: ${n}`),Hn(n))return new D(b.UNAVAILABLE,`${e}: ${n}`);throw n}class Cn{static emptySet(e){return new Cn(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||L.comparator(t.key,r.key):(t,r)=>L.comparator(t.key,r.key),this.keyedMap=mr(),this.sortedSet=new te(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,r)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Cn)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new Cn;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class Pl{constructor(){this.ga=new te(L.comparator)}track(e){const t=e.doc.key,r=this.ga.get(t);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(t,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(t):e.type===1&&r.type===2?this.ga=this.ga.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):x(63341,{Vt:e,pa:r}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal(((t,r)=>{e.push(r)})),e}}class xn{constructor(e,t,r,s,i,a,l,u,d){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=a,this.syncStateChanged=l,this.excludesMetadataChanges=u,this.hasCachedResults=d}static fromInitialDocuments(e,t,r,s,i){const a=[];return t.forEach((l=>{a.push({type:0,doc:l})})),new xn(e,t,Cn.emptySet(t),a,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&ri(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}class ny{constructor(){this.wa=void 0,this.ba=[]}Sa(){return this.ba.some((e=>e.Da()))}}class ry{constructor(){this.queries=kl(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,r){const s=B(t),i=s.queries;s.queries=kl(),i.forEach(((a,l)=>{for(const u of l.ba)u.onError(r)}))})(this,new D(b.ABORTED,"Firestore shutting down"))}}function kl(){return new dn((n=>_h(n)),ri)}async function Xh(n,e){const t=B(n);let r=3;const s=e.query;let i=t.queries.get(s);i?!i.Sa()&&e.Da()&&(r=2):(i=new ny,r=e.Da()?0:1);try{switch(r){case 0:i.wa=await t.onListen(s,!0);break;case 1:i.wa=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(a){const l=ca(a,`Initialization of query '${vn(e.query)}' failed`);return void e.onError(l)}t.queries.set(s,i),i.ba.push(e),e.va(t.onlineState),i.wa&&e.Fa(i.wa)&&la(t)}async function Zh(n,e){const t=B(n),r=e.query;let s=3;const i=t.queries.get(r);if(i){const a=i.ba.indexOf(e);a>=0&&(i.ba.splice(a,1),i.ba.length===0?s=e.Da()?0:1:!i.Sa()&&e.Da()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function sy(n,e){const t=B(n);let r=!1;for(const s of e){const i=s.query,a=t.queries.get(i);if(a){for(const l of a.ba)l.Fa(s)&&(r=!0);a.wa=s}}r&&la(t)}function iy(n,e,t){const r=B(n),s=r.queries.get(e);if(s)for(const i of s.ba)i.onError(t);r.queries.delete(e)}function la(n){n.Ca.forEach((e=>{e.next()}))}var So,Nl;(Nl=So||(So={})).Ma="default",Nl.Cache="cache";class ed{constructor(e,t,r){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new xn(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const r=t!=="Offline";return(!this.options.Ka||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=xn.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==So.Cache}}class td{constructor(e){this.key=e}}class nd{constructor(e){this.key=e}}class oy{constructor(e,t){this.query=e,this.Za=t,this.Xa=null,this.hasCachedResults=!1,this.current=!1,this.Ya=H(),this.mutatedKeys=H(),this.eu=yh(e),this.tu=new Cn(this.eu)}get nu(){return this.Za}ru(e,t){const r=t?t.iu:new Pl,s=t?t.tu:this.tu;let i=t?t.mutatedKeys:this.mutatedKeys,a=s,l=!1;const u=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,d=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal(((f,_)=>{const g=s.get(f),C=si(this.query,_)?_:null,k=!!g&&this.mutatedKeys.has(g.key),V=!!C&&(C.hasLocalMutations||this.mutatedKeys.has(C.key)&&C.hasCommittedMutations);let M=!1;g&&C?g.data.isEqual(C.data)?k!==V&&(r.track({type:3,doc:C}),M=!0):this.su(g,C)||(r.track({type:2,doc:C}),M=!0,(u&&this.eu(C,u)>0||d&&this.eu(C,d)<0)&&(l=!0)):!g&&C?(r.track({type:0,doc:C}),M=!0):g&&!C&&(r.track({type:1,doc:g}),M=!0,(u||d)&&(l=!0)),M&&(C?(a=a.add(C),i=V?i.add(f):i.delete(f)):(a=a.delete(f),i=i.delete(f)))})),this.query.limit!==null)for(;a.size>this.query.limit;){const f=this.query.limitType==="F"?a.last():a.first();a=a.delete(f.key),i=i.delete(f.key),r.track({type:1,doc:f})}return{tu:a,iu:r,Ss:l,mutatedKeys:i}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const a=e.iu.ya();a.sort(((f,_)=>(function(C,k){const V=M=>{switch(M){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return x(20277,{Vt:M})}};return V(C)-V(k)})(f.type,_.type)||this.eu(f.doc,_.doc))),this.ou(r),s=s??!1;const l=t&&!s?this._u():[],u=this.Ya.size===0&&this.current&&!s?1:0,d=u!==this.Xa;return this.Xa=u,a.length!==0||d?{snapshot:new xn(this.query,e.tu,i,a,e.mutatedKeys,u===0,d,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:l}:{au:l}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new Pl,mutatedKeys:this.mutatedKeys,Ss:!1},!1)):{au:[]}}uu(e){return!this.Za.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((t=>this.Za=this.Za.add(t))),e.modifiedDocuments.forEach((t=>{})),e.removedDocuments.forEach((t=>this.Za=this.Za.delete(t))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Ya;this.Ya=H(),this.tu.forEach((r=>{this.uu(r.key)&&(this.Ya=this.Ya.add(r.key))}));const t=[];return e.forEach((r=>{this.Ya.has(r)||t.push(new nd(r))})),this.Ya.forEach((r=>{e.has(r)||t.push(new td(r))})),t}cu(e){this.Za=e.ks,this.Ya=H();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return xn.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Xa===0,this.hasCachedResults)}}const ua="SyncEngine";class ay{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class cy{constructor(e){this.key=e,this.hu=!1}}class ly{constructor(e,t,r,s,i,a){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=a,this.Pu={},this.Tu=new dn((l=>_h(l)),ri),this.Iu=new Map,this.Eu=new Set,this.Ru=new te(L.comparator),this.Au=new Map,this.Vu=new Zo,this.du={},this.mu=new Map,this.fu=Ln.ar(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function uy(n,e,t=!0){const r=cd(n);let s;const i=r.Tu.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.lu()):s=await rd(r,e,t,!0),s}async function hy(n,e){const t=cd(n);await rd(t,e,!0,!1)}async function rd(n,e,t,r){const s=await k_(n.localStore,Je(e)),i=s.targetId,a=n.sharedClientState.addLocalQueryTarget(i,t);let l;return r&&(l=await dy(n,e,i,a==="current",s.resumeToken)),n.isPrimaryClient&&t&&Wh(n.remoteStore,s),l}async function dy(n,e,t,r,s){n.pu=(_,g,C)=>(async function(V,M,G,K){let J=M.view.ru(G);J.Ss&&(J=await wl(V.localStore,M.query,!1).then((({documents:T})=>M.view.ru(T,J))));const Me=K&&K.targetChanges.get(M.targetId),$e=K&&K.targetMismatches.get(M.targetId)!=null,_e=M.view.applyChanges(J,V.isPrimaryClient,Me,$e);return Ol(V,M.targetId,_e.au),_e.snapshot})(n,_,g,C);const i=await wl(n.localStore,e,!0),a=new oy(e,i.ks),l=a.ru(i.documents),u=$r.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),d=a.applyChanges(l,n.isPrimaryClient,u);Ol(n,t,d.au);const f=new ay(e,t,a);return n.Tu.set(e,f),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),d.snapshot}async function fy(n,e,t){const r=B(n),s=r.Tu.get(e),i=r.Iu.get(s.targetId);if(i.length>1)return r.Iu.set(s.targetId,i.filter((a=>!ri(a,e)))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await wo(r.localStore,s.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(s.targetId),t&&ra(r.remoteStore,s.targetId),Ro(r,s.targetId)})).catch(qn)):(Ro(r,s.targetId),await wo(r.localStore,s.targetId,!0))}async function py(n,e){const t=B(n),r=t.Tu.get(e),s=t.Iu.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),ra(t.remoteStore,r.targetId))}async function my(n,e,t){const r=vy(n);try{const s=await(function(a,l){const u=B(a),d=ee.now(),f=l.reduce(((C,k)=>C.add(k.key)),H());let _,g;return u.persistence.runTransaction("Locally write mutations","readwrite",(C=>{let k=dt(),V=H();return u.xs.getEntries(C,f).next((M=>{k=M,k.forEach(((G,K)=>{K.isValidDocument()||(V=V.add(G))}))})).next((()=>u.localDocuments.getOverlayedDocuments(C,k))).next((M=>{_=M;const G=[];for(const K of l){const J=Pg(K,_.get(K.key).overlayedDocument);J!=null&&G.push(new Wt(K.key,J,lh(J.value.mapValue),Be.exists(!0)))}return u.mutationQueue.addMutationBatch(C,d,G,l)})).next((M=>{g=M;const G=M.applyToLocalDocumentSet(_,V);return u.documentOverlayCache.saveOverlays(C,M.batchId,G)}))})).then((()=>({batchId:g.batchId,changes:Ih(_)})))})(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),(function(a,l,u){let d=a.du[a.currentUser.toKey()];d||(d=new te(q)),d=d.insert(l,u),a.du[a.currentUser.toKey()]=d})(r,s.batchId,t),await qr(r,s.changes),await ui(r.remoteStore)}catch(s){const i=ca(s,"Failed to persist write");t.reject(i)}}async function sd(n,e){const t=B(n);try{const r=await C_(t.localStore,e);e.targetChanges.forEach(((s,i)=>{const a=t.Au.get(i);a&&(Q(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?a.hu=!0:s.modifiedDocuments.size>0?Q(a.hu,14607):s.removedDocuments.size>0&&(Q(a.hu,42227),a.hu=!1))})),await qr(t,r,e)}catch(r){await qn(r)}}function Dl(n,e,t){const r=B(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.Tu.forEach(((i,a)=>{const l=a.view.va(e);l.snapshot&&s.push(l.snapshot)})),(function(a,l){const u=B(a);u.onlineState=l;let d=!1;u.queries.forEach(((f,_)=>{for(const g of _.ba)g.va(l)&&(d=!0)})),d&&la(u)})(r.eventManager,e),s.length&&r.Pu.J_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function gy(n,e,t){const r=B(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Au.get(e),i=s&&s.key;if(i){let a=new te(L.comparator);a=a.insert(i,Ae.newNoDocument(i,U.min()));const l=H().add(i),u=new ai(U.min(),new Map,new te(q),a,l);await sd(r,u),r.Ru=r.Ru.remove(i),r.Au.delete(e),ha(r)}else await wo(r.localStore,e,!1).then((()=>Ro(r,e,t))).catch(qn)}async function _y(n,e){const t=B(n),r=e.batch.batchId;try{const s=await R_(t.localStore,e);od(t,r,null),id(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await qr(t,s)}catch(s){await qn(s)}}async function yy(n,e,t){const r=B(n);try{const s=await(function(a,l){const u=B(a);return u.persistence.runTransaction("Reject batch","readwrite-primary",(d=>{let f;return u.mutationQueue.lookupMutationBatch(d,l).next((_=>(Q(_!==null,37113),f=_.keys(),u.mutationQueue.removeMutationBatch(d,_)))).next((()=>u.mutationQueue.performConsistencyCheck(d))).next((()=>u.documentOverlayCache.removeOverlaysForBatchId(d,f,l))).next((()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,f))).next((()=>u.localDocuments.getDocuments(d,f)))}))})(r.localStore,e);od(r,e,t),id(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await qr(r,s)}catch(s){await qn(s)}}function id(n,e){(n.mu.get(e)||[]).forEach((t=>{t.resolve()})),n.mu.delete(e)}function od(n,e,t){const r=B(n);let s=r.du[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),r.du[r.currentUser.toKey()]=s}}function Ro(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Iu.get(e))n.Tu.delete(r),t&&n.Pu.yu(r,t);n.Iu.delete(e),n.isPrimaryClient&&n.Vu.Gr(e).forEach((r=>{n.Vu.containsKey(r)||ad(n,r)}))}function ad(n,e){n.Eu.delete(e.path.canonicalString());const t=n.Ru.get(e);t!==null&&(ra(n.remoteStore,t),n.Ru=n.Ru.remove(e),n.Au.delete(t),ha(n))}function Ol(n,e,t){for(const r of t)r instanceof td?(n.Vu.addReference(r.key,e),Ey(n,r)):r instanceof nd?(O(ua,"Document no longer in limbo: "+r.key),n.Vu.removeReference(r.key,e),n.Vu.containsKey(r.key)||ad(n,r.key)):x(19791,{wu:r})}function Ey(n,e){const t=e.key,r=t.path.canonicalString();n.Ru.get(t)||n.Eu.has(r)||(O(ua,"New document in limbo: "+t),n.Eu.add(r),ha(n))}function ha(n){for(;n.Eu.size>0&&n.Ru.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new L(X.fromString(e)),r=n.fu.next();n.Au.set(r,new cy(t)),n.Ru=n.Ru.insert(t,r),Wh(n.remoteStore,new bt(Je(zo(t.path)),r,"TargetPurposeLimboResolution",ei.ce))}}async function qr(n,e,t){const r=B(n),s=[],i=[],a=[];r.Tu.isEmpty()||(r.Tu.forEach(((l,u)=>{a.push(r.pu(u,e,t).then((d=>{if((d||t)&&r.isPrimaryClient){const f=d?!d.fromCache:t?.targetChanges.get(u.targetId)?.current;r.sharedClientState.updateQueryState(u.targetId,f?"current":"not-current")}if(d){s.push(d);const f=ta.Es(u.targetId,d);i.push(f)}})))})),await Promise.all(a),r.Pu.J_(s),await(async function(u,d){const f=B(u);try{await f.persistence.runTransaction("notifyLocalViewChanges","readwrite",(_=>P.forEach(d,(g=>P.forEach(g.Ts,(C=>f.persistence.referenceDelegate.addReference(_,g.targetId,C))).next((()=>P.forEach(g.Is,(C=>f.persistence.referenceDelegate.removeReference(_,g.targetId,C)))))))))}catch(_){if(!Hn(_))throw _;O(na,"Failed to update sequence numbers: "+_)}for(const _ of d){const g=_.targetId;if(!_.fromCache){const C=f.vs.get(g),k=C.snapshotVersion,V=C.withLastLimboFreeSnapshotVersion(k);f.vs=f.vs.insert(g,V)}}})(r.localStore,i))}async function Iy(n,e){const t=B(n);if(!t.currentUser.isEqual(e)){O(ua,"User change. New user:",e.toKey());const r=await jh(t.localStore,e);t.currentUser=e,(function(i,a){i.mu.forEach((l=>{l.forEach((u=>{u.reject(new D(b.CANCELLED,a))}))})),i.mu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await qr(t,r.Ns)}}function Ty(n,e){const t=B(n),r=t.Au.get(e);if(r&&r.hu)return H().add(r.key);{let s=H();const i=t.Iu.get(e);if(!i)return s;for(const a of i){const l=t.Tu.get(a);s=s.unionWith(l.view.nu)}return s}}function cd(n){const e=B(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=sd.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Ty.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=gy.bind(null,e),e.Pu.J_=sy.bind(null,e.eventManager),e.Pu.yu=iy.bind(null,e.eventManager),e}function vy(n){const e=B(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=_y.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=yy.bind(null,e),e}class Bs{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=ci(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return S_(this.persistence,new v_,e.initialUser,this.serializer)}Cu(e){return new $h(ea.Vi,this.serializer)}Du(e){return new D_}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Bs.provider={build:()=>new Bs};class wy extends Bs{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){Q(this.persistence.referenceDelegate instanceof Fs,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new a_(r,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?De.withCacheSize(this.cacheSizeBytes):De.DEFAULT;return new $h((r=>Fs.Vi(r,t)),this.serializer)}}class Co{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>Dl(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=Iy.bind(null,this.syncEngine),await ty(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new ry})()}createDatastore(e){const t=ci(e.databaseInfo.databaseId),r=x_(e.databaseInfo);return j_(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return(function(r,s,i,a,l){return new H_(r,s,i,a,l)})(this.localStore,this.datastore,e.asyncQueue,(t=>Dl(this.syncEngine,t,0)),(function(){return Rl.v()?new Rl:new O_})())}createSyncEngine(e,t){return(function(s,i,a,l,u,d,f){const _=new ly(s,i,a,l,u,d);return f&&(_.gu=!0),_})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await(async function(t){const r=B(t);O(cn,"RemoteStore shutting down."),r.Ea.add(5),await jr(r),r.Aa.shutdown(),r.Va.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}Co.provider={build:()=>new Co};class ld{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):ht("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}const qt="FirestoreClient";class Ay{constructor(e,t,r,s,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this._databaseInfo=s,this.user=we.UNAUTHENTICATED,this.clientId=$o.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,(async a=>{O(qt,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(r,(a=>(O(qt,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this._databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new lt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=ca(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}}async function Zi(n,e){n.asyncQueue.verifyOperationInProgress(),O(qt,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener((async s=>{r.isEqual(s)||(await jh(e.localStore,s),r=s)})),e.persistence.setDatabaseDeletedListener((()=>n.terminate())),n._offlineComponents=e}async function Vl(n,e){n.asyncQueue.verifyOperationInProgress();const t=await Sy(n);O(qt,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener((r=>bl(e.remoteStore,r))),n.setAppCheckTokenChangeListener(((r,s)=>bl(e.remoteStore,s))),n._onlineComponents=e}async function Sy(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){O(qt,"Using user provided OfflineComponentProvider");try{await Zi(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!(function(s){return s.name==="FirebaseError"?s.code===b.FAILED_PRECONDITION||s.code===b.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11})(t))throw t;Dn("Error using user provided cache. Falling back to memory cache: "+t),await Zi(n,new Bs)}}else O(qt,"Using default OfflineComponentProvider"),await Zi(n,new wy(void 0));return n._offlineComponents}async function ud(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(O(qt,"Using user provided OnlineComponentProvider"),await Vl(n,n._uninitializedComponentsProvider._online)):(O(qt,"Using default OnlineComponentProvider"),await Vl(n,new Co))),n._onlineComponents}function Ry(n){return ud(n).then((e=>e.syncEngine))}async function hd(n){const e=await ud(n),t=e.eventManager;return t.onListen=uy.bind(null,e.syncEngine),t.onUnlisten=fy.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=hy.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=py.bind(null,e.syncEngine),t}function Cy(n,e,t={}){const r=new lt;return n.asyncQueue.enqueueAndForget((async()=>(function(i,a,l,u,d){const f=new ld({next:g=>{f.Nu(),a.enqueueAndForget((()=>Zh(i,_)));const C=g.docs.has(l);!C&&g.fromCache?d.reject(new D(b.UNAVAILABLE,"Failed to get document because the client is offline.")):C&&g.fromCache&&u&&u.source==="server"?d.reject(new D(b.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):d.resolve(g)},error:g=>d.reject(g)}),_=new ed(zo(l.path),f,{includeMetadataChanges:!0,Ka:!0});return Xh(i,_)})(await hd(n),n.asyncQueue,e,t,r))),r.promise}function by(n,e,t={}){const r=new lt;return n.asyncQueue.enqueueAndForget((async()=>(function(i,a,l,u,d){const f=new ld({next:g=>{f.Nu(),a.enqueueAndForget((()=>Zh(i,_))),g.fromCache&&u.source==="server"?d.reject(new D(b.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(g)},error:g=>d.reject(g)}),_=new ed(l,f,{includeMetadataChanges:!0,Ka:!0});return Xh(i,_)})(await hd(n),n.asyncQueue,e,t,r))),r.promise}function Py(n,e){const t=new lt;return n.asyncQueue.enqueueAndForget((async()=>my(await Ry(n),e,t))),t.promise}function dd(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}const ky="ComponentProvider",Ml=new Map;function Ny(n,e,t,r,s){return new Jm(n,e,t,s.host,s.ssl,s.experimentalForceLongPolling,s.experimentalAutoDetectLongPolling,dd(s.experimentalLongPollingOptions),s.useFetchStreams,s.isUsingEmulator,r)}const fd="firestore.googleapis.com",Ll=!0;class xl{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new D(b.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=fd,this.ssl=Ll}else this.host=e.host,this.ssl=e.ssl??Ll;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=Bh;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<i_)throw new D(b.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Bm("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=dd(e.experimentalLongPollingOptions??{}),(function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new D(b.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new D(b.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new D(b.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(r,s){return r.timeoutSeconds===s.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class hi{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new xl({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new D(b.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new D(b.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new xl(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new km;switch(r.type){case"firstParty":return new Vm(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new D(b.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){const r=Ml.get(t);r&&(O(ky,"Removing Datastore"),Ml.delete(t),r.terminate())})(this),Promise.resolve()}}function Dy(n,e,t,r={}){n=Ge(n,hi);const s=Ht(e),i=n._getSettings(),a={...i,emulatorOptions:n._getEmulatorOptions()},l=`${e}:${t}`;s&&(Mo(`https://${l}`),Lo("Firestore",!0)),i.host!==fd&&i.host!==l&&Dn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const u={...i,host:l,ssl:s,emulatorOptions:r};if(!sn(u,a)&&(n._setSettings(u),r.mockUserToken)){let d,f;if(typeof r.mockUserToken=="string")d=r.mockUserToken,f=we.MOCK_USER;else{d=ep(r.mockUserToken,n._app?.options.projectId);const _=r.mockUserToken.sub||r.mockUserToken.user_id;if(!_)throw new D(b.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");f=new we(_)}n._authCredentials=new Nm(new Ju(d,f))}}class pn{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new pn(this.firestore,e,this._query)}}class se{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Mt(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new se(this.firestore,e,this._key)}toJSON(){return{type:se._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(Ur(t,se._jsonSchema))return new se(e,r||null,new L(X.fromString(t.referencePath)))}}se._jsonSchemaVersion="firestore/documentReference/1.0",se._jsonSchema={type:ce("string",se._jsonSchemaVersion),referencePath:ce("string")};class Mt extends pn{constructor(e,t,r){super(e,t,zo(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new se(this.firestore,null,new L(e))}withConverter(e){return new Mt(this.firestore,e,this._path)}}function Tt(n,e,...t){if(n=le(n),Xu("collection","path",e),n instanceof hi){const r=X.fromString(e,...t);return Yc(r),new Mt(n,null,r)}{if(!(n instanceof se||n instanceof Mt))throw new D(b.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(X.fromString(e,...t));return Yc(r),new Mt(n.firestore,null,r)}}function wt(n,e,...t){if(n=le(n),arguments.length===1&&(e=$o.newId()),Xu("doc","path",e),n instanceof hi){const r=X.fromString(e,...t);return Qc(r),new se(n,null,new L(r))}{if(!(n instanceof se||n instanceof Mt))throw new D(b.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(X.fromString(e,...t));return Qc(r),new se(n.firestore,n instanceof Mt?n.converter:null,new L(r))}}const Fl="AsyncQueue";class Ul{constructor(e=Promise.resolve()){this.Yu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new Hh(this,"async_queue_retry"),this._c=()=>{const r=Xi();r&&O(Fl,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const t=Xi();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=Xi();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const t=new lt;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Yu.push(e),this.lc())))}async lc(){if(this.Yu.length!==0){try{await this.Yu[0](),this.Yu.shift(),this.M_.reset()}catch(e){if(!Hn(e))throw e;O(Fl,"Operation failed with retryable error: "+e)}this.Yu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const t=this.ac.then((()=>(this.rc=!0,e().catch((r=>{throw this.nc=r,this.rc=!1,ht("INTERNAL UNHANDLED ERROR: ",Bl(r)),r})).then((r=>(this.rc=!1,r))))));return this.ac=t,t}enqueueAfterDelay(e,t,r){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const s=aa.createAndSchedule(this,e,t,r,(i=>this.hc(i)));return this.tc.push(s),s}uc(){this.nc&&x(47125,{Pc:Bl(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((t,r)=>t.targetTimeMs-r.targetTimeMs));for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()}))}Rc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function Bl(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}class mn extends hi{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new Ul,this._persistenceKey=s?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new Ul(e),this._firestoreClient=void 0,await e}}}function Oy(n,e){const t=typeof n=="object"?n:Uo(),r=typeof n=="string"?n:Ds,s=Xs(t,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=Lu("firestore");i&&Dy(s,...i)}return s}function da(n){if(n._terminated)throw new D(b.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||Vy(n),n._firestoreClient}function Vy(n){const e=n._freezeSettings(),t=Ny(n._databaseId,n._app?.options.appId||"",n._persistenceKey,n._app?.options.apiKey,e);n._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new Ay(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&(function(s){const i=s?._online.build();return{_offline:s?._offline.build(i),_online:i}})(n._componentsProvider))}class Ue{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Ue(Ie.fromBase64String(e))}catch(t){throw new D(b.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Ue(Ie.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Ue._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Ur(e,Ue._jsonSchema))return Ue.fromBase64String(e.bytes)}}Ue._jsonSchemaVersion="firestore/bytes/1.0",Ue._jsonSchema={type:ce("string",Ue._jsonSchemaVersion),bytes:ce("string")};class fa{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new D(b.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ee(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class pa{constructor(e){this._methodName=e}}class Ze{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new D(b.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new D(b.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return q(this._lat,e._lat)||q(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Ze._jsonSchemaVersion}}static fromJSON(e){if(Ur(e,Ze._jsonSchema))return new Ze(e.latitude,e.longitude)}}Ze._jsonSchemaVersion="firestore/geoPoint/1.0",Ze._jsonSchema={type:ce("string",Ze._jsonSchemaVersion),latitude:ce("number"),longitude:ce("number")};class qe{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0})(this._values,e._values)}toJSON(){return{type:qe._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Ur(e,qe._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((t=>typeof t=="number")))return new qe(e.vectorValues);throw new D(b.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}qe._jsonSchemaVersion="firestore/vectorValue/1.0",qe._jsonSchema={type:ce("string",qe._jsonSchemaVersion),vectorValues:ce("object")};const My=/^__.*__$/;class Ly{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new Wt(e,this.data,this.fieldMask,t,this.fieldTransforms):new Br(e,this.data,t,this.fieldTransforms)}}class pd{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new Wt(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function md(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw x(40011,{dataSource:n})}}class ma{constructor(e,t,r,s,i,a){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.validatePath(),this.fieldTransforms=i||[],this.fieldMask=a||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new ma({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){const t=this.path?.child(e),r=this.contextWith({path:t,arrayElement:!1});return r.validatePathSegment(e),r}childContextForFieldPath(e){const t=this.path?.child(e),r=this.contextWith({path:t,arrayElement:!1});return r.validatePath(),r}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return $s(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return this.fieldMask.find((t=>e.isPrefixOf(t)))!==void 0||this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))!==void 0}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(e.length===0)throw this.createError("Document fields must not be empty");if(md(this.dataSource)&&My.test(e))throw this.createError('Document fields cannot begin and end with "__"')}}class xy{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||ci(e)}createContext(e,t,r,s=!1){return new ma({dataSource:e,methodName:t,targetDoc:r,path:Ee.emptyPath(),arrayElement:!1,hasConverter:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function di(n){const e=n._freezeSettings(),t=ci(n._databaseId);return new xy(n._databaseId,!!e.ignoreUndefinedProperties,t)}function gd(n,e,t,r,s,i={}){const a=n.createContext(i.merge||i.mergeFields?2:0,e,t,s);ga("Data must be an object, but it was:",a,r);const l=_d(r,a);let u,d;if(i.merge)u=new xe(a.fieldMask),d=a.fieldTransforms;else if(i.mergeFields){const f=[];for(const _ of i.mergeFields){const g=ln(e,_,t);if(!a.contains(g))throw new D(b.INVALID_ARGUMENT,`Field '${g}' is specified in your field mask but missing from your input data.`);Id(f,g)||f.push(g)}u=new xe(f),d=a.fieldTransforms.filter((_=>u.covers(_.field)))}else u=null,d=a.fieldTransforms;return new Ly(new Oe(l),u,d)}class fi extends pa{_toFieldTransform(e){if(e.dataSource!==2)throw e.dataSource===1?e.createError(`${this._methodName}() can only appear at the top level of your update data`):e.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof fi}}function Fy(n,e,t,r){const s=n.createContext(1,e,t);ga("Data must be an object, but it was:",s,r);const i=[],a=Oe.empty();Gt(r,((u,d)=>{const f=Ed(e,u,t);d=le(d);const _=s.childContextForFieldPath(f);if(d instanceof fi)i.push(f);else{const g=Hr(d,_);g!=null&&(i.push(f),a.set(f,g))}}));const l=new xe(i);return new pd(a,l,s.fieldTransforms)}function Uy(n,e,t,r,s,i){const a=n.createContext(1,e,t),l=[ln(e,r,t)],u=[s];if(i.length%2!=0)throw new D(b.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let g=0;g<i.length;g+=2)l.push(ln(e,i[g])),u.push(i[g+1]);const d=[],f=Oe.empty();for(let g=l.length-1;g>=0;--g)if(!Id(d,l[g])){const C=l[g];let k=u[g];k=le(k);const V=a.childContextForFieldPath(C);if(k instanceof fi)d.push(C);else{const M=Hr(k,V);M!=null&&(d.push(C),f.set(C,M))}}const _=new xe(d);return new pd(f,_,a.fieldTransforms)}function By(n,e,t,r=!1){return Hr(t,n.createContext(r?4:3,e))}function Hr(n,e){if(yd(n=le(n)))return ga("Unsupported field value:",e,n),_d(n,e);if(n instanceof pa)return(function(r,s){if(!md(s.dataSource))throw s.createError(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.createError(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)})(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.arrayElement&&e.dataSource!==4)throw e.createError("Nested arrays are not supported");return(function(r,s){const i=[];let a=0;for(const l of r){let u=Hr(l,s.childContextForArray(a));u==null&&(u={nullValue:"NULL_VALUE"}),i.push(u),a++}return{arrayValue:{values:i}}})(n,e)}return(function(r,s){if((r=le(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return wg(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=ee.fromDate(r);return{timestampValue:xs(s.serializer,i)}}if(r instanceof ee){const i=new ee(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:xs(s.serializer,i)}}if(r instanceof Ze)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Ue)return{bytesValue:Dh(s.serializer,r._byteString)};if(r instanceof se){const i=s.databaseId,a=r.firestore._databaseId;if(!a.isEqual(i))throw s.createError(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:Xo(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof qe)return(function(a,l){const u=a instanceof qe?a.toArray():a;return{mapValue:{fields:{[ah]:{stringValue:ch},[Os]:{arrayValue:{values:u.map((f=>{if(typeof f!="number")throw l.createError("VectorValues must only contain numeric values.");return Ko(l.serializer,f)}))}}}}}})(r,s);if(Uh(r))return r._toProto(s.serializer);throw s.createError(`Unsupported field value: ${Zs(r)}`)})(n,e)}function _d(n,e){const t={};return th(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Gt(n,((r,s)=>{const i=Hr(s,e.childContextForField(r));i!=null&&(t[r]=i)})),{mapValue:{fields:t}}}function yd(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof ee||n instanceof Ze||n instanceof Ue||n instanceof se||n instanceof pa||n instanceof qe||Uh(n))}function ga(n,e,t){if(!yd(t)||!Zu(t)){const r=Zs(t);throw r==="an object"?e.createError(n+" a custom object"):e.createError(n+" "+r)}}function ln(n,e,t){if((e=le(e))instanceof fa)return e._internalPath;if(typeof e=="string")return Ed(n,e);throw $s("Field path arguments must be of type string or ",n,!1,void 0,t)}const $y=new RegExp("[~\\*/\\[\\]]");function Ed(n,e,t){if(e.search($y)>=0)throw $s(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new fa(...e.split("."))._internalPath}catch{throw $s(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function $s(n,e,t,r,s){const i=r&&!r.isEmpty(),a=s!==void 0;let l=`Function ${e}() called with invalid data`;t&&(l+=" (via `toFirestore()`)"),l+=". ";let u="";return(i||a)&&(u+=" (found",i&&(u+=` in field ${r}`),a&&(u+=` in document ${s}`),u+=")"),new D(b.INVALID_ARGUMENT,l+n+u)}function Id(n,e){return n.some((t=>t.isEqual(e)))}class jy{convertValue(e,t="none"){switch($t(e)){case 0:return null;case 1:return e.booleanValue;case 2:return re(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Bt(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw x(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return Gt(e,((s,i)=>{r[s]=this.convertValue(i,t)})),r}convertVectorValue(e){const t=e.fields?.[Os].arrayValue?.values?.map((r=>re(r.doubleValue)));return new qe(t)}convertGeoPoint(e){return new Ze(re(e.latitude),re(e.longitude))}convertArray(e,t){return(e.values||[]).map((r=>this.convertValue(r,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const r=ni(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(br(e));default:return null}}convertTimestamp(e){const t=Ut(e);return new ee(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=X.fromString(e);Q(Fh(r),9688,{name:e});const s=new Pr(r.get(1),r.get(3)),i=new L(r.popFirst(5));return s.isEqual(t)||ht(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}class Td extends jy{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ue(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new se(this.firestore,null,t)}}const $l="@firebase/firestore",jl="4.10.0";class vd{constructor(e,t,r,s,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new se(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new qy(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}_fieldsProto(){return this._document?.data.clone().value.mapValue.fields??void 0}get(e){if(this._document){const t=this._document.data.field(ln("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class qy extends vd{data(){return super.data()}}function Hy(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new D(b.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class _a{}class wd extends _a{}function hr(n,e,...t){let r=[];e instanceof _a&&r.push(e),r=r.concat(t),(function(i){const a=i.filter((u=>u instanceof ya)).length,l=i.filter((u=>u instanceof pi)).length;if(a>1||a>0&&l>0)throw new D(b.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(r);for(const s of r)n=s._apply(n);return n}class pi extends wd{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new pi(e,t,r)}_apply(e){const t=this._parse(e);return Ad(e._query,t),new pn(e.firestore,e.converter,_o(e._query,t))}_parse(e){const t=di(e.firestore);return(function(i,a,l,u,d,f,_){let g;if(d.isKeyField()){if(f==="array-contains"||f==="array-contains-any")throw new D(b.INVALID_ARGUMENT,`Invalid Query. You can't perform '${f}' queries on documentId().`);if(f==="in"||f==="not-in"){Hl(_,f);const k=[];for(const V of _)k.push(ql(u,i,V));g={arrayValue:{values:k}}}else g=ql(u,i,_)}else f!=="in"&&f!=="not-in"&&f!=="array-contains-any"||Hl(_,f),g=By(l,a,_,f==="in"||f==="not-in");return ae.create(d,f,g)})(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function En(n,e,t){const r=e,s=ln("where",n);return pi._create(s,r,t)}class ya extends _a{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new ya(e,t)}_parse(e){const t=this._queryConstraints.map((r=>r._parse(e))).filter((r=>r.getFilters().length>0));return t.length===1?t[0]:We.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:((function(s,i){let a=s;const l=i.getFlattenedFilters();for(const u of l)Ad(a,u),a=_o(a,u)})(e._query,t),new pn(e.firestore,e.converter,_o(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class Ea extends wd{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Ea(e,t)}_apply(e){const t=(function(s,i,a){if(s.startAt!==null)throw new D(b.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new D(b.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Nr(i,a)})(e._query,this._field,this._direction);return new pn(e.firestore,e.converter,mg(e._query,t))}}function eo(n,e="asc"){const t=e,r=ln("orderBy",n);return Ea._create(r,t)}function ql(n,e,t){if(typeof(t=le(t))=="string"){if(t==="")throw new D(b.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!gh(e)&&t.indexOf("/")!==-1)throw new D(b.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(X.fromString(t));if(!L.isDocumentKey(r))throw new D(b.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return sl(n,new L(r))}if(t instanceof se)return sl(n,t._key);throw new D(b.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Zs(t)}.`)}function Hl(n,e){if(!Array.isArray(n)||n.length===0)throw new D(b.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Ad(n,e){const t=(function(s,i){for(const a of s)for(const l of a.getFlattenedFilters())if(i.indexOf(l.op)>=0)return l.op;return null})(n.filters,(function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(t!==null)throw t===e.op?new D(b.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new D(b.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function Sd(n,e,t){let r;return r=n?n.toFirestore(e):e,r}class _r{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class nn extends vd{constructor(e,t,r,s,i,a){super(e,t,r,s,a),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new ws(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(ln("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new D(b.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=nn._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}nn._jsonSchemaVersion="firestore/documentSnapshot/1.0",nn._jsonSchema={type:ce("string",nn._jsonSchemaVersion),bundleSource:ce("string","DocumentSnapshot"),bundleName:ce("string"),bundle:ce("string")};class ws extends nn{data(e={}){return super.data(e)}}class bn{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new _r(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((r=>{e.call(t,new ws(this._firestore,this._userDataWriter,r.key,r,new _r(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new D(b.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(s,i){if(s._snapshot.oldDocs.isEmpty()){let a=0;return s._snapshot.docChanges.map((l=>{const u=new ws(s._firestore,s._userDataWriter,l.doc.key,l.doc,new _r(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);return l.doc,{type:"added",doc:u,oldIndex:-1,newIndex:a++}}))}{let a=s._snapshot.oldDocs;return s._snapshot.docChanges.filter((l=>i||l.type!==3)).map((l=>{const u=new ws(s._firestore,s._userDataWriter,l.doc.key,l.doc,new _r(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);let d=-1,f=-1;return l.type!==0&&(d=a.indexOf(l.doc.key),a=a.delete(l.doc.key)),l.type!==1&&(a=a.add(l.doc),f=a.indexOf(l.doc.key)),{type:Gy(l.type),doc:u,oldIndex:d,newIndex:f}}))}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new D(b.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=bn._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=$o.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],r=[],s=[];return this.docs.forEach((i=>{i._document!==null&&(t.push(i._document),r.push(this._userDataWriter.convertObjectMap(i._document.data.value.mapValue.fields,"previous")),s.push(i.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function Gy(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return x(61501,{type:n})}}bn._jsonSchemaVersion="firestore/querySnapshot/1.0",bn._jsonSchema={type:ce("string",bn._jsonSchemaVersion),bundleSource:ce("string","QuerySnapshot"),bundleName:ce("string"),bundle:ce("string")};function Wy(n){n=Ge(n,se);const e=Ge(n.firestore,mn),t=da(e);return Cy(t,n._key).then((r=>Ky(e,n,r)))}function dr(n){n=Ge(n,pn);const e=Ge(n.firestore,mn),t=da(e),r=new Td(e);return Hy(n._query),by(t,n._query).then((s=>new bn(e,r,n,s)))}function Gl(n,e,t){n=Ge(n,se);const r=Ge(n.firestore,mn),s=Sd(n.converter,e),i=di(r);return mi(r,[gd(i,"setDoc",n._key,s,n.converter!==null,t).toMutation(n._key,Be.none())])}function zy(n,e,t,...r){n=Ge(n,se);const s=Ge(n.firestore,mn),i=di(s);let a;return a=typeof(e=le(e))=="string"||e instanceof fa?Uy(i,"updateDoc",n._key,e,t,r):Fy(i,"updateDoc",n._key,e),mi(s,[a.toMutation(n._key,Be.exists(!0))])}function to(n){return mi(Ge(n.firestore,mn),[new Qo(n._key,Be.none())])}function no(n,e){const t=Ge(n.firestore,mn),r=wt(n),s=Sd(n.converter,e),i=di(n.firestore);return mi(t,[gd(i,"addDoc",r._key,s,n.converter!==null,{}).toMutation(r._key,Be.exists(!1))]).then((()=>r))}function mi(n,e){const t=da(n);return Py(t,e)}function Ky(n,e,t){const r=t.docs.get(e._key),s=new Td(n);return new nn(n,s,e._key,r,new _r(t.hasPendingWrites,t.fromCache),e.converter)}(function(e,t=!0){Pm($n),on(new xt("firestore",((r,{instanceIdentifier:s,options:i})=>{const a=r.getProvider("app").getImmediate(),l=new mn(new Dm(r.getProvider("auth-internal")),new Mm(a,r.getProvider("app-check-internal")),Xm(a,s),a);return i={useFetchStreams:t,...i},l._setSettings(i),l}),"PUBLIC").setMultipleInstances(!0)),Ye($l,jl,e),Ye($l,jl,"esm2020")})();function Rd(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const Qy=Rd,Cd=new xr("auth","Firebase",Rd());const js=new xo("@firebase/auth");function Yy(n,...e){js.logLevel<=j.WARN&&js.warn(`Auth (${$n}): ${n}`,...e)}function As(n,...e){js.logLevel<=j.ERROR&&js.error(`Auth (${$n}): ${n}`,...e)}function rt(n,...e){throw Ta(n,...e)}function He(n,...e){return Ta(n,...e)}function Ia(n,e,t){const r={...Qy(),[e]:t};return new xr("auth","Firebase",r).create(e,{appName:n.name})}function rn(n){return Ia(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Jy(n,e,t){const r=t;if(!(e instanceof r))throw r.name!==e.constructor.name&&rt(n,"argument-error"),Ia(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function Ta(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return Cd.create(n,...e)}function F(n,e,...t){if(!n)throw Ta(e,...t)}function ot(n){const e="INTERNAL ASSERTION FAILED: "+n;throw As(e),new Error(e)}function ft(n,e){n||ot(e)}function bo(){return typeof self<"u"&&self.location?.href||""}function Xy(){return Wl()==="http:"||Wl()==="https:"}function Wl(){return typeof self<"u"&&self.location?.protocol||null}function Zy(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Xy()||op()||"connection"in navigator)?navigator.onLine:!0}function eE(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}class Gr{constructor(e,t){this.shortDelay=e,this.longDelay=t,ft(t>e,"Short delay should be less than long delay!"),this.isMobile=rp()||ap()}get(){return Zy()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function va(n,e){ft(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}class bd{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;ot("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;ot("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;ot("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const tE={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};const nE=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],rE=new Gr(3e4,6e4);function wa(n,e){return n.tenantId&&!e.tenantId?{...e,tenantId:n.tenantId}:e}async function zn(n,e,t,r,s={}){return Pd(n,s,async()=>{let i={},a={};r&&(e==="GET"?a=r:i={body:JSON.stringify(r)});const l=Fr({key:n.config.apiKey,...a}).slice(1),u=await n._getAdditionalHeaders();u["Content-Type"]="application/json",n.languageCode&&(u["X-Firebase-Locale"]=n.languageCode);const d={method:e,headers:u,...i};return ip()||(d.referrerPolicy="no-referrer"),n.emulatorConfig&&Ht(n.emulatorConfig.host)&&(d.credentials="include"),bd.fetch()(await kd(n,n.config.apiHost,t,l),d)})}async function Pd(n,e,t){n._canInitEmulator=!1;const r={...tE,...e};try{const s=new iE(n),i=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const a=await i.json();if("needConfirmation"in a)throw gs(n,"account-exists-with-different-credential",a);if(i.ok&&!("errorMessage"in a))return a;{const l=i.ok?a.errorMessage:a.error.message,[u,d]=l.split(" : ");if(u==="FEDERATED_USER_ID_ALREADY_LINKED")throw gs(n,"credential-already-in-use",a);if(u==="EMAIL_EXISTS")throw gs(n,"email-already-in-use",a);if(u==="USER_DISABLED")throw gs(n,"user-disabled",a);const f=r[u]||u.toLowerCase().replace(/[_\s]+/g,"-");if(d)throw Ia(n,f,d);rt(n,f)}}catch(s){if(s instanceof st)throw s;rt(n,"network-request-failed",{message:String(s)})}}async function sE(n,e,t,r,s={}){const i=await zn(n,e,t,r,s);return"mfaPendingCredential"in i&&rt(n,"multi-factor-auth-required",{_serverResponse:i}),i}async function kd(n,e,t,r){const s=`${e}${t}?${r}`,i=n,a=i.config.emulator?va(n.config,s):`${n.config.apiScheme}://${s}`;return nE.includes(t)&&(await i._persistenceManagerAvailable,i._getPersistenceType()==="COOKIE")?i._getPersistence()._getFinalTarget(a).toString():a}class iE{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(He(this.auth,"network-request-failed")),rE.get())})}}function gs(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const s=He(n,e,r);return s.customData._tokenResponse=t,s}async function oE(n,e){return zn(n,"POST","/v1/accounts:delete",e)}async function qs(n,e){return zn(n,"POST","/v1/accounts:lookup",e)}function wr(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function aE(n,e=!1){const t=le(n),r=await t.getIdToken(e),s=Aa(r);F(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,a=i?.sign_in_provider;return{claims:s,token:r,authTime:wr(ro(s.auth_time)),issuedAtTime:wr(ro(s.iat)),expirationTime:wr(ro(s.exp)),signInProvider:a||null,signInSecondFactor:i?.sign_in_second_factor||null}}function ro(n){return Number(n)*1e3}function Aa(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return As("JWT malformed, contained fewer than 3 sections"),null;try{const s=Vu(t);return s?JSON.parse(s):(As("Failed to decode base64 JWT payload"),null)}catch(s){return As("Caught error parsing JWT payload as JSON",s?.toString()),null}}function zl(n){const e=Aa(n);return F(e,"internal-error"),F(typeof e.exp<"u","internal-error"),F(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}async function Vr(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof st&&cE(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function cE({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}class lE{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class Po{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=wr(this.lastLoginAt),this.creationTime=wr(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function Hs(n){const e=n.auth,t=await n.getIdToken(),r=await Vr(n,qs(e,{idToken:t}));F(r?.users.length,e,"internal-error");const s=r.users[0];n._notifyReloadListener(s);const i=s.providerUserInfo?.length?Nd(s.providerUserInfo):[],a=hE(n.providerData,i),l=n.isAnonymous,u=!(n.email&&s.passwordHash)&&!a?.length,d=l?u:!1,f={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new Po(s.createdAt,s.lastLoginAt),isAnonymous:d};Object.assign(n,f)}async function uE(n){const e=le(n);await Hs(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function hE(n,e){return[...n.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function Nd(n){return n.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}async function dE(n,e){const t=await Pd(n,{},async()=>{const r=Fr({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=n.config,a=await kd(n,s,"/v1/token",`key=${i}`),l=await n._getAdditionalHeaders();l["Content-Type"]="application/x-www-form-urlencoded";const u={method:"POST",headers:l,body:r};return n.emulatorConfig&&Ht(n.emulatorConfig.host)&&(u.credentials="include"),bd.fetch()(a,u)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function fE(n,e){return zn(n,"POST","/v2/accounts:revokeToken",wa(n,e))}class Pn{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){F(e.idToken,"internal-error"),F(typeof e.idToken<"u","internal-error"),F(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):zl(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){F(e.length!==0,"internal-error");const t=zl(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(F(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:s,expiresIn:i}=await dE(e,t);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:s,expirationTime:i}=t,a=new Pn;return r&&(F(typeof r=="string","internal-error",{appName:e}),a.refreshToken=r),s&&(F(typeof s=="string","internal-error",{appName:e}),a.accessToken=s),i&&(F(typeof i=="number","internal-error",{appName:e}),a.expirationTime=i),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Pn,this.toJSON())}_performRefresh(){return ot("not implemented")}}function vt(n,e){F(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class je{constructor({uid:e,auth:t,stsTokenManager:r,...s}){this.providerId="firebase",this.proactiveRefresh=new lE(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new Po(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const t=await Vr(this,this.stsTokenManager.getToken(this.auth,e));return F(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return aE(this,e)}reload(){return uE(this)}_assign(e){this!==e&&(F(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new je({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){F(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await Hs(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Fe(this.auth.app))return Promise.reject(rn(this.auth));const e=await this.getIdToken();return await Vr(this,oE(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const r=t.displayName??void 0,s=t.email??void 0,i=t.phoneNumber??void 0,a=t.photoURL??void 0,l=t.tenantId??void 0,u=t._redirectEventId??void 0,d=t.createdAt??void 0,f=t.lastLoginAt??void 0,{uid:_,emailVerified:g,isAnonymous:C,providerData:k,stsTokenManager:V}=t;F(_&&V,e,"internal-error");const M=Pn.fromJSON(this.name,V);F(typeof _=="string",e,"internal-error"),vt(r,e.name),vt(s,e.name),F(typeof g=="boolean",e,"internal-error"),F(typeof C=="boolean",e,"internal-error"),vt(i,e.name),vt(a,e.name),vt(l,e.name),vt(u,e.name),vt(d,e.name),vt(f,e.name);const G=new je({uid:_,auth:e,email:s,emailVerified:g,displayName:r,isAnonymous:C,photoURL:a,phoneNumber:i,tenantId:l,stsTokenManager:M,createdAt:d,lastLoginAt:f});return k&&Array.isArray(k)&&(G.providerData=k.map(K=>({...K}))),u&&(G._redirectEventId=u),G}static async _fromIdTokenResponse(e,t,r=!1){const s=new Pn;s.updateFromServerResponse(t);const i=new je({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await Hs(i),i}static async _fromGetAccountInfoResponse(e,t,r){const s=t.users[0];F(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?Nd(s.providerUserInfo):[],a=!(s.email&&s.passwordHash)&&!i?.length,l=new Pn;l.updateFromIdToken(r);const u=new je({uid:s.localId,auth:e,stsTokenManager:l,isAnonymous:a}),d={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new Po(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!i?.length};return Object.assign(u,d),u}}const Kl=new Map;function at(n){ft(n instanceof Function,"Expected a class definition");let e=Kl.get(n);return e?(ft(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,Kl.set(n,e),e)}class Dd{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Dd.type="NONE";const Ql=Dd;function Ss(n,e,t){return`firebase:${n}:${e}:${t}`}class kn{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=Ss(this.userKey,s.apiKey,i),this.fullPersistenceKey=Ss("persistence",s.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await qs(this.auth,{idToken:e}).catch(()=>{});return t?je._fromGetAccountInfoResponse(this.auth,t,e):null}return je._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new kn(at(Ql),e,r);const s=(await Promise.all(t.map(async d=>{if(await d._isAvailable())return d}))).filter(d=>d);let i=s[0]||at(Ql);const a=Ss(r,e.config.apiKey,e.name);let l=null;for(const d of t)try{const f=await d._get(a);if(f){let _;if(typeof f=="string"){const g=await qs(e,{idToken:f}).catch(()=>{});if(!g)break;_=await je._fromGetAccountInfoResponse(e,g,f)}else _=je._fromJSON(e,f);d!==i&&(l=_),i=d;break}}catch{}const u=s.filter(d=>d._shouldAllowMigration);return!i._shouldAllowMigration||!u.length?new kn(i,e,r):(i=u[0],l&&await i._set(a,l.toJSON()),await Promise.all(t.map(async d=>{if(d!==i)try{await d._remove(a)}catch{}})),new kn(i,e,r))}}function Yl(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(Ld(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Od(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Fd(e))return"Blackberry";if(Ud(e))return"Webos";if(Vd(e))return"Safari";if((e.includes("chrome/")||Md(e))&&!e.includes("edge/"))return"Chrome";if(xd(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if(r?.length===2)return r[1]}return"Other"}function Od(n=Re()){return/firefox\//i.test(n)}function Vd(n=Re()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Md(n=Re()){return/crios\//i.test(n)}function Ld(n=Re()){return/iemobile/i.test(n)}function xd(n=Re()){return/android/i.test(n)}function Fd(n=Re()){return/blackberry/i.test(n)}function Ud(n=Re()){return/webos/i.test(n)}function Sa(n=Re()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function pE(n=Re()){return Sa(n)&&!!window.navigator?.standalone}function mE(){return cp()&&document.documentMode===10}function Bd(n=Re()){return Sa(n)||xd(n)||Ud(n)||Fd(n)||/windows phone/i.test(n)||Ld(n)}function $d(n,e=[]){let t;switch(n){case"Browser":t=Yl(Re());break;case"Worker":t=`${Yl(Re())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${$n}/${r}`}class gE{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=i=>new Promise((a,l)=>{try{const u=e(i);a(u)}catch(u){l(u)}});r.onAbort=t,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}}}async function _E(n,e={}){return zn(n,"GET","/v2/passwordPolicy",wa(n,e))}const yE=6;class EE{constructor(e){const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??yE,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}class IE{constructor(e,t,r,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Jl(this),this.idTokenSubscription=new Jl(this),this.beforeStateQueue=new gE(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Cd,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion,this._persistenceManagerAvailable=new Promise(i=>this._resolvePersistenceManagerAvailable=i)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=at(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await kn.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await qs(this,{idToken:e}),r=await je._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(Fe(this.app)){const i=this.app.settings.authIdToken;return i?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(i).then(a,a))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let r=t,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const i=this.redirectUser?._redirectEventId,a=r?._redirectEventId,l=await this.tryRedirectSignIn(e);(!i||i===a)&&l?.user&&(r=l.user,s=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(r)}catch(i){r=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(i))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return F(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Hs(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=eE()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Fe(this.app))return Promise.reject(rn(this));const t=e?le(e):null;return t&&F(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&F(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Fe(this.app)?Promise.reject(rn(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Fe(this.app)?Promise.reject(rn(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(at(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await _E(this),t=new EE(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new xr("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await fE(this,r)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&at(e)||this._popupRedirectResolver;F(t,this,"argument-error"),this.redirectPersistenceManager=await kn.create(this,[at(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,s){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let a=!1;const l=this._isInitialized?Promise.resolve():this._initializationPromise;if(F(l,this,"internal-error"),l.then(()=>{a||i(this.currentUser)}),typeof t=="function"){const u=e.addObserver(t,r,s);return()=>{a=!0,u()}}else{const u=e.addObserver(t);return()=>{a=!0,u()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return F(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=$d(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){if(Fe(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&Yy(`Error while retrieving App Check token: ${e.error}`),e?.token}}function gi(n){return le(n)}class Jl{constructor(e){this.auth=e,this.observer=null,this.addObserver=gp(t=>this.observer=t)}get next(){return F(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let Ra={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function TE(n){Ra=n}function vE(n){return Ra.loadJS(n)}function wE(){return Ra.gapiScript}function AE(n){return`__${n}${Math.floor(Math.random()*1e6)}`}function SE(n,e){const t=Xs(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),i=t.getOptions();if(sn(i,e??{}))return s;rt(s,"already-initialized")}return t.initialize({options:e})}function RE(n,e){const t=e?.persistence||[],r=(Array.isArray(t)?t:[t]).map(at);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e?.popupRedirectResolver)}function CE(n,e,t){const r=gi(n);F(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!1,i=jd(e),{host:a,port:l}=bE(e),u=l===null?"":`:${l}`,d={url:`${i}//${a}${u}/`},f=Object.freeze({host:a,port:l,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!r._canInitEmulator){F(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),F(sn(d,r.config.emulator)&&sn(f,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=d,r.emulatorConfig=f,r.settings.appVerificationDisabledForTesting=!0,Ht(a)?(Mo(`${i}//${a}${u}`),Lo("Auth",!0)):PE()}function jd(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function bE(n){const e=jd(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:Xl(r.substr(i.length+1))}}else{const[i,a]=r.split(":");return{host:i,port:Xl(a)}}}function Xl(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function PE(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}class qd{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return ot("not implemented")}_getIdTokenResponse(e){return ot("not implemented")}_linkToIdToken(e,t){return ot("not implemented")}_getReauthenticationResolver(e){return ot("not implemented")}}async function Nn(n,e){return sE(n,"POST","/v1/accounts:signInWithIdp",wa(n,e))}const kE="http://localhost";class un extends qd{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new un(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):rt("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,...i}=t;if(!r||!s)return null;const a=new un(r,s);return a.idToken=i.idToken||void 0,a.accessToken=i.accessToken||void 0,a.secret=i.secret,a.nonce=i.nonce,a.pendingToken=i.pendingToken||null,a}_getIdTokenResponse(e){const t=this.buildRequest();return Nn(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,Nn(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Nn(e,t)}buildRequest(){const e={requestUri:kE,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Fr(t)}return e}}class Ca{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class Wr extends Ca{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class St extends Wr{constructor(){super("facebook.com")}static credential(e){return un._fromParams({providerId:St.PROVIDER_ID,signInMethod:St.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return St.credentialFromTaggedObject(e)}static credentialFromError(e){return St.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return St.credential(e.oauthAccessToken)}catch{return null}}}St.FACEBOOK_SIGN_IN_METHOD="facebook.com";St.PROVIDER_ID="facebook.com";class it extends Wr{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return un._fromParams({providerId:it.PROVIDER_ID,signInMethod:it.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return it.credentialFromTaggedObject(e)}static credentialFromError(e){return it.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return it.credential(t,r)}catch{return null}}}it.GOOGLE_SIGN_IN_METHOD="google.com";it.PROVIDER_ID="google.com";class Rt extends Wr{constructor(){super("github.com")}static credential(e){return un._fromParams({providerId:Rt.PROVIDER_ID,signInMethod:Rt.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Rt.credentialFromTaggedObject(e)}static credentialFromError(e){return Rt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Rt.credential(e.oauthAccessToken)}catch{return null}}}Rt.GITHUB_SIGN_IN_METHOD="github.com";Rt.PROVIDER_ID="github.com";class Ct extends Wr{constructor(){super("twitter.com")}static credential(e,t){return un._fromParams({providerId:Ct.PROVIDER_ID,signInMethod:Ct.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Ct.credentialFromTaggedObject(e)}static credentialFromError(e){return Ct.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return Ct.credential(t,r)}catch{return null}}}Ct.TWITTER_SIGN_IN_METHOD="twitter.com";Ct.PROVIDER_ID="twitter.com";class Fn{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,s=!1){const i=await je._fromIdTokenResponse(e,r,s),a=Zl(r);return new Fn({user:i,providerId:a,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const s=Zl(r);return new Fn({user:e,providerId:s,_tokenResponse:r,operationType:t})}}function Zl(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}class Gs extends st{constructor(e,t,r,s){super(t.code,t.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,Gs.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,s){return new Gs(e,t,r,s)}}function Hd(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?Gs._fromErrorAndOperation(n,i,e,r):i})}async function NE(n,e,t=!1){const r=await Vr(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return Fn._forOperation(n,"link",r)}async function DE(n,e,t=!1){const{auth:r}=n;if(Fe(r.app))return Promise.reject(rn(r));const s="reauthenticate";try{const i=await Vr(n,Hd(r,s,e,n),t);F(i.idToken,r,"internal-error");const a=Aa(i.idToken);F(a,r,"internal-error");const{sub:l}=a;return F(n.uid===l,r,"user-mismatch"),Fn._forOperation(n,s,i)}catch(i){throw i?.code==="auth/user-not-found"&&rt(r,"user-mismatch"),i}}async function OE(n,e,t=!1){if(Fe(n.app))return Promise.reject(rn(n));const r="signIn",s=await Hd(n,r,e),i=await Fn._fromIdTokenResponse(n,r,s);return t||await n._updateCurrentUser(i.user),i}function VE(n,e,t,r){return le(n).onIdTokenChanged(e,t,r)}function ME(n,e,t){return le(n).beforeAuthStateChanged(e,t)}function LE(n,e,t,r){return le(n).onAuthStateChanged(e,t,r)}function xE(n){return le(n).signOut()}const Ws="__sak";class Gd{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Ws,"1"),this.storage.removeItem(Ws),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}const FE=1e3,UE=10;class Wd extends Gd{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Bd(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),s=this.localCache[t];r!==s&&e(t,s,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((a,l,u)=>{this.notifyListeners(a,u)});return}const r=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const a=this.storage.getItem(r);!t&&this.localCache[r]===a||this.notifyListeners(r,a)},i=this.storage.getItem(r);mE()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,UE):s()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},FE)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}Wd.type="LOCAL";const BE=Wd;class zd extends Gd{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}zd.type="SESSION";const Kd=zd;function $E(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}class _i{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const r=new _i(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:s,data:i}=t.data,a=this.handlersMap[s];if(!a?.size)return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const l=Array.from(a).map(async d=>d(t.origin,i)),u=await $E(l);t.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:u})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}_i.receivers=[];function ba(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}class jE{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,a;return new Promise((l,u)=>{const d=ba("",20);s.port1.start();const f=setTimeout(()=>{u(new Error("unsupported_event"))},r);a={messageChannel:s,onMessage(_){const g=_;if(g.data.eventId===d)switch(g.data.status){case"ack":clearTimeout(f),i=setTimeout(()=>{u(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),l(g.data.response);break;default:clearTimeout(f),clearTimeout(i),u(new Error("invalid_response"));break}}},this.handlers.add(a),s.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:e,eventId:d,data:t},[s.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})}}function et(){return window}function qE(n){et().location.href=n}function Qd(){return typeof et().WorkerGlobalScope<"u"&&typeof et().importScripts=="function"}async function HE(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function GE(){return navigator?.serviceWorker?.controller||null}function WE(){return Qd()?self:null}const Yd="firebaseLocalStorageDb",zE=1,zs="firebaseLocalStorage",Jd="fbase_key";class zr{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function yi(n,e){return n.transaction([zs],e?"readwrite":"readonly").objectStore(zs)}function KE(){const n=indexedDB.deleteDatabase(Yd);return new zr(n).toPromise()}function ko(){const n=indexedDB.open(Yd,zE);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(zs,{keyPath:Jd})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(zs)?e(r):(r.close(),await KE(),e(await ko()))})})}async function eu(n,e,t){const r=yi(n,!0).put({[Jd]:e,value:t});return new zr(r).toPromise()}async function QE(n,e){const t=yi(n,!1).get(e),r=await new zr(t).toPromise();return r===void 0?null:r.value}function tu(n,e){const t=yi(n,!0).delete(e);return new zr(t).toPromise()}const YE=800,JE=3;class Xd{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await ko(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>JE)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Qd()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=_i._getInstance(WE()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await HE(),!this.activeServiceWorker)return;this.sender=new jE(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||GE()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await ko();return await eu(e,Ws,"1"),await tu(e,Ws),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>eu(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>QE(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>tu(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=yi(s,!1).getAll();return new zr(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),YE)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}Xd.type="LOCAL";const XE=Xd;new Gr(3e4,6e4);function Zd(n,e){return e?at(e):(F(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}class Pa extends qd{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Nn(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Nn(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Nn(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function ZE(n){return OE(n.auth,new Pa(n),n.bypassAuthState)}function eI(n){const{auth:e,user:t}=n;return F(t,e,"internal-error"),DE(t,new Pa(n),n.bypassAuthState)}async function tI(n){const{auth:e,user:t}=n;return F(t,e,"internal-error"),NE(t,new Pa(n),n.bypassAuthState)}class ef{constructor(e,t,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:s,tenantId:i,error:a,type:l}=e;if(a){this.reject(a);return}const u={auth:this.auth,requestUri:t,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(l)(u))}catch(d){this.reject(d)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return ZE;case"linkViaPopup":case"linkViaRedirect":return tI;case"reauthViaPopup":case"reauthViaRedirect":return eI;default:rt(this.auth,"internal-error")}}resolve(e){ft(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){ft(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const nI=new Gr(2e3,1e4);async function rI(n,e,t){if(Fe(n.app))return Promise.reject(He(n,"operation-not-supported-in-this-environment"));const r=gi(n);Jy(n,e,Ca);const s=Zd(r,t);return new tn(r,"signInViaPopup",e,s).executeNotNull()}class tn extends ef{constructor(e,t,r,s,i){super(e,t,s,i),this.provider=r,this.authWindow=null,this.pollId=null,tn.currentPopupAction&&tn.currentPopupAction.cancel(),tn.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return F(e,this.auth,"internal-error"),e}async onExecution(){ft(this.filter.length===1,"Popup operations only handle one event");const e=ba();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(He(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(He(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,tn.currentPopupAction=null}pollUserCancellation(){const e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(He(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,nI.get())};e()}}tn.currentPopupAction=null;const sI="pendingRedirect",Rs=new Map;class iI extends ef{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=Rs.get(this.auth._key());if(!e){try{const r=await oI(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}Rs.set(this.auth._key(),e)}return this.bypassAuthState||Rs.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function oI(n,e){const t=lI(e),r=cI(n);if(!await r._isAvailable())return!1;const s=await r._get(t)==="true";return await r._remove(t),s}function aI(n,e){Rs.set(n._key(),e)}function cI(n){return at(n._redirectPersistence)}function lI(n){return Ss(sI,n.config.apiKey,n.name)}async function uI(n,e,t=!1){if(Fe(n.app))return Promise.reject(rn(n));const r=gi(n),s=Zd(r,e),a=await new iI(r,s,t).execute();return a&&!t&&(delete a.user._redirectEventId,await r._persistUserIfCurrent(a.user),await r._setRedirectUser(null,e)),a}const hI=600*1e3;class dI{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!fI(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!tf(e)){const r=e.error.code?.split("auth/")[1]||"internal-error";t.onError(He(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=hI&&this.cachedEventUids.clear(),this.cachedEventUids.has(nu(e))}saveEventToCache(e){this.cachedEventUids.add(nu(e)),this.lastProcessedEventTime=Date.now()}}function nu(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function tf({type:n,error:e}){return n==="unknown"&&e?.code==="auth/no-auth-event"}function fI(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return tf(n);default:return!1}}async function pI(n,e={}){return zn(n,"GET","/v1/projects",e)}const mI=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,gI=/^https?/;async function _I(n){if(n.config.emulator)return;const{authorizedDomains:e}=await pI(n);for(const t of e)try{if(yI(t))return}catch{}rt(n,"unauthorized-domain")}function yI(n){const e=bo(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const a=new URL(n);return a.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&a.hostname===r}if(!gI.test(t))return!1;if(mI.test(n))return r===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}const EI=new Gr(3e4,6e4);function ru(){const n=et().___jsl;if(n?.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function II(n){return new Promise((e,t)=>{function r(){ru(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{ru(),t(He(n,"network-request-failed"))},timeout:EI.get()})}if(et().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if(et().gapi?.load)r();else{const s=AE("iframefcb");return et()[s]=()=>{gapi.load?r():t(He(n,"network-request-failed"))},vE(`${wE()}?onload=${s}`).catch(i=>t(i))}}).catch(e=>{throw Cs=null,e})}let Cs=null;function TI(n){return Cs=Cs||II(n),Cs}const vI=new Gr(5e3,15e3),wI="__/auth/iframe",AI="emulator/auth/iframe",SI={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},RI=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function CI(n){const e=n.config;F(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?va(e,AI):`https://${n.config.authDomain}/${wI}`,r={apiKey:e.apiKey,appName:n.name,v:$n},s=RI.get(n.config.apiHost);s&&(r.eid=s);const i=n._getFrameworks();return i.length&&(r.fw=i.join(",")),`${t}?${Fr(r).slice(1)}`}async function bI(n){const e=await TI(n),t=et().gapi;return F(t,n,"internal-error"),e.open({where:document.body,url:CI(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:SI,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const a=He(n,"network-request-failed"),l=et().setTimeout(()=>{i(a)},vI.get());function u(){et().clearTimeout(l),s(r)}r.ping(u).then(u,()=>{i(a)})}))}const PI={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},kI=500,NI=600,DI="_blank",OI="http://localhost";class su{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function VI(n,e,t,r=kI,s=NI){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString();let l="";const u={...PI,width:r.toString(),height:s.toString(),top:i,left:a},d=Re().toLowerCase();t&&(l=Md(d)?DI:t),Od(d)&&(e=e||OI,u.scrollbars="yes");const f=Object.entries(u).reduce((g,[C,k])=>`${g}${C}=${k},`,"");if(pE(d)&&l!=="_self")return MI(e||"",l),new su(null);const _=window.open(e||"",l,f);F(_,n,"popup-blocked");try{_.focus()}catch{}return new su(_)}function MI(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}const LI="__/auth/handler",xI="emulator/auth/handler",FI=encodeURIComponent("fac");async function iu(n,e,t,r,s,i){F(n.config.authDomain,n,"auth-domain-config-required"),F(n.config.apiKey,n,"invalid-api-key");const a={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:$n,eventId:s};if(e instanceof Ca){e.setDefaultLanguage(n.languageCode),a.providerId=e.providerId||"",mp(e.getCustomParameters())||(a.customParameters=JSON.stringify(e.getCustomParameters()));for(const[f,_]of Object.entries({}))a[f]=_}if(e instanceof Wr){const f=e.getScopes().filter(_=>_!=="");f.length>0&&(a.scopes=f.join(","))}n.tenantId&&(a.tid=n.tenantId);const l=a;for(const f of Object.keys(l))l[f]===void 0&&delete l[f];const u=await n._getAppCheckToken(),d=u?`#${FI}=${encodeURIComponent(u)}`:"";return`${UI(n)}?${Fr(l).slice(1)}${d}`}function UI({config:n}){return n.emulator?va(n,xI):`https://${n.authDomain}/${LI}`}const so="webStorageSupport";class BI{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Kd,this._completeRedirectFn=uI,this._overrideRedirectResult=aI}async _openPopup(e,t,r,s){ft(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");const i=await iu(e,t,r,bo(),s);return VI(e,i,ba())}async _openRedirect(e,t,r,s){await this._originValidation(e);const i=await iu(e,t,r,bo(),s);return qE(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:i}=this.eventManagers[t];return s?Promise.resolve(s):(ft(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await bI(e),r=new dI(e);return t.register("authEvent",s=>(F(s?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(so,{type:so},s=>{const i=s?.[0]?.[so];i!==void 0&&t(!!i),rt(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=_I(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Bd()||Vd()||Sa()}}const $I=BI;var ou="@firebase/auth",au="1.12.0";class jI{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){F(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function qI(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function HI(n){on(new xt("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:a,authDomain:l}=r.options;F(a&&!a.includes(":"),"invalid-api-key",{appName:r.name});const u={apiKey:a,authDomain:l,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:$d(n)},d=new IE(r,s,i,u);return RE(d,t),d},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),on(new xt("auth-internal",e=>{const t=gi(e.getProvider("auth").getImmediate());return(r=>new jI(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Ye(ou,au,qI(n)),Ye(ou,au,"esm2020")}const GI=300,WI=Fu("authIdTokenMaxAge")||GI;let cu=null;const zI=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>WI)return;const s=t?.token;cu!==s&&(cu=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function KI(n=Uo()){const e=Xs(n,"auth");if(e.isInitialized())return e.getImmediate();const t=SE(n,{popupRedirectResolver:$I,persistence:[XE,BE,Kd]}),r=Fu("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const a=zI(i.toString());ME(t,a,()=>a(t.currentUser)),VE(t,l=>a(l))}}const s=Mu("auth");return s&&CE(t,`http://${s}`),t}function QI(){return document.getElementsByTagName("head")?.[0]??document}TE({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=s=>{const i=He("internal-error");i.customData=s,t(i)},r.type="text/javascript",r.charset="UTF-8",QI().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});HI("Browser");const YI="type.googleapis.com/google.protobuf.Int64Value",JI="type.googleapis.com/google.protobuf.UInt64Value";function nf(n,e){const t={};for(const r in n)n.hasOwnProperty(r)&&(t[r]=e(n[r]));return t}function Ks(n){if(n==null)return null;if(n instanceof Number&&(n=n.valueOf()),typeof n=="number"&&isFinite(n)||n===!0||n===!1||Object.prototype.toString.call(n)==="[object String]")return n;if(n instanceof Date)return n.toISOString();if(Array.isArray(n))return n.map(e=>Ks(e));if(typeof n=="function"||typeof n=="object")return nf(n,e=>Ks(e));throw new Error("Data cannot be encoded in JSON: "+n)}function Un(n){if(n==null)return n;if(n["@type"])switch(n["@type"]){case YI:case JI:{const e=Number(n.value);if(isNaN(e))throw new Error("Data cannot be decoded from JSON: "+n);return e}default:throw new Error("Data cannot be decoded from JSON: "+n)}return Array.isArray(n)?n.map(e=>Un(e)):typeof n=="function"||typeof n=="object"?nf(n,e=>Un(e)):n}const ka="functions";const lu={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Ve extends st{constructor(e,t,r){super(`${ka}/${e}`,t||""),this.details=r,Object.setPrototypeOf(this,Ve.prototype)}}function XI(n){if(n>=200&&n<300)return"ok";switch(n){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}function Qs(n,e){let t=XI(n),r=t,s;try{const i=e&&e.error;if(i){const a=i.status;if(typeof a=="string"){if(!lu[a])return new Ve("internal","internal");t=lu[a],r=a}const l=i.message;typeof l=="string"&&(r=l),s=i.details,s!==void 0&&(s=Un(s))}}catch{}return t==="ok"?null:new Ve(t,r,s)}class ZI{constructor(e,t,r,s){this.app=e,this.auth=null,this.messaging=null,this.appCheck=null,this.serverAppAppCheckToken=null,Fe(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.auth=t.getImmediate({optional:!0}),this.messaging=r.getImmediate({optional:!0}),this.auth||t.get().then(i=>this.auth=i,()=>{}),this.messaging||r.get().then(i=>this.messaging=i,()=>{}),this.appCheck||s?.get().then(i=>this.appCheck=i,()=>{})}async getAuthToken(){if(this.auth)try{return(await this.auth.getToken())?.accessToken}catch{return}}async getMessagingToken(){if(!(!this.messaging||!("Notification"in self)||Notification.permission!=="granted"))try{return await this.messaging.getToken()}catch{return}}async getAppCheckToken(e){if(this.serverAppAppCheckToken)return this.serverAppAppCheckToken;if(this.appCheck){const t=e?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return t.error?null:t.token}return null}async getContext(e){const t=await this.getAuthToken(),r=await this.getMessagingToken(),s=await this.getAppCheckToken(e);return{authToken:t,messagingToken:r,appCheckToken:s}}}const No="us-central1",eT=/^data: (.*?)(?:\n|$)/;function tT(n){let e=null;return{promise:new Promise((t,r)=>{e=setTimeout(()=>{r(new Ve("deadline-exceeded","deadline-exceeded"))},n)}),cancel:()=>{e&&clearTimeout(e)}}}class nT{constructor(e,t,r,s,i=No,a=(...l)=>fetch(...l)){this.app=e,this.fetchImpl=a,this.emulatorOrigin=null,this.contextProvider=new ZI(e,t,r,s),this.cancelAllRequests=new Promise(l=>{this.deleteService=()=>Promise.resolve(l())});try{const l=new URL(i);this.customDomain=l.origin+(l.pathname==="/"?"":l.pathname),this.region=No}catch{this.customDomain=null,this.region=i}}_delete(){return this.deleteService()}_url(e){const t=this.app.options.projectId;return this.emulatorOrigin!==null?`${this.emulatorOrigin}/${t}/${this.region}/${e}`:this.customDomain!==null?`${this.customDomain}/${e}`:`https://${this.region}-${t}.cloudfunctions.net/${e}`}}function rT(n,e,t){const r=Ht(e);n.emulatorOrigin=`http${r?"s":""}://${e}:${t}`,r&&(Mo(n.emulatorOrigin+"/backends"),Lo("Functions",!0))}function sT(n,e,t){const r=s=>oT(n,e,s,{});return r.stream=(s,i)=>cT(n,e,s,i),r}function rf(n){return n.emulatorOrigin&&Ht(n.emulatorOrigin)?"include":void 0}async function iT(n,e,t,r,s){t["Content-Type"]="application/json";let i;try{i=await r(n,{method:"POST",body:JSON.stringify(e),headers:t,credentials:rf(s)})}catch{return{status:0,json:null}}let a=null;try{a=await i.json()}catch{}return{status:i.status,json:a}}async function sf(n,e){const t={},r=await n.contextProvider.getContext(e.limitedUseAppCheckTokens);return r.authToken&&(t.Authorization="Bearer "+r.authToken),r.messagingToken&&(t["Firebase-Instance-ID-Token"]=r.messagingToken),r.appCheckToken!==null&&(t["X-Firebase-AppCheck"]=r.appCheckToken),t}function oT(n,e,t,r){const s=n._url(e);return aT(n,s,t,r)}async function aT(n,e,t,r){t=Ks(t);const s={data:t},i=await sf(n,r),a=r.timeout||7e4,l=tT(a),u=await Promise.race([iT(e,s,i,n.fetchImpl,n),l.promise,n.cancelAllRequests]);if(l.cancel(),!u)throw new Ve("cancelled","Firebase Functions instance was deleted.");const d=Qs(u.status,u.json);if(d)throw d;if(!u.json)throw new Ve("internal","Response is not valid JSON object.");let f=u.json.data;if(typeof f>"u"&&(f=u.json.result),typeof f>"u")throw new Ve("internal","Response is missing data field.");return{data:Un(f)}}function cT(n,e,t,r){const s=n._url(e);return lT(n,s,t,r||{})}async function lT(n,e,t,r){t=Ks(t);const s={data:t},i=await sf(n,r);i["Content-Type"]="application/json",i.Accept="text/event-stream";let a;try{a=await n.fetchImpl(e,{method:"POST",body:JSON.stringify(s),headers:i,signal:r?.signal,credentials:rf(n)})}catch(g){if(g instanceof Error&&g.name==="AbortError"){const k=new Ve("cancelled","Request was cancelled.");return{data:Promise.reject(k),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(k)}}}}}}const C=Qs(0,null);return{data:Promise.reject(C),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(C)}}}}}}let l,u;const d=new Promise((g,C)=>{l=g,u=C});r?.signal?.addEventListener("abort",()=>{const g=new Ve("cancelled","Request was cancelled.");u(g)});const f=a.body.getReader(),_=uT(f,l,u,r?.signal);return{stream:{[Symbol.asyncIterator](){const g=_.getReader();return{async next(){const{value:C,done:k}=await g.read();return{value:C,done:k}},async return(){return await g.cancel(),{done:!0,value:void 0}}}}},data:d}}function uT(n,e,t,r){const s=(a,l)=>{const u=a.match(eT);if(!u)return;const d=u[1];try{const f=JSON.parse(d);if("result"in f){e(Un(f.result));return}if("message"in f){l.enqueue(Un(f.message));return}if("error"in f){const _=Qs(0,f);l.error(_),t(_);return}}catch(f){if(f instanceof Ve){l.error(f),t(f);return}}},i=new TextDecoder;return new ReadableStream({start(a){let l="";return u();async function u(){if(r?.aborted){const d=new Ve("cancelled","Request was cancelled");return a.error(d),t(d),Promise.resolve()}try{const{value:d,done:f}=await n.read();if(f){l.trim()&&s(l.trim(),a),a.close();return}if(r?.aborted){const g=new Ve("cancelled","Request was cancelled");a.error(g),t(g),await n.cancel();return}l+=i.decode(d,{stream:!0});const _=l.split(`
`);l=_.pop()||"";for(const g of _)g.trim()&&s(g.trim(),a);return u()}catch(d){const f=d instanceof Ve?d:Qs(0,null);a.error(f),t(f)}}},cancel(){return n.cancel()}})}const uu="@firebase/functions",hu="0.13.1";const hT="auth-internal",dT="app-check-internal",fT="messaging-internal";function pT(n){const e=(t,{instanceIdentifier:r})=>{const s=t.getProvider("app").getImmediate(),i=t.getProvider(hT),a=t.getProvider(fT),l=t.getProvider(dT);return new nT(s,i,a,l,r)};on(new xt(ka,e,"PUBLIC").setMultipleInstances(!0)),Ye(uu,hu,n),Ye(uu,hu,"esm2020")}function mT(n=Uo(),e=No){const r=Xs(le(n),ka).getImmediate({identifier:e}),s=Lu("functions");return s&&gT(r,...s),r}function gT(n,e,t){rT(le(n),e,t)}function _T(n,e,t){return sT(le(n),e)}pT();const yT={apiKey:"AIzaSyDYJnmOizWwLmdCxUAiEf9cwqCLL6NXvHs".trim(),authDomain:"aifoodjournal.firebaseapp.com".trim(),projectId:"aifoodjournal".trim(),storageBucket:"aifoodjournal.firebasestorage.app".trim(),messagingSenderId:"203981513764".trim(),appId:"1:203981513764:web:a7731a9de17a4c0c08e4b1".trim()},Na=$u(yT),Pe=Oy(Na),me=KI(Na),ET=mT(Na,"us-central1"),ke={SETTINGS:"settings",MEALS:"meals",SHOPPING:"shopping",WATER:"water",FAVORITES:"favorites",CHECKINS:"checkins"},he={getSettings:async()=>{const n=me.currentUser;if(!n)return{};const e=await Wy(wt(Pe,ke.SETTINGS,n.uid));return e.exists()?e.data():{}},saveSettings:async n=>{const e=me.currentUser;e&&await Gl(wt(Pe,ke.SETTINGS,e.uid),n)},getMeals:async n=>{const e=me.currentUser;if(!e)return[];const t=hr(Tt(Pe,ke.MEALS),En("userId","==",e.uid),eo("timestamp","desc")),s=(await dr(t)).docs.map(i=>({...i.data(),id:i.id}));return n?s.filter(i=>i.timestamp.startsWith(n)):s},addMeal:async n=>{const e=me.currentUser;if(e)return await no(Tt(Pe,ke.MEALS),{...n,userId:e.uid})},updateMeal:async(n,e)=>{me.currentUser&&await zy(wt(Pe,ke.MEALS,n),e)},deleteMeal:async n=>{me.currentUser&&await to(wt(Pe,ke.MEALS,n))},getFavorites:async()=>{const n=me.currentUser;if(!n)return[];const e=hr(Tt(Pe,ke.FAVORITES),En("userId","==",n.uid));return(await dr(e)).docs.map(r=>({...r.data(),id:r.id}))},addFavorite:async n=>{const e=me.currentUser;e&&await no(Tt(Pe,ke.FAVORITES),{...n,userId:e.uid,createdAt:new Date().toISOString()})},deleteFavorite:async n=>{me.currentUser&&await to(wt(Pe,ke.FAVORITES,n))},getWater:async n=>{const e=me.currentUser;if(!e)return 0;const t=hr(Tt(Pe,ke.WATER),En("userId","==",e.uid),En("date","==",n)),r=await dr(t);return r.empty?0:r.docs[0].data().amount||0},setWater:async(n,e)=>{const t=me.currentUser;if(!t)return;const r=`${t.uid}_${n}`;await Gl(wt(Pe,ke.WATER,r),{userId:t.uid,date:n,amount:e,timestamp:new Date().toISOString()})},getCheckins:async()=>{const n=me.currentUser;if(!n)return[];const e=hr(Tt(Pe,ke.CHECKINS),En("userId","==",n.uid),eo("timestamp","desc"));return(await dr(e)).docs.map(r=>({...r.data(),id:r.id}))},addCheckin:async n=>{const e=me.currentUser;e&&await no(Tt(Pe,ke.CHECKINS),{...n,userId:e.uid,timestamp:n.timestamp||new Date().toISOString()})},deleteCheckin:async n=>{me.currentUser&&await to(wt(Pe,ke.CHECKINS,n))},getShoppingList:async()=>{const n=me.currentUser;if(!n)return[];const e=hr(Tt(Pe,ke.SHOPPING),En("userId","==",n.uid),eo("timestamp","desc"));return(await dr(e)).docs.map(r=>({...r.data(),id:r.id}))}};var du;(function(n){n.STRING="string",n.NUMBER="number",n.INTEGER="integer",n.BOOLEAN="boolean",n.ARRAY="array",n.OBJECT="object"})(du||(du={}));var fu;(function(n){n.LANGUAGE_UNSPECIFIED="language_unspecified",n.PYTHON="python"})(fu||(fu={}));var pu;(function(n){n.OUTCOME_UNSPECIFIED="outcome_unspecified",n.OUTCOME_OK="outcome_ok",n.OUTCOME_FAILED="outcome_failed",n.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded"})(pu||(pu={}));const mu=["user","model","function","system"];var gu;(function(n){n.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",n.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",n.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",n.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",n.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",n.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY"})(gu||(gu={}));var _u;(function(n){n.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",n.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",n.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",n.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",n.BLOCK_NONE="BLOCK_NONE"})(_u||(_u={}));var yu;(function(n){n.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",n.NEGLIGIBLE="NEGLIGIBLE",n.LOW="LOW",n.MEDIUM="MEDIUM",n.HIGH="HIGH"})(yu||(yu={}));var Eu;(function(n){n.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",n.SAFETY="SAFETY",n.OTHER="OTHER"})(Eu||(Eu={}));var Ar;(function(n){n.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",n.STOP="STOP",n.MAX_TOKENS="MAX_TOKENS",n.SAFETY="SAFETY",n.RECITATION="RECITATION",n.LANGUAGE="LANGUAGE",n.BLOCKLIST="BLOCKLIST",n.PROHIBITED_CONTENT="PROHIBITED_CONTENT",n.SPII="SPII",n.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",n.OTHER="OTHER"})(Ar||(Ar={}));var Iu;(function(n){n.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",n.RETRIEVAL_QUERY="RETRIEVAL_QUERY",n.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",n.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",n.CLASSIFICATION="CLASSIFICATION",n.CLUSTERING="CLUSTERING"})(Iu||(Iu={}));var Tu;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.AUTO="AUTO",n.ANY="ANY",n.NONE="NONE"})(Tu||(Tu={}));var vu;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.MODE_DYNAMIC="MODE_DYNAMIC"})(vu||(vu={}));class Se extends Error{constructor(e){super(`[GoogleGenerativeAI Error]: ${e}`)}}class In extends Se{constructor(e,t){super(e),this.response=t}}class of extends Se{constructor(e,t,r,s){super(e),this.status=t,this.statusText=r,this.errorDetails=s}}class Lt extends Se{}class af extends Se{}const IT="https://generativelanguage.googleapis.com",TT="v1beta",vT="0.24.1",wT="genai-js";var hn;(function(n){n.GENERATE_CONTENT="generateContent",n.STREAM_GENERATE_CONTENT="streamGenerateContent",n.COUNT_TOKENS="countTokens",n.EMBED_CONTENT="embedContent",n.BATCH_EMBED_CONTENTS="batchEmbedContents"})(hn||(hn={}));class AT{constructor(e,t,r,s,i){this.model=e,this.task=t,this.apiKey=r,this.stream=s,this.requestOptions=i}toString(){var e,t;const r=((e=this.requestOptions)===null||e===void 0?void 0:e.apiVersion)||TT;let i=`${((t=this.requestOptions)===null||t===void 0?void 0:t.baseUrl)||IT}/${r}/${this.model}:${this.task}`;return this.stream&&(i+="?alt=sse"),i}}function ST(n){const e=[];return n?.apiClient&&e.push(n.apiClient),e.push(`${wT}/${vT}`),e.join(" ")}async function RT(n){var e;const t=new Headers;t.append("Content-Type","application/json"),t.append("x-goog-api-client",ST(n.requestOptions)),t.append("x-goog-api-key",n.apiKey);let r=(e=n.requestOptions)===null||e===void 0?void 0:e.customHeaders;if(r){if(!(r instanceof Headers))try{r=new Headers(r)}catch(s){throw new Lt(`unable to convert customHeaders value ${JSON.stringify(r)} to Headers: ${s.message}`)}for(const[s,i]of r.entries()){if(s==="x-goog-api-key")throw new Lt(`Cannot set reserved header name ${s}`);if(s==="x-goog-api-client")throw new Lt(`Header name ${s} can only be set using the apiClient field`);t.append(s,i)}}return t}async function CT(n,e,t,r,s,i){const a=new AT(n,e,t,r,i);return{url:a.toString(),fetchOptions:Object.assign(Object.assign({},NT(i)),{method:"POST",headers:await RT(a),body:s})}}async function Kr(n,e,t,r,s,i={},a=fetch){const{url:l,fetchOptions:u}=await CT(n,e,t,r,s,i);return bT(l,u,a)}async function bT(n,e,t=fetch){let r;try{r=await t(n,e)}catch(s){PT(s,n)}return r.ok||await kT(r,n),r}function PT(n,e){let t=n;throw t.name==="AbortError"?(t=new af(`Request aborted when fetching ${e.toString()}: ${n.message}`),t.stack=n.stack):n instanceof of||n instanceof Lt||(t=new Se(`Error fetching from ${e.toString()}: ${n.message}`),t.stack=n.stack),t}async function kT(n,e){let t="",r;try{const s=await n.json();t=s.error.message,s.error.details&&(t+=` ${JSON.stringify(s.error.details)}`,r=s.error.details)}catch{}throw new of(`Error fetching from ${e.toString()}: [${n.status} ${n.statusText}] ${t}`,n.status,n.statusText,r)}function NT(n){const e={};if(n?.signal!==void 0||n?.timeout>=0){const t=new AbortController;n?.timeout>=0&&setTimeout(()=>t.abort(),n.timeout),n?.signal&&n.signal.addEventListener("abort",()=>{t.abort()}),e.signal=t.signal}return e}function Da(n){return n.text=()=>{if(n.candidates&&n.candidates.length>0){if(n.candidates.length>1&&console.warn(`This response had ${n.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),bs(n.candidates[0]))throw new In(`${At(n)}`,n);return DT(n)}else if(n.promptFeedback)throw new In(`Text not available. ${At(n)}`,n);return""},n.functionCall=()=>{if(n.candidates&&n.candidates.length>0){if(n.candidates.length>1&&console.warn(`This response had ${n.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),bs(n.candidates[0]))throw new In(`${At(n)}`,n);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),wu(n)[0]}else if(n.promptFeedback)throw new In(`Function call not available. ${At(n)}`,n)},n.functionCalls=()=>{if(n.candidates&&n.candidates.length>0){if(n.candidates.length>1&&console.warn(`This response had ${n.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),bs(n.candidates[0]))throw new In(`${At(n)}`,n);return wu(n)}else if(n.promptFeedback)throw new In(`Function call not available. ${At(n)}`,n)},n}function DT(n){var e,t,r,s;const i=[];if(!((t=(e=n.candidates)===null||e===void 0?void 0:e[0].content)===null||t===void 0)&&t.parts)for(const a of(s=(r=n.candidates)===null||r===void 0?void 0:r[0].content)===null||s===void 0?void 0:s.parts)a.text&&i.push(a.text),a.executableCode&&i.push("\n```"+a.executableCode.language+`
`+a.executableCode.code+"\n```\n"),a.codeExecutionResult&&i.push("\n```\n"+a.codeExecutionResult.output+"\n```\n");return i.length>0?i.join(""):""}function wu(n){var e,t,r,s;const i=[];if(!((t=(e=n.candidates)===null||e===void 0?void 0:e[0].content)===null||t===void 0)&&t.parts)for(const a of(s=(r=n.candidates)===null||r===void 0?void 0:r[0].content)===null||s===void 0?void 0:s.parts)a.functionCall&&i.push(a.functionCall);if(i.length>0)return i}const OT=[Ar.RECITATION,Ar.SAFETY,Ar.LANGUAGE];function bs(n){return!!n.finishReason&&OT.includes(n.finishReason)}function At(n){var e,t,r;let s="";if((!n.candidates||n.candidates.length===0)&&n.promptFeedback)s+="Response was blocked",!((e=n.promptFeedback)===null||e===void 0)&&e.blockReason&&(s+=` due to ${n.promptFeedback.blockReason}`),!((t=n.promptFeedback)===null||t===void 0)&&t.blockReasonMessage&&(s+=`: ${n.promptFeedback.blockReasonMessage}`);else if(!((r=n.candidates)===null||r===void 0)&&r[0]){const i=n.candidates[0];bs(i)&&(s+=`Candidate was blocked due to ${i.finishReason}`,i.finishMessage&&(s+=`: ${i.finishMessage}`))}return s}function Mr(n){return this instanceof Mr?(this.v=n,this):new Mr(n)}function VT(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(n,e||[]),s,i=[];return s={},a("next"),a("throw"),a("return"),s[Symbol.asyncIterator]=function(){return this},s;function a(g){r[g]&&(s[g]=function(C){return new Promise(function(k,V){i.push([g,C,k,V])>1||l(g,C)})})}function l(g,C){try{u(r[g](C))}catch(k){_(i[0][3],k)}}function u(g){g.value instanceof Mr?Promise.resolve(g.value.v).then(d,f):_(i[0][2],g)}function d(g){l("next",g)}function f(g){l("throw",g)}function _(g,C){g(C),i.shift(),i.length&&l(i[0][0],i[0][1])}}const Au=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;function MT(n){const e=n.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})),t=FT(e),[r,s]=t.tee();return{stream:xT(r),response:LT(s)}}async function LT(n){const e=[],t=n.getReader();for(;;){const{done:r,value:s}=await t.read();if(r)return Da(UT(e));e.push(s)}}function xT(n){return VT(this,arguments,function*(){const t=n.getReader();for(;;){const{value:r,done:s}=yield Mr(t.read());if(s)break;yield yield Mr(Da(r))}})}function FT(n){const e=n.getReader();return new ReadableStream({start(r){let s="";return i();function i(){return e.read().then(({value:a,done:l})=>{if(l){if(s.trim()){r.error(new Se("Failed to parse stream"));return}r.close();return}s+=a;let u=s.match(Au),d;for(;u;){try{d=JSON.parse(u[1])}catch{r.error(new Se(`Error parsing JSON response: "${u[1]}"`));return}r.enqueue(d),s=s.substring(u[0].length),u=s.match(Au)}return i()}).catch(a=>{let l=a;throw l.stack=a.stack,l.name==="AbortError"?l=new af("Request aborted when reading from the stream"):l=new Se("Error reading from the stream"),l})}}})}function UT(n){const e=n[n.length-1],t={promptFeedback:e?.promptFeedback};for(const r of n){if(r.candidates){let s=0;for(const i of r.candidates)if(t.candidates||(t.candidates=[]),t.candidates[s]||(t.candidates[s]={index:s}),t.candidates[s].citationMetadata=i.citationMetadata,t.candidates[s].groundingMetadata=i.groundingMetadata,t.candidates[s].finishReason=i.finishReason,t.candidates[s].finishMessage=i.finishMessage,t.candidates[s].safetyRatings=i.safetyRatings,i.content&&i.content.parts){t.candidates[s].content||(t.candidates[s].content={role:i.content.role||"user",parts:[]});const a={};for(const l of i.content.parts)l.text&&(a.text=l.text),l.functionCall&&(a.functionCall=l.functionCall),l.executableCode&&(a.executableCode=l.executableCode),l.codeExecutionResult&&(a.codeExecutionResult=l.codeExecutionResult),Object.keys(a).length===0&&(a.text=""),t.candidates[s].content.parts.push(a)}s++}r.usageMetadata&&(t.usageMetadata=r.usageMetadata)}return t}async function cf(n,e,t,r){const s=await Kr(e,hn.STREAM_GENERATE_CONTENT,n,!0,JSON.stringify(t),r);return MT(s)}async function lf(n,e,t,r){const i=await(await Kr(e,hn.GENERATE_CONTENT,n,!1,JSON.stringify(t),r)).json();return{response:Da(i)}}function uf(n){if(n!=null){if(typeof n=="string")return{role:"system",parts:[{text:n}]};if(n.text)return{role:"system",parts:[n]};if(n.parts)return n.role?n:{role:"system",parts:n.parts}}}function Lr(n){let e=[];if(typeof n=="string")e=[{text:n}];else for(const t of n)typeof t=="string"?e.push({text:t}):e.push(t);return BT(e)}function BT(n){const e={role:"user",parts:[]},t={role:"function",parts:[]};let r=!1,s=!1;for(const i of n)"functionResponse"in i?(t.parts.push(i),s=!0):(e.parts.push(i),r=!0);if(r&&s)throw new Se("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!r&&!s)throw new Se("No content is provided for sending chat message.");return r?e:t}function $T(n,e){var t;let r={model:e?.model,generationConfig:e?.generationConfig,safetySettings:e?.safetySettings,tools:e?.tools,toolConfig:e?.toolConfig,systemInstruction:e?.systemInstruction,cachedContent:(t=e?.cachedContent)===null||t===void 0?void 0:t.name,contents:[]};const s=n.generateContentRequest!=null;if(n.contents){if(s)throw new Lt("CountTokensRequest must have one of contents or generateContentRequest, not both.");r.contents=n.contents}else if(s)r=Object.assign(Object.assign({},r),n.generateContentRequest);else{const i=Lr(n);r.contents=[i]}return{generateContentRequest:r}}function Su(n){let e;return n.contents?e=n:e={contents:[Lr(n)]},n.systemInstruction&&(e.systemInstruction=uf(n.systemInstruction)),e}function jT(n){return typeof n=="string"||Array.isArray(n)?{content:Lr(n)}:n}const Ru=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],qT={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function HT(n){let e=!1;for(const t of n){const{role:r,parts:s}=t;if(!e&&r!=="user")throw new Se(`First content should be with role 'user', got ${r}`);if(!mu.includes(r))throw new Se(`Each item should include role field. Got ${r} but valid roles are: ${JSON.stringify(mu)}`);if(!Array.isArray(s))throw new Se("Content should have 'parts' property with an array of Parts");if(s.length===0)throw new Se("Each Content should have at least one part");const i={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(const l of s)for(const u of Ru)u in l&&(i[u]+=1);const a=qT[r];for(const l of Ru)if(!a.includes(l)&&i[l]>0)throw new Se(`Content with role '${r}' can't contain '${l}' part`);e=!0}}function Cu(n){var e;if(n.candidates===void 0||n.candidates.length===0)return!1;const t=(e=n.candidates[0])===null||e===void 0?void 0:e.content;if(t===void 0||t.parts===void 0||t.parts.length===0)return!1;for(const r of t.parts)if(r===void 0||Object.keys(r).length===0||r.text!==void 0&&r.text==="")return!1;return!0}const bu="SILENT_ERROR";class GT{constructor(e,t,r,s={}){this.model=t,this.params=r,this._requestOptions=s,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=e,r?.history&&(HT(r.history),this._history=r.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(e,t={}){var r,s,i,a,l,u;await this._sendPromise;const d=Lr(e),f={safetySettings:(r=this.params)===null||r===void 0?void 0:r.safetySettings,generationConfig:(s=this.params)===null||s===void 0?void 0:s.generationConfig,tools:(i=this.params)===null||i===void 0?void 0:i.tools,toolConfig:(a=this.params)===null||a===void 0?void 0:a.toolConfig,systemInstruction:(l=this.params)===null||l===void 0?void 0:l.systemInstruction,cachedContent:(u=this.params)===null||u===void 0?void 0:u.cachedContent,contents:[...this._history,d]},_=Object.assign(Object.assign({},this._requestOptions),t);let g;return this._sendPromise=this._sendPromise.then(()=>lf(this._apiKey,this.model,f,_)).then(C=>{var k;if(Cu(C.response)){this._history.push(d);const V=Object.assign({parts:[],role:"model"},(k=C.response.candidates)===null||k===void 0?void 0:k[0].content);this._history.push(V)}else{const V=At(C.response);V&&console.warn(`sendMessage() was unsuccessful. ${V}. Inspect response object for details.`)}g=C}).catch(C=>{throw this._sendPromise=Promise.resolve(),C}),await this._sendPromise,g}async sendMessageStream(e,t={}){var r,s,i,a,l,u;await this._sendPromise;const d=Lr(e),f={safetySettings:(r=this.params)===null||r===void 0?void 0:r.safetySettings,generationConfig:(s=this.params)===null||s===void 0?void 0:s.generationConfig,tools:(i=this.params)===null||i===void 0?void 0:i.tools,toolConfig:(a=this.params)===null||a===void 0?void 0:a.toolConfig,systemInstruction:(l=this.params)===null||l===void 0?void 0:l.systemInstruction,cachedContent:(u=this.params)===null||u===void 0?void 0:u.cachedContent,contents:[...this._history,d]},_=Object.assign(Object.assign({},this._requestOptions),t),g=cf(this._apiKey,this.model,f,_);return this._sendPromise=this._sendPromise.then(()=>g).catch(C=>{throw new Error(bu)}).then(C=>C.response).then(C=>{if(Cu(C)){this._history.push(d);const k=Object.assign({},C.candidates[0].content);k.role||(k.role="model"),this._history.push(k)}else{const k=At(C);k&&console.warn(`sendMessageStream() was unsuccessful. ${k}. Inspect response object for details.`)}}).catch(C=>{C.message!==bu&&console.error(C)}),g}}async function WT(n,e,t,r){return(await Kr(e,hn.COUNT_TOKENS,n,!1,JSON.stringify(t),r)).json()}async function zT(n,e,t,r){return(await Kr(e,hn.EMBED_CONTENT,n,!1,JSON.stringify(t),r)).json()}async function KT(n,e,t,r){const s=t.requests.map(a=>Object.assign(Object.assign({},a),{model:e}));return(await Kr(e,hn.BATCH_EMBED_CONTENTS,n,!1,JSON.stringify({requests:s}),r)).json()}class Pu{constructor(e,t,r={}){this.apiKey=e,this._requestOptions=r,t.model.includes("/")?this.model=t.model:this.model=`models/${t.model}`,this.generationConfig=t.generationConfig||{},this.safetySettings=t.safetySettings||[],this.tools=t.tools,this.toolConfig=t.toolConfig,this.systemInstruction=uf(t.systemInstruction),this.cachedContent=t.cachedContent}async generateContent(e,t={}){var r;const s=Su(e),i=Object.assign(Object.assign({},this._requestOptions),t);return lf(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(r=this.cachedContent)===null||r===void 0?void 0:r.name},s),i)}async generateContentStream(e,t={}){var r;const s=Su(e),i=Object.assign(Object.assign({},this._requestOptions),t);return cf(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(r=this.cachedContent)===null||r===void 0?void 0:r.name},s),i)}startChat(e){var t;return new GT(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(t=this.cachedContent)===null||t===void 0?void 0:t.name},e),this._requestOptions)}async countTokens(e,t={}){const r=$T(e,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),s=Object.assign(Object.assign({},this._requestOptions),t);return WT(this.apiKey,this.model,r,s)}async embedContent(e,t={}){const r=jT(e),s=Object.assign(Object.assign({},this._requestOptions),t);return zT(this.apiKey,this.model,r,s)}async batchEmbedContents(e,t={}){const r=Object.assign(Object.assign({},this._requestOptions),t);return KT(this.apiKey,this.model,e,r)}}class QT{constructor(e){this.apiKey=e}getGenerativeModel(e,t){if(!e.model)throw new Se("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new Pu(this.apiKey,e,t)}getGenerativeModelFromCachedContent(e,t,r){if(!e.name)throw new Lt("Cached content must contain a `name` field.");if(!e.model)throw new Lt("Cached content must contain a `model` field.");const s=["model","systemInstruction"];for(const a of s)if(t?.[a]&&e[a]&&t?.[a]!==e[a]){if(a==="model"){const l=t.model.startsWith("models/")?t.model.replace("models/",""):t.model,u=e.model.startsWith("models/")?e.model.replace("models/",""):e.model;if(l===u)continue}throw new Lt(`Different value for "${a}" specified in modelParams (${t[a]}) and cachedContent (${e[a]})`)}const i=Object.assign(Object.assign({},t),{model:e.model,tools:e.tools,toolConfig:e.toolConfig,systemInstruction:e.systemInstruction,cachedContent:e});return new Pu(this.apiKey,i,r)}}const YT=n=>new Promise(e=>setTimeout(e,n)),hf=async(n,e,t)=>{if(!n)return null;const r=new QT(n.trim()),s=["gemini-2.0-flash","gemini-1.5-flash","gemini-1.5-pro"];for(const i of s)for(let a=1;a<=2;a++)try{console.log(`[POST-ENTRY] AI HUNT: ${i} (Attempt ${a})...`);const l=r.getGenerativeModel({model:i}),u=`Analyze this food input: "${e}". 
        SEARCH INTENT: Identify the exact branded product if possible.
        
        CRITICAL NUTRITION RULES:
        1. serving_size: Use the PACKAGE SUGGESTED SERVING (e.g., "1 oz", "approx 7 grapes", "1 pouch"). 
        2. DO NOT use "100g" unless it is explicitly a raw ingredient like flour/rice. 
        3. If vague, assume a "Single Normal Portion".
        4. For "Fruit Riot", use 1 oz (approx 45-50 kcals).

        RETURN JSON:
        { 
          "name": "Specific Product Name", 
          "calories": number, 
          "protein": number_float, 
          "carbs": number_float, 
          "fat": number_float, 
          "category": "Snack", 
          "serving_size": "string",
          "photoSearchQuery": "string_optimized_for_image_search"
        }`,d=t==="photo"?[{text:u},{inlineData:{data:e,mimeType:"image/jpeg"}}]:u,C=(await(await l.generateContent(d)).response).text().match(/\{[\s\S]*\}/);if(C)return console.log(`[POST-ENTRY] Success with ${i}!`),JSON.parse(C[0])}catch(l){if(l.message.includes("429")||l.message.includes("Quota")){console.warn(`[POST-ENTRY] ${i} Rate Limited. Waiting 5s...`),await YT(5e3);continue}if(l.message.includes("404")){console.warn(`[POST-ENTRY] ${i} not found.`);break}console.warn(`[POST-ENTRY] Error: ${i}`,l.message)}return null},JT=async n=>{try{const t=await(await fetch(`https://world.openfoodfacts.org/api/v0/product/${n}.json`)).json();if(t.status===1&&t.product){const r=t.product,s=r.nutriments||{},i=r.serving_size||"100g";let a=s["energy-kcal_serving"]||s["energy-kcal_value"]||0,l=s.proteins_serving||s.proteins_value||0,u=s.carbohydrates_serving||s.carbohydrates_value||0,d=s.fat_serving||s.fat_value||0;a=Math.round(Number(a)||0),l=Math.round(Number(l)||0),u=Math.round(Number(u)||0),d=Math.round(Number(d)||0);const f=r.image_url||r.image_front_url||null;return{name:r.product_name||"Unknown Product",calories:a,protein:l,carbs:u,fat:d,category:"Snack",serving_size:i,stockPhoto:f}}return null}catch(e){return console.error("OpenFoodFacts Lookup Error:",e),null}},XT=async n=>{try{console.log("Call...");const t=await _T(ET,"searchFatSecret")({upc:n});return console.log("Result:",t.data),t.data}catch(e){return console.error("Cloud Function Error:",e),null}};let de=null,tt=new Date().toISOString().split("T")[0],z={geminiKey:"",calGoal:2e3,startWeight:180,goalWeight:160},Do={Breakfast:!0,Lunch:!0,Dinner:!0,Snack:!0},Ei=[],Bn=[],ct="history",Sn=!1,Pt=new Set,pt=[],Sr=null,A={};function ZT(){A={authScreen:document.getElementById("auth-screen"),app:document.getElementById("app"),loginBtn:document.getElementById("login-btn"),logoutBtn:document.getElementById("logout-btn"),settingsBtn:document.getElementById("settings-btn"),searchBtn:document.getElementById("search-btn"),navItems:document.querySelectorAll(".nav-item"),views:{journal:document.getElementById("journal-view"),weight:document.getElementById("weight-view"),favorites:document.getElementById("favorites-view"),shopping:document.getElementById("shopping-view")},prevDay:document.getElementById("prev-day"),nextDay:document.getElementById("next-day"),dateDisplay:document.getElementById("current-date-display"),datePickerHidden:document.getElementById("date-picker-hidden"),totalCals:document.getElementById("total-calories"),goalCals:document.getElementById("goal-calories-display"),totalPro:document.getElementById("total-protein"),goalPro:document.getElementById("goal-protein-display"),calBar:document.getElementById("cal-progress-bar"),proBar:document.getElementById("pro-progress-bar"),waterCard:document.getElementById("water-card"),currentWater:document.getElementById("current-water"),goalWater:document.getElementById("goal-water"),waterBar:document.getElementById("water-progress-bar"),waterBtns:document.querySelectorAll(".water-btn"),resetWater:document.getElementById("reset-water"),logBtn:document.getElementById("log-btn"),textLog:document.getElementById("text-log"),voiceBtn:document.getElementById("voice-btn"),photoBtn:document.getElementById("photo-btn"),openFavsLogBtn:document.getElementById("open-favs-log-btn"),favsDropdown:document.getElementById("favs-dropdown"),favsDropdownList:document.getElementById("favs-dropdown-list"),categorizedMeals:document.getElementById("categorized-meals"),favoritesList:document.getElementById("favorites-list"),confirmModal:document.getElementById("confirm-modal"),confirmImgPreview:document.getElementById("confirm-img-preview"),confirmName:document.getElementById("confirm-name"),confirmCalories:document.getElementById("confirm-calories"),confirmProtein:document.getElementById("confirm-protein"),confirmCarbs:document.getElementById("confirm-carbs"),confirmFat:document.getElementById("confirm-fat"),confirmCategory:document.getElementById("confirm-category"),saveConfirm:document.getElementById("save-confirm"),saveAsFavBtn:document.getElementById("save-as-fav-btn"),deleteBtn:document.getElementById("delete-btn"),loadingOverlay:document.getElementById("loading-overlay"),searchModal:document.getElementById("search-modal"),globalSearchInput:document.getElementById("global-search-input"),searchResults:document.getElementById("search-results"),closeSearch:document.getElementById("close-search"),addCheckinBtn:document.getElementById("add-checkin-btn"),checkinHistoryList:document.getElementById("checkin-history"),goalProgress:document.getElementById("goal-progress"),currentWeightDisplay:document.getElementById("current-weight"),goalWeightDisplay:document.getElementById("goal-weight"),logSearchBtn:document.getElementById("log-search-btn"),searchTabHistory:document.getElementById("search-tab-history"),searchTabWeb:document.getElementById("search-tab-web"),triggerAiSearch:document.getElementById("trigger-ai-search"),aiSearchPrompt:document.getElementById("ai-search-prompt"),confirmTitle:document.getElementById("confirm-title"),barcodeBtn:document.getElementById("barcode-btn"),barcodeModal:document.getElementById("barcode-modal"),closeBarcodeModal:document.getElementById("close-barcode-modal"),manualBarcodeInput:document.getElementById("manual-barcode-input"),manualBarcodeSubmit:document.getElementById("manual-barcode-submit")}}function ev(){ZT(),tv(),LE(me,async n=>{n?(A.authScreen&&(A.authScreen.style.display="none"),A.app&&(A.app.style.display="block"),await kt()):(A.authScreen&&(A.authScreen.style.display="flex"),A.app&&(A.app.style.display="none"))})}function tv(){A.loginBtn&&(A.loginBtn.onclick=()=>rI(me,new it)),A.logoutBtn&&(A.logoutBtn.onclick=()=>xE(me)),A.prevDay&&(A.prevDay.onclick=()=>Nu(-1)),A.nextDay&&(A.nextDay.onclick=()=>Nu(1)),A.dateDisplay&&(A.dateDisplay.onclick=()=>A.datePickerHidden.showPicker()),A.datePickerHidden&&(A.datePickerHidden.onchange=u=>{tt=u.target.value,Oa(),Nt()}),A.navItems&&A.navItems.forEach(u=>{u.onclick=d=>{d.preventDefault(),rv(u.getAttribute("data-tab"))}}),A.logBtn&&(A.logBtn.onclick=()=>Ys("text")),A.textLog&&(A.textLog.onkeypress=u=>{u.key==="Enter"&&Ys("text")}),A.voiceBtn&&(A.voiceBtn.onclick=cv),A.photoBtn&&(A.photoBtn.onclick=()=>document.getElementById("photo-modal").style.display="flex"),A.barcodeBtn&&(A.barcodeBtn.onclick=lv),A.closeBarcodeModal&&(A.closeBarcodeModal.onclick=df),A.manualBarcodeSubmit&&(A.manualBarcodeSubmit.onclick=()=>Vo(A.manualBarcodeInput.value.trim())),A.manualBarcodeInput&&(A.manualBarcodeInput.onkeypress=u=>{u.key==="Enter"&&Vo(A.manualBarcodeInput.value.trim())});const n=document.getElementById("close-photo-modal");n&&(n.onclick=()=>document.getElementById("photo-modal").style.display="none");const e=document.getElementById("take-photo-btn"),t=document.getElementById("choose-photo-btn");e&&(e.onclick=()=>{document.getElementById("photo-modal").style.display="none",document.getElementById("camera-input").click()}),t&&(t.onclick=()=>{document.getElementById("photo-modal").style.display="none",document.getElementById("file-input").click()});const r=document.getElementById("cancel-confirm");r&&(r.onclick=()=>A.confirmModal.style.display="none"),A.openFavsLogBtn&&(A.openFavsLogBtn.onclick=u=>{u.stopPropagation();const d=A.favsDropdown;if(!d)return;const f=d.style.display==="block";d.style.display=f?"none":"block",f||iv()}),document.addEventListener("click",()=>{A.favsDropdown&&(A.favsDropdown.style.display="none")}),A.saveConfirm&&(A.saveConfirm.onclick=async()=>{if(!de)return;const u=ku();oe(!0),de.id?await he.updateMeal(de.id,u):await he.addMeal(u),await Nt(),oe(!1),A.confirmModal.style.display="none"}),A.saveAsFavBtn&&(A.saveAsFavBtn.onclick=async()=>{if(!de)return;const u=prompt("Name favorite:",de.name);if(!u)return;const d=ku();oe(!0),await he.addFavorite({...d,name:u}),await kt(),oe(!1)}),A.deleteBtn&&(A.deleteBtn.onclick=async()=>{!de||!de.id||confirm("Delete?")&&(oe(!0),await he.deleteMeal(de.id),await Nt(),oe(!1),A.confirmModal.style.display="none")}),A.searchBtn&&(A.searchBtn.onclick=()=>{A.searchModal.style.display="flex",ct="history",_s(),fr("")}),A.logSearchBtn&&(A.logSearchBtn.onclick=()=>{A.searchModal.style.display="flex",ct="history",_s(),fr("")}),A.searchTabHistory&&(A.searchTabHistory.onclick=()=>{ct="history",_s(),fr(A.globalSearchInput.value)}),A.searchTabWeb&&(A.searchTabWeb.onclick=()=>{ct="web",_s(),fr(A.globalSearchInput.value)}),A.triggerAiSearch&&(A.triggerAiSearch.onclick=()=>nv()),A.closeSearch&&(A.closeSearch.onclick=()=>A.searchModal.style.display="none"),A.globalSearchInput&&(A.globalSearchInput.oninput=u=>fr(u.target.value)),A.settingsBtn&&(A.settingsBtn.onclick=()=>{document.getElementById("settings-modal").style.display="flex",document.getElementById("api-key").value=z.geminiKey,document.getElementById("cal-goal-input").value=z.calGoal,document.getElementById("goal-weight-input").value=z.goalWeight,document.getElementById("start-weight-input").value=z.startWeight});const s=document.getElementById("close-settings");s&&(s.onclick=()=>document.getElementById("settings-modal").style.display="none");const i=document.getElementById("save-settings");i&&(i.onclick=async()=>{z.geminiKey=document.getElementById("api-key").value.trim(),z.calGoal=parseInt(document.getElementById("cal-goal-input").value)||2e3,z.goalWeight=parseFloat(document.getElementById("goal-weight-input").value)||160,z.startWeight=parseFloat(document.getElementById("start-weight-input").value)||180,await he.saveSettings(z),localStorage.setItem("gemini_key",z.geminiKey),await kt(),document.getElementById("settings-modal").style.display="none"}),A.waterBtns&&A.waterBtns.forEach(u=>{u.onclick=async d=>{d.stopPropagation();const f=parseInt(u.getAttribute("data-amt")),_=Math.max(0,parseInt(A.currentWater.textContent)+f);A.currentWater.textContent=_,Oo(_),await he.setWater(tt,_)}}),A.resetWater&&(A.resetWater.onclick=async u=>{u.stopPropagation(),confirm("Reset water?")&&(A.currentWater.textContent=0,Oo(0),await he.setWater(tt,0))});const a=document.getElementById("bulk-select-btn");a&&(a.onclick=()=>{Sn=!Sn,Pt.clear(),document.getElementById("bulk-actions").style.display=Sn?"block":"none",Nt()});const l=document.getElementById("save-bulk-fav-btn");l&&(l.onclick=async()=>{if(Pt.size===0)return;const u=prompt("Group name:");if(!u)return;const f=Bn.filter(_=>Pt.has(_.id)).reduce((_,g)=>({calories:_.calories+g.calories,protein:_.protein+(g.protein||0),carbs:_.carbs+(g.carbs||0),fat:_.fat+(g.fat||0)}),{calories:0,protein:0,carbs:0,fat:0});oe(!0),await he.addFavorite({...f,name:u,category:"Lunch",stockPhoto:`https://source.unsplash.com/featured/?${encodeURIComponent(u)},food`}),Sn=!1,Pt.clear(),document.getElementById("bulk-actions").style.display="none",await kt(),oe(!1)}),A.addCheckinBtn&&(A.addCheckinBtn.onclick=async()=>{const u=prompt("Weight:");if(!u||isNaN(u))return;const d=new Date,f=new Date(d);f.setDate(d.getDate()-d.getDay()),oe(!0),await he.addCheckin({weight:parseFloat(u),date:f.toISOString().split("T")[0]}),await kt(),oe(!1)})}function ku(){return{name:A.confirmName.value,calories:parseInt(A.confirmCalories.value),protein:parseInt(A.confirmProtein.value)||0,carbs:parseInt(A.confirmCarbs.value)||0,fat:parseInt(A.confirmFat.value)||0,category:A.confirmCategory.value,stockPhoto:de.stockPhoto,timestamp:de.timestamp||new Date().toISOString()}}async function Ys(n,e=null){oe(!0);try{let t=n==="text"?A.textLog.value.trim():e;const r=/^\d{8,14}$/;let s=null;if(n==="text"&&r.test(t)){console.log("Stage 1: Checking Barcode Databases..."),console.log("Checking UPC:",t);try{s=await JT(t)}catch(i){console.error(i)}if(s&&console.log("Found in OpenFoodFacts"),!s){console.log("Stage 2: Barcode lookup failed. Falling back to AI Search..."),console.log("Checking FatSecret...");try{s=await XT(t)}catch(i){console.error(i)}s&&console.log("Found in FatSecret")}}if(s||(console.log("Stage 2: Barcode lookup failed. Falling back to AI Search..."),z.geminiKey&&(s=await hf(z.geminiKey,t,n))),!s&&!z.geminiKey&&alert("Product not found in database and AI is disabled (API Key missing)."),s&&typeof s=="object")if(Array.isArray(s)&&s.length>1)showSearchResultsModal(s);else{const i=Array.isArray(s)?s[0]:s;let a=i.stockPhoto;a||(a=`https://source.unsplash.com/featured/?${encodeURIComponent(i.photoSearchQuery||i.name)},food`),de={...i,stockPhoto:a},Qr(de,!1)}}catch(t){console.error(t)}finally{oe(!1)}}function Qr(n,e){A.confirmTitle.textContent=e?"Edit":"Confirm",A.confirmName.value=n.name,A.confirmCalories.value=n.calories,A.confirmProtein.value=n.protein||0,A.confirmCarbs.value=n.carbs||0,A.confirmFat.value=n.fat||0,A.confirmCategory.value=n.category||"Lunch",A.confirmImgPreview.style.backgroundImage=`url('${n.stockPhoto}')`,A.deleteBtn.style.display=e?"flex":"none",A.confirmModal.style.display="flex"}function _s(){A.searchTabHistory.classList.toggle("active-tab",ct==="history"),A.searchTabWeb.classList.toggle("active-tab",ct==="web"),A.aiSearchPrompt.style.display=ct==="web"?"block":"none",A.searchResults.style.display=ct==="history"?"flex":"none"}async function fr(n){if(ct==="web")return;let e=[];n.length<1?e=Bn.slice().sort((s,i)=>new Date(i.timestamp)-new Date(s.timestamp)).slice(0,10):e=Bn.filter(s=>s.name.toLowerCase().includes(n.toLowerCase())).slice(0,10);const t=[],r=new Set;e.forEach(s=>{r.has(s.name.toLowerCase())||(r.add(s.name.toLowerCase()),t.push(s))}),A.searchResults.innerHTML=t.map(s=>`
    <div class="search-item glass" onclick="window.quickLog('${s.id||""}')">
      <div><strong>${s.name}</strong><small>${s.calories} kcal | ${s.category}</small></div>
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>
    </div>`).join("")||"<p style='text-align:center; padding: 20px; color: var(--text-dim)'>No recent history found.</p>"}async function nv(){const n=A.globalSearchInput.value.trim();if(!n)return alert("Type what you're looking for first!");oe(!0);try{const e=await hf(z.geminiKey,n,"text");!e&&!z.geminiKey&&alert("Product not found in database and AI is disabled (API Key missing)."),e&&typeof e=="object"&&(de={...e,stockPhoto:`https://source.unsplash.com/featured/?${encodeURIComponent(e.photoSearchQuery||e.name)},food`},Qr(de,!1),A.searchModal.style.display="none")}catch(e){console.error(e),alert("AI Search failed. Check API Key.")}finally{oe(!1)}}window.quickLog=n=>{const e=Bn.find(t=>t.id===n);e&&(de={...e,timestamp:new Date().toISOString()},Qr(de,!1),A.searchModal.style.display="none")};async function kt(){const n=await he.getSettings();n.calGoal&&(z={...z,...n});const e="AIzaSyD6s0xCW1r55msAUQAnO_LQ2EqHUwuefMI";(!z.geminiKey||z.geminiKey.length<10)&&(console.log("AI: Syncing new API key from environment..."),z.geminiKey=e,he.saveSettings(z)),Ei=await he.getFavorites(),Bn=await he.getMeals(),pt=await he.getCheckins(),Oa(),await Nt(),await sv(),av(),ov()}function rv(n){Object.keys(A.views).forEach(e=>{A.views[e]&&(A.views[e].style.display=e===n?"block":"none")}),A.navItems&&A.navItems.forEach(e=>e.classList.toggle("active",e&&e.getAttribute("data-tab")===n))}async function Nt(){const n=await he.getMeals(tt),e=await he.getWater(tt);A.currentWater&&(A.currentWater.textContent=e),Oo(e);const t={Breakfast:[],Lunch:[],Dinner:[],Snack:[]};let r=0,s=0;n.forEach(l=>{r+=l.calories,s+=l.protein||0,t[l.category]?t[l.category].push(l):t.Snack.push(l)});const i=pt.length>0?pt[0].weight:z.startWeight||180,a=Math.round(i*.825);A.totalCals&&(A.totalCals.textContent=r),A.totalPro&&(A.totalPro.textContent=s),A.goalCals&&(A.goalCals.textContent=z.calGoal),A.goalPro&&(A.goalPro.textContent=a),A.calBar&&(A.calBar.style.width=`${Math.min(100,r/z.calGoal*100)}%`),A.proBar&&(A.proBar.style.width=`${Math.min(100,s/a*100)}%`),A.categorizedMeals&&(A.categorizedMeals.innerHTML=Object.keys(t).map(l=>`
    <div class="category-section glass ${Do[l]?"":"collapsed"}">
      <div class="category-header" onclick="window.toggleCat('${l}')">
        <h4><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="chevron"><polyline points="6 9 12 15 18 9"></polyline></svg> ${l}</h4>
        <span>${t[l].length} items  ${t[l].reduce((u,d)=>u+d.calories,0)} kcal</span>
      </div>
      <div class="category-content">
        ${t[l].map(u=>`
          <div class="meal-item glass" onclick="${Sn?`window.toggleSelect('${u.id||""}')`:`window.editMeal('${u.id||""}')`}">
            ${Sn?`<div style="padding:15px; border-right:1px solid var(--glass-border)"><input type="checkbox" ${Pt.has(u.id)?"checked":""} /></div>`:""}
            <div class="meal-photo" style="background-image: url('${u.stockPhoto}')"></div>
            <div class="meal-details"><strong>${u.name}</strong><br><small>${u.calories} kcal | P:${u.protein}g</small></div>
          </div>
        `).join("")}
      </div>
    </div>`).join(""))}window.toggleCat=n=>{Do[n]=!Do[n],Nt()};window.editMeal=n=>{const e=Bn.find(t=>t.id===n);e&&(de=e,Qr(e,!0))};window.toggleSelect=n=>{Pt.has(n)?Pt.delete(n):Pt.add(n),Nt()};window.logFav=async n=>{const e=Ei.find(t=>t.id===n);e&&(oe(!0),await he.addMeal({...e,timestamp:new Date().toISOString(),id:null}),await kt(),oe(!1))};window.deleteFav=async n=>{confirm("Delete?")&&(oe(!0),await he.deleteFavorite(n),await kt(),oe(!1))};async function sv(){A.favoritesList&&(A.favoritesList.innerHTML=Ei.map(n=>`
    <div class="fav-item glass" style="padding:15px; margin-bottom:10px; display:flex; justify-content:space-between; align-items:center;">
      <div><strong>${n.name}</strong><br><small>${n.calories} kcal</small></div>
      <div style="display:flex; gap:10px;"><button class="primary" onclick="window.logFav('${n.id}')">Add</button><button class="glass" onclick="window.deleteFav('${n.id}')">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"></path><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
      </button></div>
    </div>`).join("")||"<p style='text-align:center; padding:20px;'>None</p>")}function iv(){A.favsDropdownList&&(A.favsDropdownList.innerHTML=Ei.map(n=>`<div class="fav-drop-item" onclick="window.logFav('${n.id}')" style="padding:10px; cursor:pointer; border-bottom:1px solid rgba(255,255,255,0.05)">${n.name}</div>`).join("")||"<div style='padding:10px'>Empty</div>")}function ov(){if(A.checkinHistoryList){if(pt.length===0){A.checkinHistoryList.innerHTML='<p style="text-align: center; color: var(--text-dim); padding: 20px;">No check-ins.</p>';return}A.checkinHistoryList.innerHTML=pt.map(n=>`
    <div class="checkin-item glass" style="display: flex; justify-content: space-between; align-items: center; padding: 12px 16px; margin-bottom: 10px;">
      <div><strong>${n.weight} lbs</strong><br><small>${new Date(n.date+"T12:00:00").toLocaleDateString()}</small></div>
      <button class="icon-sm glass" style="color: #ef4444;" onclick="window.deleteCheckin('${n.id}')">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"></path><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
      </button>
    </div>`).join("")}}window.deleteCheckin=async n=>{confirm("Delete?")&&(oe(!0),await he.deleteCheckin(n),await kt(),oe(!1))};function Oa(){A.dateDisplay&&(A.dateDisplay.textContent=tt===new Date().toISOString().split("T")[0]?"Today":new Date(tt+"T12:00:00").toLocaleDateString()),A.datePickerHidden&&(A.datePickerHidden.value=tt)}function Nu(n){const e=new Date(tt+"T12:00:00");e.setDate(e.getDate()+n),tt=e.toISOString().split("T")[0],Oa(),Nt()}function Oo(n){const e=pt.length>0?pt[0].weight:z.startWeight||180,t=Math.round(e*.5);A.goalWater&&(A.goalWater.textContent=t),A.waterBar&&(A.waterBar.style.width=`${Math.min(100,n/t*100)}%`)}function av(){const n=pt.length>0?pt[0].weight:z.startWeight||"--";if(A.currentWeightDisplay&&(A.currentWeightDisplay.textContent=n+(n!=="--"?" lbs":"")),A.goalWeightDisplay&&(A.goalWeightDisplay.textContent=z.goalWeight+" lbs"),z.goalWeight&&z.startWeight&&n!=="--"&&A.goalProgress){const e=Math.min(100,Math.abs(z.startWeight-n)/Math.abs(z.startWeight-z.goalWeight)*100);A.goalProgress.style.width=e+"%"}}function oe(n){A.loadingOverlay&&(A.loadingOverlay.style.display=n?"flex":"none")}function cv(){const n=window.SpeechRecognition||window.webkitSpeechRecognition;if(!n)return alert("No support");const e=new n;e.onresult=t=>{A.textLog.value=t.results[0][0].transcript,Ys("text")},e.start()}async function lv(){A.barcodeModal.style.display="flex",Sr=new Html5Qrcode("barcode-reader");const n={fps:10,qrbox:{width:250,height:150}};try{await Sr.start({facingMode:"environment"},n,e=>{console.log("Barcode Scanned:",e),Vo(e)})}catch(e){console.error("Scanner Error:",e),alert("Camera access failed. Use manual entry.")}}async function df(){if(A.barcodeModal.style.display="none",Sr)try{await Sr.stop(),Sr=null}catch(n){console.error(n)}}async function Vo(n){n&&(await df(),Ys("text",n))}ev();window.showSearchResultsModal=n=>{const e=document.getElementById("search-modal"),t=document.getElementById("search-results");t.innerHTML="",n.forEach(r=>{const s=document.createElement("div");s.className="search-item glass",s.style.padding="15px",s.style.cursor="pointer",s.innerHTML=`
      <div style="font-weight:bold; color:var(--primary);">${r.name}</div>
      <div style="font-size:0.85rem; color:var(--text-dim);">
        ${r.calories} kcal | P:${r.protein||0}g C:${r.carbs||0}g F:${r.fat||0}g
      </div>
    `,s.onclick=()=>{de={...r,stockPhoto:r.stockPhoto||`https://source.unsplash.com/featured/?${encodeURIComponent(r.photoSearchQuery||r.name)},food`},e.style.display="none",Qr(de,!1)},t.appendChild(s)}),document.getElementById("search-tabs").style.display="none",document.getElementById("ai-search-prompt").style.display="none",document.getElementById("global-search-input").placeholder="Select a match...",e.style.display="flex"};
